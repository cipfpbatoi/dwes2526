
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cipfpbatoi.github.io/dwes2526/1val.html">
      
      
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>El llenguatge PHP - Desenvolupament web en entorn de Servidor</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-X6D0LR7TC8"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-X6D0LR7TC8",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-X6D0LR7TC8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#el-llenguatge-php" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="index.html" title="Desenvolupament web en entorn de Servidor" class="md-header__button md-logo" aria-label="Desenvolupament web en entorn de Servidor" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desenvolupament web en entorn de Servidor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              El llenguatge PHP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode nit"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canviar a mode nit" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Desenvolupament web en entorn de Servidor" class="md-nav__button md-logo" aria-label="Desenvolupament web en entorn de Servidor" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    Desenvolupament web en entorn de Servidor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01arquitecturas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.- Arquitectures Web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02php.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.- Programació web amb PHP
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03MVC_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.- Arquitectura MVC amb Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04dades_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.- Accés segur i estructurat a bases de dades amb Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05seguretat_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.- Aplicacions segures i reactives en Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06Nodejs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.- Desenvolupament d'APIs REST amb Node.js
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="el-llenguatge-php">El llenguatge PHP<a class="headerlink" href="#el-llenguatge-php" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duració i criteris d'avaluació</summary>
<p>Duració estimada: 20 hores</p>
<hr />
<table>
<thead>
<tr>
<th>Resultat d'aprenentatge</th>
<th>Criteris d'avaluació</th>
</tr>
</thead>
<tbody>
<tr>
<td>2. Escriu sentències executables per un servidor Web reconeixent i aplicant procediments d'integració del codi en llenguatges de marques.</td>
<td>a) S'han reconegut els mecanismes de generació de pàgines Web a partir de llenguatges de marques amb codi embegut. <br/> b) S'han identificat les principals tecnologies associades.  <br/> c) S'han utilitzat etiquetes per a la inclusió de codi en el llenguatge de marques.  <br/> d) S'ha reconegut la sintaxi del llenguatge de programació que s'ha d'utilitzar.  <br/> e) S'han escrit sentències simples i s'ha comprovat els seus efectes en el document resultant.  <br/> f) S'han utilitzat directives per a modificar el comportament predeterminat.  <br/> g) S'han utilitzat els diferents tipus de variables i operadors disponibles en el llenguatge.  <br/> h) S'han identificat els àmbits d'utilització de les variables.  <br/></td>
</tr>
<tr>
<td>3. Genera pàgines web de forma dinàmica seguint especificacions rebudes.</td>
<td>a) S'han identificat els mecanismes de separació de la lògica de negoci.<br/>b) S'han utilitzat tecnologies adequades per a la generació dinàmica de pàgines web.<br/>c) S'han utilitzat tècniques d'accés a dades.<br/>d) S'han generat pàgines web dinàmiques que compleixen amb les especificacions rebudes.<br/>e) S'ha comprovat el funcionament de les pàgines web generades.<br/>f) S'han seguit les convencions de format i codificació establertes.</td>
</tr>
</tbody>
</table>
</details>
<h2 id="1-introduccio-a-php">1. Introducció a PHP<a class="headerlink" href="#1-introduccio-a-php" title="Permanent link">&para;</a></h2>
<h4 id="que-es-php">Què és PHP?<a class="headerlink" href="#que-es-php" title="Permanent link">&para;</a></h4>
<p><strong>PHP</strong> (Hypertext Preprocessor) és un llenguatge de programació de codi obert, especialment dissenyat per al desenvolupament web del costat del servidor. Es pot incrustar fàcilment en codi HTML, cosa que el fa una opció popular per crear aplicacions web dinàmiques i interactives. PHP s'utilitza per gestionar el contingut dinàmic, les bases de dades, el seguiment de sessions i fins i tot per crear aplicacions completes.</p>
<h4 id="historia-de-php">Història de PHP<a class="headerlink" href="#historia-de-php" title="Permanent link">&para;</a></h4>
<p>PHP (Hypertext Preprocessor) és un llenguatge de programació de codi obert creat l'any 1994 per Rasmus Lerdorf. La primera versió pública va ser PHP/FI (Personal Home Page/Forms Interpreter), que va evolucionar fins a convertir-se en PHP 3 el 1998, el qual va ser completament reescrit per Zeev Suraski i Andi Gutmans.</p>
<p>Actualment, PHP és mantingut per The PHP Group i la versió estable més recent (a partir de juliol de 2024) és PHP 8.3. Aquesta versió inclou millores en el rendiment, noves funcions com les propietats llegibles i escriptibles per tipus, expressió <code>match</code>, i molt més.</p>
<h4 id="importancia-en-el-desenvolupament-web">Importància en el desenvolupament web<a class="headerlink" href="#importancia-en-el-desenvolupament-web" title="Permanent link">&para;</a></h4>
<p>PHP és un dels llenguatges més utilitzats en el desenvolupament web per diverses raons:</p>
<ul>
<li><strong>Facilitat d'aprenentatge:</strong> PHP és relativament fàcil d'aprendre per als principiants en programació web. La seva sintaxi és senzilla i similar a altres llenguatges com C i Perl.</li>
<li><strong>Gran comunitat i suport:</strong> PHP té una gran comunitat de desenvolupadors que proporcionen suport, biblioteques, extensions i eines. A més, hi ha nombrosos recursos en línia, tutorials i documentació.</li>
<li><strong>Integració amb bases de dades:</strong> PHP es pot integrar fàcilment amb una àmplia varietat de bases de dades, cosa que el fa ideal per a aplicacions web basades en dades.</li>
<li><strong>Flexibilitat i escalabilitat:</strong> PHP és altament flexible i es pot utilitzar per desenvolupar tant aplicacions petites com projectes grans i complexos. També és escalable, cosa que permet gestionar un gran volum de trànsit.</li>
<li><strong>Cost efectiu:</strong> Com que és de codi obert, PHP és gratuït per utilitzar i distribuir. Això redueix els costos de desenvolupament per a les empreses i els desenvolupadors.</li>
</ul>
<h4 id="exemple-de-codi-php-simple">Exemple de codi PHP simple<a class="headerlink" href="#exemple-de-codi-php-simple" title="Permanent link">&para;</a></h4>
<p>Aquí tens un exemple senzill de com funciona PHP:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">PHP</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">&lt;h1&gt;El meu primer script PHP&lt;/h1&gt;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">echo</span> <span class="s2">&quot;Hola, món!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
<p>En aquest exemple, el codi PHP s'incrusta dins del codi HTML i es delimina amb <?php i ?>. Quan el servidor processa aquest fitxer, executa el codi PHP i envia el resultat al navegador, generant el contingut dinàmic "Hola, món!".
Aquest és un altre exemple de com PHP pot generar HTML dinàmicament:</p>
<h2 id="2-llenguatges-imbricats-en-html">2. Llenguatges imbricats en HTML<a class="headerlink" href="#2-llenguatges-imbricats-en-html" title="Permanent link">&para;</a></h2>
<p>PHP permet incrustar codi dins de documents HTML, permetent la generació de contingut dinàmic. El codi PHP es delimita amb <code>&lt;?php ... ?&gt;</code>.
És comú utilitzar codi PHP dins de HTML per generar contingut dinàmic. També es pot incloure HTML dins de fitxers PHP.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    &lt;h1&gt;Benvingut a la meva web&lt;/h1&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    &lt;p&gt;La data d&#39;avui és: </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="linenos" data-linenos="6 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="7 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
El codi HTML pot ser generat dins d'instruccions PHP.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;html&gt;&lt;body&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;h1&gt;Benvingut a la meva web&lt;/h1&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;La data d&#39;avui és: &quot;</span> <span class="o">.</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="cp">?&gt;</span>
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Només etiquetes d'obertura</p>
<p>Si el nostre codi només contindrà codi PHP i res d'html, com per exemple, quan codifiquem classes o interfícies, només posarem l'etiqueta d'obertura, per a així indicar que és una arxiu de php pur.</p>
</div>
<h2 id="3-etiquetes-per-a-insercio-de-codi">3. Etiquetes per a inserció de codi<a class="headerlink" href="#3-etiquetes-per-a-insercio-de-codi" title="Permanent link">&para;</a></h2>
<p>Per inserir codi PHP dins de HTML, utilitzem les etiquetes:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Codi PHP aquí</span>
<span class="linenos" data-linenos="3 "></span><span class="cp">?&gt;</span>
</code></pre></div>
Per imprimir directament:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$variable</span> <span class="cp">?&gt;</span>
</code></pre></div>
Exemple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    &lt;h1&gt;Benvingut a la meva web&lt;/h1&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    &lt;p&gt;La data d&#39;avui és: </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="linenos" data-linenos="6 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="7 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div></p>
<h2 id="4-tipus-de-dades-conversions-entre-tipus-de-dades">4. Tipus de dades. Conversions entre tipus de dades<a class="headerlink" href="#4-tipus-de-dades-conversions-entre-tipus-de-dades" title="Permanent link">&para;</a></h2>
<p>PHP té diversos tipus de dades: enter, flotant, cadena, booleà, matriu, objecte, nul.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$enter = 10; // Enter</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$flotant = 3.14; // Flotant</span>
<span class="linenos" data-linenos="3 "></span><span class="x">$cadena = &quot;Hola, món!&quot;; // Cadena</span>
<span class="linenos" data-linenos="4 "></span><span class="x">$boolea = true; // Booleà</span>
<span class="linenos" data-linenos="5 "></span><span class="x">$matriu = array(1, 2, 3); // Matriu</span>
<span class="linenos" data-linenos="6 "></span><span class="x">$objecte = new stdClass(); // Objecte</span>
<span class="linenos" data-linenos="7 "></span><span class="x">$nul = null; // Nul</span>
</code></pre></div>
Conversions:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$integer = (int) $variable;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$float = (float) $variable;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">$string = (string) $variable;</span>
</code></pre></div>
Exemple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$cadena = &quot;123&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$enter = (int)$cadena; // Converteix la cadena &quot;123&quot; a l&#39;enter 123</span>
</code></pre></div></p>
<h2 id="5-constants">5. Constants<a class="headerlink" href="#5-constants" title="Permanent link">&para;</a></h2>
<p>Són variables el valor dels quals no varien. Existeixen dues possibilitats:</p>
<ul>
<li><code>define(NOMBRE, valor);</code></li>
<li><code>const NOMBRE; // PHP &gt; 5.3</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;PI&quot;</span><span class="p">,</span> <span class="mf">3.1416</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="k">const</span> <span class="no">IVA</span> <span class="o">=</span> <span class="mf">0.21</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">echo</span> <span class="nx">PI</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nx">IVA</span><span class="p">;</span> <span class="c1">// No se pone el símbolo dolar</span>
</code></pre></div>
<ul>
<li>Es declaren sempre en MAJÚSCULES</li>
<li>Hi ha un conjunt de constants ja predefinides, també conegudes com <em>magic constants</em>: <a href="https://www.php.net/manual/es/language.constants.predefined.php">https://www.php.net/manual/es/language.constants.predefined.php</a></li>
</ul>
<h2 id="6-variables-operadors-ambits-de-les-variables">6. Variables. Operadors.  Àmbits de les variables<a class="headerlink" href="#6-variables-operadors-ambits-de-les-variables" title="Permanent link">&para;</a></h2>
<ul>
<li>No és necessari declarar-les prèviament.</li>
<li>Comencen per <code>$</code>, per exemple <code>$nom</code>. Després del <code>$</code>, el següent caràcter ha de ser una lletra en minúscula (recomanació) o guió baix <code>_</code>. Després ja es poden posar números.</li>
<li>Són case <em>sensitive</em>: <code>$*var != $*vAR</code></li>
<li>No es declara el seu tipus, el tipat és dinàmic. S'assigna en temps d'execució depenent del valor assignat.</li>
<li>Convenient inicialitzar-les, sinó donen error a l'utilitzar-les.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$variable = &quot;valor&quot;;</span>
</code></pre></div>
Operadors:</li>
<li>Aritmètics: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code></li>
<li>Assignació: <code>=</code>, <code>+=</code>, <code>-=</code></li>
<li>Comparació: <code>==</code>, <code>===</code>, <code>!=</code></li>
<li>Lògics: <code>&amp;&amp;</code>, <code>||</code>, <code>!</code></li>
<li>Concatenació: <code>.</code></li>
</ul>
<p>Els àmbits d'utilització d'una variable són:</p>
<p>Local: dins d'una funció.
Global: fora de qualsevol funció.
Estàtic: persisteixen el seu valor entre crides a la funció.</p>
<p>Exemple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$global = 10; // Variable global    </span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">function contar() {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    static $vegades = 0;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    $local = 0; // Variable local</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    $local++;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    $vegades++;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    $global++;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    echo $local,$vegades,$global;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">}</span>
<span class="linenos" data-linenos="10 "></span><span class="x">contar(); // Mostra 1,1,11</span>
<span class="linenos" data-linenos="11 "></span><span class="x">contar(); // Mostra 1,2,12</span>
</code></pre></div></p>
<h2 id="7-sentencies-simples-en-php-i-els-seus-efectes">7. Sentències simples en PHP i els seus efectes<a class="headerlink" href="#7-sentencies-simples-en-php-i-els-seus-efectes" title="Permanent link">&para;</a></h2>
<p>Assignacions
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$x = 5;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$y = &quot;Hola món&quot;;</span>
</code></pre></div>
Operacions aritmètiques
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$suma = $x + 10;  // Resulta en 15</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$producte = $x * 2;  // Resulta en 10</span>
</code></pre></div>
Operacions d'entrada i eixida:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">echo &quot;Hola, món!&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">print &quot;Hola, món!&quot;;</span>
</code></pre></div>
Operacions amb cadenes:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$nom = &quot;Joan&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$salutacio = $y . &quot;, &quot; . $nom;  // Resulta en &quot;Hola món, Joan&quot;</span>
</code></pre></div>
Exemple complet:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Assignació de valors</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$y</span> <span class="o">=</span> <span class="s2">&quot;Hola món&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// Operacions aritmètiques</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$suma</span> <span class="o">=</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$producte</span> <span class="o">=</span> <span class="nv">$x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1">// Concatenació de cadenes</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$nom</span> <span class="o">=</span> <span class="s2">&quot;Joan&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$salutacio</span> <span class="o">=</span> <span class="nv">$y</span> <span class="o">.</span> <span class="s2">&quot;, &quot;</span> <span class="o">.</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="c1">// Impressió de resultats</span>
<span class="linenos" data-linenos="15 "></span><span class="k">echo</span> <span class="nv">$y</span><span class="p">;</span>  <span class="c1">// Hola món</span>
<span class="linenos" data-linenos="16 "></span><span class="k">echo</span> <span class="nv">$suma</span><span class="p">;</span>  <span class="c1">// 15</span>
<span class="linenos" data-linenos="17 "></span><span class="k">echo</span> <span class="nv">$producte</span><span class="p">;</span>  <span class="c1">// 10</span>
<span class="linenos" data-linenos="18 "></span><span class="k">echo</span> <span class="nv">$salutacio</span><span class="p">;</span>  <span class="c1">// Hola món, Joan</span>
</code></pre></div></p>
<h2 id="8-funcions">8. Funcions<a class="headerlink" href="#8-funcions" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Sintaxi bàsica</strong>:<ul>
<li>La paraula clau <code>function</code> es fa servir per a definir la funció.</li>
<li>Després segueix el nom de la funció, que pot contenir lletres, nombres i guions baixos (però no pot començar amb un nombre).</li>
<li>Entre els parèntesis es poden passar arguments (opcionals).</li>
<li>El cos de la funció es defineix entre claudàtors <code>{}</code>.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function nomFuncio() {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    // Codi de la funció</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
</code></pre></div>
<ol start="2">
<li><strong>Amb arguments</strong>:<ul>
<li>Els arguments es passen entre els parèntesis i poden ser utilitzats dins de la funció.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function saluda($nom) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    echo &quot;Hola, $nom!&quot;;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="x">saluda(&quot;Maria&quot;);  // Mostra &quot;Hola, Maria!&quot;</span>
</code></pre></div>
<ol start="3">
<li><strong>Amb valor de retorn</strong>:<ul>
<li>La paraula clau <code>return</code> permet retornar un valor des de la funció. Es pot retornar qualsevol tipus de dades (enter, string, array, etc.).</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function suma($a, $b) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    return $a + $b;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="x">$resultat = suma(5, 3);  // $resultat conté 8</span>
</code></pre></div>
<ol start="4">
<li><strong>Funcions amb valors per defecte</strong>:<ul>
<li>Si no es passa cap argument, la funció pot utilitzar un valor per defecte.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function saludar($nom = &quot;amic&quot;) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    echo &quot;Hola, &quot; . $nom;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="x">saludar();  // Mostra &quot;Hola, amic&quot;</span>
<span class="linenos" data-linenos="6 "></span><span class="x">saludar(&quot;Maria&quot;);  // Mostra &quot;Hola, Maria&quot;</span>
</code></pre></div>
<ol start="5">
<li><strong>Tipus de dades en arguments i retorn</strong> (des de PHP 7):<ul>
<li>És possible especificar el tipus de dades dels arguments i el tipus de retorn. Això ajuda a assegurar que la funció rep i retorna els tipus esperats.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function sumar(int $a, int $b): int {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    return $a + $b;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="x">$resultat = sumar(5, 3);  // $resultat conté 8</span>
</code></pre></div>
<h2 id="9-directives-per-a-modificar-el-comportament-predeterminat-del-codi">9. Directives per a modificar el comportament predeterminat del codi<a class="headerlink" href="#9-directives-per-a-modificar-el-comportament-predeterminat-del-codi" title="Permanent link">&para;</a></h2>
<p>Include i require:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">include &#39;fitxer.php&#39;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">require &#39;fitxer.php&#39;;</span>
</code></pre></div>
Include_once i require_once:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">include_once &#39;fitxer.php&#39;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">require_once &#39;fitxer.php&#39;;</span>
</code></pre></div>
Exemple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">// contingut de fitxer.php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">function</span> <span class="nf">saludar</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">echo</span> <span class="s2">&quot;Hola!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">// contingut de principal.php</span>
<span class="linenos" data-linenos=" 9 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="10 "></span><span class="k">include</span> <span class="s1">&#39;fitxer.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="nx">saludar</span><span class="p">();</span> <span class="c1">// Mostra &quot;Hola!&quot;</span>
<span class="linenos" data-linenos="12 "></span><span class="cp">?&gt;</span>
</code></pre></div></p>
<h2 id="10-mecanismes-de-decisio-if-switch">10. Mecanismes de decisió (if, switch)<a class="headerlink" href="#10-mecanismes-de-decisio-if-switch" title="Permanent link">&para;</a></h2>
<p>If, else, elseif:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">if ($condicio) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    // Codi si la condició és certa</span>
<span class="linenos" data-linenos="3 "></span><span class="x">} elseif ($altra_condicio) {</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    // Codi si la segona condició és certa</span>
<span class="linenos" data-linenos="5 "></span><span class="x">} else {</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    // Codi si cap de les condicions anteriors és certa</span>
<span class="linenos" data-linenos="7 "></span><span class="x">}</span>
</code></pre></div>
Switch:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">switch ($variable) {</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    case 1:</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        // Codi per al cas 1</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    case 2:</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        // Codi per al cas 2</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    default:</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        // Codi per al cas per defecte</span>
<span class="linenos" data-linenos="10 "></span><span class="x">}</span>
</code></pre></div>
Exemple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$dia = &quot;dilluns&quot;;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">switch ($dia) {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    case &quot;dilluns&quot;:</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        echo &quot;Avui és dilluns&quot;;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    case &quot;dimarts&quot;:</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        echo &quot;Avui és dimarts&quot;;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    default:</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        echo &quot;Avui no és dilluns ni dimarts&quot;;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">}</span>
</code></pre></div>
Match: 
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$result = match ($variable) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    valor1 =&gt; resultat1,</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    valor2 =&gt; resultat2,</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    valor3 =&gt; resultat3,</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    // ...</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    default =&gt; valorPerDefecte,</span>
<span class="linenos" data-linenos="7 "></span><span class="x">};</span>
</code></pre></div>
<strong>Diferències amb switch</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>1. **Comparació estricta**: `match` utilitza comparació estricta (===) per comparar els valors.
<span class="linenos" data-linenos="2 "></span>2. **Retorna un valor**: `match` és una expressió, la qual cosa significa que retorna un valor.
<span class="linenos" data-linenos="3 "></span>3. **No necessita break**: A diferència de `switch`, no es necessita l&#39;ús de `break` per evitar la caiguda (fall-through).
<span class="linenos" data-linenos="4 "></span>4. **Més concís**: Permet una sintaxi més neta i concisa.
</code></pre></div>
<p>Exemple simple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$color = &#39;roig&#39;;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$resultat = match ($color) {</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &#39;roig&#39; =&gt; &#39;El color és vermell&#39;,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &#39;blau&#39; =&gt; &#39;El color és blau&#39;,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    &#39;verd&#39; =&gt; &#39;El color és verd&#39;,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    default =&gt; &#39;Color desconegut&#39;,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">};</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="x">echo $resultat;  // Sortida: El color és vermell</span>
</code></pre></div>
Exemple expressions complexes:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$edat = 20;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$categoria = match (true) {</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    $edat &gt;= 0 &amp;&amp; $edat &lt;= 12 =&gt; &#39;Nen&#39;,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    $edat &gt;= 13 &amp;&amp; $edat &lt;= 17 =&gt; &#39;Adolescent&#39;,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    $edat &gt;= 18 &amp;&amp; $edat &lt;= 64 =&gt; &#39;Adult&#39;,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    $edat &gt;= 65 =&gt; &#39;Gent gran&#39;,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    default =&gt; &#39;Edat desconeguda&#39;,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">};</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">echo $categoria;  // Sortida: Adult</span>
</code></pre></div>
Exemples casos multiples:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dia = &#39;dimecres&#39;;</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="x">$tipusDia = match ($dia) {</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    &#39;dissabte&#39;, &#39;diumenge&#39; =&gt; &#39;Cap de setmana&#39;,</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    &#39;dilluns&#39;, &#39;dimarts&#39;, &#39;dimecres&#39;, &#39;dijous&#39;, &#39;divendres&#39; =&gt; &#39;Dia laborable&#39;,</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    default =&gt; &#39;Dia desconegut&#39;,</span>
<span class="linenos" data-linenos="7 "></span><span class="x">};</span>
<span class="linenos" data-linenos="8 "></span><span class="x">echo $tipusDia;  // Sortida: Dia laborable</span>
</code></pre></div></p>
<h2 id="11-bucles-for-while-foreach">11. Bucles (for, while, foreach)<a class="headerlink" href="#11-bucles-for-while-foreach" title="Permanent link">&para;</a></h2>
<p>For:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">for ($i = 0; $i &lt; 10; $i++) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    echo $i;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
</code></pre></div>
While:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$i = 0;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">while ($i &lt; 10) {</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    echo $i;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    $i++;</span>
<span class="linenos" data-linenos="5 "></span><span class="x">}</span>
</code></pre></div>
Foreach:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$matriu = array(1, 2, 3);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">foreach ($matriu as $valor) {</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    echo $valor;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">}</span>
</code></pre></div>
Exemple:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$fruites = array(&quot;poma&quot;, &quot;plàtan&quot;, &quot;maduixa&quot;);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">foreach ($fruites as $fruita) {</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    echo $fruita;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">}</span>
</code></pre></div></p>
<h2 id="12-arrays">12. Arrays<a class="headerlink" href="#12-arrays" title="Permanent link">&para;</a></h2>
<p>Per a emmagatzemar dades compostes, podem utilitzar tant arrays senzills com arrays associatius (similars a un mapa). En realitat tots els arrays són mapes ordenats compostos de parells clau-valor.</p>
<div class="admonition caution">
<p class="admonition-title">Compte amb mesclar tipus</p>
<p>Com el tipat és dinàmic, nostres arrays poden contenir dades de diferents tipus. No es recomana mesclar els tipus.</p>
</div>
<p>De la mateixa manera que Java, es defineixen mitjançant claudàtors, són 0-index, i es pot assignar un valor a un posició determinada:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$frutas</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;naranja&quot;</span><span class="p">,</span> <span class="s2">&quot;pera&quot;</span><span class="p">,</span> <span class="s2">&quot;manzana&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$frutas2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;naranja&quot;</span><span class="p">,</span> <span class="s2">&quot;pera&quot;</span><span class="p">,</span> <span class="s2">&quot;manzana&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="nv">$frutas3</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$frutas3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;naranja&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="nv">$frutas3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pera&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="9 "></span><span class="nv">$frutas3</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;manzana&quot;</span><span class="p">;</span> <span class="c1">// lo añade al final</span>
</code></pre></div>
<p>Podem obtindre la grandària del array mitjançant la funció <code>count(array)</code>. Per a recórrer el array farem ús d'un bucle <code>for</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$tam</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$frutas</span><span class="p">);</span> <span class="c1">// tamaño del array</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$frutas</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">echo</span> <span class="s2">&quot;Elemento </span><span class="si">$i</span><span class="s2">: </span><span class="si">$frutas[$i]</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<p>Una altra manera de recórrer els arrays, fins i tot més elegant, és fer ús de <code>foreach</code>. La seua sintaxi és <code>foreach (array as element)</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Mitjançant foreach no necessitem saber la grandària del array</span>
<span class="linenos" data-linenos="3 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$frutas</span> <span class="k">as</span> <span class="nv">$fruta</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$fruta</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="13-arrays-associatius">13. Arrays associatius<a class="headerlink" href="#13-arrays-associatius" title="Permanent link">&para;</a></h2>
<p>Cada element és un parell clau-valor. En comptes d'accedir per la posició, el fem mitjançant una clau. Així doncs, per a cada clau s'emmagatzema un valor.</p>
<p>A l'hora de recórrer aquest tipus de arrays, mitjançant <code>foreach</code> separem cada element en una parella <code>clau =&gt; valor</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$capitales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Italia&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Roma&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="s2">&quot;Francia&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Paris&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="s2">&quot;Portugal&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Lisboa&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">$capitalFrancia</span> <span class="o">=</span> <span class="nv">$capitales</span><span class="p">[</span><span class="s2">&quot;Francia&quot;</span><span class="p">];</span> <span class="c1">// se accede al elemento por la clave, no la posición</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$capitales</span><span class="p">[</span><span class="s2">&quot;Alemania&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Berlín&quot;</span><span class="p">;</span> <span class="c1">// añadimos un elemento</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">echo</span> <span class="s2">&quot;La capital de Francia es </span><span class="si">$capitalFrancia</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="k">echo</span> <span class="s2">&quot;La capital de Francia es </span><span class="si">{</span><span class="nv">$capitales</span><span class="p">[</span><span class="s2">&quot;Francia&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$capitales</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;Madrid&quot;</span><span class="p">;</span> <span class="c1">// se añade con la clave 0 !!! ¡¡¡No asignar valores sin clave!!!</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$capitales</span> <span class="k">as</span> <span class="nv">$valor</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// si recorremos un array asociativo, mostraremos los valores</span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$valor</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$capitales</span> <span class="k">as</span> <span class="nv">$pais</span> <span class="o">=&gt;</span> <span class="nv">$ciudad</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// separamos cada elemento en clave =&gt; valor</span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$pais</span><span class="s2"> : </span><span class="si">$ciudad</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="14-com-utilitzar-les-cometes-en-php">14. Com utilitzar les cometes en PHP<a class="headerlink" href="#14-com-utilitzar-les-cometes-en-php" title="Permanent link">&para;</a></h2>
<p>En PHP, les cometes dobles (<code>"</code>) i les cometes simples (<code>'</code>) s'utilitzen per definir cadenes de caràcters, però tenen comportaments diferents a l'hora de processar variables:</p>
<ul>
<li><strong>Cometes dobles (<code>"</code>)</strong>: Interpolen variables i seqüències d'escapament especials. És a dir, el contingut de la variable es mostrarà dins de la cadena.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$nom = &quot;Maria&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">echo &quot;Hola, $nom!&quot;;  // Sortida: Hola, Maria!</span>
</code></pre></div>
<ul>
<li><strong>Cometes simples (<code>'</code>)</strong>: No interpolen variables ni seqüències d'escapament especials. La cadena es mostrarà exactament com es defineix.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$nom = &quot;Maria&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">echo &#39;Hola, $nom!&#39;;  // Sortida: Hola, $nom!</span>
</code></pre></div>
<h4 id="exemple-dus-de-cometes-dobles-per-imprimir-variables">Exemple d'ús de cometes dobles per imprimir variables<a class="headerlink" href="#exemple-dus-de-cometes-dobles-per-imprimir-variables" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$color = &quot;blau&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$frase = &quot;El meu color preferit és $color.&quot;;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">echo $frase;  // Sortida: El meu color preferit és blau.</span>
<span class="linenos" data-linenos="4 "></span><span class="x">  ```</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="x">## 15. Comentaris en el codi</span>
<span class="linenos" data-linenos="7 "></span><span class="x">Comentaris d&#39;una línia:</span>
<span class="linenos" data-linenos="8 "></span><span class="x">```php</span>
<span class="linenos" data-linenos="9 "></span><span class="x">// Això és un comentari d&#39;una línia</span>
</code></pre></div>
Comentaris de diverses línies:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">/* Això és un comentari</span>
<span class="linenos" data-linenos="2 "></span><span class="x">   de diverses línies */</span>
</code></pre></div></p>
<h2 id="16-variables-de-servidor">16. Variables de servidor<a class="headerlink" href="#16-variables-de-servidor" title="Permanent link">&para;</a></h2>
<p>PHP emmagatzema la informació del servidor i de les peticions HTTP en sis arrays globals:</p>
<ul>
<li><code>$_ENV</code>: informació sobre les variables d'entorn</li>
<li><code>$_GET</code>: paràmetres enviats en la petició GET</li>
<li><code>$_POST</code>: paràmetres enviats en el envio POST</li>
<li><code>$_COOKIE</code>: conté les cookies de la petició, les claus del array són els noms de les cookies</li>
<li><code>$_SERVER</code>: informació sobre el servidor</li>
<li><code>$_FILES</code>: informació sobre els fitxers carregats via upload</li>
</ul>
<p>Si ens centrem en el array <code>$_SERVER</code> podem consultar les següents propietats:</p>
<ul>
<li><code>PHP_SELF</code>: nom del script executat, relatiu al document root (p.ej: <code>/tenda/carret.php</code>)</li>
<li><code>SERVER_SOFTWARE</code>: (p.ej: Apatxe)</li>
<li><code>SERVER_NAME</code>: domini, àlies DNS (p.ej: <code>www.elche.es</code>)</li>
<li><code>REQUEST_METHOD</code>: GET</li>
<li><code>REQUEST_URI</code>: URI, sense el domini</li>
<li><code>QUERY_STRING</code>: tot el que va després de <code>?</code> en la URL (p.ej: <code>heroe=Batman&amp;nomene=Bruce</code>)</li>
</ul>
<p>Més informació en <a href="https://www.php.net/manual/es/reserved.variables.server.php">https://www.php.net/manual/es/reserved.variables.server.php</a></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// /u4/401server.php</span>
<span class="linenos" data-linenos="3 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;SERVER_SOFTWARE&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.9</span>
<span class="linenos" data-linenos="4 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;SERVER_NAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// localhost</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_METHOD&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// GET</span>
<span class="linenos" data-linenos="7 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_URI&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// /u4/401server.php?heroe=Batman</span>
<span class="linenos" data-linenos="8 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;QUERY_STRING&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// heroe=Batman</span>
</code></pre></div>
<p>Altres propietats relacionades:</p>
<ul>
<li><code>PATH_INFO</code>: ruta extra després de la petició. Si la URL és <code>http://www.php.com/php/pathinfo.php/algo/cosa?foo=bar</code>, llavors <code>$_SERVER['PATH_INFO']</code> serà <code>/alguna cosa/cosa</code>.</li>
<li><code>REMOTE_HOST</code>: hostname que va fer la petició</li>
<li><code>REMOTE_ADDR</code>: IP del client</li>
<li><code>AUTH_TYPE</code>: tipus d'autenticació (p.ej: Basic)</li>
<li><code>REMOTE_USER</code>: nom de l'usuari autenticat</li>
</ul>
<p>Apatxe crea una clau per a cada capçalera HTTP, en majúscules i substituint els guions per subratllats:</p>
<ul>
<li><code>HTTP_USER_AGENT</code>: agent (navegador)</li>
<li><code>HTTP_REFERER</code>: pàgina des de la qual es va fer la petició</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;HTTP_USER_AGENT&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</span>
</code></pre></div>
<h2 id="17-formularis">17. Formularis<a class="headerlink" href="#17-formularis" title="Permanent link">&para;</a></h2>
<p>A l'hora d'enviar un formulari, hem de tindre clar quan usar GET o POST</p>
<ul>
<li>
<p>GET: els paràmetres es passen en la URL</p>
<ul>
<li>&lt;2048 caràcters, només ASCII</li>
<li>Permet emmagatzemar la direcció completa (marcador / historial)</li>
<li>Idempotent: dues crides amb les mateixes dades sempre ha de donar el mateix resultat</li>
<li>El navegador pot cachejar les cridades</li>
</ul>
</li>
<li>
<p>POST: paràmetres ocults (no encriptats)</p>
<ul>
<li>Sense límit de dades, permet dades binàries.</li>
<li>No es poden escorcollar</li>
<li>No idempotent → actualitzar la BBDD</li>
</ul>
</li>
</ul>
<p>Així doncs, per a recollir les dades accedirem al array depenent del mètode del formulari que ens ha invocat:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$par</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;parametro&quot;</span><span class="p">]</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$par</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;parametro&quot;</span><span class="p">]</span>
</code></pre></div>
<p>A l'hora d'enviar un formulari, hem de tindre clar quan usar GET o POST. Per als següents apartats ens basarem en el següent exemple:</p>
<h3 id="validacio">Validació<a class="headerlink" href="#validacio" title="Permanent link">&para;</a></h3>
<p>Respecte a la validació, és convenient sempre fer <em>validació doble</em>:</p>
<ul>
<li>En el client mitjançant JS</li>
<li>En servidor, abans de cridar a la capa de negoci, és convenient tornar a validar les dades.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;parametro&quot;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$par </span><span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;parametro&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="4 "></span>    <span class="c1">// comprobar si $par tiene el formato adecuado, su valor, etc...</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Llibreries de validació</p>
</div>
<p>Existeixen diverses llibreries que faciliten la validació dels formularis, com són <a href="https://respect-validation.readthedocs.io/en/latest/">respect/validation</a> o <a href="http://validator.particle-php.com/en/latest/">particle/validator</a>.
Quan estudiem Laravel aprofundirem en la validació de manera declarativa.</p>
<h3 id="parametre-multivalor">Parámetre multivalor<a class="headerlink" href="#parametre-multivalor" title="Permanent link">&para;</a></h3>
<p>Existeixen elements HTML que envien diversos valors:</p>
<ul>
<li><code>select multiple</code></li>
<li><code>checkbox</code></li>
</ul>
<p>Per a recollir les dades, el nom de l'element ha de ser un array.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;lenguajes[]&quot;</span> <span class="na">multiple</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">&gt;</span>C<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;java&quot;</span><span class="p">&gt;</span>Java<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;php&quot;</span><span class="p">&gt;</span>PHP<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;python&quot;</span><span class="p">&gt;</span>Python<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;lenguajes[]&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;c&quot;</span> <span class="p">/&gt;</span> C<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;lenguajes[]&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="p">/&gt;</span> Java<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;lenguajes[]&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;php&quot;</span> <span class="p">/&gt;</span> Php<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;lenguajes[]&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;python&quot;</span> <span class="p">/&gt;</span> Python<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
</code></pre></div>
<p>De manera que després en recollir les dades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$lenguajes</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;lenguajes&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$lenguajes</span> <span class="k">as</span> <span class="nv">$lenguaje</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$lenguaje</span><span class="s2"> &lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="tornant-a-emplenar-un-formulari">Tornant a emplenar un formulari<a class="headerlink" href="#tornant-a-emplenar-un-formulari" title="Permanent link">&para;</a></h3>
<p>Un <em>sticky form</em> és un formulari que recorda els seus valors. Per a això, hem d'emplenar els atributs <code>value</code> dels elements HTML amb la informació que contenien:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;modulos&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>  <span class="c1">// Aquí se incluye el código a ejecutar cuando los datos son correctos</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="c1">// Generamos el formulario</span>
<span class="linenos" data-linenos=" 6 "></span>  <span class="nv">$nombre</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>  <span class="nv">$modulos</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;modulos&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="cp">?&gt;</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">];</span><span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="10 "></span>   <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span><span class="p">&gt;</span>Nombre del alumno:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$nombre</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="p">/&gt;</span> 
<span class="linenos" data-linenos="12 "></span>   <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="13 "></span>   <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;modulos[]&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;modulosDWES&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;DWES&quot;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="s2">&quot;DWES&quot;</span><span class="p">,</span><span class="nv">$modulos</span><span class="p">))</span> <span class="k">echo</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;modulosDWES&quot;</span><span class="p">&gt;</span>Desarrollo web en entorno servidor<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="16 "></span>   <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="17 "></span>   <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;modulos[]&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;modulosDWEC&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;DWEC&quot;</span>
<span class="linenos" data-linenos="18 "></span>    <span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="s2">&quot;DWEC&quot;</span><span class="p">,</span><span class="nv">$modulos</span><span class="p">))</span> <span class="k">echo</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="19 "></span>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;modulosDWEC&quot;</span><span class="p">&gt;</span>Desarrollo web en entorno cliente<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="20 "></span>   <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="21 "></span>   <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Enviar&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;enviar&quot;</span><span class="p">/&gt;</span>
<span class="linenos" data-linenos="22 "></span>  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>
</code></pre></div>
<h3 id="pujant-arxius">Pujant arxius<a class="headerlink" href="#pujant-arxius" title="Permanent link">&para;</a></h3>
<p>S'emmagatzemen en el servidor en el array <code>$_FILES</code> amb el nom del camp del tipus <code>file</code> del formulari.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&lt;?php echo $_SERVER[&#39;PHP_SELF&#39;]; ?&gt;&quot;</span>  <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>    Archivo: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;archivoEnviado&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;btnSubir&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Subir&quot;</span> <span class="p">/&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
<p>Configuració en <code>php.ini</code></p>
<ul>
<li><code>file_uploads</code>: on / off</li>
<li><code>upload_max_filesize</code>: 2M</li>
<li><code>upload_tmp_dir</code>: directori temporal. No és necessari configurar-ho, agafarà el predeterminat del sistema</li>
<li><code>post_max_size</code>: grandària màxima de les dades POST. Ha de ser major a upload_max_filesize.</li>
<li><code>max_file_uploads</code>: nombre màxim d'arxius que es poden carregar alhora.</li>
<li><code>max_input_estafe</code>: temps màxim emprat en la càrrega (GET/POST i upload → normalment es configura en 60)</li>
<li><code>memory_limit</code>: 128M</li>
<li><code>max_execution_estafe</code>: temps d'execució d'un script (no té en compte el upload)</li>
</ul>
<p>Per a carregar els arxius, accedim al array <code>$_FILES</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;btnSubir&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;btnSubir&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Subir&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nb">is_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;archivoEnviado&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="c1">// subido con éxito</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="nv">$nombre</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;archivoEnviado&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;archivoEnviado&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="s2">&quot;./uploads/</span><span class="si">{</span><span class="nv">$nombre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Archivo </span><span class="si">$nombre</span><span class="s2"> subido con éxito&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
<p>Cada arxiu carregat en <code>$_FILES</code> té:</p>
<ul>
<li><code>name</code>: nom</li>
<li><code>tmp_name</code>: ruta temporal</li>
<li><code>size</code>: grandària en bytes</li>
<li><code>type</code>: tipus ACARONE</li>
<li><code>error</code>: si hi ha error, conté un missatge. Si ok → 0.</li>
</ul>
<h2 id="capcaleres-de-resposta">Capçaleres de resposta<a class="headerlink" href="#capcaleres-de-resposta" title="Permanent link">&para;</a></h2>
<p>Ha de ser el primer a retornar. Es retornen mitjançant la funció <code>header(cadena)</code>. Mitjançant les capçaleres podem configurar el tipus de contingut, temps d'expiració, redirigir el navegador, especificar errors HTTP, etc.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span> <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/plain&quot;</span><span class="p">);</span> <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="cp">&lt;?php</span> <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: http://www.ejemplo.com/inicio.html&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="k">exit</span><span class="p">();</span> 
</code></pre></div>
<p>Es pot comprovar en les eines del desenvolupador dels navegadors web mitjançant <em>Developer Tools &rarr; Network &rarr; Headers</em>.</p>
<p>És molt comú configurar les capçaleres per a evitar consultes a la cache o provocar la seua renovació:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Expires: Sun, 31 Jan 2021 23:59:59 GMT&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">// tres horas</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$now</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">$horas3</span> <span class="o">=</span> <span class="nb">gmstrftime</span><span class="p">(</span><span class="s2">&quot;%a, %d %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="nv">$now</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Expires: </span><span class="si">{</span><span class="nv">$horas3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">// un año</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$now</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$anyo1</span> <span class="o">=</span> <span class="nb">gmstrftime</span><span class="p">(</span><span class="s2">&quot;%a, %d %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="nv">$now</span> <span class="o">+</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">86440</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Expires: </span><span class="si">{</span><span class="nv">$anyo1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">// se marca como expirado (fecha en el pasado)</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$pasado</span> <span class="o">=</span> <span class="nb">gmstrftime</span><span class="p">(</span><span class="s2">&quot;%a, %d %b %Y %H:%M:%S GMT&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Expires: </span><span class="si">{</span><span class="nv">$pasado</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span><span class="c1">// evitamos cache de navegador y/o proxy</span>
<span class="linenos" data-linenos="15 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Expires: Mon, 26 Jul 1997 05:00:00 GMT&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Last-Modified: &quot;</span> <span class="o">.</span> <span class="nb">gmdate</span><span class="p">(</span><span class="s2">&quot;D, d M Y H:i:s&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; GMT&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Cache-Control: no-store, no-cache, must-revalidate&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Cache-Control: post-check=0, pre-check=0&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Pragma: no-cache&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span><span class="c1">// redirigimos a otra página</span>
<span class="linenos" data-linenos="21 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: http://www.ejemplo.com/inicio.html&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span><span class="k">exit</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span><span class="c1">// devolvemos un error 404</span>
<span class="linenos" data-linenos="24 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;HTTP/1.0 404 Not Found&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="25 "></span><span class="c1">// enviamos un archivo para descargar</span>
<span class="linenos" data-linenos="26 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/force-download&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span><span class="c1">// enviamos un archivo json</span>
<span class="linenos" data-linenos="28 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>
</code></pre></div>
<h2 id="18-referencies">18. Referències<a class="headerlink" href="#18-referencies" title="Permanent link">&para;</a></h2>
<h3 id="llibres-recomanats">Llibres Recomanats<a class="headerlink" href="#llibres-recomanats" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong><a href="https://www.pearson.com/us/higher-education/program/Welling-PHP-and-My-SQL-Web-Development-5th-Edition/PGM335533.html">PHP and MySQL Web Development</a></strong> de Luke Welling i Laura Thomson</p>
<ul>
<li>Aquest llibre proporciona una visió completa sobre el desenvolupament web amb PHP i MySQL, des de conceptes bàsics fins a tècniques avançades.</li>
</ul>
</li>
<li>
<p><strong><a href="https://www.oreilly.com/library/view/learning-php-mysql/9781491918661/">Learning PHP, MySQL &amp; JavaScript: With jQuery, CSS &amp; HTML5</a></strong> de Robin Nixon</p>
<ul>
<li>Ideal per a aquells que busquen una introducció pràctica al desenvolupament web modern utilitzant PHP juntament amb altres tecnologies web.</li>
</ul>
</li>
<li>
<p><strong><a href="https://www.oreilly.com/library/view/modern-php/9781491905180/">Modern PHP: New Features and Good Practices</a></strong> de Josh Lockhart</p>
<ul>
<li>Aquest llibre explora les novetats i bones pràctiques en les versions modernes de PHP, incloent-hi temes com la programació orientada a objectes i l'ús de frameworks.</li>
</ul>
</li>
</ol>
<h3 id="documentacio-oficial">Documentació Oficial<a class="headerlink" href="#documentacio-oficial" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><a href="https://www.php.net/manual/es/index.php">Documentació Oficial de PHP</a></strong><ul>
<li>La documentació oficial de PHP és una referència essencial per a qualsevol desenvolupador que utilitzi PHP. Inclou guies de llenguatge, referències de funcions i exemples de codi.</li>
</ul>
</li>
</ul>
<h3 id="cursos-en-linia">Cursos en Línia<a class="headerlink" href="#cursos-en-linia" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong><a href="https://www.w3schools.com/php/">Curso de PHP en W3Schools</a></strong></p>
<ul>
<li>Un recurs en línia gratuït amb tutorials i exercicis interactius que cobreixen els conceptes bàsics i avançats de PHP.</li>
</ul>
</li>
<li>
<p><strong><a href="https://www.udemy.com/course/php-for-complete-beginners-includes-msql-object-oriented/">PHP for Beginners - Become a PHP Master - CMS Project</a></strong> a Udemy</p>
<ul>
<li>Un curs complet de PHP en Udemy que inclou la creació d'un sistema de gestió de continguts (CMS) com a projecte final.</li>
</ul>
</li>
</ul>
<h3 id="recursos-addicionals">Recursos Addicionals<a class="headerlink" href="#recursos-addicionals" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong><a href="https://phptherightway.com/">PHP: The Right Way</a></strong></p>
<ul>
<li>Un recurs comunitari que ofereix bones pràctiques, consells i pautes per al desenvolupament amb PHP.</li>
</ul>
</li>
<li>
<p><strong><a href="https://laravel.com/docs">Laravel Documentation</a></strong></p>
<ul>
<li>Documentació oficial de Laravel, un dels frameworks de PHP més populars per al desenvolupament web.</li>
</ul>
</li>
</ul>
<h3 id="exemples-i-tutorials">Exemples i Tutorials<a class="headerlink" href="#exemples-i-tutorials" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong><a href="https://www.tutorialspoint.com/php/index.htm">TutorialsPoint PHP Tutorial</a></strong></p>
<ul>
<li>Proporciona una introducció detallada a PHP amb exemples de codi i explicacions pas a pas.</li>
</ul>
</li>
<li>
<p><strong><a href="https://www.geeksforgeeks.org/php/">GeeksforGeeks PHP Tutorials</a></strong></p>
<ul>
<li>Una col·lecció d'articles i tutorials sobre diversos temes relacionats amb PHP, des de conceptes bàsics fins a avançats.</li>
</ul>
</li>
</ul>
<h3 id="repositoris-de-codi">Repositoris de Codi<a class="headerlink" href="#repositoris-de-codi" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><a href="https://github.com/search?q=PHP">GitHub PHP</a></strong><ul>
<li>Una col·lecció de repositoris de codi font en PHP, on pots trobar projectes de codi obert i exemples pràctics.</li>
</ul>
</li>
</ul>
<h2 id="19-exercicis">19. Exercicis<a class="headerlink" href="#19-exercicis" title="Permanent link">&para;</a></h2>
<h3 id="bateria-dexercicis-solucionats-per-a-la-unitat-de-php">Bateria d'Exercicis Solucionats per a la Unitat de PHP<a class="headerlink" href="#bateria-dexercicis-solucionats-per-a-la-unitat-de-php" title="Permanent link">&para;</a></h3>
<h4 id="exercici-1-introduccio-a-php">Exercici 1: Introducció a PHP<a class="headerlink" href="#exercici-1-introduccio-a-php" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer  que imprimeixi "Hola, món!" a la pantalla.</li>
<li>Modifica el fitxer per tal que imprimeixi el teu nom utilitzant una variable.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Exercici 1</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;Ignasi&#39;</span><span class="o">:</span>
<span class="linenos" data-linenos="4 "></span><span class="k">echo</span> <span class="s2">&quot;Hola, món!&quot;</span> <span class="o">.</span> <span class="s2">&quot;Hola, &quot;</span> <span class="o">.</span><span class="nv">$name</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-2-us-de-cometes">Exercici 2: Ús de cometes<a class="headerlink" href="#exercici-2-us-de-cometes" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer que definisca una variable <code>$name</code> amb el teu nom i imprimeixi la frase "Hola, [nom]!" utilitzant cometes dobles.</li>
<li>Fes-ho amb cometes simples i compara els resultats.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Exercici 2</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;Ignasi&#39;</span><span class="o">:</span>
<span class="linenos" data-linenos="4 "></span><span class="k">echo</span> <span class="s2">&quot;Hola, </span><span class="si">$name</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="k">echo</span> <span class="s1">&#39;Hola, $name!&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-3-funcions-basiques">Exercici 3: Funcions bàsiques<a class="headerlink" href="#exercici-3-funcions-basiques" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una funció <code>suma</code> que sume dos números i retorni el resultat. Invoca la funció amb els números 5 i 3 i imprimeix el resultat.</li>
<li>Crea una funció <code>multiplicacio</code> que multipliqui dos números i retorni el resultat. Invoca la funció amb els números 4 i 7 i imprimeix el resultat.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Exercici 2</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">function</span> <span class="nf">suma</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">function</span> <span class="nf">multiplicacio</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">return</span> <span class="nv">$a</span> <span class="o">*</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">echo</span> <span class="nx">suma</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>  <span class="c1">// Sortida: 8</span>
<span class="linenos" data-linenos="10 "></span><span class="k">echo</span> <span class="nx">multiplicacio</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>  <span class="c1">// Sortida: 28</span>
<span class="linenos" data-linenos="11 "></span><span class="cp">?&gt;</span>
</code></pre></div>

</details>

<h4 id="exercici-4-control-de-flux-condicionals">Exercici 4: Control de flux - Condicionals<a class="headerlink" href="#exercici-4-control-de-flux-condicionals" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer que definisca una variable <code>$edat</code>. Si <code>$edat</code> és major o igual a 18, imprimeix "Ets major d'edat"; en cas contrari, imprimeix "Ets menor d'edat".</li>
<li>Modifica el fitxer <code>edat.php</code> per tal que imprimeixi "Edat invàlida" si <code>$edat</code> és un número negatiu.</li>
</ol>
<details>
    <summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Exercici 4</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$edat</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$edat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">echo</span> <span class="s2">&quot;Edat invàlida&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">}</span> <span class="k">else</span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$edat</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">echo</span> <span class="s2">&quot;Ets major d&#39;edat&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">echo</span> <span class="s2">&quot;Ets menor d&#39;edat&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-5-control-de-flux-bucles">Exercici 5: Control de flux - Bucles<a class="headerlink" href="#exercici-5-control-de-flux-bucles" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer que utilitzi un bucle <code>for</code> per imprimir els números del 0 al 9.</li>
<li>Fes-ho també amb un bucle <code>while</code> que faci el mateix.</li>
</ol>
<details>
    <summary>Solució</summary>

        <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">// Exercici 5</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="c1">// Bucle for</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">echo</span> <span class="nv">$i</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// Bucle while</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">while</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">echo</span> <span class="nv">$i</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>    <span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-6-treballar-amb-arrays">Exercici 6: Treballar amb arrays<a class="headerlink" href="#exercici-6-treballar-amb-arrays" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer que definisca un array <code>$fruites</code> amb tres elements: "poma", "plàtan" i "maduixa". Imprimeix el primer element de l'array.</li>
<li>Afegeix un quart element "taronja" a l'array i imprimeix tots els elements utilitzant un bucle <code>foreach</code>.</li>
</ol>
<details>
    <summary>Solució</summary>

        <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Exercici 6</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">// Punt 1</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$fruites</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;poma&quot;</span><span class="p">,</span> <span class="s2">&quot;plàtan&quot;</span><span class="p">,</span> <span class="s2">&quot;maduixa&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">echo</span> <span class="nv">$fruites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// Punt 2</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$fruites</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;taronja&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$fruites</span> <span class="k">as</span> <span class="nv">$fruita</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">echo</span> <span class="nv">$fruita</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-7-cometes-dobles-i-variables">Exercici 7: Cometes dobles i variables<a class="headerlink" href="#exercici-7-cometes-dobles-i-variables" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer que definisca una variable <code>$color</code> amb el valor "blau". Utilitza cometes dobles per imprimir "El meu color preferit és [color]."</li>
<li>Ara,  utilitza cometes simples i concatenació.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Exercici 7</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$color</span> <span class="o">=</span> <span class="s2">&quot;blau&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="k">echo</span> <span class="s2">&quot;El meu color preferit és </span><span class="si">$color</span><span class="s2">.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="k">echo</span> <span class="s1">&#39;El meu color preferit és &#39;</span> <span class="o">.</span> <span class="nv">$color</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-8-combinacio-de-funcions-i-arrays">Exercici 8: Combinació de funcions i arrays<a class="headerlink" href="#exercici-8-combinacio-de-funcions-i-arrays" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una funció <code>afegir_element</code> que prenga un array i un element com a arguments, afegeisca l'element a l'array i retorne l'array modificat.</li>
<li>Crea un fitxer on defnisques un array <code>$animals</code> amb els elements "gat" i "gos". Utilitza la funció <code>afegir_element</code> per afegir "conill" a l'array i imprimeix tots els elements.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Exercici 8</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">function</span> <span class="nf">afegir_element</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$array</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$element</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">return</span> <span class="nv">$array</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$animals</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;gat&quot;</span><span class="p">,</span> <span class="s2">&quot;gos&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$animals</span> <span class="o">=</span> <span class="nx">afegir_element</span><span class="p">(</span><span class="nv">$animals</span><span class="p">,</span> <span class="s2">&quot;conill&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$animals</span> <span class="k">as</span> <span class="nv">$animal</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">echo</span> <span class="nv">$animal</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-9-utilitzant-match-per-a-categoritzar">Exercici 9: Utilitzant <code>match</code> per a categoritzar<a class="headerlink" href="#exercici-9-utilitzant-match-per-a-categoritzar" title="Permanent link">&para;</a></h4>
<p>Crea un fitxer  que utilitze la instrucció <code>match</code> per categoritzar una variable <code>$nota</code> segons el següent criteri:
     - Si la nota és 10, imprimir "Excel·lent".
     - Si la nota és 8 o 9, imprimir "Molt bé".
     - Si la nota és 5, 6 o 7, imprimir "Bé".
     - Per qualsevol altra nota, imprimir "Insuficient".</p>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$nota = 8;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$resultat = match (true) {</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    $nota === 10 =&gt; &#39;Excel·lent&#39;,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    $nota &gt;= 8 &amp;&amp; $nota &lt;= 9 =&gt; &#39;Molt bé&#39;,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    $nota &gt;= 5 &amp;&amp; $nota &lt;= 7 =&gt; &#39;Bé&#39;,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    default =&gt; &#39;Insuficient&#39;,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">};</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="x">echo $resultat;  // Sortida: Molt bé</span>
</code></pre></div>
</details>

<h4 id="exercici-10-llista-de-preus-amb-match">Exercici 10: Llista de preus amb <code>match</code><a class="headerlink" href="#exercici-10-llista-de-preus-amb-match" title="Permanent link">&para;</a></h4>
<p>Crea un fitxer que utilitze la instrucció <code>match</code> per assignar un preu a una variable <code>$producte</code>. Els productes i preus són:
     - "pa" =&gt; 1.00
     - "llet" =&gt; 0.80
     - "formatge" =&gt; 2.50
     - Qualsevol altre producte =&gt; 0.00</p>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$producte = &#39;formatge&#39;;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$preu = match ($producte) {</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &#39;pa&#39; =&gt; 1.00,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &#39;llet&#39; =&gt; 0.80,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    &#39;formatge&#39; =&gt; 2.50,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    default =&gt; 0.00,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">};</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="x">echo &quot;El preu de $producte és $preu euros.&quot;;  // Sortida: El preu de formatge és 2.5 euros.</span>
</code></pre></div>
</details>

<h4 id="exercici-11-calculadora-simple-amb-match">Exercici 11: Calculadora simple amb <code>match</code><a class="headerlink" href="#exercici-11-calculadora-simple-amb-match" title="Permanent link">&para;</a></h4>
<p>Crea un fitxer que utilitze la instrucció <code>match</code> per fer operacions matemàtiques bàsiques (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>). La variable <code>$operacio</code> ha de determinar l'operació a realitzar i les variables <code>$a</code> i <code>$b</code> seran els operands.</p>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$a = 10;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">$b = 5;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$operacio = &#39;+&#39;;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">$resultat = match ($operacio) {</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    &#39;+&#39; =&gt; $a + $b,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    &#39;-&#39; =&gt; $a - $b,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    &#39;*&#39; =&gt; $a * $b,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    &#39;/&#39; =&gt; $a / $b,</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    default =&gt; &#39;Operació desconeguda&#39;,</span>
<span class="linenos" data-linenos="11 "></span><span class="x">};</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">echo &quot;El resultat de $a $operacio $b és $resultat.&quot;;  // Sortida: El resultat de 10 + 5 és 15.</span>
</code></pre></div>
</details>

<h4 id="exercici-12-tractament-de-formulari">Exercici 12: Tractament de formulari<a class="headerlink" href="#exercici-12-tractament-de-formulari" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un formulari en HTML que permeti als usuaris introduir el seu nom i edat. Després de l'enviament del formulari, mostra una pàgina PHP que processi les dades introduïdes i mostri un missatge de benvinguda personalitzat.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;html lang=&quot;ca&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &lt;title&gt;Formulari de Benvinguda&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    &lt;h2&gt;Formulari de Benvinguda&lt;/h2&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    &lt;form action=&quot;benvinguda.php&quot; method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        &lt;label for=&quot;nom&quot;&gt;Nom:&lt;/label&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        &lt;input type=&quot;text&quot; id=&quot;nom&quot; name=&quot;nom&quot; required&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        &lt;label for=&quot;edat&quot;&gt;Edat:&lt;/label&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        &lt;input type=&quot;number&quot; id=&quot;edat&quot; name=&quot;edat&quot; required&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        &lt;input type=&quot;submit&quot; value=&quot;Enviar&quot;&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">    &lt;/form&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;html lang=&quot;ca&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &lt;title&gt;Benvinguda&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_METHOD&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>            <span class="nv">$nom</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]);</span>
<span class="linenos" data-linenos="11 "></span>            <span class="nv">$edat</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;edat&#39;</span><span class="p">]);</span>
<span class="linenos" data-linenos="12 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;Benvingut/da, </span><span class="si">$nom</span><span class="s2">!&lt;/h2&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Tens </span><span class="si">$edat</span><span class="s2"> anys.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Si us plau, completa el formulari.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>    <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-13-formulari-en-la-mateixa-pagina">Exercici 13: Formulari en la mateixa pàgina<a class="headerlink" href="#exercici-13-formulari-en-la-mateixa-pagina" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un formulari en HTML que permeta als usuaris introduir la seva adreça de correu electrònic i un missatge. Després de l'enviament del formulari, crea una pàgina PHP que processe les dades introduïdes, comprove que l'adreça de correu electrònic és vàlida i mostre el missatge introduït per l'usuari.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;html lang=&quot;ca&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &lt;title&gt;Formulari de Contacte&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_METHOD&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$email</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]);</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$missatge</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;missatge&#39;</span><span class="p">]);</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_EMAIL</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;Gràcies per contactar-nos!&lt;/h2&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;El teu correu electrònic: </span><span class="si">$email</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;El teu missatge: </span><span class="si">$missatge</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Adreça de correu electrònic no vàlida. Si us plau, torna-ho a intentar.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>        <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">        &lt;h2&gt;Formulari de Contacte&lt;/h2&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">        &lt;form action=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x">&quot; method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">            &lt;label for=&quot;email&quot;&gt;Correu electrònic:&lt;/label&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">            &lt;input type=&quot;email&quot; id=&quot;email&quot; name=&quot;email&quot; required&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="26 "></span><span class="x">            &lt;label for=&quot;missatge&quot;&gt;Missatge:&lt;/label&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="27 "></span><span class="x">            &lt;textarea id=&quot;missatge&quot; name=&quot;missatge&quot; rows=&quot;4&quot; cols=&quot;50&quot; required&gt;&lt;/textarea&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="28 "></span><span class="x">            &lt;input type=&quot;submit&quot; value=&quot;Enviar&quot;&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">        &lt;/form&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">        </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="31 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>    <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="33 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="34 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-14-validacio-de-formulari-amb-match">Exercici 14: Validació de formulari amb <code>match</code><a class="headerlink" href="#exercici-14-validacio-de-formulari-amb-match" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un fitxer que utilitze la instrucció <code>match</code> per validar un formulari amb camps per a nom, correu electrònic i edat. Si algun camp està buit, ha de retornar un missatge d'error corresponent.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$nom = &#39;Joan&#39;;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">$correu = &#39;joan@example.com&#39;;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$edat = &#39;&#39;;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">$validacio = match (true) {</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">empty($nom) =&gt; &#39;El camp nom és obligatori.&#39;,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">!filter_var($correu, FILTER_VALIDATE_EMAIL) =&gt; &#39;El correu electrònic no és vàlid.&#39;,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">empty($edat) =&gt; &#39;El camp edat és obligatori.&#39;,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">default =&gt; &#39;Formulari vàlid.&#39;,</span>
<span class="linenos" data-linenos="10 "></span><span class="x">};</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="x">echo $validacio;  // Sortida: El camp edat és obligatori.</span>
</code></pre></div>

</details>

<h4 id="exercici-15-variables-de-servidor">Exercici 15: Variables de servidor<a class="headerlink" href="#exercici-15-variables-de-servidor" title="Permanent link">&para;</a></h4>
<ol>
<li>Mostra en un fitxer les variables de servidor que conegues</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;html lang=&quot;ca&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &lt;title&gt;Informació del Servidor&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    &lt;h2&gt;Informació del Servidor&lt;/h2&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Nom del servidor:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Adreça IP del servidor:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_ADDR&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Software del servidor:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_SOFTWARE&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Agent d&#39;usuari del client:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_USER_AGENT&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Mètode de la sol·licitud:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;URL de la sol·licitud:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Referent:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;No disponible&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Protocol utilitzat:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_PROTOCOL&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Port utilitzat:&lt;/strong&gt; &quot;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>    <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-16-pujar-fitxers-al-servidor">Exercici 16: Pujar fitxers al servidor<a class="headerlink" href="#exercici-16-pujar-fitxers-al-servidor" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un formulari en HTML que permeti als usuaris pujar un fitxer i seleccionar una opció d'un checkbox. Les opcions del checkbox han de ser carregades des d'un array predefinit en PHP. Després de l'enviament del formulari, el fitxer pujat ha de ser processat i mogut a una ubicació específica del servidor, i s'ha de mostrar la informació del fitxer i l'opció seleccionada.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;html lang=&quot;ca&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &lt;title&gt;Pujar Fitxer i Selecció Opció&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="c1">// Definim les opcions per al checkbox</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$opcions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Opció 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Opció 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Opció 3&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="c1">// Comprovem si el formulari ha estat enviat</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_METHOD&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="c1">// Comprovem si el fitxer ha estat pujat sense errors</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fitxer&quot;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fitxer&quot;</span><span class="p">][</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>            <span class="nv">$nom_fitxer</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fitxer&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="17 "></span>            <span class="nv">$tipus_fitxer</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fitxer&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nv">$mida_fitxer</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fitxer&quot;</span><span class="p">][</span><span class="s2">&quot;size&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="19 "></span>            <span class="nv">$ubicacio_temporal</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fitxer&quot;</span><span class="p">][</span><span class="s2">&quot;tmp_name&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>            <span class="c1">// Movem el fitxer a una ubicació permanent</span>
<span class="linenos" data-linenos="22 "></span>            <span class="nv">$ubicacio_destinacio</span> <span class="o">=</span> <span class="s2">&quot;uploads/&quot;</span> <span class="o">.</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$nom_fitxer</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>            <span class="k">if</span> <span class="p">(</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$ubicacio_temporal</span><span class="p">,</span> <span class="nv">$ubicacio_destinacio</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>                <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;El fitxer &lt;strong&gt;</span><span class="si">$nom_fitxer</span><span class="s2">&lt;/strong&gt; ha estat pujat correctament.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>                <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Tipus de fitxer: </span><span class="si">$tipus_fitxer</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="26 "></span>                <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Mida del fitxer: &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$mida_fitxer</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; KB&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="27 "></span>                <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Ubicació del fitxer: </span><span class="si">$ubicacio_destinacio</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="28 "></span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="29 "></span>                <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Error al moure el fitxer a la ubicació final.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="30 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="32 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Error al pujar el fitxer.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="33 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="34 "></span>
<span class="linenos" data-linenos="35 "></span>        <span class="c1">// Comprovem si una opció del checkbox ha estat seleccionada</span>
<span class="linenos" data-linenos="36 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;opcio&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="37 "></span>            <span class="nv">$opcio_seleccionada</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;opcio&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="38 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Has seleccionat: </span><span class="si">$opcio_seleccionada</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="39 "></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="40 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;No has seleccionat cap opció.&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="41 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="42 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="43 "></span>        <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="44 "></span><span class="x">        &lt;h2&gt;Formulari per Pujar Fitxer i Selecció d&#39;Opció&lt;/h2&gt;</span>
<span class="linenos" data-linenos="45 "></span><span class="x">        &lt;form action=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x">&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
<span class="linenos" data-linenos="46 "></span><span class="x">            &lt;label for=&quot;fitxer&quot;&gt;Selecciona un fitxer:&lt;/label&gt;</span>
<span class="linenos" data-linenos="47 "></span><span class="x">            &lt;input type=&quot;file&quot; id=&quot;fitxer&quot; name=&quot;fitxer&quot; required&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="48 "></span>
<span class="linenos" data-linenos="49 "></span><span class="x">            &lt;label for=&quot;opcio&quot;&gt;Selecciona una opció:&lt;/label&gt;&lt;br&gt;</span>
<span class="linenos" data-linenos="50 "></span><span class="x">            </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="51 "></span>            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$opcions</span> <span class="k">as</span> <span class="nv">$opcio</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="52 "></span>                <span class="k">echo</span> <span class="s1">&#39;&lt;input type=&quot;checkbox&quot; id=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$opcio</span> <span class="o">.</span> <span class="s1">&#39;&quot; name=&quot;opcio&quot; value=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$opcio</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="53 "></span>                <span class="k">echo</span> <span class="s1">&#39;&lt;label for=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$opcio</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt; &#39;</span> <span class="o">.</span> <span class="nv">$opcio</span> <span class="o">.</span> <span class="s1">&#39;&lt;/label&gt;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="54 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos="55 "></span>            <span class="cp">?&gt;</span><span class="x">&lt;br&gt;</span>
<span class="linenos" data-linenos="56 "></span>
<span class="linenos" data-linenos="57 "></span><span class="x">            &lt;input type=&quot;submit&quot; value=&quot;Enviar&quot;&gt;</span>
<span class="linenos" data-linenos="58 "></span><span class="x">        &lt;/form&gt;</span>
<span class="linenos" data-linenos="59 "></span><span class="x">        </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="60 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="61 "></span>    <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="62 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="63 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
</details>

<h3 id="exercicis-proposats">Exercicis proposats<a class="headerlink" href="#exercicis-proposats" title="Permanent link">&para;</a></h3>
<h4 id="exercici-1-manipulacio-de-variables-i-operadors">Exercici 1: Manipulació de Variables i Operadors<a class="headerlink" href="#exercici-1-manipulacio-de-variables-i-operadors" title="Permanent link">&para;</a></h4>
<p>Assigna múltiples variables i utilitza operadors aritmètics i lògics. Mostra el resultat de cada operació.</p>
<h4 id="exercici-2-control-de-flux-amb-bucles">Exercici 2: Control de Flux amb Bucles<a class="headerlink" href="#exercici-2-control-de-flux-amb-bucles" title="Permanent link">&para;</a></h4>
<p>Utilitza un bucle <code>for</code> per imprimir els números parells del 0 al 20.
Fes-ho també amb un bucle <code>while</code>.</p>
<h4 id="exercici-3-treballar-amb-arrays-i-funcions">Exercici 3: Treballar amb Arrays i Funcions<a class="headerlink" href="#exercici-3-treballar-amb-arrays-i-funcions" title="Permanent link">&para;</a></h4>
<p>Escriu una funció que prenga un array de números, calculi la mitjana i retorni el resultat. Utilitza aquesta funció per imprimir la mitjana d'un array de cinc números.</p>
<h4 id="exercici-4-manipulacio-de-strings">Exercici 4: Manipulació de Strings<a class="headerlink" href="#exercici-4-manipulacio-de-strings" title="Permanent link">&para;</a></h4>
<p>Escriu un script que prenga una cadena de text i compti el nombre de vocals. Imprimeix el resultat.</p>
<h4 id="exercici-5-arrays-multidimensionals">Exercici 5: Arrays Multidimensionals<a class="headerlink" href="#exercici-5-arrays-multidimensionals" title="Permanent link">&para;</a></h4>
<p>Crea un array multidimensional que represente una taula de multiplicar del 1 al 5 i imprimeix els resultats en forma de taula.</p>
<h4 id="exercici-6-utilitzant-match-per-a-categoritzar">Exercici 6: Utilitzant <code>match</code> per a categoritzar<a class="headerlink" href="#exercici-6-utilitzant-match-per-a-categoritzar" title="Permanent link">&para;</a></h4>
<p>Crea un fitxer que utilitze la instrucció <code>match</code> per categoritzar una variable <code>$nota</code> segons el següent criteri:
- Si la nota és 10, imprimir "Excel·lent".
- Si la nota és 8 o 9, imprimir "Molt bé".
- Si la nota és 5, 6 o 7, imprimir "Bé".
- Per qualsevol altra nota, imprimir "Insuficient".</p>
<h4 id="exercici-7-validacio-de-formularis">Exercici 7: Validació de Formularis<a class="headerlink" href="#exercici-7-validacio-de-formularis" title="Permanent link">&para;</a></h4>
<p>Crea un formulari en HTML que permetis als usuaris introduir el seu nom, el correu electrònic i un password (dues vegades). Després de l'enviament del formulari, valida que tots els camps han estat completats i que el correu electrònic és vàlid, que el password tinga complexitat i que coincidixen. Mostra un missatge d'error si alguna validació falla, i si tot és correcte, mostra un missatge confirmant que l'usuari s'ha registrat correctament.</p>
<h4 id="exercici-8-processament-de-formularis-amb-select-i-radio-buttons">Exercici 8: Processament de Formularis amb Select i Radio Buttons<a class="headerlink" href="#exercici-8-processament-de-formularis-amb-select-i-radio-buttons" title="Permanent link">&para;</a></h4>
<p>A partir del formulari <a href="recursos/newBook.php">newBook.php</a>, fes que el mòdul i el estat els agafe de valors introduïts en arrays. Mostra el resultat en una taula.  </p>
<h4 id="exercici-9-pujar-imatges-des-de-formulari">Exercici 9: Pujar imatges des de formulari<a class="headerlink" href="#exercici-9-pujar-imatges-des-de-formulari" title="Permanent link">&para;</a></h4>
<p>A partir del formulari anterior fes que es puga pujar una imatge. Mostra la imatge en la taula.</p>
<h3 id="solucions"><a href="10solucions.html#Tema 2: Introducció a PHP">Solucions</a><a class="headerlink" href="#solucions" title="Permanent link">&para;</a></h3>
<h2 id="20-enunciats-dels-projectes">20. Enunciats dels Projectes<a class="headerlink" href="#20-enunciats-dels-projectes" title="Permanent link">&para;</a></h2>
<h3 id="projecte-lofegat">Projecte "L'Ofegat"<a class="headerlink" href="#projecte-lofegat" title="Permanent link">&para;</a></h3>
<p><strong>Enunciat:</strong>
Implementa una versió simplificada del joc "L'Ofegat" utilitzant HTML i PHP. El joc ha de permetre als jugadors endevinar les lletres d'una paraula predefinida i mostrar l'estat actual de les lletres endevinades. No és necessari mantenir l'estat del joc entre sol·licituds ni comprovar si s'han esgotat els intents en aquesta fase inicial.</p>
<p><strong>Requisits:</strong></p>
<ol>
<li><strong>Paraula a Endevinar:</strong><ul>
<li>Defineix una paraula predefinida a endevinar.</li>
</ul>
</li>
<li><strong>Inicialització de les Lletres Endevinades:</strong><ul>
<li>Crea un array amb guions baixos per representar les lletres que l'usuari ha de trobar.</li>
<li>Crea una funció per imprimir este array i que serà el que ens mostre el progres del joc. <strong>(les funcions aniran en un fitxer a part)</strong></li>
</ul>
</li>
<li><strong>Funció per a Comprovar Intents:</strong><ul>
<li>Crea una funció en PHP que prenga la paraula a endevinar, la lletra introduïda per l'usuari i l'array de lletres endevinades (passat per referència).</li>
<li>La funció ha de comprovar si la lletra introduïda per l'usuari forma part de la paraula.</li>
<li>Si la lletra és correcta, la funció substituirà els guions baixos per la lletra corresponent.</li>
<li>La funció retornarà un valor booleà que indique si la lletra és errònia o no.</li>
<li>Fes proves de la funció per comprovar que funciona correctament.</li>
</ul>
</li>
<li><strong>Comprovació d'Intents:</strong><ul>
<li>Utilitza la funció creada per comprovar si la lletra introduïda per l'usuari forma part de la paraula.</li>
<li>Mostra un missatge d'error si la lletra no és correcta.</li>
</ul>
</li>
<li><strong>Interfície d'Usuari:</strong><ul>
<li>Mostra les lletres introduïdes per l'usuari fins al moment en color verd si són encertades o roig si són errades.</li>
<li>Mostra les errades de l'usuari.</li>
<li>Crea un formulari HTML que permeta als jugadors introduir una lletra.</li>
</ul>
</li>
</ol>
<p><strong>Codi CSS Proporcionat</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">.</span><span class="nc">correct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">green</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="2 "></span><span class="p">.</span><span class="nc">incorrect</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">red</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3 id="projecte-4-en-ratlla">Projecte "4 en Ratlla"<a class="headerlink" href="#projecte-4-en-ratlla" title="Permanent link">&para;</a></h3>
<p><strong>Enunciat:</strong>
Implementa una versió simplificada del joc "4 en Ratlla" utilitzant HTML i PHP. El joc ha de permetre als jugadors introduir els seus moviments i mostrar l'estat actual de la graella. No és necessari mantenir l'estat del joc entre sol·licituds ni comprovar si hi ha un guanyador en aquesta fase inicial.</p>
<p><strong>Requisits:</strong></p>
<ol>
<li><strong>Inicialització de la Graella</strong>:<ul>
<li>Crea una funció <code>inicialitzarGraella()</code> que inicialitze una graella buida de 6 files i 7 columnes.</li>
</ul>
</li>
<li><strong>Pintar la Graella</strong>:<ul>
<li>Crea una funció <code>pintarGraella($graella)</code> que pinte la graella en HTML. Utilitza diferents colors per a les fitxes dels jugadors, aplicant el CSS adjunt.</li>
</ul>
</li>
<li><strong>Realitzar Moviments</strong>:<ul>
<li>Crea una funció <code>ferMoviment(&amp;$graella, $columna, $jugadorActual)</code> que realitze un moviment en la columna especificada pel jugador actual.</li>
</ul>
</li>
<li><strong>Interfície d'Usuari</strong>:<ul>
<li>Crea un formulari HTML que permeta als jugadors introduir la columna on volen posar la seua fitxa. Aquest formulari ha de mantenir el jugador actual entre sol·licituds.</li>
</ul>
</li>
</ol>
<p><strong>Codi CSS Proporcionat</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">table</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">border-collapse</span><span class="p">:</span><span class="w"> </span><span class="kc">collapse</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nt">td</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="kc">dotted</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span><span class="w"> </span><span class="c">/* Cercle amb punts blancs */</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span><span class="w"> </span><span class="c">/* Fons negre o pot ser un altre color */</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="w"> </span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="k">vertical-align</span><span class="p">:</span><span class="w"> </span><span class="kc">middle</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">.</span><span class="nc">player1</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">red</span><span class="p">;</span><span class="w"> </span><span class="c">/* Color vermell per un dels jugadors */</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="p">.</span><span class="nc">player2</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">yellow</span><span class="p">;</span><span class="w"> </span><span class="c">/* Color groc per l&#39;altre jugador */</span>
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
<span class="linenos" data-linenos="21 "></span><span class="p">.</span><span class="nc">buid</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span><span class="w"> </span><span class="c">/* Color blanc per cercles buits */</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="k">border-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span><span class="w"> </span><span class="c">/* Puntes negres per millor visibilitat */</span>
<span class="linenos" data-linenos="24 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="rubrica">Rúbrica<a class="headerlink" href="#rubrica" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Criteri</th>
<th>Puntuació Total</th>
<th>Complet(2)</th>
<th>A mitjes(1)</th>
<th>No(0)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Paraula a Endevinar</strong></td>
<td>1</td>
<td>Paraula definida correctament</td>
<td>Paraula definida però amb errors</td>
<td>No s'ha definit la paraula</td>
</tr>
<tr>
<td><strong>Inicialització de les Lletres</strong></td>
<td>3</td>
<td>Array creat correctament</td>
<td>Array creat però amb errors</td>
<td>No s'ha creat l'array</td>
</tr>
<tr>
<td><strong>Funció per a Comprovar Intents</strong></td>
<td>5</td>
<td>Funció creada i funcional</td>
<td>Funció creada però amb errors</td>
<td>No s'ha creat la funció</td>
</tr>
<tr>
<td><strong>Comprovació d'Intents</strong></td>
<td>3</td>
<td>Comprovació realitzada correctament</td>
<td>Comprovació amb errors</td>
<td>No s'ha realitzat la comprovació</td>
</tr>
<tr>
<td><strong>Inicialització de la Graella</strong></td>
<td>4</td>
<td>Funció creada correctament</td>
<td>Funció creada però amb errors</td>
<td>No s'ha creat la funció</td>
</tr>
<tr>
<td><strong>Pintar la Graella</strong></td>
<td>4</td>
<td>Funció creada i funcional</td>
<td>Funció creada però amb errors</td>
<td>No s'ha creat la funció</td>
</tr>
<tr>
<td><strong>Realitzar Moviments</strong></td>
<td>5</td>
<td>Funció creada i funcional</td>
<td>Funció creada però amb errors</td>
<td>No s'ha creat la funció</td>
</tr>
<tr>
<td><strong>Interfícies d'Usuari</strong></td>
<td>6</td>
<td>Interfície correcta i funcional</td>
<td>Interfície creada però amb errors</td>
<td>No s'ha creat la interfície</td>
</tr>
<tr>
<td><strong>Estil CSS</strong></td>
<td>2</td>
<td>CSS aplicat correctament</td>
<td>CSS aplicat però amb errors</td>
<td>No s'ha aplicat el CSS</td>
</tr>
<tr>
<td><strong>Comentaris i Claredat del Codi</strong></td>
<td>1</td>
<td>Codi ben comentat i clar</td>
<td>Codi amb alguns comentaris</td>
<td>Codi sense comentaris o desordenat</td>
</tr>
</tbody>
</table>
<h2 id="21-autoavaluacio-conceptes-basics-de-php">21. Autoavaluació: Conceptes Bàsics de PHP<a class="headerlink" href="#21-autoavaluacio-conceptes-basics-de-php" title="Permanent link">&para;</a></h2>
<h4 id="exercici-1-sintaxi-basica-de-php">Exercici 1: Sintaxi Bàsica de PHP<a class="headerlink" href="#exercici-1-sintaxi-basica-de-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta">Pregunta:<a class="headerlink" href="#pregunta" title="Permanent link">&para;</a></h5>
<p>Quina és la manera correcta d'iniciar i finalitzar un bloc de codi PHP dins d'un fitxer HTML?</p>
<h5 id="opcions">Opcions:<a class="headerlink" href="#opcions" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q1a" name="question1" value="a">
  <label for="q1a">a) `<?php ... ?>`</label><br>
  <input type="radio" id="q1b" name="question1" value="b">
  <label for="q1b">b) `<php> ... </php>`</label><br>
  <input type="radio" id="q1c" name="question1" value="c">
  <label for="q1c">c) `<?php ?> ... <?php end ?>`</label><br>
  <input type="radio" id="q1d" name="question1" value="d">
  <label for="q1d">d) `<script php> ... </script>`</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer1()">
</form>

<p id="result1"></p>

<script>
function checkAnswer1() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question1');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) <?php ... ?>.";
    document.getElementById('result1').innerText = resultText;
}
</script>

<h4 id="exercici-2-variables-i-tipus-de-dades">Exercici 2: Variables i Tipus de Dades<a class="headerlink" href="#exercici-2-variables-i-tipus-de-dades" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_1">Pregunta:<a class="headerlink" href="#pregunta_1" title="Permanent link">&para;</a></h5>
<p>Quina opció mostra el tipus de dades assignat a la variable <code>$nom</code>?</p>
<h5 id="opcions_1">Opcions:<a class="headerlink" href="#opcions_1" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q2a" name="question2" value="a">
  <label for="q2a">a) `echo gettype($nom);`</label><br>
  <input type="radio" id="q2b" name="question2" value="b">
  <label for="q2b">b) `print datatype($nom);`</label><br>
  <input type="radio" id="q2c" name="question2" value="c">
  <label for="q2c">c) `echo typeof($nom);`</label><br>
  <input type="radio" id="q2d" name="question2" value="d">
  <label for="q2d">d) `print type($nom);`</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer2()">
</form>

<p id="result2"></p>

<script>
function checkAnswer2() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question2');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) echo gettype($nom);";
    document.getElementById('result2').innerText = resultText;
}
</script>

<h4 id="exercici-3-estructures-de-control">Exercici 3: Estructures de Control<a class="headerlink" href="#exercici-3-estructures-de-control" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_2">Pregunta:<a class="headerlink" href="#pregunta_2" title="Permanent link">&para;</a></h5>
<p>Quina és la sortida de l'estructura de control següent?
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$numero = 10;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">if ($numero &gt; 5) {</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    echo &quot;Major que 5&quot;;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">} else {</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    echo &quot;Menor o igual a 5&quot;;</span>
<span class="linenos" data-linenos="6 "></span><span class="x">}</span>
</code></pre></div></p>
<h5 id="opcions_2">Opcions<a class="headerlink" href="#opcions_2" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q3a" name="question3" value="a">
  <label for="q3a">a) Major que 5</label><br>
  <input type="radio" id="q3b" name="question3" value="b">
  <label for="q3b">b) Menor o igual a 5</label><br>
  <input type="radio" id="q3c" name="question3" value="c">
  <label for="q3c">c) No imprimeix res</label><br>
  <input type="radio" id="q3d" name="question3" value="d">
  <label for="q3d">d) Error de sintaxi</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer3()">
</form>
<p id="result3"></p>
<script>
function checkAnswer3() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question3');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) Major que 5.";
    document.getElementById('result3').innerText = resultText;
}
</script>

<h4 id="exercici-4-operadors-en-php">Exercici 4: Operadors en PHP<a class="headerlink" href="#exercici-4-operadors-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_3">Pregunta:<a class="headerlink" href="#pregunta_3" title="Permanent link">&para;</a></h5>
<p>Quin serà el valor de <code>$resultat</code> després d'executar el següent codi?
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$resultat = 5 + 2 * 3;</span>
</code></pre></div></p>
<h5 id="opcions_3">Opcions:<a class="headerlink" href="#opcions_3" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q4a" name="question4" value="a">
  <label for="q4a">a) 21</label><br>
  <input type="radio" id="q4b" name="question4" value="b">
  <label for="q4b">b) 11</label><br>
  <input type="radio" id="q4c" name="question4" value="c">
  <label for="q4c">c) 17</label><br>
  <input type="radio" id="q4d" name="question4" value="d">
  <label for="q4d">d) 13</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer4()">
</form>
<p id="result4"></p>
<script>
function checkAnswer4() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question4');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) 11.";
    document.getElementById('result4').innerText = resultText;
}
</script>

<h4 id="exercici-5-arrays-en-php">Exercici 5: Arrays en PHP<a class="headerlink" href="#exercici-5-arrays-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_4">Pregunta:<a class="headerlink" href="#pregunta_4" title="Permanent link">&para;</a></h5>
<p>Com es pot afegir un element al final d'un array en PHP?</p>
<h5 id="opcions_4">Opcions:<a class="headerlink" href="#opcions_4" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q5a" name="question5" value="a">
  <label for="q5a">a) array_add($array, $element);</label><br>
  <input type="radio" id="q5b" name="question5" value="b">
  <label for="q5b">b) $array[] = $element;</label><br>
  <input type="radio" id="q5c" name="question5" value="c">
  <label for="q5c">c) append($array, $element);</label><br>
  <input type="radio" id="q5d" name="question5" value="d">
  <label for="q5d">d) add_to_array($array, $element);</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer5()">
</form>
<p id="result5"></p>
<script>
function checkAnswer5() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question5');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) $array[] = $element;";
    document.getElementById('result5').innerText = resultText;
}
</script>

<h4 id="exercici-6-funcions-en-php">Exercici 6: Funcions en PHP<a class="headerlink" href="#exercici-6-funcions-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_5">Pregunta:<a class="headerlink" href="#pregunta_5" title="Permanent link">&para;</a></h5>
<p>Com es defineix una funció en PHP?</p>
<h5 id="opcions_5">Opcions:<a class="headerlink" href="#opcions_5" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q6a" name="question6" value="a">
  <label for="q6a">a) function: myFunction() { ... }</label><br>
  <input type="radio" id="q6b" name="question6" value="b">
  <label for="q6b">b) def myFunction() { ... }</label><br>
  <input type="radio" id="q6c" name="question6" value="c">
  <label for="q6c">c) function myFunction() { ... }</label><br>
  <input type="radio" id="q6d" name="question6" value="d">
  <label for="q6d">d) fn myFunction() => { ... }</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer6()">
</form>
<p id="result6"></p>
<script>
function checkAnswer6() {
    var correctAnswer = "c";
    var radios = document.getElementsByName('question6');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és c) function myFunction() { ... }";
    document.getElementById('result6').innerText = resultText;
}
</script>

<h4 id="exercici-7-instruccio-switch">Exercici 7: Instrucció switch<a class="headerlink" href="#exercici-7-instruccio-switch" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_6">Pregunta:<a class="headerlink" href="#pregunta_6" title="Permanent link">&para;</a></h5>
<p>Quina instrucció s'utilitza per detenir l'execució d'un cas dins d'un switch en PHP?</p>
<h5 id="opcions_6">Opcions:<a class="headerlink" href="#opcions_6" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q7a" name="question7" value="a">
  <label for="q7a">a) stop</label><br>
  <input type="radio" id="q7b" name="question7" value="b">
  <label for="q7b">b) exit</label><br>
  <input type="radio" id="q7c" name="question7" value="c">
  <label for="q7c">c) halt</label><br>
  <input type="radio" id="q7d" name="question7" value="d">
  <label for="q7d">d) break</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer7()">
</form>
<p id="result7"></p>
<script>
function checkAnswer7() {
    var correctAnswer = "d";
    var radios = document.getElementsByName('question7');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és d) break.";
    document.getElementById('result7').innerText = resultText;
}
</script>
<h1 id="programacio-web">Programació Web<a class="headerlink" href="#programacio-web" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duració i criteris d'evaluació</summary>
<p>Duració estimada: 10 hores</p>
<hr />
<table>
<thead>
<tr>
<th>Resultat d'aprenentatge</th>
<th>Criteris d'avaluació</th>
</tr>
</thead>
<tbody>
<tr>
<td>4. Desenvolupa aplicacions Web embegudes en llenguatges de marques analitzant i incorporant funcionalitats segons especificacions</td>
<td>a) S'han identificat els mecanismes disponibles per al manteniment de la informació que concerneix un client web concret i s'han assenyalat els seus avantatges.<br /> b) S'han utilitzat mecanismes per a mantindre l'estat de les aplicacions web.<br /> c) S'han utilitzat mecanismes per a emmagatzemar informació en el client web i per a recuperar el seu contingut.<br /> d) S'han identificat i caracteritzat els mecanismes disponibles per a l'autenticació d'usuaris.<br /> e) S'han escrit aplicacions que integren mecanismes d'autenticació d'usuaris.<br /> f) S'han utilitzat eines i entorns per a facilitar la programació, prova i depuració del codi.</td>
</tr>
</tbody>
</table>
</details>
<h2 id="1-mecanismes-per-al-manteniment-de-la-informacio-en-aplicacions-web">1.  Mecanismes per al Manteniment de la Informació en Aplicacions Web<a class="headerlink" href="#1-mecanismes-per-al-manteniment-de-la-informacio-en-aplicacions-web" title="Permanent link">&para;</a></h2>
<p>HTTP és un protocol <strong>stateless</strong>, sense estat. En les aplicacions web modernes, és essencial gestionar l'estat del client per proporcionar una experiència d'usuari fluida i personalitzada.
Per això, se simula l'estat mitjançant l'ús de cookies, tokens o la sessió. L'estat és necessari per a processos com ara el carret de la compra, operacions associades a un usuari, etc... 
A continuació es detallen diversos mecanismes per mantenir aquesta informació, així com els seus avantatges i desavantatges.</p>
<h3 id="cookies">Cookies<a class="headerlink" href="#cookies" title="Permanent link">&para;</a></h3>
<p>Les <strong>cookies</strong> són petits fitxers de text emmagatzemats al navegador de l'usuari. Són àmpliament utilitzades per mantenir l'estat del client entre sol·licituds HTTP, ja que HTTP és un protocol sense estat.</p>
<h4 id="avantatges-de-les-cookies">Avantatges de les Cookies<a class="headerlink" href="#avantatges-de-les-cookies" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Persistència</strong>: Les cookies poden mantenir-se durant períodes llargs definits per l'atribut <code>expires</code> o <code>max-age</code>.</li>
<li><strong>Accessibilitat</strong>: Es poden accedir des de qualsevol pàgina del mateix domini.</li>
<li><strong>Simplicitat</strong>: Fàcils d'implementar i gestionar.</li>
</ul>
<h4 id="desavantatges-de-les-cookies">Desavantatges de les Cookies<a class="headerlink" href="#desavantatges-de-les-cookies" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Seguretat</strong>: Poden ser objectiu d'atacs com <strong>XSS (Cross-Site Scripting)</strong> si no es gestionen correctament.</li>
<li><strong>Limitacions de mida</strong>: Les cookies estan limitades a 4KB de dades.</li>
<li><strong>Privadesa</strong>: Les dades de l'usuari poden ser vulnerables si no es protegeixen adequadament.</li>
</ul>
<h4 id="millors-practiques">Millors Pràctiques<a class="headerlink" href="#millors-practiques" title="Permanent link">&para;</a></h4>
<ul>
<li>Utilitzar l'atribut <code>HttpOnly</code> per evitar l'accés a les cookies des de JavaScript.</li>
<li>Configurar <code>SameSite</code> per prevenir atacs CSRF.</li>
<li>Emmagatzemar únicament informació essencial i no sensible.</li>
</ul>
<h3 id="sessions">Sessions<a class="headerlink" href="#sessions" title="Permanent link">&para;</a></h3>
<p>Les <strong>sessions</strong> són un mecanisme que permet associar dades a un usuari durant una sessió específica. Aquestes dades s'emmagatzemen al servidor, mentre que el client només guarda un identificador de sessió.</p>
<h4 id="avantatges-de-les-sessions">Avantatges de les Sessions<a class="headerlink" href="#avantatges-de-les-sessions" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Seguretat</strong>: Les dades sensibles es mantenen al servidor.</li>
<li><strong>Capacitat d'emmagatzematge</strong>: No limitades per la mida de les cookies.</li>
<li><strong>Compartició de dades</strong>: Facilita la compartició d'estat entre diferents components d'una aplicació web.</li>
</ul>
<h4 id="desavantatges-de-les-sessions">Desavantatges de les Sessions<a class="headerlink" href="#desavantatges-de-les-sessions" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Escalabilitat</strong>: Requereix memòria addicional al servidor, la qual cosa pot ser problemàtica amb molts usuaris.</li>
<li><strong>Persistència limitada</strong>: Normalment només duren mentre el navegador està obert, tret que es configuri d'una altra manera.</li>
</ul>
<h4 id="millors-practiques_1">Millors Pràctiques<a class="headerlink" href="#millors-practiques_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Emmagatzemar únicament referències o identificadors a la sessió.</li>
<li>Utilitzar eines com Redis per a una gestió eficient de sessions en entorns escalables.</li>
</ul>
<h3 id="web-storage">Web Storage<a class="headerlink" href="#web-storage" title="Permanent link">&para;</a></h3>
<p>El <strong>Web Storage</strong> és una API del navegador que permet emmagatzemar dades al client de manera més senzilla i amb més capacitat que les cookies tradicionals. Inclou dos mecanismes principals: <code>localStorage</code> i <code>sessionStorage</code>.</p>
<h4 id="caracteristiques-del-web-storage">Característiques del Web Storage<a class="headerlink" href="#caracteristiques-del-web-storage" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>localStorage</code></strong>: Permet emmagatzemar dades que persisteixen fins que s'elimina explícitament, fins i tot després de tancar el navegador.</li>
<li><strong><code>sessionStorage</code></strong>: Les dades es mantenen només durant la sessió del navegador i s'esborren quan es tanca la pestanya o finestra.</li>
</ul>
<h4 id="avantatges">Avantatges<a class="headerlink" href="#avantatges" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Capacitat d'Emmagatzematge</strong>: Ofereix més espai (fins a 5-10MB) que les cookies.</li>
<li><strong>API Simple</strong>: Proporciona una interfície senzilla per emmagatzemar i recuperar dades.</li>
</ul>
<h4 id="usos-comuns">Usos Comuns<a class="headerlink" href="#usos-comuns" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Manteniment de l'Estat del Client</strong>: Pot guardar dades de sessió i preferències de l'usuari que no cal enviar al servidor.</li>
<li><strong>Sincronització amb l'Entorn Servidor</strong>: Es pot utilitzar per emmagatzemar dades que després es sincronitzen amb el servidor, millorant el rendiment i l'experiència d'usuari.</li>
</ul>
<h4 id="consideracions-de-seguretat">Consideracions de Seguretat<a class="headerlink" href="#consideracions-de-seguretat" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Accessibilitat</strong>: Les dades són accessibles per JavaScript, per la qual cosa s'ha de tenir cura amb les vulnerabilitats XSS.</li>
<li><strong>Dades Sensibles</strong>: Evita emmagatzemar dades sensibles o confidencials.</li>
</ul>
<p>Tot i que <strong>Web Storage</strong> s'executa al costat del client, entendre les seves funcionalitats pot ajudar els desenvolupadors del servidor a dissenyar sistemes més robustos i eficaços, on la cooperació entre client i servidor maximitza l'eficiència de l'aplicació web.</p>
<h3 id="tokens-dautenticacio">Tokens d'Autenticació<a class="headerlink" href="#tokens-dautenticacio" title="Permanent link">&para;</a></h3>
<p>Els <strong>JSON Web Tokens (JWT)</strong> són un estàndard obert que defineix una manera compacta i autònoma d'enviar informació entre dues parts de manera segura com a objecte JSON. S'utilitzen habitualment per a l'autenticació en aplicacions web.</p>
<h4 id="avantatges-dels-jwt">Avantatges dels JWT<a class="headerlink" href="#avantatges-dels-jwt" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Estatut autònom</strong>: Porten tota la informació necessària, eliminant la necessitat de mantenir sessions al servidor.</li>
<li><strong>Escalabilitat</strong>: Milloren l'escalabilitat en aplicacions distribuïdes.</li>
<li><strong>Seguretat</strong>: Es poden signar digitalment per assegurar la seva autenticitat.</li>
</ul>
<h4 id="desavantatges-dels-jwt">Desavantatges dels JWT<a class="headerlink" href="#desavantatges-dels-jwt" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Revocació complexa</strong>: Una vegada emesos, és difícil revocar-los sense mantenir una llista negra.</li>
<li><strong>Sobrecarrega de dades</strong>: Si els tokens són grans, poden afectar el rendiment, especialment en xarxes de baixa latència.</li>
</ul>
<h4 id="millors-practiques_2">Millors Pràctiques<a class="headerlink" href="#millors-practiques_2" title="Permanent link">&para;</a></h4>
<ul>
<li>Utilitzar signatura HS256 o RS256 per garantir la integritat del token.</li>
<li>No emmagatzemar dades sensibles directament al token.</li>
</ul>
<h3 id="cache-del-navegador">Cache del Navegador<a class="headerlink" href="#cache-del-navegador" title="Permanent link">&para;</a></h3>
<p>El <strong>cache del navegador</strong> s'utilitza per emmagatzemar còpies temporals de recursos web per millorar el rendiment i reduir la càrrega del servidor.</p>
<h4 id="avantatges-del-cache">Avantatges del Cache<a class="headerlink" href="#avantatges-del-cache" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Rendiment</strong>: Redueix el temps de càrrega dels recursos.</li>
<li><strong>Optimització</strong>: Disminueix l'ample de banda requerit.</li>
</ul>
<h4 id="desavantatges-del-cache">Desavantatges del Cache<a class="headerlink" href="#desavantatges-del-cache" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Consistència</strong>: Pot servir dades obsoletes si no es gestiona correctament.</li>
<li><strong>Control</strong>: Requereix configuració per evitar el caching indesitjat de dades dinàmiques.</li>
</ul>
<h4 id="millors-practiques_3">Millors Pràctiques<a class="headerlink" href="#millors-practiques_3" title="Permanent link">&para;</a></h4>
<ul>
<li>Configurar els encapçalaments HTTP correctament (<code>Cache-Control</code>, <code>ETag</code>) per gestionar l'actualització de recursos.</li>
</ul>
<h3 id="sincronitzacio-offline">Sincronització Offline<a class="headerlink" href="#sincronitzacio-offline" title="Permanent link">&para;</a></h3>
<p>La <strong>sincronització offline</strong> es refereix a la capacitat d'una aplicació web de funcionar sense connexió a Internet, sincronitzant dades quan es recupera la connexió.</p>
<h4 id="tecniques-i-eines">Tècniques i Eines<a class="headerlink" href="#tecniques-i-eines" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>IndexedDB</strong>: Emmagatzema grans volums de dades estructurades dins del navegador.</li>
<li><strong>Service Workers</strong>: Gestionen peticions de xarxa, proporcionant funcionalitats offline i cache avançat.</li>
</ul>
<h4 id="millors-practiques_4">Millors Pràctiques<a class="headerlink" href="#millors-practiques_4" title="Permanent link">&para;</a></h4>
<ul>
<li>Gestionar conflictes de dades quan es torna a estar en línia.</li>
<li>Utilitzar estratègies de sincronització optimitzades per minimitzar l'ample de banda i el temps de sincronització.</li>
</ul>
<h3 id="seguretat-de-les-cookies-i-sessions">Seguretat de les Cookies i Sessions<a class="headerlink" href="#seguretat-de-les-cookies-i-sessions" title="Permanent link">&para;</a></h3>
<p>La <strong>seguretat</strong> és fonamental en la gestió de cookies i sessions per protegir les dades dels usuaris de possibles atacs.</p>
<h4 id="practiques-de-seguretat">Pràctiques de Seguretat<a class="headerlink" href="#practiques-de-seguretat" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>CSRF</strong>: Utilitzar tokens CSRF per validar sol·licituds d'accions sensibles.</li>
<li><strong>XSS</strong>: Sanear les dades d'entrada i utilitzar capçaleres de seguretat (<code>Content-Security-Policy</code>) per prevenir XSS.</li>
<li><strong>Secure Flag</strong>: Marcar les cookies amb l'atribut <code>Secure</code> perquè només s'enviïn a través de connexions HTTPS.</li>
</ul>
<h4 id="conclusio">Conclusió<a class="headerlink" href="#conclusio" title="Permanent link">&para;</a></h4>
<p>La selecció del mecanisme adequat per al manteniment de l'estat en una aplicació web depèn de les necessitats específiques de l'aplicació, el volum de dades, els requisits de seguretat i l'arquitectura del sistema. Avaluar cada tècnica pel que fa a avantatges i desavantatges ajudarà a prendre decisions informades i construir aplicacions web més segures i eficients.</p>
<h2 id="2exemples-de-cookies-i-sessions-en-php">2.Exemples de Cookies i Sessions en PHP<a class="headerlink" href="#2exemples-de-cookies-i-sessions-en-php" title="Permanent link">&para;</a></h2>
<h3 id="cookies_1">Cookies<a class="headerlink" href="#cookies_1" title="Permanent link">&para;</a></h3>
<p>Les cookies s'emmagatzemen en el array global <code>$_COOKIE</code>. El que col·loquem dins del array, es guardarà en el client. Cal tindre present que el client pot no voler emmagatzemar-les.</p>
<p>Existeix una limitació de 20 cookies per domini i 300 en total en el navegador.</p>
<p>En PHP, per a crear una cookie s'utilitza la funció <code>setcookie</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nb">setcookie</span><span class="p">(</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="s1">&#39;nom_cookie&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="s1">&#39;valor_cookie&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">[</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="s1">&#39;expires&#39;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="c1">// 1 hora</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="s1">&#39;domain&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// Domini actual</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="s1">&#39;secure&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// Només HTTPS</span>
<span class="linenos" data-linenos="10 "></span>        <span class="s1">&#39;httponly&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// Només accessible via HTTP</span>
<span class="linenos" data-linenos="11 "></span>        <span class="s1">&#39;samesite&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Lax&#39;</span> <span class="c1">// o &#39;Strict&#39; o &#39;None&#39;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">]</span>
<span class="linenos" data-linenos="13 "></span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span><span class="cp">?&gt;</span>
</code></pre></div>
Destacar que el nom no pot contindre espais ni el caràcter <code>;</code>. Respecte al contingut de la cookie, no pot superar els 4 KB.</p>
<h4 id="consideracions-de-seguretat-per-a-cookies">Consideracions de seguretat per a cookies:<a class="headerlink" href="#consideracions-de-seguretat-per-a-cookies" title="Permanent link">&para;</a></h4>
<p><strong>HTTPOnly</strong>: Assegura't que les cookies que contenen informació sensible no siguin accessibles per JavaScript utilitzant l'atribut HttpOnly.</p>
<p><strong>Secure</strong>: Utilitza l'atribut Secure per assegurar que les cookies només es transmeten en connexions HTTPS.</p>
<p><strong>SameSite</strong>: Defineix correctament l'atribut SameSite per a prevenir atacs CSRF (Cross-Site Request Forgery).</p>
<p>Per exemple, mitjançant <em>cookies</em> podem comprovar la quantitat de visites diferents que realitza un usuari:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$accesosPagina </span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;accesos&#39;</span><span class="p">]))</span> <span class="p">{</span> 
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$accesosPagina </span><span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;accesos&#39;</span><span class="p">];</span> <span class="c1">// recuperamos una cookie</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;accesos&#39;</span><span class="p">,</span> <span class="o">++</span><span class="nv">$accesosPagina</span><span class="p">);</span> <span class="c1">// le asignamos un valor</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
<span class="linenos" data-linenos="7 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Inspeccionant les cookies</p>
<p>Si volem veure que contenen les cookies que tenim emmagatzemades en el navegador, es pot comprovar el seu valor en Dev Tools &rarr; Application &rarr; Storage</p>
</div>
<p>El temps de vida de les cookies pot ser tan llarg com el lloc web en el qual resideixen. Elles seguiran ací, fins i tot si el navegador està tancat o obert.</p>
<p>Per a esborrar una cookie es pot posar que expiren en el passat:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">setcookie</span><span class="p">(</span><span class="nx">nombre</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// pasado</span>
</code></pre></div>
<p>O que caduquen dins d'un període de temps deteminado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">setcookie</span><span class="p">(</span><span class="nx">nombre</span><span class="p">,</span> <span class="nx">valor</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">)</span> <span class="c1">// Caducan dentro de una hora</span>
</code></pre></div>
<figure style="align: center;">
    <img src="imagenes/04/04cookies.png" width="700">
    <figcaption>Comunicació amb cookies</figcaption>
</figure>

<p>S'utilitzen per a:</p>
<ul>
<li>Recordar els inicis de sessió</li>
<li>Emmagatzemar valors temporals d'usuari</li>
<li>Si un usuari està navegant per una llista paginada d'articles, ordenats d'una certa manera, podem emmagatzemar l'ajust de la classificació.</li>
</ul>
<p>L'alternativa en el client per a emmagatzemar informació en el navegador és l'objecte <a href="https://developer.mozilla.org/es/docs/web/api/window/localstorage">LocalStorage</a>.</p>
<h3 id="sessio">Sessió<a class="headerlink" href="#sessio" title="Permanent link">&para;</a></h3>
<p>La sessió afig la gestió de l'estat a HTTP, emmagatzemant en aquest cas la informació en el servidor.
Cada visitant té un ID de sessió únic, el qual per defecte s'emmagatzema en una cookie denominada <code>PHPSESSID</code>.
Si el client no té les cookies actives, l'ID es propaga en cada URL dins del mateix domini.
Cada sessió té associat un magatzem de dades mitjançant el array global <code>$_SESSION</code>, en el qual podem emmagatzemar i recuperar informació.</p>
<p>La sessió comença en executar un script PHP. Es genera un nou ID i es carreguen les dades del magatzem:</p>
<figure style="align: center;">
    <img src="imagenes/04/04sesion.png" width="700">
    <figcaption>Comunicació amb sessions</figcaption>
</figure>

<p>Les operacions que podem realitzar amb la sessió són:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">session_start</span><span class="p">();</span> <span class="c1">// carga la sesión</span>
<span class="linenos" data-linenos="3 "></span><span class="nb">session_regenerate_id</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// regenera el id</span>
<span class="linenos" data-linenos="4 "></span><span class="nb">session_id</span><span class="p">()</span> <span class="c1">// devuelve el id</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nx">clave</span><span class="p">]</span> <span class="o">=</span> <span class="nx">valor</span><span class="p">;</span> <span class="c1">// inserción</span>
<span class="linenos" data-linenos="6 "></span><span class="nb">session_destroy</span><span class="p">();</span> <span class="c1">// destruye la sesión</span>
<span class="linenos" data-linenos="7 "></span><span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nx">clave</span><span class="p">];</span> <span class="c1">// borrado</span>
</code></pre></div>
<p>Veurem mitjançant un exemple com podem inserir en un pàgina dades en la sessió per a posteriorment en una altra pàgina accedir a aqueixes dades. Per exemple, en <code>sesion.php</code> tindríem</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Iniciar sessió</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nb">session_regenerate_id</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// Establir valors de sessió</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;usuari&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;JohnDoe&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<p>I posteriorment podem accedir a la sessió en <code>sesion1.php</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">// Recuperar valors de sessió</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">echo</span> <span class="s1">&#39;Usuari: &#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;usuari&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">echo</span> <span class="s1">&#39;Rol: &#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">// Tancar sessió de forma segura</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nb">session_unset</span><span class="p">();</span>  <span class="c1">// Eliminar totes les variables de sessió</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nb">session_destroy</span><span class="p">();</span>  <span class="c1">// Destruir la sessió</span>
<span class="linenos" data-linenos="10 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Configurant la sessió en <code>php.ini</code></p>
<p>Les següent propietats de <code>php.ini</code> permeten configurar alguns aspectes de la sessió:</p>
<ul>
<li><code>session.save_handler</code>: controlador que gestiona com s'emmagatzema (<code>files</code>)</li>
<li><code>session.save_path</code>: ruta on s'emmagatzemen els arxius amb les dades (si tenim un clúster, podríem usar <code>/mnt/sessions</code> en tots els servidor de manera que apunten a una carpeta compartida)</li>
<li><code>session.name</code>: nom de la sessió (<code>PHSESSID</code>)</li>
<li><code>session.acte_start</code>: Es pot fer que s'autocarregue amb cada script. Per defecte està deshabilitat</li>
<li><code>session.cookie_lifetime</code>: temps de vida per defecte</li>
</ul>
</div>
<p>Més informació en la <a href="https://www.php.net/manual/es/session.configuration.php">documentació oficial</a>.</p>
<h3 id="serialitzacio-en-php">Serialització en PHP<a class="headerlink" href="#serialitzacio-en-php" title="Permanent link">&para;</a></h3>
<p>La serialització és el procés de convertir una estructura de dades o un objecte en una seqüència de caràcters que pot ser fàcilment emmagatzemada o transmesa i després reconstruïda. PHP proporciona dos funcions principals per a això: serialize() i unserialize().</p>
<ol>
<li>serialize()
   La funció serialize() en PHP s'utilitza per a convertir una estructura de dades o un objecte en una representació de cadena.</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$data = array(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$serialized_data = serialize($data);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">echo $serialized_data;</span>
</code></pre></div>
Eixida </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">a:3:{i:0;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;s:1:&quot;c&quot;;}</span>
</code></pre></div>
<ol start="2">
<li>unserialize()
   La funció unserialize() en PHP s'utilitza per a convertir la representació de cadena serialitzada de nou en una estructura de dades o un objecte.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$original_data = unserialize($serialized_data);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">print_r($original_data);</span>
</code></pre></div>
<p>Eixida</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">Array</span>
<span class="linenos" data-linenos="2 "></span><span class="x">(</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    [0] =&gt; a</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    [1] =&gt; b</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    [2] =&gt; c</span>
<span class="linenos" data-linenos="6 "></span><span class="x">)</span>
</code></pre></div>
<h4 id="utilitzant-amb-sessions">Utilitzant amb Sessions<a class="headerlink" href="#utilitzant-amb-sessions" title="Permanent link">&para;</a></h4>
<p>Les sessions en PHP permeten emmagatzemar informació d'usuari per ser utilitzada en diverses pàgines. Pot ser útil serialitzar dades per a emmagatzemar-les en una sessió:</p>
<p>Iniciant una sessió i emmagatzemant dades serialitzades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">session_start();</span>
<span class="linenos" data-linenos="2 "></span><span class="x">session_regenerate_id(true);</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="x">$data = array(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">$_SESSION[&#39;data_serialitzada&#39;] = serialize($data);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">session_start();</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="x">if (isset($_SESSION[&#39;data_serialitzada&#39;])) {</span>
<span class="linenos" data-linenos="4 "></span><span class="x">$data = unserialize($_SESSION[&#39;data_serialitzada&#39;]);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">print_r($data);</span>
<span class="linenos" data-linenos="6 "></span><span class="x">}</span>
</code></pre></div>
<p>Consideracions de Seguretat:
És crucial entendre que la funció unserialize() pot ser perillosa si s'usa amb dades que no són de confiança, ja que podria portar a l'execució de codi arbitrari. Per això, mai has de deserialitzar dades que vinguen d'una font desconeguda o no fiable sense validar-les prèviament.</p>
<h2 id="3autenticacio-dusuaris">3.Autenticació d'usuaris<a class="headerlink" href="#3autenticacio-dusuaris" title="Permanent link">&para;</a></h2>
<h3 id="mecanismes-dautenticacio-dusuaris">Mecanismes d'Autenticació d'Usuaris<a class="headerlink" href="#mecanismes-dautenticacio-dusuaris" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Mecanisme d'Autenticació</th>
<th>Característiques</th>
<th>Avantatges</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Bàsica (usuari/contrasenya)</strong></td>
<td>Es requereix un nom d'usuari i una contrasenya per accedir.</td>
<td>Fàcil d'implementar, àmpliament utilitzada.</td>
</tr>
<tr>
<td><strong>Cookies</strong></td>
<td>Emmagatzema informació d'autenticació en el navegador de l'usuari.</td>
<td>Persistència d'inici de sessió, personalització d'experiència.</td>
</tr>
<tr>
<td><strong>Sessions</strong></td>
<td>Manté l'estat d'autenticació en el servidor amb una identificació de sessió única.</td>
<td>Major seguretat, evita la necessitat d'emmagatzemar informació sensible al client.</td>
</tr>
<tr>
<td><strong>OAuth</strong></td>
<td>Permet als usuaris accedir a recursos sense compartir les seves credencials.</td>
<td>Seguretat millorada, experiència d'usuari simplificada.</td>
</tr>
<tr>
<td><strong>JWT (JSON Web Token)</strong></td>
<td>Utilitza tokens basats en JSON per a l'autenticació.</td>
<td>Lliure d'estat, fàcil de compartir entre diferents serveis.</td>
</tr>
<tr>
<td><strong>SAML (Security Assertion Markup Language)</strong></td>
<td>Utilitza XML per a intercanviar dades d'autenticació entre l'usuari i el servei.</td>
<td>Integració amb sistemes d'autenticació empresarial, alt nivell de seguretat.</td>
</tr>
<tr>
<td><strong>Autenticació multifactor (MFA)</strong></td>
<td>Requereix múltiples formes de verificació (per exemple, contrasenya + codi SMS).</td>
<td>Seguretat augmentada, redueix el risc de compromís de comptes.</td>
</tr>
</tbody>
</table>
<h4 id="exemple-amb-sessions">Exemple amb sessions<a class="headerlink" href="#exemple-amb-sessions" title="Permanent link">&para;</a></h4>
<p>Una sessió estableix una relació anònima amb un usuari particular, de manera que podem saber si és el mateix usuari entre dues peticions diferents. Si preparem un sistema de login, podrem saber qui utilitza la nostra aplicació.</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Llista d&#39;usuaris predefinits amb contrasenyes en text pla</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$users</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="s1">&#39;user1@example.com&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="s1">&#39;user2@example.com&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password2&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">];</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// Convertir les contrasenyes a un format encriptat</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$email</span> <span class="o">=&gt;</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$users</span><span class="p">[</span><span class="nv">$email</span><span class="p">]</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="c1">// Formulari d&#39;autenticació</span>
<span class="linenos" data-linenos="14 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>    <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="16 "></span>    <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$users</span><span class="p">[</span><span class="nv">$email</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$users</span><span class="p">[</span><span class="nv">$email</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>        <span class="c1">// L&#39;usuari està autenticat</span>
<span class="linenos" data-linenos="20 "></span>        <span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$email</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">echo</span> <span class="s2">&quot;Login successful. Welcome, &quot;</span> <span class="o">.</span> <span class="nv">$email</span><span class="p">;</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="c1">// Credencials incorrectes</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">echo</span> <span class="s2">&quot;Invalid email or password.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="p">}</span>
<span class="linenos" data-linenos="28 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">&lt;form method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">    Email: &lt;input type=&quot;email&quot; name=&quot;email&quot; required&gt;</span>
<span class="linenos" data-linenos="31 "></span><span class="x">    Password: &lt;input type=&quot;password&quot; name=&quot;password&quot; required&gt;</span>
<span class="linenos" data-linenos="32 "></span><span class="x">    &lt;button type=&quot;submit&quot; name=&quot;login&quot;&gt;Login&lt;/button&gt;</span>
<span class="linenos" data-linenos="33 "></span><span class="x">&lt;/form&gt;</span>
</code></pre></div>
Aquest exemple mostra com mantenir l'estat de la sessió d'un usuari una vegada autenticat.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: login.php&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">exit</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// Mostra la pàgina només si l&#39;usuari està autenticat</span>
<span class="linenos" data-linenos="10 "></span><span class="k">echo</span> <span class="s2">&quot;Welcome, &quot;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="11 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<p>Finalment, necessitem l'opció de tancar la sessió que col·loquem en <code>logout.php</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Recuperamos la información de la sesión</span>
<span class="linenos" data-linenos="3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="c1">// Y la destruimos</span>
<span class="linenos" data-linenos="6 "></span><span class="nb">session_destroy</span><span class="p">();</span>
<span class="linenos" data-linenos="7 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: index.php&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="8 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Autenticació en producció</p>
<p>En l'actualitat l'autenticació d'usuari no es realitza gestionant la sessió direcamente, sinó que es realitza mitjançant algun framekwork que abstrau tot el procés o la integració de mecanismes d'autenticació tipus <em>OAuth</em>, com estudiarem en l'última unitat mitjançant <em>Laravel</em>.</p>
</div>
<h4 id="exemple-amb-cookies">Exemple amb cookies<a class="headerlink" href="#exemple-amb-cookies" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Llista d&#39;usuaris predefinits amb contrasenyes en text pla</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$users</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="s1">&#39;user1@example.com&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="s1">&#39;user2@example.com&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password2&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">];</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// Convertir les contrasenyes a un format encriptat</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$email</span> <span class="o">=&gt;</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$users</span><span class="p">[</span><span class="nv">$email</span><span class="p">]</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="15 "></span>    <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$users</span><span class="p">[</span><span class="nv">$email</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$users</span><span class="p">[</span><span class="nv">$email</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>        <span class="c1">// Establir una cookie d&#39;autenticació</span>
<span class="linenos" data-linenos="19 "></span>        <span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="nv">$email</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">86400</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span> <span class="s2">&quot;/&quot;</span><span class="p">);</span> <span class="c1">// 86400 = 1 dia</span>
<span class="linenos" data-linenos="20 "></span>        <span class="k">echo</span> <span class="s2">&quot;Login successful. Welcome, &quot;</span> <span class="o">.</span> <span class="nv">$email</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="22 "></span>        <span class="c1">// Credencials incorrectes</span>
<span class="linenos" data-linenos="23 "></span>        <span class="k">echo</span> <span class="s2">&quot;Invalid email or password.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="p">}</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span><span class="c1">// Llegir la cookie</span>
<span class="linenos" data-linenos="28 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="29 "></span>    <span class="k">echo</span> <span class="s2">&quot;Welcome back, &quot;</span> <span class="o">.</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="30 "></span><span class="p">}</span>
<span class="linenos" data-linenos="31 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="32 "></span><span class="x">&lt;form method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="33 "></span><span class="x">    Email: &lt;input type=&quot;email&quot; name=&quot;email&quot; required&gt;</span>
<span class="linenos" data-linenos="34 "></span><span class="x">    Password: &lt;input type=&quot;password&quot; name=&quot;password&quot; required&gt;</span>
<span class="linenos" data-linenos="35 "></span><span class="x">    &lt;button type=&quot;submit&quot; name=&quot;login&quot;&gt;Login&lt;/button&gt;</span>
<span class="linenos" data-linenos="36 "></span><span class="x">&lt;/form&gt;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Seguretat en cookies</p>
<p>Les cookies són vulnerables a atacs com <em>Cross-Site Scripting (XSS)</em> i <em>Cross-Site Request Forgery (CSRF)</em>. Per a protegir-les, s'ha de configurar la cookie com a segura i només accessible a través de la web.</p>
</div>
<h4 id="exemple-amb-jwt">Exemple amb JWT<a class="headerlink" href="#exemple-amb-jwt" title="Permanent link">&para;</a></h4>
<p>Aquest exemple mostra com generar i verificar un JWT per a l'autenticació.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">function</span> <span class="nf">base64UrlEncode</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">return</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span> <span class="s1">&#39;+/&#39;</span><span class="p">,</span> <span class="s1">&#39;-_&#39;</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">function</span> <span class="nf">base64UrlDecode</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">return</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;-_&#39;</span><span class="p">,</span> <span class="s1">&#39;+/&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">function</span> <span class="nf">createJWT</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="nv">$payload</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$headerEncoded</span> <span class="o">=</span> <span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$header</span><span class="p">));</span>
<span class="linenos" data-linenos="12 "></span>    <span class="nv">$payloadEncoded</span> <span class="o">=</span> <span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$payload</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$signature</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$headerEncoded</span><span class="s2">.</span><span class="si">$payloadEncoded</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>    <span class="nv">$signatureEncoded</span> <span class="o">=</span> <span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nv">$signature</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">$headerEncoded</span><span class="s2">.</span><span class="si">$payloadEncoded</span><span class="s2">.</span><span class="si">$signatureEncoded</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span><span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="k">function</span> <span class="nf">verifyJWT</span><span class="p">(</span><span class="nv">$jwt</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">list</span><span class="p">(</span><span class="nv">$headerEncoded</span><span class="p">,</span> <span class="nv">$payloadEncoded</span><span class="p">,</span> <span class="nv">$signatureEncoded</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nv">$jwt</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    <span class="nv">$signature</span> <span class="o">=</span> <span class="nx">base64UrlDecode</span><span class="p">(</span><span class="nv">$signatureEncoded</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>    <span class="nv">$expectedSignature</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$headerEncoded</span><span class="s2">.</span><span class="si">$payloadEncoded</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$signature</span> <span class="o">===</span> <span class="nv">$expectedSignature</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="27 "></span>        <span class="k">return</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nx">base64UrlDecode</span><span class="p">(</span><span class="nv">$payloadEncoded</span><span class="p">));</span>
<span class="linenos" data-linenos="28 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="linenos" data-linenos="31 "></span><span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="c1">// Exemples d&#39;ús</span>
<span class="linenos" data-linenos="34 "></span><span class="nv">$header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;HS256&#39;</span><span class="p">,</span> <span class="s1">&#39;typ&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;JWT&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="35 "></span><span class="nv">$payload</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user1@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">];</span>
<span class="linenos" data-linenos="36 "></span><span class="nv">$secret</span> <span class="o">=</span> <span class="s1">&#39;your_secret_key&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="37 "></span>
<span class="linenos" data-linenos="38 "></span><span class="nv">$jwt</span> <span class="o">=</span> <span class="nx">createJWT</span><span class="p">(</span><span class="nv">$header</span><span class="p">,</span> <span class="nv">$payload</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">);</span>
<span class="linenos" data-linenos="39 "></span><span class="k">echo</span> <span class="s2">&quot;JWT: &quot;</span> <span class="o">.</span> <span class="nv">$jwt</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="40 "></span>
<span class="linenos" data-linenos="41 "></span><span class="nv">$decoded</span> <span class="o">=</span> <span class="nx">verifyJWT</span><span class="p">(</span><span class="nv">$jwt</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">);</span>
<span class="linenos" data-linenos="42 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$decoded</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="43 "></span>    <span class="k">echo</span> <span class="s2">&quot;JWT valid: &quot;</span> <span class="o">.</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$decoded</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="44 "></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="45 "></span>    <span class="k">echo</span> <span class="s2">&quot;Invalid JWT.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="46 "></span><span class="p">}</span>
<span class="linenos" data-linenos="47 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<h4 id="exemple-amb-mfa">Exemple amb MFA<a class="headerlink" href="#exemple-amb-mfa" title="Permanent link">&para;</a></h4>
<p>Aquest exemple mostra com afegir una capa addicional d'autenticació amb un codi MFA.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">function</span> <span class="nf">sendMFACode</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$code</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">999999</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;mfa_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$code</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="c1">// Simular enviament de codi via email o SMS</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">echo</span> <span class="s2">&quot;Verification code: </span><span class="si">$code</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// En un entorn real, envia el codi per email o SMS.</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="k">function</span> <span class="nf">verifyMFACode</span><span class="p">(</span><span class="nv">$inputCode</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;mfa_code&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$inputCode</span> <span class="o">==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;mfa_code&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;send_code&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>    <span class="nx">sendMFACode</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span><span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;verify_code&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">verifyMFACode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;mfa_code&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">echo</span> <span class="s2">&quot;MFA successful.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="k">echo</span> <span class="s2">&quot;Invalid verification code.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="26 "></span><span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="28 "></span><span class="x">&lt;form method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">    &lt;button type=&quot;submit&quot; name=&quot;send_code&quot;&gt;Send MFA Code&lt;/button&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">&lt;/form&gt;</span>
<span class="linenos" data-linenos="31 "></span><span class="x">&lt;form method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="32 "></span><span class="x">    MFA Code: &lt;input type=&quot;text&quot; name=&quot;mfa_code&quot; required&gt;</span>
<span class="linenos" data-linenos="33 "></span><span class="x">    &lt;button type=&quot;submit&quot; name=&quot;verify_code&quot;&gt;Verify MFA Code&lt;/button&gt;</span>
<span class="linenos" data-linenos="34 "></span><span class="x">&lt;/form&gt;</span>
</code></pre></div>
<h4 id="exemple-amb-oauth">Exemple amb OAuth<a class="headerlink" href="#exemple-amb-oauth" title="Permanent link">&para;</a></h4>
<p>Per a OAuth, es pot utilitzar un proveïdor extern com Google per autenticar els usuaris. Ho vorem més avant.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require_once</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">League\OAuth2\Client\Provider\Google</span><span class="p">([</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="s1">&#39;clientId&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;your-client-id&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="s1">&#39;clientSecret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;your-client-secret&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="s1">&#39;redirectUri&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;your-redirect-url&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">]);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$authUrl</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getAuthorizationUrl</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;oauth2state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: &#39;</span> <span class="o">.</span> <span class="nv">$authUrl</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">exit</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;oauth2state&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>    <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;oauth2state&#39;</span><span class="p">]);</span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">exit</span><span class="p">(</span><span class="s1">&#39;Invalid state&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getAccessToken</span><span class="p">(</span><span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span> <span class="p">[</span>
<span class="linenos" data-linenos="20 "></span>        <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">]);</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getResourceOwner</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>    <span class="nv">$userData</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    <span class="c1">// Mostra la informació de l&#39;usuari</span>
<span class="linenos" data-linenos="27 "></span>    <span class="k">echo</span> <span class="s1">&#39;Hello, &#39;</span> <span class="o">.</span> <span class="nv">$userData</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="28 "></span><span class="p">}</span>
<span class="linenos" data-linenos="29 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<h2 id="4-referencies-addicionals">4. Referències Addicionals<a class="headerlink" href="#4-referencies-addicionals" title="Permanent link">&para;</a></h2>
<p>A continuació es presenten diverses referències que poden ajudar-te a aprofundir en el tema de la gestió de sessions i cookies en PHP.</p>
<h3 id="documentacio-oficial-de-php">Documentació Oficial de PHP<a class="headerlink" href="#documentacio-oficial-de-php" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Sessions a PHP</strong>: La documentació oficial de PHP proporciona informació detallada sobre l'ús de sessions, incloent-hi exemples pràctics i consells de millors pràctiques.</p>
<ul>
<li><a href="https://www.php.net/manual/es/book.session.php">Sessions a PHP</a></li>
</ul>
</li>
<li>
<p><strong>Cookies a PHP</strong>: Trobaràs informació oficial sobre com treballar amb cookies en PHP, amb descripcions d'atributs com <code>HttpOnly</code>, <code>Secure</code> i <code>SameSite</code>.</p>
<ul>
<li><a href="https://www.php.net/manual/es/function.setcookie.php">Cookies a PHP</a></li>
</ul>
</li>
</ul>
<h3 id="articles-i-blocs-tecnics">Articles i Blocs Tècnics<a class="headerlink" href="#articles-i-blocs-tecnics" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>PHP Sessions: Tips &amp; Tricks</strong>: Aquest article discuteix tècniques avançades per gestionar sessions en PHP, amb exemples i millors pràctiques per a la seguretat.</p>
<ul>
<li><a href="https://www.php.net/manual/en/features.sessions.php">PHP Sessions: Tips &amp; Tricks</a></li>
</ul>
</li>
<li>
<p><strong>Handling Cookies Securely in PHP</strong>: Una guia sobre com manejar cookies de manera segura, destacant estratègies per protegir les dades de l'usuari.</p>
<ul>
<li><a href="https://paragonie.com/blog/2015/04/secure-authentication-php-with-long-term-persistence">Handling Cookies Securely in PHP</a></li>
</ul>
</li>
</ul>
<h3 id="llibres-sobre-php">Llibres sobre PHP<a class="headerlink" href="#llibres-sobre-php" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>"Modern PHP: New Features and Good Practices"</strong> de Josh Lockhart: Aquest llibre cobreix les novetats de PHP i les millors pràctiques, incloent la seguretat de sessions i cookies.</p>
</li>
<li>
<p><strong>"PHP Objects, Patterns, and Practice"</strong> de M. Zandstra: Proporciona una visió profunda sobre el disseny de programari amb PHP, incloent-hi aspectes de seguretat relacionats amb sessions i cookies.</p>
</li>
</ul>
<h3 id="guies-de-seguretat-en-desenvolupament-web">Guies de Seguretat en Desenvolupament Web<a class="headerlink" href="#guies-de-seguretat-en-desenvolupament-web" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>OWASP Secure Coding Practices</strong>: Aquesta guia de OWASP ofereix una ràpida referència sobre les millors pràctiques de codificació segura, útils per a protegir les teves aplicacions web.</p>
<ul>
<li><a href="https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/">OWASP Secure Coding Practices</a></li>
</ul>
</li>
<li>
<p><strong>OWASP Cheat Sheet on Session Management</strong>: Una fitxa de referència ràpida de OWASP sobre la gestió de sessions, proporcionant consells de seguretat essencials.</p>
<ul>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html">OWASP Cheat Sheet on Session Management</a></li>
</ul>
</li>
</ul>
<h3 id="conferencies-i-videos-educatius">Conferències i Vídeos Educatius<a class="headerlink" href="#conferencies-i-videos-educatius" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>PHP Conference YouTube Channel</strong>: El canal de YouTube de PHP Conference ofereix vídeos de conferències i xerrades que cobreixen una varietat de temes, incloent sessions i seguretat.</p>
<ul>
<li><a href="https://www.youtube.com/user/phpvideos">PHP Conference YouTube Channel</a></li>
</ul>
</li>
<li>
<p><strong>Laracasts</strong>: Ofereix vídeos d'alta qualitat sobre desenvolupament en PHP i Laravel, amb temes rellevants per a sessions i cookies.</p>
<ul>
<li><a href="https://laracasts.com/">Laracasts</a></li>
</ul>
</li>
</ul>
<h3 id="tutorials-online-i-plataformes-educatives">Tutorials Online i Plataformes Educatives<a class="headerlink" href="#tutorials-online-i-plataformes-educatives" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Stack Overflow PHP Sessions Tag</strong>: Un lloc de consulta on trobar respostes a preguntes freqüents sobre la gestió de sessions en PHP.</p>
<ul>
<li><a href="https://stackoverflow.com/questions/tagged/php+session">Stack Overflow PHP Sessions Tag</a></li>
</ul>
</li>
<li>
<p><strong>Cursos a Udemy sobre PHP</strong>: Cursos que cobreixen des de conceptes bàsics fins a avançats de PHP, incloent-hi la gestió de sessions i cookies.</p>
<ul>
<li><a href="https://www.udemy.com/topic/php/">Cursos a Udemy sobre PHP</a></li>
</ul>
</li>
</ul>
<h2 id="5exercicis">5.Exercicis<a class="headerlink" href="#5exercicis" title="Permanent link">&para;</a></h2>
<h3 id="bateria-dexercicis-solucionats-per-a-la-unitat-de-programacio-web">Bateria d'Exercicis Solucionats per a la Unitat de Programació web<a class="headerlink" href="#bateria-dexercicis-solucionats-per-a-la-unitat-de-programacio-web" title="Permanent link">&para;</a></h3>
<h4 id="exercici-1-crear-una-sessio">Exercici 1: Crear una sessió<a class="headerlink" href="#exercici-1-crear-una-sessio" title="Permanent link">&para;</a></h4>
<p>1.Crea una pàgina PHP que inicialitze una sessió i emmagatzeme el nom i el rol d'un usuari en variables de sessió. Mostra aquests valors a la pàgina web.</p>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Iniciar sessió</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">// Emmagatzemar informació de l&#39;usuari en la sessió</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Joan&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Administrador&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">echo</span> <span class="s1">&#39;Benvingut, &#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="k">echo</span> <span class="s1">&#39;Rol: &#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-2-regenerar-lid-de-sessio">Exercici 2: Regenerar l'ID de sessió<a class="headerlink" href="#exercici-2-regenerar-lid-de-sessio" title="Permanent link">&para;</a></h4>
<ol>
<li>Modifica l'exercici anterior per regenerar l'ID de sessió just després d'emmagatzemar la informació de l'usuari.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Iniciar sessió</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">// Emmagatzemar informació de l&#39;usuari en la sessió</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Joan&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Administrador&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// Regenerar l&#39;ID de sessió</span>
<span class="linenos" data-linenos="10 "></span><span class="nb">session_regenerate_id</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="k">echo</span> <span class="s1">&#39;Benvingut, &#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span><span class="k">echo</span> <span class="s1">&#39;Rol: &#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-3-tancar-la-sessio">Exercici 3: Tancar la sessió<a class="headerlink" href="#exercici-3-tancar-la-sessio" title="Permanent link">&para;</a></h4>
<ol>
<li>Escriu un script PHP que elimine totes les variables de sessió i destrueixi la sessió quan l'usuari tanqui sessió.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Iniciar sessió</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">// Eliminar totes les variables de sessió</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nb">session_unset</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// Destruir la sessió</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nb">session_destroy</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-4-crear-una-cookie-segura">Exercici 4: Crear una cookie segura<a class="headerlink" href="#exercici-4-crear-una-cookie-segura" title="Permanent link">&para;</a></h4>
<ol>
<li>Escriu un script PHP per crear una cookie que emmagatzeme el nom d'usuari amb els atributs de seguretat <code>HttpOnly</code>, <code>Secure</code> i <code>SameSite</code>.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Crear una cookie segura</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">setcookie</span><span class="p">(</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="s1">&#39;nom_usuari&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="s1">&#39;Joan&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">[</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="s1">&#39;expires&#39;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="c1">// 1 hora</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="s1">&#39;domain&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// Domini actual</span>
<span class="linenos" data-linenos="10 "></span>        <span class="s1">&#39;secure&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// Només HTTPS</span>
<span class="linenos" data-linenos="11 "></span>        <span class="s1">&#39;httponly&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// Només accessible via HTTP</span>
<span class="linenos" data-linenos="12 "></span>        <span class="s1">&#39;samesite&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Lax&#39;</span> <span class="c1">// o &#39;Strict&#39; o &#39;None&#39;</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">]</span>
<span class="linenos" data-linenos="14 "></span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-5-llegir-i-modificar-una-cookie">Exercici 5: Llegir i modificar una cookie<a class="headerlink" href="#exercici-5-llegir-i-modificar-una-cookie" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una pàgina PHP que llegeixca el valor d'una cookie anomenada <code>nom_usuari</code> i la modifique afegint un prefix de salutació.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Llegir el valor de la cookie</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$nomUsuari</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">echo</span> <span class="s1">&#39;Hola, &#39;</span> <span class="o">.</span> <span class="nv">$nomUsuari</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// Modificar el valor de la cookie</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$salutacio</span> <span class="o">=</span> <span class="s1">&#39;Hola, &#39;</span> <span class="o">.</span> <span class="nv">$nomUsuari</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">,</span> <span class="nv">$salutacio</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">echo</span> <span class="s1">&#39;Cookie not found.&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</details>

<h4 id="exercici-6-aplicacio-de-gestio-dusuaris-amb-sessions">Exercici 6: Aplicació de gestió d'usuaris amb sessions<a class="headerlink" href="#exercici-6-aplicacio-de-gestio-dusuaris-amb-sessions" title="Permanent link">&para;</a></h4>
<ol>
<li>Desenvolupa una aplicació PHP amb dos scripts: un per iniciar sessió i un altre per tancar sessió. L'aplicació ha de permetre que l'usuari introdueixca el seu nom d'usuari i vega un missatge de benvinguda una vegada haja iniciat sessió.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!-- login.php --&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$nomUsuari</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="c1">// Emmagatzemar el nom d&#39;usuari en la sessió</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$nomUsuari</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="c1">// Redireccionar a la pàgina de benvinguda</span>
<span class="linenos" data-linenos="12 "></span>    <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: welcome.php&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">exit</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    &lt;title&gt;Iniciar Sessió&lt;/title&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">    &lt;h2&gt;Iniciar Sessió&lt;/h2&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">    &lt;form method=&quot;post&quot; action=&quot;login.php&quot;&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">        &lt;label for=&quot;nom_usuari&quot;&gt;Nom d&#39;usuari:&lt;/label&gt;</span>
<span class="linenos" data-linenos="26 "></span><span class="x">        &lt;input type=&quot;text&quot; id=&quot;nom_usuari&quot; name=&quot;nom_usuari&quot; required&gt;</span>
<span class="linenos" data-linenos="27 "></span><span class="x">        &lt;button type=&quot;submit&quot;&gt;Iniciar Sessió&lt;/button&gt;</span>
<span class="linenos" data-linenos="28 "></span><span class="x">    &lt;/form&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!-- logout.php --&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">// Tancar sessió de forma segura</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nb">session_unset</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nb">session_destroy</span><span class="p">();</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// Redireccionar a la pàgina de login</span>
<span class="linenos" data-linenos="10 "></span><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="k">exit</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span><span class="cp">?&gt;</span>
</code></pre></div>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!-- wellcome.php --&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="c1">// Redireccionar a la pàgina de login si no s&#39;ha iniciat sessió</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">exit</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$nomUsuari</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;nom_usuari&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos="12 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">    &lt;title&gt;Benvingut&lt;/title&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    &lt;h2&gt;Benvingut, </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$nomUsuari</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x">!&lt;/h2&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">    &lt;p&gt;Aquesta és la teva pàgina de benvinguda.&lt;/p&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">    &lt;a href=&quot;logout.php&quot;&gt;Tancar Sessió&lt;/a&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>

</details>

<h4 id="exercici-7-aplicacio-de-gestio-de-preferencies-amb-cookies">Exercici 7: Aplicació de gestió de preferències amb cookies<a class="headerlink" href="#exercici-7-aplicacio-de-gestio-de-preferencies-amb-cookies" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una aplicació PHP que permeta als usuaris seleccionar el seu color preferit, emmagatzemant aquesta informació en una cookie. La pàgina hauria de mostrar el color preferit de l'usuari en futures visites.</li>
</ol>
<details>
<summary>Solució</summary>

    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Llegir el color preferit de la cookie</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$colorPreferit</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;color_preferit&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;color_preferit&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;blau&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$colorPreferit</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;color_preferit&#39;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="c1">// Emmagatzemar el color preferit en una cookie</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;color_preferit&#39;</span><span class="p">,</span> <span class="nv">$colorPreferit</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">    &lt;title&gt;Preferències de Color&lt;/title&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">&lt;body style=&quot;background-color: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$colorPreferit</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">    &lt;h2&gt;Preferències de Color&lt;/h2&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">        &lt;label for=&quot;color_preferit&quot;&gt;Color preferit:&lt;/label&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">        &lt;select id=&quot;color_preferit&quot; name=&quot;color_preferit&quot;&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">            &lt;option value=&quot;blau&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$colorPreferit</span> <span class="o">===</span> <span class="s1">&#39;blau&#39;</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39;selected&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&gt;Blau&lt;/option&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">            &lt;option value=&quot;vermell&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$colorPreferit</span> <span class="o">===</span> <span class="s1">&#39;vermell&#39;</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39;selected&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&gt;Vermell&lt;/option&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">            &lt;option value=&quot;verd&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$colorPreferit</span> <span class="o">===</span> <span class="s1">&#39;verd&#39;</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39;selected&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&gt;Verd&lt;/option&gt;</span>
<span class="linenos" data-linenos="26 "></span><span class="x">        &lt;/select&gt;</span>
<span class="linenos" data-linenos="27 "></span><span class="x">        &lt;button type=&quot;submit&quot;&gt;Guardar&lt;/button&gt;</span>
<span class="linenos" data-linenos="28 "></span><span class="x">    &lt;/form&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
</details>

<h3 id="exercicis-proposats_1">Exercicis proposats<a class="headerlink" href="#exercicis-proposats_1" title="Permanent link">&para;</a></h3>
<h4 id="exercici-1-sistema-de-carret-de-compres-sense-base-de-dades">Exercici 1: Sistema de Carret de Compres sense Base de Dades<a class="headerlink" href="#exercici-1-sistema-de-carret-de-compres-sense-base-de-dades" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Descripció:</strong></li>
</ol>
<p>Desenvolupa una aplicació PHP que permeta als usuaris afegir productes a un carret de compres i mostrar el contingut del carret. Utilitza sessions per a mantindre l'estat del carret entre pàgines.</p>
<ol start="2">
<li><strong>Requisits:</strong><ul>
<li>Crear una pàgina on l'usuari puga seleccionar productes.</li>
<li>Afegir els productes seleccionats a un carret emmagatzemat en una sessió.</li>
<li>Mostrar un resum del carret amb els productes afegits i les seues quantitats.</li>
<li>Permetre que l'usuari elimine productes del carret.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ca&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Selecció de productes<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Afegir productes al carret<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;carret.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="10 "></span>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;producte&quot;</span><span class="p">&gt;</span>Tria un producte:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;producte&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;producte&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="12 "></span>            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Poma&quot;</span><span class="p">&gt;</span>Poma<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="13 "></span>            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Plàtan&quot;</span><span class="p">&gt;</span>Plàtan<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="14 "></span>            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Taronja&quot;</span><span class="p">&gt;</span>Taronja<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="16 "></span>        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Afegir al carret&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;carret.php&quot;</span><span class="p">&gt;</span>Veure carret<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="exercici-2-autenticacio-basica-dusuaris-amb-sessions">Exercici 2: Autenticació Bàsica d'Usuaris amb Sessions<a class="headerlink" href="#exercici-2-autenticacio-basica-dusuaris-amb-sessions" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Descripció:</strong></li>
</ol>
<p>Crea una aplicació PHP que permeta als usuaris iniciar sessió mitjançant un formulari. Utilitza sessions per a mantindre l'estat d'autenticació de l'usuari i mostrar missatges personalitzats basats en aquest estat.</p>
<ol start="2">
<li><strong>Requisits:</strong><ul>
<li>Crear un formulari d'inici de sessió que sol·licite el nom d'usuari i la contrasenya.</li>
<li>Emmagatzemar l'estat d'autenticació en una sessió després de verificar les credencials.</li>
<li>Mostrar una pàgina de benvinguda personalitzada per a l'usuari autenticat.</li>
<li>Proporcionar un enllaç per a tancar sessió i destruir la sessió.</li>
</ul>
</li>
</ol>
<h4 id="exercici-3-recordatori-dusuari-amb-cookies">Exercici 3: Recordatori d'Usuari amb Cookies<a class="headerlink" href="#exercici-3-recordatori-dusuari-amb-cookies" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Descripció:</strong></li>
</ol>
<p>Afig una funcionalitat de "recordar-me" a l'exercici anterior que emmagatzeme el nom d'usuari en una cookie i permeta a l'usuari ser recordat en futures visites al lloc web.</p>
<ol start="2">
<li><strong>Requisits:</strong><ul>
<li>Afig una opció de "recordar-me" al formulari d'inici de sessió.</li>
<li>Emmagatzemar el nom d'usuari en una cookie quan l'opció és seleccionada.</li>
<li>Comprovar la cookie en futures visites i iniciar sessió automàticament si la cookie existeix.</li>
<li>Assegurar que les cookies es configuren amb atributs de seguretat adequats (<code>HttpOnly</code>, <code>Secure</code>, <code>SameSite</code>).</li>
</ul>
</li>
</ol>
<h4 id="exercici-4-formulari-de-contacte-amb-proteccio-csrf">Exercici 4: Formulari de Contacte amb Protecció CSRF<a class="headerlink" href="#exercici-4-formulari-de-contacte-amb-proteccio-csrf" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Descripció:</strong></li>
</ol>
<p>Desenvolupa un formulari de contacte que permeta als usuaris enviar missatges i implementa protecció CSRF per a assegurar que les sol·licituds siguen legítimes.</p>
<ol start="2">
<li><strong>Requisits:</strong><ul>
<li>Crear un formulari de contacte amb camps per al nom, correu electrònic i missatge.</li>
<li>Generar i emmagatzemar un token CSRF en una sessió quan es carrega el formulari.</li>
<li>Incloure el token CSRF com a camp ocult en el formulari.</li>
<li>Verificar el token CSRF quan s'envia el formulari i mostrar un missatge de confirmació si és vàlid.</li>
<li>Mostrar un missatge d'error si el token CSRF no és vàlid o no existeix.</li>
</ul>
</li>
</ol>
<h4 id="exercici-5-seguiment-dactivitat-de-lusuari-amb-sessions">Exercici 5: Seguiment d'Activitat de l'Usuari amb Sessions<a class="headerlink" href="#exercici-5-seguiment-dactivitat-de-lusuari-amb-sessions" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Descripció:</strong></li>
</ol>
<p>Crea un sistema que registre les pàgines visitades per l'usuari durant una sessió i mostre aquesta informació quan l'usuari visita una pàgina d'activitat.</p>
<ol start="2">
<li><strong>Requisits:</strong><ul>
<li>Emmagatzemar una llista de pàgines visitades per l'usuari en una sessió.</li>
<li>Actualitzar la llista de pàgines cada vegada que l'usuari visite una nova pàgina.</li>
<li>Crear una pàgina que mostre l'historial de pàgines visitades durant la sessió actual.</li>
<li>Assegurar que l'historial es restableix quan l'usuari tanca la sessió.</li>
</ul>
</li>
</ol>
<h3 id="solucions_1"><a href="10solucions.html#tema-3-programacio-web">Solucions</a><a class="headerlink" href="#solucions_1" title="Permanent link">&para;</a></h3>
<h2 id="6-enunciats-dels-projectes">6. Enunciats dels projectes<a class="headerlink" href="#6-enunciats-dels-projectes" title="Permanent link">&para;</a></h2>
<h3 id="per-als-dos-projectes">Per als dos projectes<a class="headerlink" href="#per-als-dos-projectes" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Autenticació de Jugadors:</strong><ul>
<li>Implementa un sistema d'autenticació bàsic que permeta als jugadors iniciar sessió abans de començar el joc. Utilitza sessions per a mantindre l'estat d'autenticació.</li>
<li>Ha de servir per als dos jocs, "Penjat" i "4 en Ratlla".</li>
<li>Fes que una vegada autenticar l'usuari puga triar a quin joc vol jugar (en la mateix pàgina).</li>
<li>Protegeix els jocs per tal que no es puga jugar en cas de no estar autenticat.</li>
</ul>
</li>
</ol>
<h3 id="projecte-penjat">Projecte Penjat<a class="headerlink" href="#projecte-penjat" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Manteniment de l'Estat del Joc amb Sessions:</strong></p>
<ul>
<li>Utilitza sessions per a emmagatzemar l'estat actual del joc, incloent la paraula a endevinar, lletres endevinades, i el nombre d'intents restants.</li>
</ul>
</li>
<li>
<p><strong>Gestió de la Sessió del Joc:</strong></p>
<ul>
<li>Afegeix funcionalitats per a reiniciar el joc en qualsevol moment, reinicialitzant les variables de sessió per a començar una nova partida.</li>
<li>Afegeix una opció per a tancar sessió i finalitzar la partida actual.</li>
<li>Afegeix un funció per a saver si el joc ha acabat, ja siga perquè s'han endevinat totes les lletres o s'haguen arribat al màxim número d'intents permesos.</li>
<li>Controla el final del joc</li>
</ul>
</li>
<li>
<p><strong>Cookies per a Recordar Jugadors:</strong></p>
<ul>
<li>Implementa cookies per a recordar els jugadors entre visites, permetent que l'usuari siga recordat si selecciona una opció de "Recordar-me" durant l'inici de sessió.</li>
</ul>
</li>
<li>
<p><strong>Seguretat i Autenticació:</strong></p>
<ul>
<li>Implementa un sistema d'autenticació bàsic per a garantir que només els jugadors autenticats puguen accedir al joc.</li>
<li>Utilitza sessions per a mantenir l'estat d'autenticació i controlar l'accés a les funcionalitats del joc.</li>
</ul>
</li>
</ol>
<h4 id="consideracions-addicionals">Consideracions Addicionals<a class="headerlink" href="#consideracions-addicionals" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Resiliència del Joc:</strong> Implementa la lògica necessària per a manejar intents invàlids i mostrar missatges d'error adequats.</li>
<li><strong>Millores d'Interfície:</strong> Afegix un enllaç o botó per a tancar sessió i una opció per a reiniciar el joc.</li>
</ul>
<hr />
<h3 id="projecte-4-en-ratlla_1">Projecte "4 en Ratlla"<a class="headerlink" href="#projecte-4-en-ratlla_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Gestió de l'Estat de la Graella amb Sessions:</strong></p>
<ul>
<li>Utilitza sessions per a emmagatzemar l'estat actual de la graella i el torn del jugador. Això permet mantenir la partida entre sol·licituds.</li>
</ul>
</li>
<li>
<p><strong>Manteniment de la Sessió entre Jugadors:</strong></p>
<ul>
<li>Emmagatzema l'identificador de cada jugador en sessions per a assegurar que el torn actual siga persistent entre sol·licituds.</li>
<li>Afegeix funcionalitats per a reiniciar el joc en qualsevol moment, reinicialitzant les variables de sessió per a començar una nova partida.</li>
<li>Afegeix una opció per a tancar sessió i finalitzar la partida actual.</li>
<li>Afegeix un funció per a saver si el joc ha acabat, ja siga perquè s'ha fet 4 en ratlla  o s'haja completat el tauler.</li>
<li>Controla el final del joc.</li>
</ul>
</li>
<li>
<p><strong>Cookies per a la Persistència d'Usuaris:</strong></p>
<ul>
<li>Permet l'ús de cookies per a recordar els jugadors entre visites si han seleccionat "Recordar-me". Utilitza cookies per a emmagatzemar l'últim jugador autenticat.</li>
</ul>
</li>
<li>
<p><strong>Seguretat i Autenticació:</strong></p>
<ul>
<li>Implementa un sistema d'autenticació bàsic per a garantir que només els jugadors autenticats puguen accedir al joc.</li>
<li>Utilitza sessions per a mantenir l'estat d'autenticació i controlar l'accés a les funcionalitats del joc.</li>
</ul>
</li>
<li>
<p><strong>Addicional</strong></p>
<ul>
<li>Implementa la lògica per tal que el segon jugador siga la màquina (pots adaptar i/o millorar l'algorisme de baix).</li>
<li>Controla el joc per a que no es puga seguir jugant una vegada acabat.</li>
<li>Implementa un sistema de puntuació que otorgue 2 punts al guanyador i 1 a cadascú en cas d'empat.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">function jugar(&amp;$graella,$jugadorActual){</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">       $opponent = $jugadorActual === 1 ? 2 : 1;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">       // Comprovar si pots guanyar</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">       for ($col = 1; $col &lt;= COLUMNES; $col++) {</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">           if (isValidMove($graella, $col)) {</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">               $tempBoard = $graella;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">               $coord = ferMoviment($tempBoard, $col, $jugadorActual);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">               if (fi_joc($tempBoard, $coord)) {</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                   return ferMoviment($graella,$col,$jugadorActual); // Guanyar immediatament</span>
<span class="linenos" data-linenos="13 "></span><span class="x">               }</span>
<span class="linenos" data-linenos="14 "></span><span class="x">           }</span>
<span class="linenos" data-linenos="15 "></span><span class="x">       }</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="x">       // Comprovar si l&#39;oponent pot guanyar i bloquejar</span>
<span class="linenos" data-linenos="18 "></span><span class="x">       for ($col = 1; $col &lt;= COLUMNES; $col++) {</span>
<span class="linenos" data-linenos="19 "></span><span class="x">           if (isValidMove($graella, $col)) {</span>
<span class="linenos" data-linenos="20 "></span><span class="x">               $tempBoard = $graella;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">               $coord = ferMoviment($tempBoard, $col, $opponent);</span>
<span class="linenos" data-linenos="22 "></span><span class="x">               if (fi_joc($tempBoard, $coord )) {</span>
<span class="linenos" data-linenos="23 "></span><span class="x">                   return ferMoviment($graella,$col,$jugadorActual); // Bloquejar</span>
<span class="linenos" data-linenos="24 "></span><span class="x">               }</span>
<span class="linenos" data-linenos="25 "></span><span class="x">           }</span>
<span class="linenos" data-linenos="26 "></span><span class="x">       }</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span><span class="x">       // Estratègia: buscar el millor moviment</span>
<span class="linenos" data-linenos="29 "></span><span class="x">       // Podem afegir més lògica aquí per seleccionar el millor moviment</span>
<span class="linenos" data-linenos="30 "></span><span class="x">       $possibles = array();</span>
<span class="linenos" data-linenos="31 "></span><span class="x">       for ($col = 1; $col &lt;= COLUMNES; $col++) {</span>
<span class="linenos" data-linenos="32 "></span><span class="x">           if (isValidMove($graella, $col)) {</span>
<span class="linenos" data-linenos="33 "></span><span class="x">               $possibles[] = $col; </span>
<span class="linenos" data-linenos="34 "></span><span class="x">           }</span>
<span class="linenos" data-linenos="35 "></span><span class="x">       }</span>
<span class="linenos" data-linenos="36 "></span><span class="x">       if (count($possibles)&gt;2) {</span>
<span class="linenos" data-linenos="37 "></span><span class="x">           $random = rand(-1,1);</span>
<span class="linenos" data-linenos="38 "></span><span class="x">       }</span>
<span class="linenos" data-linenos="39 "></span><span class="x">       $middle = (int) (count($possibles) / 2)+$random;</span>
<span class="linenos" data-linenos="40 "></span><span class="x">       $inthemiddle = $possibles[$middle];</span>
<span class="linenos" data-linenos="41 "></span><span class="x">       return ferMoviment($graella, $inthemiddle, $jugadorActual); </span>
<span class="linenos" data-linenos="42 "></span>
<span class="linenos" data-linenos="43 "></span><span class="x">       return -1; // Totes les columnes estan plenes</span>
<span class="linenos" data-linenos="44 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="consideracions-addicionals_1">Consideracions Addicionals<a class="headerlink" href="#consideracions-addicionals_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Lògica de Torn de Jugadors:</strong> Implementa la lògica necessària per a canviar de torn entre els jugadors utilitzant sessions.</li>
<li><strong>Reinici de Partida:</strong> Afegeix una opció per a reiniciar el joc, que ha de restablir les sessions i permetre començar de nou.</li>
<li><strong>Interfície d'Usuari Amigable:</strong> Assegura't que la interfície d'usuari és clara i proporciona indicacions visuals dels moviments i torns dels jugadors.</li>
</ul>
<h3 id="rubrica-davaluacio">Rúbrica d'Avaluació<a class="headerlink" href="#rubrica-davaluacio" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Criteri</th>
<th>Excel·lent (4)</th>
<th>Bé (3)</th>
<th>Adequat (2)</th>
<th>Insuficient (1)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Funcionalitat del Joc</strong></td>
<td>El joc està completament funcional i sense errors.</td>
<td>El joc està majoritàriament funcional amb errors mínims.</td>
<td>El joc és funcional, però conté errors significatius.</td>
<td>El joc no és funcional o està incomplet.</td>
</tr>
<tr>
<td><strong>Ús de Sessions</strong></td>
<td>Sessions ben implementades per a mantenir l'estat del joc.</td>
<td>Sessions utilitzades correctament amb alguns problemes menors.</td>
<td>Sessions utilitzades, però amb deficiències importants.</td>
<td>No s'han utilitzat sessions o són incorrectes.</td>
</tr>
<tr>
<td><strong>Ús de Cookies</strong></td>
<td>Cookies ben utilitzades per a recordar els jugadors.</td>
<td>Cookies utilitzades adequadament amb algunes millores possibles.</td>
<td>Cookies utilitzades amb limitacions evidents.</td>
<td>No s'han utilitzat cookies o són incorrectes.</td>
</tr>
<tr>
<td><strong>Autenticació d'Usuaris</strong></td>
<td>Autenticació segura i efectiva implementada.</td>
<td>Autenticació implementada amb alguns problemes.</td>
<td>Autenticació present però amb deficiències notables.</td>
<td>No s'ha implementat autenticació o és incorrecta.</td>
</tr>
<tr>
<td><strong>Interfície d'Usuari</strong></td>
<td>Interfície atractiva i fàcil d'utilitzar.</td>
<td>Interfície clara amb algunes millores possibles.</td>
<td>Interfície funcional però poc intuïtiva.</td>
<td>Interfície confusa i difícil d'utilitzar.</td>
</tr>
<tr>
<td><strong>Seguretat</strong></td>
<td>Totes les mesures de seguretat implementades correctament.</td>
<td>Seguretat adequada amb algunes millores possibles.</td>
<td>Mesures de seguretat bàsiques implementades.</td>
<td>No s'han tingut en compte mesures de seguretat.</td>
</tr>
<tr>
<td><strong>Comentaris i Codi</strong></td>
<td>Codi ben comentat i fàcilment llegible.</td>
<td>Codi clar amb comentaris adequats.</td>
<td>Codi llegible però amb pocs comentaris.</td>
<td>Codi desordenat i sense comentaris.</td>
</tr>
<tr>
<td><strong>Innovació i Creativitat</strong></td>
<td>El projecte mostra innovació significativa.</td>
<td>Algunes idees creatives han estat implementades.</td>
<td>Alguna creativitat present, però limitada.</td>
<td>Cap creativitat o innovació en el projecte.</td>
</tr>
<tr>
<td><strong>Punts addicionals</strong></td>
<td>1 punt per cadascúna aconseguida.</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="explicacio-dels-criteris">Explicació dels Criteris<a class="headerlink" href="#explicacio-dels-criteris" title="Permanent link">&para;</a></h3>
<h4 id="funcionalitat-del-joc">Funcionalitat del Joc<a class="headerlink" href="#funcionalitat-del-joc" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> El joc funciona completament segons les especificacions, amb totes les funcionalitats implementades i sense errors. Els jugadors poden interaccionar amb el joc tal com s'esperava i totes les accions es realitzen correctament.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> El joc no és funcional, falten parts importants del codi o el joc no es pot jugar correctament.</p>
</li>
</ul>
<h4 id="us-de-sessions">Ús de Sessions<a class="headerlink" href="#us-de-sessions" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> Les sessions s'utilitzen eficaçment per a mantenir l'estat del joc i de l'usuari entre sol·licituds. Les dades de la sessió es gestionen de manera adequada per a preservar l'experiència de l'usuari.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> No s'han utilitzat sessions o la seva implementació és incorrecta, la qual cosa afecta negativament l'experiència de l'usuari.</p>
</li>
</ul>
<h4 id="us-de-cookies">Ús de Cookies<a class="headerlink" href="#us-de-cookies" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> Les cookies s'utilitzen de manera efectiva per a recordar els jugadors entre sessions, amb la configuració adequada d'atributs de seguretat (<code>HttpOnly</code>, <code>Secure</code>, <code>SameSite</code>).</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> No s'han utilitzat cookies o la seva implementació és incorrecta, amb una configuració de seguretat deficient.</p>
</li>
</ul>
<h4 id="autenticacio-dusuaris">Autenticació d'Usuaris<a class="headerlink" href="#autenticacio-dusuaris" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> L'autenticació dels usuaris és segura i eficient, amb mecanismes adequats per a validar les credencials i protegir la informació dels usuaris.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> No s'ha implementat un sistema d'autenticació o el sistema present és insegur i defectuós.</p>
</li>
</ul>
<h4 id="interficie-dusuari">Interfície d'Usuari<a class="headerlink" href="#interficie-dusuari" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> La interfície d'usuari és atractiva, clara i fàcil de navegar, proporcionant una experiència d'usuari òptima.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> La interfície és confusa, difícil d'utilitzar o inacabada.</p>
</li>
</ul>
<h4 id="seguretat">Seguretat<a class="headerlink" href="#seguretat" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> Totes les mesures de seguretat necessàries han estat implementades, incloent-hi la validació de dades d'entrada, protecció CSRF i altres pràctiques de seguretat recomanades.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> No s'han tingut en compte mesures de seguretat, deixant el projecte vulnerable a possibles atacs.</p>
</li>
</ul>
<h4 id="comentaris-i-codi">Comentaris i Codi<a class="headerlink" href="#comentaris-i-codi" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> El codi està ben comentat, és llegible i segueix bones pràctiques de programació.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> El codi està desordenat, difícil de llegir i manca de comentaris explicatius.</p>
</li>
</ul>
<h4 id="innovacio-i-creativitat">Innovació i Creativitat<a class="headerlink" href="#innovacio-i-creativitat" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Excel·lent (4):</strong> El projecte mostra un alt grau d'innovació i creativitat, oferint característiques o enfocaments únics que milloren el joc.</p>
</li>
<li>
<p><strong>Insuficient (1):</strong> El projecte manca de creativitat o innovació, seguint únicament les instruccions bàsiques sense cap valor afegit.</p>
</li>
</ul>
<hr />
<h4 id="notes-addicionals">Notes Addicionals<a class="headerlink" href="#notes-addicionals" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Consistència del Codi:</strong> S'espera que el codi sigui consistent, utilitzant convencions de noms adequades i estructures de codi clares.</li>
<li><strong>Adaptació de les Necessitats:</strong> Els criteris poden ser adaptats segons les necessitats específiques del curs o dels projectes individuals.</li>
</ul>
<h2 id="7-autoavaluacio-gestio-de-sessions-i-cookies">7. Autoavaluació: Gestió de Sessions i Cookies<a class="headerlink" href="#7-autoavaluacio-gestio-de-sessions-i-cookies" title="Permanent link">&para;</a></h2>
<h4 id="exercici-1-funcions-de-les-cookies">Exercici 1: Funcions de les Cookies<a class="headerlink" href="#exercici-1-funcions-de-les-cookies" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_7">Pregunta:<a class="headerlink" href="#pregunta_7" title="Permanent link">&para;</a></h5>
<p>Quina és la funció principal de les cookies en el context del desenvolupament web?</p>
<h5 id="opcions_7">Opcions:<a class="headerlink" href="#opcions_7" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q1a" name="question1" value="a">
  <label for="q1a">a) Guardar els fitxers de l'usuari al servidor.</label><br>
  <input type="radio" id="q1b" name="question1" value="b">
  <label for="q1b">b) Emmagatzemar informació del client per personalitzar l'experiència d'usuari.</label><br>
  <input type="radio" id="q1c" name="question1" value="c">
  <label for="q1c">c) Executar codi al servidor.</label><br>
  <input type="radio" id="q1d" name="question1" value="d">
  <label for="q1d">d) Controlar la velocitat de la connexió a Internet.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer1()">
</form>

<p id="result1"></p>

<script>
function checkAnswer1() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question1');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) Emmagatzemar informació del client per personalitzar l'experiència d'usuari.";
    document.getElementById('result1').innerText = resultText;
}
</script>

<h4 id="exercici-2-seguretat-de-les-cookies">Exercici 2: Seguretat de les Cookies<a class="headerlink" href="#exercici-2-seguretat-de-les-cookies" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_8">Pregunta:<a class="headerlink" href="#pregunta_8" title="Permanent link">&para;</a></h5>
<p>Quins atributs de seguretat haurien de tindre les cookies per protegir-les contra atacs?</p>
<h5 id="opcions_8">Opcions:<a class="headerlink" href="#opcions_8" title="Permanent link">&para;</a></h5>
<form>
  <input type="checkbox" id="q2a" name="question2" value="a">
  <label for="q2a">a) Secure</label><br>
  <input type="checkbox" id="q2b" name="question2" value="b">
  <label for="q2b">b) HttpOnly</label><br>
  <input type="checkbox" id="q2c" name="question2" value="c">
  <label for="q2c">c) SameSite</label><br>
  <input type="checkbox" id="q2d" name="question2" value="d">
  <label for="q2d">d) CrossSite</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer2()">
</form>

<p id="result2"></p>

<script>
function checkAnswer2() {
    var correctAnswers = ["a", "b", "c"];
    var checkboxes = document.getElementsByName('question2');
    var userAnswers = [];
    for (var i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked) {
            userAnswers.push(checkboxes[i].value);
        }
    }
    userAnswers.sort();
    var resultText = (JSON.stringify(userAnswers) === JSON.stringify(correctAnswers))
        ? "Correcte!"
        : "Incorrecte. Les respostes correctes són a) Secure, b) HttpOnly, c) SameSite.";
    document.getElementById('result2').innerText = resultText;
}
</script>

<h4 id="exercici-3-creacio-de-sessions-en-php">Exercici 3: Creació de Sessions en PHP<a class="headerlink" href="#exercici-3-creacio-de-sessions-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_9">Pregunta:<a class="headerlink" href="#pregunta_9" title="Permanent link">&para;</a></h5>
<p>Quin dels següents passos és necessari per iniciar una sessió en PHP?</p>
<h5 id="opcions_9">Opcions:<a class="headerlink" href="#opcions_9" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q3a" name="question3" value="a">
  <label for="q3a">a) Cridar a la funció session_start().</label><br>
  <input type="radio" id="q3b" name="question3" value="b">
  <label for="q3b">b) Utilitzar la funció session_open().</label><br>
  <input type="radio" id="q3c" name="question3" value="c">
  <label for="q3c">c) Assignar un valor a la variable $_SESSION.</label><br>
  <input type="radio" id="q3d" name="question3" value="d">
  <label for="q3d">d) No es necessita cap funció especial.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer3()">
</form>

<p id="result3"></p>

<script>
function checkAnswer3() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question3');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) Cridar a la funció session_start().";
    document.getElementById('result3').innerText = resultText;
}
</script>

<h4 id="exercici-4-manteniment-dinformacio-en-sessions">Exercici 4: Manteniment d'Informació en Sessions<a class="headerlink" href="#exercici-4-manteniment-dinformacio-en-sessions" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_10">Pregunta:<a class="headerlink" href="#pregunta_10" title="Permanent link">&para;</a></h5>
<p>Com es pot mantindre la informació d'un usuari durant la sessió d'una aplicació web?</p>
<h5 id="opcions_10">Opcions:<a class="headerlink" href="#opcions_10" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q4a" name="question4" value="a">
  <label for="q4a">a) Utilitzant la variable global $GLOBALS.</label><br>
  <input type="radio" id="q4b" name="question4" value="b">
  <label for="q4b">b) Utilitzant la variable $_SESSION.</label><br>
  <input type="radio" id="q4c" name="question4" value="c">
  <label for="q4c">c) Utilitzant la variable $_COOKIE.</label><br>
  <input type="radio" id="q4d" name="question4" value="d">
  <label for="q4d">d) Utilitzant arxius temporals al servidor.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer4()">
</form>

<p id="result4"></p>

<script>
function checkAnswer4() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question4');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) Utilitzant la variable $_SESSION.";
    document.getElementById('result4').innerText = resultText;
}
</script>

<h4 id="exercici-5-funcions-de-php-per-a-sessions">Exercici 5: Funcions de PHP per a Sessions<a class="headerlink" href="#exercici-5-funcions-de-php-per-a-sessions" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_11">Pregunta:<a class="headerlink" href="#pregunta_11" title="Permanent link">&para;</a></h5>
<p>Quina funció de PHP es fa servir per destruir una sessió?</p>
<h5 id="opcions_11">Opcions:<a class="headerlink" href="#opcions_11" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q5a" name="question5" value="a">
  <label for="q5a">a) session_destroy()</label><br>
  <input type="radio" id="q5b" name="question5" value="b">
  <label for="q5b">b) session_unset()</label><br>
  <input type="radio" id="q5c" name="question5" value="c">
  <label for="q5c">c) session_delete()</label><br>
  <input type="radio" id="q5d" name="question5" value="d">
  <label for="q5d">d) session_end()</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer5()">
</form>

<p id="result5"></p>

<script>
function checkAnswer5() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question5');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) session_destroy().";
    document.getElementById('result5').innerText = resultText;
}
</script>

<h4 id="exercici-6-avantatges-de-les-sessions">Exercici 6: Avantatges de les Sessions<a class="headerlink" href="#exercici-6-avantatges-de-les-sessions" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_12">Pregunta:<a class="headerlink" href="#pregunta_12" title="Permanent link">&para;</a></h5>
<p>Quins són els avantatges d'utilitzar sessions en lloc de cookies per a mantenir l'estat de l'usuari?</p>
<h5 id="opcions_12">Opcions:<a class="headerlink" href="#opcions_12" title="Permanent link">&para;</a></h5>
<form>
  <input type="checkbox" id="q6a" name="question6" value="a">
  <label for="q6a">a) Les sessions poden emmagatzemar més informació perquè es guarden al servidor.</label><br>
  <input type="checkbox" id="q6b" name="question6" value="b">
  <label for="q6b">b) Les sessions són més segures perquè no s'envien al client.</label><br>
  <input type="checkbox" id="q6c" name="question6" value="c">
  <label for="q6c">c) Les sessions redueixen la càrrega del servidor.</label><br>
  <input type="checkbox" id="q6d" name="question6" value="d">
  <label for="q6d">d) Les sessions no necessiten ser configurades amb atributs de seguretat.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer6()">
</form>

<p id="result6"></p>

<script>
function checkAnswer6() {
    var correctAnswers = ["a", "b"];
    var checkboxes = document.getElementsByName('question6');
    var userAnswers = [];
    for (var i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked) {
            userAnswers.push(checkboxes[i].value);
        }
    }
    userAnswers.sort();
    var resultText = (JSON.stringify(userAnswers) === JSON.stringify(correctAnswers))
        ? "Correcte!"
        : "Incorrecte. Les respostes correctes són a) Les sessions poden emmagatzemar més informació perquè es guarden al servidor, b) Les sessions són més segures perquè no s'envien al client.";
    document.getElementById('result6').innerText = resultText;
}
</script>

<h4 id="exercici-7-autenticacio-dusuaris">Exercici 7: Autenticació d'Usuaris<a class="headerlink" href="#exercici-7-autenticacio-dusuaris" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_13">Pregunta:<a class="headerlink" href="#pregunta_13" title="Permanent link">&para;</a></h5>
<p>Quina és la pràctica recomanada per assegurar la identitat d'un usuari en una aplicació web?</p>
<h5 id="opcions_13">Opcions:<a class="headerlink" href="#opcions_13" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q7a" name="question7" value="a">
  <label for="q7a">a) Utilitzar noms d'usuari i contrasenyes emmagatzemades com a cookies.</label><br>
  <input type="radio" id="q7b" name="question7" value="b">
  <label for="q7b">b) Utilitzar sessions per mantenir l'estat d'autenticació després d'iniciar sessió.</label><br>
  <input type="radio" id="q7c" name="question7" value="c">
  <label for="q7c">c) Emmagatzemar la contrasenya de l'usuari a la URL.</label><br>
  <input type="radio" id="q7d" name="question7" value="d">
  <label for="q7d">d) No utilitzar cap forma d'autenticació.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer7()">
</form>

<p id="result7"></p>

<script>
function checkAnswer7() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question7');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) Utilitzar sessions per mantenir l'estat d'autenticació després d'iniciar sessió.";
    document.getElementById('result7').innerText = resultText;
}
</script>
<h1 id="desenvolupament-daplicacions-web-poo-separacio-de-logica-i-presentacio-gestio-derrors-i-proves">Desenvolupament d'Aplicacions Web: POO, Separació de Lògica i Presentació, Gestió d'Errors i Proves<a class="headerlink" href="#desenvolupament-daplicacions-web-poo-separacio-de-logica-i-presentacio-gestio-derrors-i-proves" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duració i criteris d'avaluació</summary>
<p>Duració estimada: 20 hores</p>
<hr />
<table>
<thead>
<tr>
<th>Resultat d'aprenentatge</th>
<th>Criteris d'avaluació</th>
</tr>
</thead>
<tbody>
<tr>
<td>5. Desenvolupa aplicacions Web identificant i aplicant mecanismes per a separar el codi de presentació de la lògica de negoci.</td>
<td>a) S'han identificat els avantatges de separar la lògica de negoci dels aspectes de presentació de l'aplicació. <br/> b) S'han analitzat tecnologies i mecanismes que permeten realitzar aquesta separació i les seues característiques principals. <br/> c) S'han utilitzat objectes i controls en el servidor per a generar l'aspecte visual de l'aplicació Web en el client. <br/> d) S’han utilitzat formularis generats de forma dinàmica per a respondre als esdeveniments de l'aplicació Web. <br/> e) S'han identificat i aplicat els paràmetres relatius a la configuració de l'aplicació Web. <br/> f) S'han escrit aplicacions Web amb manteniment d'estat i separació de la lògica de negoci. <br/> g) S'han aplicat els principis de la programació orientada a objectes. <br/> g) S'ha provat i documentat el codi.</td>
</tr>
</tbody>
</table>
</details>
<h2 id="1-concepte-de-classes-i-objectes">1. Concepte de classes i Objectes<a class="headerlink" href="#1-concepte-de-classes-i-objectes" title="Permanent link">&para;</a></h2>
<p>PHP segueix un paradigma de programació orientada a objectes (POO) basada en classes.</p>
<p>Un classe és un plantilla que defineix les propietats i mètodes per a poder crear objectes. D'aquest manera, un objecte és una instància d'una classe.</p>
<p>Tant les propietats com els mètodes es defineixen amb una visibilitat (qui pot accedir)</p>
<ul>
<li>Privat - <code>private</code>: Només pot accedir la pròpia classe.</li>
<li>Protegit - <code>protected</code>: Només pot accedir la pròpia classe o els seus descendents.</li>
<li>Público - <code>public</code>: Pot accedir qualsevol altra classe.</li>
</ul>
<p>Per a declarar una classe, s'utilitza la paraula clau <code>class</code> seguit del nom de la classe. Per a instanciar un objecte a partir de la classe, s'utilitza <code>new</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">NomClase</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span><span class="c1">// propiedades</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">// y métodos</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$ob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NomClase</span><span class="p">();</span>
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Classes amb majúscula</p>
<p>Totes les classes comencen per lletra majúscula.</p>
</div>
<p>Quan un projecte creix, és normal modelar les classes mitjançant UML (recordeu Entorns de Desenvolupament?). La classes es representen mitjançant un quadrat, separant el nom, de les propietats i els mètodes:</p>
<p><img alt="UML" src="imagenes/03/uml.png" width="500" /></p>
<p>Una vegada que hem creat un objecte, s'utilitza l'operador <code>-&gt;</code> per a accedir a una propietat o un mètode:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$objeto-&gt;propiedad;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$objeto-&gt;método(parámetros);</span>
</code></pre></div>
<p>Si des de dins de la classe, volem accedir a una propietat o mètode de la mateixa classe, utilitzarem la referència <code>$this</code>;</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$this-&gt;propiedad;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$this-&gt;método(parámetros);  </span>
</code></pre></div>
<p>Així doncs, com a exemple, codificaríem una persona en el fitxer <code>Persona.php</code> com:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Persona </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setNombre</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$nom</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="o">=</span><span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">imprimir</span><span class="p">(){</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="nv">$bruno </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Persona</span><span class="p">();</span> <span class="c1">// creamos un objeto</span>
<span class="linenos" data-linenos="16 "></span><span class="nv">$bruno</span><span class="o">-&gt;</span><span class="na">setNombre</span><span class="p">(</span><span class="s2">&quot;Bruno Díaz&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$bruno</span><span class="o">-&gt;</span><span class="na">imprimir</span><span class="p">();</span>
</code></pre></div>
<p>Encara que es poden declarar diverses classes en el mateix arxiu, és una mala pràctica. Així doncs, cada fitxer contedrá una sola classe, i es nomenarà amb el nom de la classe.</p>
<h2 id="2-principis-de-la-poo">2. Principis de la POO<a class="headerlink" href="#2-principis-de-la-poo" title="Permanent link">&para;</a></h2>
<h3 id="encapsulacio">Encapsulació<a class="headerlink" href="#encapsulacio" title="Permanent link">&para;</a></h3>
<p>Les propietats es defineixen privades o protegides (si volem que les classes heretades puguen accedir).</p>
<p>Per a cada propietat, s'afigen mètodes públics (<em>getter/setter</em>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public setPropiedad(tipo $param)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">public getPropiedad() : tipo</span>
</code></pre></div>
<p>Les constants es defineixen públiques perquè siguen accessibles per tots els recursos.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">MayorMenor </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$mayor</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$menor</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMayor</span><span class="p">(</span><span class="nx">int </span><span class="nv">$may</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mayor </span><span class="o">=</span> <span class="nv">$may</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMenor</span><span class="p">(</span><span class="nx">int </span><span class="nv">$men</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">menor </span><span class="o">=</span> <span class="nv">$men</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getMayor</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mayor</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getMenor</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">menor</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="rebent-i-enviant-objectes">Rebent i enviant objectes<a class="headerlink" href="#rebent-i-enviant-objectes" title="Permanent link">&para;</a></h4>
<p>És recomanable indicar-ho en la mena de paràmetres. Si l'objecte pot retornar nuls es posa <code>?</code> davant del nom de la classe.</p>
<div class="admonition important">
<p class="admonition-title">Objectes per referència</p>
<p>Els objectes que s'envien i reben com a paràmetres sempre es passen per referència.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="hll"><span class="linenos" data-linenos=" 2 "></span><span class="k">function</span> <span class="nf">maymen</span><span class="p">(</span><span class="k">array</span> <span class="nv">$numeros</span><span class="p">)</span> <span class="o">:</span> <span class="o">?</span><span class="nx">MayorMenor </span><span class="p">{</span>
</span><span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$a </span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nv">$numeros</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$b </span><span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nv">$numeros</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$result </span><span class="o">=</span> <span class="k">new</span> <span class="nx">MayorMenor</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">setMayor</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">setMenor</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="nv">$resultado </span><span class="o">=</span>  <span class="nx">maymen</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">388</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">22</span><span class="p">]);</span>
<span class="linenos" data-linenos="14 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Mayor: &quot;</span><span class="o">.</span><span class="nv">$resultado</span><span class="o">-&gt;</span><span class="na">getMayor</span><span class="p">();</span>
<span class="linenos" data-linenos="15 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Menor: &quot;</span><span class="o">.</span><span class="nv">$resultado</span><span class="o">-&gt;</span><span class="na">getMenor</span><span class="p">();</span>
</code></pre></div>
<h4 id="constructor">Constructor<a class="headerlink" href="#constructor" title="Permanent link">&para;</a></h4>
<p>El constructor dels objectes es defineix mitjançant el mètode màgic <code>__construct</code>.
Pot o no tindre paràmetres, però només pot haver-hi un únic constructor.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Persona </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="hll"><span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$nom</span><span class="p">)</span> <span class="p">{</span>
</span><span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span> <span class="o">=</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">imprimir</span><span class="p">(){</span>
<span class="linenos" data-linenos="10 "></span>      <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>      <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="nv">$bruno </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Persona</span><span class="p">(</span><span class="s2">&quot;Bruno Díaz&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span><span class="nv">$bruno</span><span class="o">-&gt;</span><span class="na">imprimir</span><span class="p">();</span>
</code></pre></div>
<h5 id="constructors-en-php-8">Constructors en PHP 8<a class="headerlink" href="#constructors-en-php-8" title="Permanent link">&para;</a></h5>
<p>Una de les grans novetats que ofereix PHP 8 és la simplificació dels constructors amb paràmetres, la qual cosa es coneix com a promoció de les propietats del constructor*.</p>
<p>Per a això, en comptes d'haver de declarar les propietats com a privades o protegides, i després dins del constructor haver d'assignar els paràmetres a estàs propietats, el propi constructor promociona les propietats.</p>
<p>Vegem-ho millor amb un exemple. Imaginem una classe <code>Punt</code> on vulguem emmagatzemar les seues coordenades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Punto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">protected</span> <span class="nx">float</span> <span class="nv">$x</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">protected</span> <span class="nx">float</span> <span class="nv">$y</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">protected</span> <span class="nx">float</span> <span class="nv">$z</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nx">float</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nx">float</span> <span class="nv">$y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nx">float</span> <span class="nv">$z</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">x</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">y</span> <span class="o">=</span> <span class="nv">$y</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">z</span> <span class="o">=</span> <span class="nv">$z</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
<p>En PHP 8, quedaria de la següent manera (molt més curt, la qual cosa facilita la seua llegibilitat):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">Punto</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
<span class="linenos" data-linenos="4 "></span>        <span class="k">protected</span> <span class="nx">float</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span>        <span class="k">protected</span> <span class="nx">float</span> <span class="nv">$y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="linenos" data-linenos="6 "></span>        <span class="k">protected</span> <span class="nx">float</span> <span class="nv">$z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="linenos" data-linenos="7 "></span>    <span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">L'ordre importa</p>
<p>A l'hora de codificar l'ordre dels elements ha de ser:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">class</span> <span class="nc">NombreClase</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="c1">// propiedades</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// constructor</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="c1">// getters - setters</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="c1">// resto de métodos</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="cp">?&gt;</span>
</code></pre></div>
</div>
<h4 id="classes-estatiques">Classes estàtiques<a class="headerlink" href="#classes-estatiques" title="Permanent link">&para;</a></h4>
<p>Són aquelles que tenen propietats i/o mètodes estàtics (també es coneixen com <em>de classe</em>, perquè el seu valor es comparteix entre totes les instàncies de la mateixa classe).</p>
<p>Es declaren amb <code>static</code> i es referencien amb <code>::</code>.</p>
<ul>
<li>Si volem accedir a un mètode estàtic, s'anteposa el nom de la classe: <code>Producte::nuevoProducto()</code>.</li>
<li>Si des d'un mètode volem accedir a una propietat estàtica de la mateixa classe, s'utilitza la referència <code>self</code>: <code>self::$numProductos</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">const</span> <span class="no">IVA</span> <span class="o">=</span> <span class="mf">0.23</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="k">static</span> <span class="nv">$numProductos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">nuevoProducto</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nx">self</span><span class="o">::</span><span class="nv">$numProductos</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="nx">Producto</span><span class="o">::</span><span class="na">nuevoProducto</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$impuesto</span> <span class="o">=</span> <span class="nx">Producto</span><span class="o">::</span><span class="na">IVA</span><span class="p">;</span>
</code></pre></div>
<p>També podem tindre classes normals que tinguen alguna propietat estàtica:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Producto </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">const</span> <span class="no">IVA </span><span class="o">=</span> <span class="mf">0.23</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="k">static</span> <span class="nv">$numProductos </span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">private</span> <span class="nv">$codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string </span><span class="nv">$cod</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nx">self</span><span class="o">::</span><span class="nv">$numProductos</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo </span><span class="o">=</span> <span class="nv">$cod</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">return</span> <span class="s2">&quot;El producto &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="o">.</span><span class="s2">&quot; es el número &quot;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="nv">$numProductos</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$prod1 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Producto</span><span class="p">(</span><span class="s2">&quot;PS5&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="nv">$prod2 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Producto</span><span class="p">(</span><span class="s2">&quot;XBOX Series X&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="nv">$prod3 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Producto</span><span class="p">(</span><span class="s2">&quot;Nintendo Switch&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span><span class="k">echo</span> <span class="nv">$prod3</span><span class="o">-&gt;</span><span class="na">mostrarResumen</span><span class="p">();</span>
</code></pre></div>
<h4 id="introspeccio">Introspecció<a class="headerlink" href="#introspeccio" title="Permanent link">&para;</a></h4>
<p>En treballar amb classes i objectes, existeixen un conjunt de funcions ja definides pel llenguatge que permeten obtindre informació sobre els objectes:</p>
<ul>
<li><code>instanceof</code>: permet comprovar si un objecte és d'una determinada classe</li>
<li><code>get_class</code>: retorna el nom de la classe</li>
<li><code>get_declared_class</code>: retorna un array amb els noms de les classes definides</li>
<li><code>class_àlies</code>: crea un àlies</li>
<li><code>class_exists</code> / <code>method_exists</code> / <code>property_exists</code>: <code>true</code> si la classe / mètode / propietat està definida</li>
<li><code>get_class_methods</code> / <code>get_class_vars</code> / <code>get_object_vars</code>: Retorna un array amb els noms dels mètodes / propietats d'una classe / propietats d'un objecte que són accessibles des d'on es fa la crida.</li>
</ul>
<p>Un exemple d'aquestes funcions pot ser el següent:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$p </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Producto</span><span class="p">(</span><span class="s2">&quot;PS5&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$p instanceof Producto</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">echo</span> <span class="s2">&quot;Es un producto&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">echo</span> <span class="s2">&quot;La clase es &quot;</span><span class="o">.</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nb">class_alias</span><span class="p">(</span><span class="s2">&quot;Producto&quot;</span><span class="p">,</span> <span class="s2">&quot;Articulo&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$c </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Articulo</span><span class="p">(</span><span class="s2">&quot;Nintendo Switch&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">echo</span> <span class="s2">&quot;Un articulo es un &quot;</span><span class="o">.</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nb">print_r</span><span class="p">(</span><span class="nb">get_class_methods</span><span class="p">(</span><span class="s2">&quot;Producto&quot;</span><span class="p">));</span>
<span class="linenos" data-linenos="12 "></span>    <span class="nb">print_r</span><span class="p">(</span><span class="nb">get_class_vars</span><span class="p">(</span><span class="s2">&quot;Producto&quot;</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nb">print_r</span><span class="p">(</span><span class="nb">get_object_vars</span><span class="p">(</span><span class="nv">$p</span><span class="p">));</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$p</span><span class="p">,</span> <span class="s2">&quot;mostrarResumen&quot;</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$p</span><span class="o">-&gt;</span><span class="na">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition caution">
<p class="admonition-title">Clonat</p>
<p>En assignar dos objectes no es copien, es crea una nova referència. Si volem una còpia, cal clonar-ho mitjançant el mètode <code>clone(object) : object</code></p>
<p>Si volem modificar el clonat per defecte, cal definir el mètode màgic <code>__clone()</code> que es dirà després de copiar totes les propietats.</p>
<p>Més informació en <a href="https://www.php.net/manual/es/language.oop5.cloning.php">https://www.php.net/manual/es/language.oop5.cloning.php</a></p>
</div>
<h3 id="herencia">Herència<a class="headerlink" href="#herencia" title="Permanent link">&para;</a></h3>
<p>PHP suporta herència simple, de manera que una classe només pot heretar d'una altra, no de dues classes alhora. Per a això s'utilitza la paraula clau <code>extends</code>. Si volem que la classe A hereta de la classe B farem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">class A extends B</span>
</code></pre></div>
<p>El fill hereta els atributs i mètodes públics i protegits.</p>
<div class="admonition warning">
<p class="admonition-title">Cada classe en un arxiu</p>
</div>
<p>Com ja hem comentat, hauríem de col·locar cada classe en un arxiu diferent per a posteriorment utilitzar-lo mitjançant <code>include</code>. En els següent exemple els hem col·locats junt per a facilitar la seua llegibilitat.</p>
<p>Per exemple, tenim una classe <code>Producte</code> i una <code>Tv</code> que hereta de <code>Producte</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="nv">$codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="nv">$nombreCorto</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="nv">$PVP</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Prod:&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="k">class</span> <span class="nc">Tv</span> <span class="k">extends</span> <span class="nx">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="nv">$pulgadas</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">public</span> <span class="nv">$tecnologia</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
<p>Podemos utilizar las siguientes funciones para averiguar si hay relación entre dos clases:</p>
<ul>
<li><code>get_parent_class(object): string</code></li>
<li><code>is_subclass_of(object, string): bool</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$t</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tv</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">codigo</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$t</span> <span class="nx">instanceof</span> <span class="nx">Producto</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">echo</span> <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$padre</span> <span class="o">=</span> <span class="nb">get_parent_class</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;La clase padre es: &quot;</span> <span class="o">.</span> <span class="nv">$padre</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$objetoPadre</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$padre</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="k">echo</span> <span class="nv">$objetoPadre</span><span class="o">-&gt;</span><span class="na">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="k">if</span> <span class="p">(</span><span class="nb">is_subclass_of</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span> <span class="s1">&#39;Producto&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Soy un hijo de Producto&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="polimorfisme">Polimorfisme<a class="headerlink" href="#polimorfisme" title="Permanent link">&para;</a></h3>
<p>Podem crear mètodes en els fills amb el mateix nom que el pare, canviant el seu comportament.
Per a invocar als mètodes del pare -&gt; <code>parent::nombreMetodo()</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Tv</span> <span class="k">extends</span> <span class="nx">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>   <span class="k">public</span> <span class="nv">$pulgadas</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>   <span class="k">public</span> <span class="nv">$tecnologia</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>      <span class="k">parent</span><span class="o">::</span><span class="na">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos=" 8 "></span>      <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;TV &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tecnologia</span><span class="o">.</span><span class="s2">&quot; de &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pulgadas</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>   <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="constructor-en-fills">Constructor en fills<a class="headerlink" href="#constructor-en-fills" title="Permanent link">&para;</a></h4>
<p>En els fills no es crea cap constructor de manera automàtica. Pel que si no n'hi ha, s'invoca automàticament al del pare. En canvi, si el definim en el fill, hem d'invocar al del pare de manera explícita.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">PHP7</label><label for="__tabbed_2_2">PHP8</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$codigo</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span> <span class="o">=</span> <span class="nv">$codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Prod:&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">class</span> <span class="nc">Tv</span> <span class="k">extends</span> <span class="nx">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">public</span> <span class="nv">$pulgadas</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="k">public</span> <span class="nv">$tecnologia</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string </span><span class="nv">$codigo</span><span class="p">,</span> <span class="nx">int </span><span class="nv">$pulgadas</span><span class="p">,</span> <span class="nx">string </span><span class="nv">$tecnologia</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$codigo</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pulgadas </span><span class="o">=</span> <span class="nv">$pulgadas</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tecnologia </span><span class="o">=</span> <span class="nv">$tecnologia</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos="26 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;TV &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tecnologia</span><span class="o">.</span><span class="s2">&quot; de &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pulgadas</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="27 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="28 "></span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">private</span> <span class="nx">string</span> <span class="nv">$codigo</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Prod:&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>        
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">class</span> <span class="nc">Tv</span> <span class="k">extends</span> <span class="nx">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
<span class="linenos" data-linenos="13 "></span>        <span class="nx">string </span><span class="nv">$codigo</span><span class="p">,</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">private</span> <span class="nx">int </span><span class="nv">$pulgadas</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">private</span> <span class="nx">string </span><span class="nv">$tecnologia</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$codigo</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;TV &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tecnologia</span><span class="o">.</span><span class="s2">&quot; de &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pulgadas</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="abstraccio">Abstracció<a class="headerlink" href="#abstraccio" title="Permanent link">&para;</a></h3>
<p>Les classes abstractes obliguen a heretar d'una classe, ja que no es permet la seua instanciación. Es defineix mitjançant <code>abstract class NombreClase {</code>.
Una classe abstracta pot contindre propietats i mètodes no-abstractes, i/o mètodes abstractes.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Clase abstracta</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Producto </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="nv">$codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCodigo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="c1">// Método abstracto</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
<p>Quan una classe hereta d'una classe abstracta, obligatòriament ha d'implementar els mètodes que té el pare marcats com a abstractes.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Tv</span> <span class="k">extends</span> <span class="nx">Producto</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="nv">$pulgadas</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="nv">$tecnologia</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//obligado a implementarlo</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;Código &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCodigo</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt;TV &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tecnologia</span><span class="o">.</span><span class="s2">&quot; de &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pulgadas</span><span class="o">.</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$t</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tv</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span><span class="k">echo</span> <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">getCodigo</span><span class="p">();</span>
</code></pre></div>
<h4 id="classes-finals">Classes finals<a class="headerlink" href="#classes-finals" title="Permanent link">&para;</a></h4>
<p>Són classes oposades a abstractes, ja que eviten que es puga heretar una classe o mètode per a sobreescriure-ho.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Producto </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCodigo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">return</span> <span class="s2">&quot;Producto &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="c1">// No podremos heredar de Microondas</span>
<span class="linenos" data-linenos="15 "></span><span class="k">final</span> <span class="k">class</span> <span class="nc">Microondas extends Producto </span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>    <span class="k">private</span> <span class="nv">$potencia</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPotencia</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">potencia</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="c1">// No podemos implementar mostrarResumen()</span>
<span class="linenos" data-linenos="23 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="interficies">Interfícies<a class="headerlink" href="#interficies" title="Permanent link">&para;</a></h4>
<p>Permet definir un contracte amb les signatures dels mètodes a complir. Així doncs, només conté declaracions de funcions i totes han de ser públiques.</p>
<p>Es declaren amb la paraula clau <code>interface</code> i després les classes que complisquen el contracte el realitzen mitjançant la paraula clau <code>implements</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">interface</span> <span class="nx">Nombreable</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span><span class="c1">// declaración de funciones</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
<span class="linenos" data-linenos="5 "></span><span class="k">class</span> <span class="nc">NombreClase</span> <span class="k">implements</span> <span class="nx">NombreInterfaz</span> <span class="p">{</span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// código de la clase</span>
</code></pre></div>
<p>Es permet l'herència d'interfícies. A més, una classe pot implementar diverses interfícies (en aquest cas, sí que suporta l'herència múltiple, però només d'interfícies).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">interface</span> <span class="nx">Mostrable </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarResumen</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">interface</span> <span class="nx">MostrableTodo extends Mostrable </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarTodo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">interface</span> <span class="nx">Facturable </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">generarFactura</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">class</span> <span class="nc">Producto implements MostrableTodo</span><span class="p">,</span> <span class="nx">Facturable </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>    <span class="c1">// Implementaciones de los métodos</span>
<span class="linenos" data-linenos="16 "></span>    <span class="c1">// Obligatoriamente deberá implementar public function mostrarResumen, mostrarTodo y generarFactura</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="metodes-encadenats">Mètodes encadenats<a class="headerlink" href="#metodes-encadenats" title="Permanent link">&para;</a></h4>
<p>Segueix el plantejament de la programació funcional, i també es coneix com <em>method chaining</em>. Planteja que sobre un objecte es realitzen diverses crides.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$p1 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Libro</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nv">$p1</span><span class="o">-&gt;</span><span class="na">setNombre</span><span class="p">(</span><span class="s2">&quot;Harry Potter&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$p1</span><span class="o">-&gt;</span><span class="na">setAutor</span><span class="p">(</span><span class="s2">&quot;JK Rowling&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">echo</span> <span class="nv">$p1</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">// Method chaining</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$p2 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Libro</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$p2</span><span class="o">-&gt;</span><span class="na">setNombre</span><span class="p">(</span><span class="s2">&quot;Patria&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setAutor</span><span class="p">(</span><span class="s2">&quot;Aramburu&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="k">echo</span> <span class="nv">$p2</span><span class="p">;</span>
</code></pre></div>
<p>Per a facilitar-ho, modificarem tots els seus mètodes mutants (que modifiquen dades, setters*, ...) perquè retornen una referència a <code>$this</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Libro </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nx">string </span><span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="nx">string </span><span class="nv">$autor</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getNombre</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setNombre</span><span class="p">(</span><span class="nx">string </span><span class="nv">$nombre</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Libro </span><span class="p">{</span> 
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre </span><span class="o">=</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAutor</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autor</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setAutor</span><span class="p">(</span><span class="nx">string </span><span class="nv">$autor</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Libro </span><span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autor </span><span class="o">=</span> <span class="nv">$autor</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string </span><span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="o">.</span><span class="s2">&quot; de &quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autor</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="metodes-magics">Mètodes màgics<a class="headerlink" href="#metodes-magics" title="Permanent link">&para;</a></h4>
<p>Totes les classes PHP ofereixen un conjunt de mètodes, també coneguts com <em>magic methods</em> que es poden sobreescriure per a substituir el seu comportament. Alguns d'ells ja els hem utilitzats.</p>
<p>Davant qualsevol dubte, és convenient consultar la <a href="https://www.php.net/manual/es/language.oop5.magic.php">documentació oficial</a>.</p>
<p>Els més destacables són:</p>
<ul>
<li><code>__construct()</code></li>
<li><code>__destruct()</code> → s'invoca en perdre la referència. S'utilitza per a tancar una connexió a la BD, tancar un fitxer, ...</li>
<li><code>__toString()</code> → representació de l'objecte com a cadena. És a dir, quan fem <code>echo $objecte</code> s'executa automàticament aquest mètode.</li>
<li><code>__get(propietat)</code>, <code>__set(propietat, valor)</code> → Permetria accedir a les propietat privades, encara que sempre és més llegible/mantenible codificar els <em>getter/setter</em>.</li>
<li><code>__isset(propietat)</code>, <code>__unset(propietat)</code> → Permet esbrinar o llevar el valor a una propietat.</li>
<li><code>__sleep()</code>, <code>__wakeup()</code> → S'executen en recuperar (<em>unserialize^) o emmagatzemar un objecte que se serialitza (</em>serialize), i s'utilitzen per a permet definir quines propietats se serialitzen.</li>
<li><code>__call()</code>, <code>__callStatic()</code> → S'executen en cridar a un mètode que no és públic. Permeten sobrecarreguen mètodes.</li>
</ul>
<h2 id="3-espai-de-noms">3. Espai de noms<a class="headerlink" href="#3-espai-de-noms" title="Permanent link">&para;</a></h2>
<p>Des de PHP 5.3 i també coneguts com <em>Namespaces</em>, permeten organitzar les classes/interfícies, funcions i/o constants de manera similar als paquets a <em>Java</em>.</p>
<div class="admonition tip">
<p class="admonition-title">Recomanació</p>
<p>Un només namespace per arxiu i crear una estructura de carpetes respectant els nivells/subnivells (igual que es fa a Java)</p>
</div>
<p>Es declaren en la primera línia mitjançant la paraula clau <code>namespace</code> seguida del nom de l'espai de noms assignat (cada subnivell se separa amb la barra invertida <code>\</code>):</p>
<p>Per exemple, per a col·locar la classe <code>Producte</code> dins del <em>namespace</em> <code>Dwes\Exemples</code> ho faríem així:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Dwes\Exemples</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">const</span> <span class="no">IVA </span><span class="o">=</span> <span class="mf">0.21</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Producte </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>      
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">muestra</span><span class="p">()</span> <span class="o">:</span> <span class="nx">void </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">echo</span><span class="s2">&quot;&lt;p&gt;Prod:&quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre </span><span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="acces">Accés<a class="headerlink" href="#acces" title="Permanent link">&para;</a></h4>
<p>Per a referenciar a un recurs que conté un namespace, primer hem de tindre'l disponible fent ús de <code>include</code> o <code>require</code>. Si el recurs està en el mateix <em>namespace</em>, es realitza un accés directe (es coneix com a accés sense qualificar).</p>
<p>Realment hi ha tres tipus d'accés:</p>
<ul>
<li>sense qualificar: <code>recurs</code></li>
<li>qualificat: <code>rutaRelativa\recurs</code> → no fa falta posar el <em>namespace</em> complet</li>
<li>totalment qualificat: <code>\rutaAbsoluta\recurs</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">include_once</span><span class="p">(</span><span class="s2">&quot;Producto.php&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">echo</span> <span class="nx">IVA</span><span class="p">;</span> <span class="c1">// sin cualificar</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">echo</span> <span class="nx">Utilidades\IVA</span><span class="p">;</span> <span class="c1">// acceso cualificado. Daría error, no existe \Dwes\Ejemplos\Utilidades\IVA</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">echo</span> <span class="nx">\Dwes\Ejemplos\IVA</span><span class="p">;</span> <span class="c1">// totalmente cualificado</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$p1 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Producto</span><span class="p">();</span> <span class="c1">// lo busca en el mismo namespace y encuentra \Dwes\Ejemplos\Producto</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$p2 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Model\Producto</span><span class="p">();</span> <span class="c1">// daría error, no existe el namespace Model. Está buscando \Dwes\Ejemplos\Model\Producto</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$p3 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">\Dwes\Ejemplos\Producto</span><span class="p">();</span> <span class="c1">// \Dwes\Ejemplos\Producto</span>
</code></pre></div>
<h4 id="acces_1">Accés<a class="headerlink" href="#acces_1" title="Permanent link">&para;</a></h4>
<p>Per a evitar la referència qualificada podem declarar l'ús mitjançant <code>use</code> (similar a fer <code>import</code> a Java). Es fa en la capçalera, després del <code>namespace</code>:</p>
<p>Els tipus Posibles són:</p>
<ul>
<li><code>use const nombreCualificadoConstante</code></li>
<li><code>use function nombreCualificadoFuncion</code></li>
<li><code>use nombreCualificadoClase</code></li>
<li><code>use nombreCualificadoClase as NuevoNombre</code> // per a canviar de nom elements</li>
</ul>
<p>Per exemple, si volem utilitzar la classe <code>\Dwes\Exemples\Producte</code> des d'un recurs que es troba en l'arrel, per exemple en <code>inici.php</code>, faríem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">include_once</span><span class="p">(</span><span class="s2">&quot;Dwes\Exemples\Producte.php&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">use</span> <span class="k">const</span> <span class="no">Dwes\Exemples\IVA</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="k">use</span> <span class="nx">\Dwes\Exemples\Producte</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="k">echo</span> <span class="nx">IVA</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="nv">$p1 </span><span class="o">=</span> <span class="k">new</span> <span class="nx">Producte</span><span class="p">();</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">To <code>use</code> or not to <code>use</code></p>
<p>En resum, <code>use</code> permet accedir sense qualificar a recursos que estan en un altre <em>namespace</em>. Si estem en el mateix espai de nom, no necessitem <code>use</code>.</p>
</div>
<h4 id="organitzacio">Organització<a class="headerlink" href="#organitzacio" title="Permanent link">&para;</a></h4>
<p>Tot projecte, conforme creix, necessita organitzar el seu codi font. Es planteja una organització en la qual els arxius que interactuan amb el navegador es col·loquen en l'arrel, i les classes que definim van dins d'un namespace (i dins de la seua pròpia carpeta <code>src</code> o <code>app</code>).</p>
<figure>
<img src="imagenes/03/03organizacion.png">
<figcaption>Organització del codi font</figcaption>
</figure>

<div class="admonition tip">
<p class="admonition-title">Organització, includes i usos</p>
<ul>
<li>Col·locarem cada recurs en un fitxer a part.</li>
<li>En la primera línia indicarem la seua <em>namespace</em> (si no està en l'arrel).</li>
<li>Si utilitzem altres recursos, farem un <code>include_once</code> d'aqueixos recursos (classes, interfícies, etc...).</li>
<li>Cada recurs ha d'incloure tots els altres recursos que referencie: la classe de la qual hereta, interfícies que implementa, classes utilitzades/rebudes com a paràmetres, etc...</li>
<li>Si els recursos estan en un espai de noms diferent al que estem, emprarem <code>use</code> amb la ruta completa per a després utilitzar referències sense qualificar.</li>
</ul>
</div>
<h4 id="autoload">Autoload<a class="headerlink" href="#autoload" title="Permanent link">&para;</a></h4>
<p>No és tediós haver de fer el <code>include</code> de les classes? El autoload ve al rescat.</p>
<p>Així doncs, permet carregar les classes (no les constants ni les funcions) que s'utilitzaran i evitar haver de fer el <code>include_once</code> de cadascuna d'elles. Per a això, es pot utilitzar el composer.</p>
<h2 id="4-composer">4. Composer<a class="headerlink" href="#4-composer" title="Permanent link">&para;</a></h2>
<figure style="float: right;">
    <img src="imagenes/05/logo-composer.png" width="200">
    <figcaption>Logo Composer</figcaption>
</figure>

<p>Eina per excel·lència en PHP per a la gestió de llibreries i dependències, de manera que instal·la i les actualitza assegurant que tot l'equip de desenvolupament té el mateix entorn i versions. A més, ofereix <em>autoloading</em> del nostre codi, de manera que no hàgem de fer-lo nosaltres "a mà".</p>
<p>Està escrit en PHP, i podeu consultar tota la seua documentació en <a href="https://getcomposer.org/">https://getcomposer.org/</a>.</p>
<p>Utilitza <a href="https://packagist.org/"><em>Packagist</em></a> com a repositori de llibreries.</p>
<p>Funcionalment, és similar a Maven (Java) / npm (JS).</p>
<h3 id="installacio">Instal·lació<a class="headerlink" href="#installacio" title="Permanent link">&para;</a></h3>
<p>Si estem usant XAMPP, hem d'instal·lar <em>Composer</em> en el propi sistema operatiu. Es recomana seguir les <a href="https://getcomposer.org/doc/00-intro.md">instruccions oficials</a> segons el sistema operatiu a emprar.</p>
<p>En canvi, si usem <em>Docker</em>, necessitem modificar la configuració del nostre contenidor. En el nostre cas, hem decidit modificar l'arxiu <code>Dockerfile</code> i afegir el següent comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>composer:2.0<span class="w"> </span>/usr/bin/composer<span class="w"> </span>/usr/local/bin/composer
</code></pre></div>
<p>És important que dins del contenidor comprovem que tenim la v2:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>-V
</code></pre></div>
<h3 id="primers-passos">Primers passos<a class="headerlink" href="#primers-passos" title="Permanent link">&para;</a></h3>
<p>Quan creem un projecte per primera vegada, hem d'inicialitzar el repositori. Per a això, executarem el comando <code>composer init</code> on:</p>
<ul>
<li>Configurem el nom del paquet, descripció, autor (nom <email>), tipus de paquet (project), etc...</li>
<li>Definim les dependències del projecte (<code>require</code>) i les de desenvolupament (<code>require-dev</code>) de manera interactiva.</li>
<li>En les de desenvolupament s'indica aquelles que no s'instal·laran a l'entorn de producció, per exemple, les llibreries de proves.</li>
</ul>
<p>Després de la seua configuració, es crearà automàticament l'arxiu <code>composer.json</code> amb les dades introduïdes i descàrrega les llibreries en la carpeta <code>vendor</code>. La instal·lació de les llibreries sempre es realitza de manera local per a cada projecte.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dwes/log&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pruebas con Monolog&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nt">&quot;require&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">        </span><span class="nt">&quot;monolog/monolog&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^2.1&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nt">&quot;license&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="nt">&quot;authors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="10 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a.medrano@edu.gva.es&quot;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">]</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<p>A l'hora d'indicar cada llibreria introduirem:</p>
<ul>
<li>el nom de la llibreria, composta tant pel creador o "vendor", com pel nom del projecte. Exemples: <code>monolog/monolog</code> o <code>laravel/installer</code>.</li>
<li>
<p>la versió de cada llibreria. Tenim diverses opcions per a indicar-la:</p>
<ul>
<li>Directament: 1.4.2</li>
<li>Amb comodins: 1.</li>
<li>A partir de: &gt;= 2.0.3</li>
<li>Sense trencament de canvis: ^1.3.2 // &gt;=1.3.2 &lt;2.0.0</li>
</ul>
</li>
</ul>
<h3 id="actualitzar-llibreries">Actualitzar llibreries<a class="headerlink" href="#actualitzar-llibreries" title="Permanent link">&para;</a></h3>
<p>Podem definir les dependències via l'arxiu <code>composer.json</code> o mitjançant comandos amb el format <code>composer require vendor/package:version</code>. Per exemple, si volem afegir phpUnit com a llibreria de desenvolupament, farem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>phpunit/phpunit<span class="w"> </span>–dev
</code></pre></div>
<p>Després d'afegir noves llibreries, hem d'actualitzar el nostre projecte:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>update
</code></pre></div>
<p>Si creem l'arxiu <code>composer.json</code> nosaltres directament sense inicialitzar el repositori, hem d'instal·lar les dependències:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>install
</code></pre></div>
<p>En fer aquest pas (tant instal·lar com actualitzar), com ja hem comentat, es descarreguen les llibreries en dins de la carpeta <code>vendor</code>. És molt important afegir aquesta carpeta a l'arxiu <code>.gitignore</code> per a no pujar-les a GitHub.</p>
<p>A més es crea l'arxiu <code>composer.lock</code>, que emmagatzema la versió exacta que s'ha instal·lat de cada llibreria (aquest arxiu no es toca).</p>
<h3 id="autoloadphp"><code>autoload.php</code><a class="headerlink" href="#autoloadphp" title="Permanent link">&para;</a></h3>
<p><em>Composer</em> crea de manera automàtica en <code>vendor/autoload.php</code> el codi per a incloure de manera automàtica totes les llibreries que tinguem configurades en <code>composer.json</code>.</p>
<p>Per a utilitzar-ho, en la capçalera del nostre arxius posarem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
</code></pre></div>
<p>En el nostre cas, de moment només el podrem en els arxius on provem les classes</p>
<p>Si volem que Composer també s'encarregue de carregar de manera automàtica les nostres classes de domini, dins de l'arxiu <code>composer.json</code>, definirem la propietat <code>autoload</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">&quot;autoload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="nt">&quot;psr-4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;Dwes\\&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app/Dwes&quot;</span><span class="p">}</span>
<span class="linenos" data-linenos="3 "></span><span class="p">},</span>
</code></pre></div>
<p>Posteriorment, hem de tornar a generar el <em>autoload</em> de <em>Composer</em> mitjançant l'opció <code>dump-autoload</code> (o <code>du</code>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>dump-autoload
</code></pre></div>
<h2 id="5-logger-amb-monolog">5. Logger amb Monolog<a class="headerlink" href="#5-logger-amb-monolog" title="Permanent link">&para;</a></h2>
<p>Provarem <em>Composer</em> afegint la llibreria de <a href="https://github.com/seldaek/monolog"><em>Monolog</em></a> al nostre projecte. Es tracta d'un llibreria per a la gestió de logs de les nostres aplicacions, suportant diferents nivells (info, warning, etc...), eixides (fitxers, sockets, BBDD, Web Services, email, etc) i formats (text pla, HTML, JSON, etc...).</p>
<p>Per a això, inclourem la llibreria en el nostre projecte amb:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>monolog/monolog
</code></pre></div>
<p>Monolog 2 requereix almenys PHP 7.2, compleix amb el estandar de logging PSR-3, i és la llibreria emprada per <em>Laravel</em> i <em>Symfony</em> per a la gestió de logs.</p>
<div class="admonition info">
<p class="admonition-title">Quan utilitzar un log</p>
<ul>
<li>Seguir les acciones/moviments dels usuaris</li>
<li>Registrar les transaccions</li>
<li>Rastrejar els errors d'usuari</li>
<li>Fallades/avisos a nivell de sistema</li>
<li>Interpretar i col·leccionar dades per a posterior investigació de patrons</li>
</ul>
</div>
<h3 id="nivells">Nivells<a class="headerlink" href="#nivells" title="Permanent link">&para;</a></h3>
<p>A continuació vam mostrar els diferents nivells de menys a més restrictiu:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>* debug -100: Informació detallada amb propòsits de debug. No usar en entorns de producció.
<span class="linenos" data-linenos="2 "></span>* info - 200: Esdeveniments interessants com l&#39;inici de sessió d&#39;usuaris.
<span class="linenos" data-linenos="3 "></span>* notice - 250: Esdeveniments normals però significatius.
<span class="linenos" data-linenos="4 "></span>* warning - 300: Ocurrències excepcionals que no arriben a ser error.
<span class="linenos" data-linenos="5 "></span>* error - 400: Errors d&#39;execució que permeten continuar amb l&#39;execució de l&#39;aplicació però que han de ser monitorats.
<span class="linenos" data-linenos="6 "></span>* critical - 500: Situacions importants on es generen excepcions no esperades o no hi ha disponible un component.
<span class="linenos" data-linenos="7 "></span>* alert - 550: S&#39;han de prendre mesures immediatament.
<span class="linenos" data-linenos="8 "></span>  Caiguda completa de la web, base de dades no disponible, etc... A més, se solen enviar missatges per email.
<span class="linenos" data-linenos="9 "></span>* emergency - 600: És l&#39;error més greu i indica que tot el sistema està inutilitzable.
</code></pre></div>
<h3 id="hola-monolog">Hola Monolog<a class="headerlink" href="#hola-monolog" title="Permanent link">&para;</a></h3>
<p>Per exemple, en l'arxiu <code>pruebaLog.php</code> que col·locaríem en l'arrel, primer incloem el <strong>autoload</strong>, importem els classes a utilitzar per a finalment usar els mètodes de <strong>Monolog</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">include</span> <span class="no">__DIR__</span> <span class="o">.</span><span class="s2">&quot;/vendor/autoload.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Level</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Debug</span><span class="p">));</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ERROR&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de CRITICAL&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">alert</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ALERT&quot;</span><span class="p">);</span>
</code></pre></div>
<p>En tots els mètodes de registre de missatges (<code>debug</code>, <code>info</code>, ...), a més del propi missatge, li podem passar informació com el contingut d'alguna variable, usuari de l'aplicació, etc.. com a segon paràmetre dins d'un array, el qual es coneix com <strong>array de contexte</strong>.
És convenient fer-ho mitjançant un array associatiu per a facilitar la lectura del log.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;datos&quot;</span> <span class="o">=&gt;</span> <span class="nv">$producto</span><span class="p">]);</span>
</code></pre></div>
<h3 id="funcionament">Funcionament<a class="headerlink" href="#funcionament" title="Permanent link">&para;</a></h3>
<p>Cada instància <code>Logger</code> té un nom de canal i una pila de manejadores (<strong>handler</strong>).
Cada missatge que manem al log travessa la pila de manejadores, i cadascun decideix si ha de registrar la informació, i si es dona el cas, finalitzar la propagació.
Per exemple, un <code>StreamHandler</code> en el fons de la pila que ho escriga tot en disc, i en el topall afig un <code>MailHandler</code> que envie un mail només quan hi haja un error.</p>
<p>Els manejadores més utilitzats són:</p>
<ul>
<li><code>StreamHandler(ruta, nivel)</code></li>
<li><code>RotatingFileHandler(ruta, maxFiles, nivel)</code></li>
<li><code>NativeMailerHandler(para, asunto, desde, nivel)</code></li>
<li><code>FirePHPHandler(nivel)</code></li>
</ul>
<p>Per exemple: Si volem que els missatges de l'aplicació isquen pel log del servidor,
en el nostre cas l'arxiu <code>error.log</code> de <strong>Apatxe</strong> utilitzarem com a ruta l'eixida d'error:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// error.log</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Debug</span><span class="p">));</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">FirePHP</p>
<p>Per exemple, mitjançant <code>FirePHPHandler</code>, podem utilitzar <code>FirePHP</code>, la qual és una eina per a fer debug en la consola de Firefox<em>.
Després d'instal·lar l'extensió en Firefox, habilitar les opcions i configurar el </em><em>Handler</em>*, podem veure els missatges acolorits amb les seues dades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiFirePHPLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Level</span><span class="o">::</span><span class="na">INFO</span><span class="p">));</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$datos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="s2">&quot;personaje&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Batman&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="6 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<span class="linenos" data-linenos="8 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<span class="linenos" data-linenos="9 "></span><span class="c1">// ...</span>
</code></pre></div>
<p><figure style="align: center;">
    <img src="imagenes/05/firePhp.png">
    <figcaption>Ejemplo de uso de FirePHP</figcaption>
</figure></p>
</div>
<h3 id="manejadors">Manejadors<a class="headerlink" href="#manejadors" title="Permanent link">&para;</a></h3>
<p>Si no s'indica cap, se li assigna un per defecte. L'últim manejador inserit serà el primer a executar-se.
Després es van executant conforme a la pila.</p>
<h3 id="processadors">Processadors<a class="headerlink" href="#processadors" title="Permanent link">&para;</a></h3>
<p>Els processadors permeten afegir informació als missatges.
Per a això, s'apilen després de cada manejador mitjançant el mètode <code>pushProcessor($processador)</code>.</p>
<p>Alguns processadors coneguts són <code>IntrospectionProcessor</code> (mostren la línia, fitxer, classe i metodo des del qual s'invoca el log), <code>WebProcessor</code> (afig la URI, mètode i IP) o <code>GitProcessor</code> (afig la branca i el commit).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">PHP</label><label for="__tabbed_3_2">Consola en format text</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">IntrospectionProcessor</span><span class="p">());</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">WARNING</span><span class="p">));</span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// no usa Introspection pq lo hemos apilado después, le asigno otro</span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">WebProcessor</span><span class="p">());</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>[2020-11-26T13:35:31.076138+01:00] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] {&quot;file&quot;:&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;,&quot;line&quot;:12,&quot;class&quot;:null,&quot;function&quot;:null}
<span class="linenos" data-linenos="2 "></span>[2020-11-26T13:35:31.078344+01:00] MiLogger.INFO: Esto es un mensaje de INFO [] {&quot;file&quot;:&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;,&quot;line&quot;:13,&quot;class&quot;:null,&quot;function&quot;:null}
</code></pre></div>
</div>
</div>
</div>
<h3 id="formatadors">Formatadors<a class="headerlink" href="#formatadors" title="Permanent link">&para;</a></h3>
<p>S'associen als manejadores amb <code>setFormatter</code>. Els formateadores més utilitzats són <code>LineFormatter</code>, <code>HtmlFormatter</code> o <code>JsonFormatter</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">PHP</label><label for="__tabbed_4_2">Consola en JSON</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$rfh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Debug</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$rfh</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">());</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$rfh</span><span class="p">);</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span><span class="nt">&quot;context&quot;</span><span class="p">:{},</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="nt">&quot;level_name&quot;</span><span class="p">:</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">,</span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="s2">&quot;2020-11-27T15:36:52.747211+01:00&quot;</span><span class="p">,</span><span class="nt">&quot;extra&quot;</span><span class="p">:{}}</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span><span class="nt">&quot;context&quot;</span><span class="p">:{},</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="nt">&quot;level_name&quot;</span><span class="p">:</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">,</span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="s2">&quot;2020-11-27T15:36:52.747538+01:00&quot;</span><span class="p">,</span><span class="nt">&quot;extra&quot;</span><span class="p">:{}}</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Més informació</p>
<p>Més informació sobre manejadores, formateadores i processadors en <a href="https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md">https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md</a></p>
</div>
<h2 id="6-generacio-de-pdf-amb-dompdf">6.  Generació de PDF amb DOMPDF<a class="headerlink" href="#6-generacio-de-pdf-amb-dompdf" title="Permanent link">&para;</a></h2>
<p>Amb PHP podem manejar tot tipus d'arxius com ja hem vist però, què passa si volem generar fitxers PDF amb dades tretes d'una base de dades?</p>
<div class="center img-small">
    <img src="imagenes/06/06-pdf.png">
</div>

<p>Gràcies a una classe escrita en PHP, podem generar arxius PDF sense necessitat d'instal·lar llibreries addicionals en el nostre servidor.
Però anem a utilitzar una llibreria que permet transformar codi html en pdf.</p>
<h3 id="dompdf">DOMPDF<a class="headerlink" href="#dompdf" title="Permanent link">&para;</a></h3>
<p>Afegirem la llibreria de <a href="https://github.com/seldaek/monolog"><em>DOMPDF</em></a> al nostre projecte. Per a això, inclourem la llibreria en el nostre projecte amb:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>dompdf/dompdf
</code></pre></div>
Una vegada que DOMPDF està instal·lat, el procés per generar PDFs des de HTML és bastant directe. Els passos bàsics són:</p>
<p>Pas 1: Incloent DOMPDF
Primer, necessitarem incloure DOMPDF en el script PHP. Si estem utilitzant Composer, això es fa automàticament a través de l'auto-càrrega de Composer. Només cal afegir la següent línia al principi del'script:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">require &#39;vendor/autoload.php&#39;;</span>
</code></pre></div>
<p>Pas 2: Creació d'una Instància de DOMPDF
A continuació, creem una nova instància de la classe DOMPDF:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">use Dompdf\Dompdf;</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="x">$dompdf = new Dompdf();</span>
</code></pre></div>
<p>Pas 3: Carregar HTML
Després, carregem l'HTML en l'objecte DOMPDF. Això es pot fer directament com una cadena o carregant un fitxer HTML:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$html = &quot;&lt;html&gt;&lt;body&gt;Hola, això és una prova.&lt;/body&gt;&lt;/html&gt;&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$dompdf-&gt;loadHtml($html);</span>
</code></pre></div>
<p>O bé carregar un fitxer HTML:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;loadHtml(file_get_contents(&#39;path/to/your/file.html&#39;));</span>
</code></pre></div>
<p>Pas 4: Configuració de la Mida del Paper i l'Orientació
Podem configurar la mida del paper i l'orientació si és necessari:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;setPaper(&#39;A4&#39;, &#39;portrait&#39;); // o &#39;landscape&#39;</span>
</code></pre></div>
<p>Pas 5: Renderització del PDF
Ara, demanem a DOMPDF que renderitze el PDF:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;render();</span>
</code></pre></div>
<p>Pas 6: Eixida del PDF
Finalment, podem enviar el PDF al navegador, guardar-lo en un fitxer o fer amb ell el que necessitem:</p>
<p>Per mostrar-lo al navegador:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;stream(&quot;document.pdf&quot;, array(&quot;Attachment&quot; =&gt; false));</span>
</code></pre></div>
<p>Per desar-lo en un fitxer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$output = $dompdf-&gt;output();</span>
<span class="linenos" data-linenos="2 "></span><span class="x">file_put_contents(&#39;path/to/save/document.pdf&#39;, $output);</span>
</code></pre></div>
<h5 id="consells-addicionals">Consells Addicionals<a class="headerlink" href="#consells-addicionals" title="Permanent link">&para;</a></h5>
<p>Cal assegurar-se que l'HTML és vàlid i ben format. DOMPDF intenta ser tolerant amb l'HTML, però l'HTML mal format pot causar problemes.
El CSS que s'utilitze pot afectar significativament com es veu el PDF. DOMPDF suporta una bona part de CSS 2.1, però no tot.
Si necessitem incloure imatges, cal assegurar-se que les rutes són absolutes i accessibles des del servidor on s'executa DOMPDF.
Aquesta és una guia bàsica per començar amb DOMPDF. Per a casos d'ús més avançats i opcions de configuració, cal consultar la documentació oficial de DOMPDF.</p>
<h2 id="7-documentacion-con-phpdocumentor">7. Documentación con <strong>phpDocumentor</strong><a class="headerlink" href="#7-documentacion-con-phpdocumentor" title="Permanent link">&para;</a></h2>
<p><a href="https://www.phpdoc.org/">phpDocumentor</a> és l'eina per a documentar el codi PHP. És similar en propòsit i funcionament a <strong>Javadoc</strong>.</p>
<p>Així doncs, és un eina que facilita la documentació del codi PHP, creant un lloc web amb l'API de l'aplicació.</p>
<p>Es basa en l'ús d'anotacions sobre els docblocks. Per a posar-ho en marxa, en el nostre cas ens decantarem per utilitzar la imatge que ja existeix de Docker.</p>
<h3 id="installacio_1">Instal·lació<a class="headerlink" href="#installacio_1" title="Permanent link">&para;</a></h3>
<h5 id="pas-1-installacio-amb-docker">Pas 1: Instal·lació amb Docker<a class="headerlink" href="#pas-1-installacio-amb-docker" title="Permanent link">&para;</a></h5>
<p>Primer, cal assegurar-se tenir Docker instal·lat i funcionant al  sistema. Després, s'ha de descarregar i executar el contenidor de phpDocumentor utilitzant la següent comanda:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker<span class="w"> </span>pull<span class="w"> </span>phpdoc/phpdoc
</code></pre></div>
<h5 id="pas-2-generacio-de-documentacio">Pas 2: Generació de Documentació<a class="headerlink" href="#pas-2-generacio-de-documentacio" title="Permanent link">&para;</a></h5>
<p>Un cop tinguem la imatge, podem utilitzar-la per generar la documentació. El procés bàsic implica muntar els fitxers de codi dins del contenidor Docker i executar phpDocumentor sobre aquests fitxers.</p>
<p>Ací hi ha un exemple de com fer-ho:</p>
<p>En el cas d'usar <em>Docker</em>, usarem el següent comando per a executar-lo (crea el contenidor, executa el comando que li demanem, i automàticament l'esborra):</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/data<span class="w"> </span>phpdoc/phpdoc:latest<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>/data/src<span class="w"> </span>-t<span class="w"> </span>/data/src/docs
</code></pre></div>
Aquesta comanda fa el següent:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>    * -rm: Això elimina el contenidor després d&#39;executar-lo, així no es queden contenidors inactius.
<span class="linenos" data-linenos="2 "></span>    * -v $(pwd):/data: Munta el directori actual del teu sistema ($(pwd)) al directori /data dins del contenidor. Hauràs de reemplaçar $(pwd) amb el camí on està el teu codi font si no estàs executant aquesta comanda des del directori del teu projecte.
<span class="linenos" data-linenos="3 "></span>    * -d /data/src: Especifica el directori dins del contenidor on es troba el teu codi font. Reemplaça /data/src amb el camí corresponent dins del contenidor si és diferent.
<span class="linenos" data-linenos="4 "></span>    * -t /data/src/docs: Especifica on vols que es generi la documentació dins del contenidor. En aquest cas, es generarà dins de /data/docs.
</code></pre></div>
<h5 id="pas-3-acces-a-la-documentacio-generada">Pas 3: Accés a la Documentació Generada<a class="headerlink" href="#pas-3-acces-a-la-documentacio-generada" title="Permanent link">&para;</a></h5>
<p>Una vegada generada, la documentació estarà dins del directori que especificat (en aquest cas, <code>docs</code> dins del directori docs de projecte). Pots obrir els fitxers HTML amb qualsevol navegador per veure la documentació.</p>
<h3 id="docblock">DocBlock<a class="headerlink" href="#docblock" title="Permanent link">&para;</a></h3>
<p>Un <em>docblock</em> és el bloc de codi que es col·loca damunt d'un recurs. El seu format és:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 3 "></span><span class="sd">* Sumari*, una sola línia</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd">* Descripció* que pot utilitzar diverses línies</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd">* i que ofereix detalls de l&#39;element o referències</span>
<span class="linenos" data-linenos=" 7 "></span><span class="sd">* per a ampliar la informació</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="sd">* @param string $miArgumento amb una descripció* de l&#39;argument</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">* que pot usar diverses línies.</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="sd">* @return void</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">*/</span>
<span class="linenos" data-linenos="14 "></span><span class="k">function</span> <span class="nf">miFuncion</span><span class="p">(</span><span class="nx">tipo</span> <span class="nv">$miArgumento</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Visual Studio Code</p>
<p>Per tal que us ajude a documentar podeu utilitzar l'extensió  PHP DocBlocker.</p>
</div>
<h3 id="documentant-el-codi">Documentant el codi<a class="headerlink" href="#documentant-el-codi" title="Permanent link">&para;</a></h3>
<p>En tots els elements, ademas del sumari i/o descripció, posarem:</p>
<ul>
<li>En les classes:<ul>
<li><code>@author</code> nom <email></li>
<li><code>@package</code> ruta del namespace</li>
</ul>
</li>
<li>En les propietats:<ul>
<li><code>@var</code> tipus descripció</li>
</ul>
</li>
<li>En els mètodes:<ul>
<li><code>@param</code> tipus $nomene descripció</li>
<li><code>@throws</code> ClaseException descripció</li>
<li><code>@return</code> tipus descripció</li>
</ul>
</li>
</ul>
<p>Vegem-ho amb un exemple. Suposem que tenim una classe que representa un client:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 3 "></span><span class="sd">* Classe que representa un client</span>
<span class="linenos" data-linenos=" 4 "></span><span class="sd">* </span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd">* El client s&#39;encarrega d&#39;emmagatzemar els suports que té llogat,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd">* de manera que podem llogar i retornar productes mitjançant les operacions</span>
<span class="linenos" data-linenos=" 7 "></span><span class="sd">* homònimes.</span>
<span class="linenos" data-linenos=" 8 "></span><span class="sd">* </span>
<span class="linenos" data-linenos=" 9 "></span><span class="sd">* @package Dwes\Videoclub\Model</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">* @author Aitor Medrano &lt;a.medrano@edu.gva.es&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">*/</span>
<span class="linenos" data-linenos="12 "></span><span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span> 
<span class="linenos" data-linenos="15 "></span>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$numero</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="18 "></span><span class="sd">    * Colecció de soports alquilats</span>
<span class="linenos" data-linenos="19 "></span><span class="sd">    * @var array&lt;Soporte&gt; </span>
<span class="linenos" data-linenos="20 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">private</span> <span class="nv">$soportesAlquilados</span><span class="p">[];</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    <span class="o">/*</span>
<span class="linenos" data-linenos="24 "></span>    <span class="o">*</span> <span class="nx">Comprova</span> <span class="nx">si</span> <span class="nx">el</span> <span class="nx">suport</span> <span class="nx">rebut</span> <span class="nx">ja</span> <span class="nx">el</span> <span class="nx">té</span> <span class="nx">llogat</span> <span class="nx">el</span> <span class="nx">client</span>
<span class="linenos" data-linenos="25 "></span>    <span class="o">*</span> <span class="o">@</span><span class="nx">param</span> <span class="nx">Suport</span> <span class="nv">$suporte</span> <span class="nx">Suport</span> <span class="nx">a</span> <span class="nx">comprovar</span>
<span class="linenos" data-linenos="26 "></span>    <span class="o">*</span> <span class="o">@</span><span class="k">return</span> <span class="nx">bool</span> <span class="k">true</span> <span class="nx">si</span> <span class="nx">ho</span> <span class="nx">té</span> <span class="nx">llogat</span>
<span class="linenos" data-linenos="27 "></span>    <span class="o">/</span>
<span class="linenos" data-linenos="28 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">tieneAlquilado</span><span class="p">(</span><span class="nx">Soporte</span> <span class="nv">$soporte</span><span class="p">)</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span> 
<span class="linenos" data-linenos="29 "></span>        <span class="c1">// ...</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
</code></pre></div>
<p>Si generem la documentació i obrim amb un navegador l'arxiu <code>docs/api/index.html</code> podrem navegar fins a la classe `Client:</p>
<figure style="align: center;">
    <img src="imagenes/05/phpdoc.png">
    <figcaption>phpDocumentor de Cliente</figcaption>
</figure>

<h2 id="8-separar-la-logica-de-negoci-dels-aspectes-de-presentacio-de-laplicacio">8. Separar la lògica de negoci dels aspectes de presentació de l'aplicació<a class="headerlink" href="#8-separar-la-logica-de-negoci-dels-aspectes-de-presentacio-de-laplicacio" title="Permanent link">&para;</a></h2>
<h4 id="logica-de-negoci">Lògica de Negoci<a class="headerlink" href="#logica-de-negoci" title="Permanent link">&para;</a></h4>
<ul>
<li>Regles i procediments que defineixen el funcionament de l'aplicació.</li>
<li>Inclou processament de dades, càlculs, interaccions amb la base de dades, etc.</li>
</ul>
<h4 id="aspectes-de-presentacio">Aspectes de Presentació<a class="headerlink" href="#aspectes-de-presentacio" title="Permanent link">&para;</a></h4>
<ul>
<li>Manera en què es mostra la informació a l'usuari.</li>
<li>Inclou la interfície d'usuari, disseny, navegació, etc.</li>
</ul>
<h3 id="avantatges_1">Avantatges<a class="headerlink" href="#avantatges_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Mantenibilitat</strong></p>
<ul>
<li>Facilita la modificació de la lògica de negoci sense afectar la presentació.</li>
<li>Permet actualitzar la interfície d'usuari sense modificar la lògica subjacent.</li>
</ul>
</li>
<li>
<p><strong>Reutilització</strong></p>
<ul>
<li>La lògica de negoci pot ser reutilitzada en diferents aplicacions amb interfícies variades.</li>
<li>Els components de presentació poden ser reutilitzats amb diferents lògiques de negoci.</li>
</ul>
</li>
<li>
<p><strong>Escalabilitat</strong></p>
<ul>
<li>Ajuda a escalar l'aplicació separant les preocupacions, permetent millorar una part sense impactar l'altra.</li>
</ul>
</li>
<li>
<p><strong>Prova i Depuració</strong></p>
<ul>
<li>Facilita les proves unitàries i la depuració en permetre provar la lògica de negoci per separat de la interfície.</li>
</ul>
</li>
<li>
<p><strong>Col·laboració</strong></p>
<ul>
<li>Permet que desenvolupadors de backend i frontend treballen de manera independent en les seues àrees respectives.</li>
</ul>
</li>
</ol>
<h3 id="tecnologies-i-mecanismes-per-a-la-separacio">Tecnologies i Mecanismes per a la Separació<a class="headerlink" href="#tecnologies-i-mecanismes-per-a-la-separacio" title="Permanent link">&para;</a></h3>
<p>A continuació es presenten diverses tecnologies i mecanismes que faciliten la separació de la lògica de negoci i la presentació en una aplicació web:</p>
<h4 id="frameworks-php">Frameworks PHP:<a class="headerlink" href="#frameworks-php" title="Permanent link">&para;</a></h4>
<p>Laravel: Framework que segueix el patró MVC (Model-View-Controller). Laravel facilita la creació de codi net i ben organitzat, separant clarament la lògica de negoci de la presentació.
Symfony: Altres frameworks populars que també segueixen el patró MVC i ofereixen eines per a la separació de la lògica i la presentació.</p>
<h4 id="patro-mvc">Patró MVC:<a class="headerlink" href="#patro-mvc" title="Permanent link">&para;</a></h4>
<p>Model-View-Controller: Patró de disseny que divideix una aplicació en tres components interconnectats:
Model: Gestiona la lògica de negoci i les dades.
Vista: Gestiona la presentació de la informació.
Controlador: Gestiona la comunicació entre el Model i la Vista.</p>
<h4 id="plantilles">Plantilles:<a class="headerlink" href="#plantilles" title="Permanent link">&para;</a></h4>
<p>Blade (Laravel): Motor de plantilles que permet separar el codi HTML de la lògica de negoci.
Twig (Symfony): Motor de plantilles similar a Blade, utilitzat per separar la lògica de negoci del codi de presentació.</p>
<h4 id="api-rest">API REST:<a class="headerlink" href="#api-rest" title="Permanent link">&para;</a></h4>
<p>Permet crear serveis web que exposen funcionalitats i dades a través de punts finals d'API, mantenint la lògica de negoci separada de la presentació.</p>
<h3 id="exemple-mvc">Exemple MVC<a class="headerlink" href="#exemple-mvc" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">// Model: Product.php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">class Product {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    private string $name;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    private float $price;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    public function __construct(string $name, float $price) {</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        $this-&gt;name = $name;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        $this-&gt;price = $price;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">    public function getName(): string {</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        return $this-&gt;name;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="x">    public function getPrice(): float {</span>
<span class="linenos" data-linenos="16 "></span><span class="x">        return $this-&gt;price;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="18 "></span><span class="x">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="x">// Controller: ProductController.php</span>
<span class="linenos" data-linenos="21 "></span><span class="x">class ProductController {</span>
<span class="linenos" data-linenos="22 "></span><span class="x">    public function showProduct() {</span>
<span class="linenos" data-linenos="23 "></span><span class="x">        $product = new Product(&quot;Laptop&quot;, 1200.00);</span>
<span class="linenos" data-linenos="24 "></span><span class="x">        include &#39;views/productView.php&#39;;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="26 "></span><span class="x">}</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span><span class="x">// View: productView.php</span>
<span class="linenos" data-linenos="29 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="31 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos="32 "></span><span class="x">    &lt;title&gt;Product Information&lt;/title&gt;</span>
<span class="linenos" data-linenos="33 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos="34 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="35 "></span><span class="x">    &lt;h1&gt;Product: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span> <span class="cp">?&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="linenos" data-linenos="36 "></span><span class="x">    &lt;p&gt;Price: $</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getPrice</span><span class="p">());</span> <span class="cp">?&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="linenos" data-linenos="37 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="38 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
La separació de la lògica de negoci dels aspectes de presentació és crucial per al desenvolupament d'aplicacions web eficients, mantenibles i escalables.</p>
<h2 id="9-gestio-dexempcions">9. Gestió d'Exempcions<a class="headerlink" href="#9-gestio-dexempcions" title="Permanent link">&para;</a></h2>
<p>La gestió d'excepcions forma part des de PHP 5. El seu funcionament és similar a Java*, fent ús d'un bloc <code>try / catch / finally</code>.
Si detectem una situació anòmala i volem llançar una excepció, haurem de realitzar <code>throw new Exception</code> (adjuntant el missatge que l'ha provocat).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$divisor </span><span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;División por cero.&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nv">$resultado </span><span class="o">=</span> <span class="nv">$dividendo </span><span class="o">/</span> <span class="nv">$divisor</span><span class="p">;</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="8 "></span>    <span class="k">echo</span> <span class="s2">&quot;Se ha producido el siguiente error: &quot;</span><span class="o">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<p>La classe <code>Exception</code> és la classe pare de totes les excepcions. El seu constructor rep <code>missatge[,codigoError][,excepcionPrevia]</code>.</p>
<p>A partir d'un objecte <code>Exception</code>, podem accedir als mètodes <code>getMessage()</code>i <code>getCode()</code> per a obtindre el missatge i el codi d'error de l'excepció capturada.</p>
<p>El propi llenguatge ofereix un conjunt d'excepcions ja definides, les quals podem capturar (i llançar des de PHP 7). Es recomana la seua consulta en la <a href="https://www.php.net/manual/es/class.exception.php">documentació oficial</a>.</p>
<h4 id="creant-exempcions">Creant exempcions<a class="headerlink" href="#creant-exempcions" title="Permanent link">&para;</a></h4>
<p>Per a crear una excepció, la forma més curta és crear una classe que únicament herete de <code>Exception</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">HolaExcepcion extends Exception </span><span class="p">{}</span>
</code></pre></div>
<p>Si volem, i és recomanable depenent dels requisits, podem sobrecarregar els mètodes màgics, per exemple, sobrecarregant el constructor i cridant al constructor del pare, o reescriure el mètode <code>__toString</code> per a canviar el seu missatge:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">MiExcepcion extends Exception </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$msj</span><span class="p">,</span> <span class="nv">$codigo </span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Exception </span><span class="nv">$previa </span><span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="c1">// código propio</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$msj</span><span class="p">,</span> <span class="nv">$codigo</span><span class="p">,</span> <span class="nv">$previa</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">return</span> <span class="no">__CLASS__</span> <span class="o">.</span> <span class="s2">&quot;: [</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">miFuncion</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span> <span class="s2">&quot;Una función personalizada para este tipo de excepción</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<p>Si definim una excepció d'aplicació dins d'un <em>namespace</em>, quan referenciem a <code>Exception</code>, haurem de referenciar-la mitjançant el seu nom totalment qualificat (<code>\Exception</code>), o utilitzant <code>use</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Mitjançant nom totalment qualificat</label><label for="__tabbed_5_2">Mitjançant <code>use</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">namespace</span> <span class="nx">\Dwes\Ejemplos</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">class</span> <span class="nc">AppExcepcion extends \Exception </span><span class="p">{}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">namespace</span> <span class="nx">\Dwes\Ejemplos</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="k">class</span> <span class="nc">AppExcepcion extends Exception </span><span class="p">{}</span>
</code></pre></div>
</div>
</div>
</div>
<h5 id="exempcions-multiples">Exempcions múltiples<a class="headerlink" href="#exempcions-multiples" title="Permanent link">&para;</a></h5>
<p>Es poden usar excepcions múltiples per a comprovar diferents condicions. A l'hora de capturar-les, es fa de més específica a més general.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$email </span><span class="o">=</span> <span class="s2">&quot;ejemplo@ejemplo.com&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="c1">// Comprueba si el email es válido</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">if</span><span class="p">(</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_EMAIL</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">MiExcepcion</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="c1">// Comprueba la palabra ejemplo en la dirección email</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="s2">&quot;ejemplo&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$email es un email de ejemplo</span><span class="s2"> no válido&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">MiExcepcion </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">miFuncion</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>¿Qué pasaría al ejectuar el siguiente código?
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">MainException extends Exception </span><span class="p">{}</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">class</span> <span class="nc">SubException extends MainException </span><span class="p">{}</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">SubException</span><span class="p">(</span><span class="s2">&quot;Lanzada SubException&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">MainException </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">echo</span> <span class="s2">&quot;Capturada MainException &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">SubException </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">echo</span> <span class="s2">&quot;Capturada SubException &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">echo</span> <span class="s2">&quot;Capturada Exception &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div></p>
</div>
<p>Si en el mateix <code>catch</code> volem capturar diverses excepcions, hem d'utilitzar l'operador <code>|</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">MainException extends Exception </span><span class="p">{}</span>
<span class="linenos" data-linenos="3 "></span><span class="k">class</span> <span class="nc">SubException extends MainException </span><span class="p">{}</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="6 "></span>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">SubException</span><span class="p">(</span><span class="s2">&quot;Lanzada SubException&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">MainException </span><span class="o">|</span> <span class="nx">SubException </span><span class="nv">$e </span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="8 "></span>    <span class="k">echo</span> <span class="s2">&quot;Capturada Exception &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<p>Des de PHP 7, existeix el tipus <code>Throwable</code>, el qual és una interfície que implementen tant els errors com les excepcions, i ens permet capturar els dos tipus alhora:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="c1">// tu codigo</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">echo</span> <span class="s1">&#39;Forma de capturar errores y excepciones a la vez&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<p>Si només volem capturar els errors fatals, podem fer ús de la classe <code>Error</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="c1">// Genera una notificación que no se captura</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">echo</span> <span class="nv">$variableNoAsignada</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="c1">// Error fatal que se captura</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nx">funcionQueNoExiste</span><span class="p">();</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Error </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="8 "></span>    <span class="k">echo</span> <span class="s2">&quot;Error capturado: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="rellancar-exempcions">Rellançar exempcions<a class="headerlink" href="#rellancar-exempcions" title="Permanent link">&para;</a></h4>
<p>En les aplicacions reals, és molt comuna capturar una excepció de sistema i llançar una d'aplicació que hem definit nostros.
També podem llançar les excepcions sense necessitat d'estar dins d'un <code>try/catch</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">AppException extends Exception </span><span class="p">{}</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="c1">// Código de negocio que falla</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception </span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">AppException</span><span class="p">(</span><span class="s2">&quot;AppException: &quot;</span><span class="o">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">(),</span> <span class="nv">$e</span><span class="p">);</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="10-proves-amb-phpunit">10. Proves amb PHPUNIT<a class="headerlink" href="#10-proves-amb-phpunit" title="Permanent link">&para;</a></h2>
<p>El curs passat, dins del mòdul de Entorns de Desenvolupament, estudiarieu la importància de la realització de proves, així com les proves unitàries mitjançant <a href="https://junit.org/junit5/">JUnit</a>.</p>
<figure style="float: right;">
    <img src="imagenes/05/tdd.png" width="300">
    <figcaption>Test Driven Development</figcaption>
</figure>

<p>Hui dia és de gran importància seguir una bona metodologia de proves, sent el desenvolupament dirigit per les proves (Test Driven Development / TDD) un dels enfocaments més emprats, el qual consisteix en:</p>
<ol>
<li>Escriure el test, i com no hi ha codi implementat, la prova falle (roig).</li>
<li>Escriure el codi d'aplicació perquè la prova funcione (verda).</li>
<li>refactoritzar el codi de l'aplicació amb l'ajuda de la prova per a comprovar que no trenquem res (refactor).</li>
</ol>
<p>En el cas de PHP, l'eina que s'utilitza és <strong>PHPUnit</strong> (<a href="https://phpunit.de/">https://phpunit.de/</a>), que com el seu nom indica, està basada en JUnit. La versió actual és la 11.</p>
<h3 id="introduccio-a-phpunit">Introducció a PHPUnit<a class="headerlink" href="#introduccio-a-phpunit" title="Permanent link">&para;</a></h3>
<p>PHPUnit és un framework de proves popular per a PHP que suporta tant proves unitàries com proves d'integració. És àmpliament utilitzat en la comunitat PHP per la seua simplicitat i eficàcia. Les proves unitàries es centren en provar components o mètodes individuals, mentre que les proves d'integració asseguren que les diferents parts del sistema funcionen conjuntament com s'espera.</p>
<h4 id="installacio_2">Instal·lació<a class="headerlink" href="#installacio_2" title="Permanent link">&para;</a></h4>
<p>Per començar a utilitzar PHPUnit, cal instal·lar-lo. La manera recomanada és a través de Composer. Executa la següent comanda en el terminal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>--dev<span class="w"> </span>phpunit/phpunit
</code></pre></div>
<p>Aquesta comanda afegirà PHPUnit com a dependència de desenvolupament en el teu projecte.</p>
<div class="admonition tip">
<p class="admonition-title">Llibreries de desenvolupament</p>
<p>Les llibreries que es col·loquen en <code>require-dev</code> són les de desenvolupament i <em>testing</em>, de manera que no s'instal·laran en un entorn de producció.</p>
</div>
<p>Una vegada instal·lat, podem configurar PHPUnit creant un fitxer phpunit.xml en l'arrel del projecte per especificar la configuració de les proves:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">&lt;phpunit</span><span class="w"> </span><span class="na">bootstrap=</span><span class="s">&quot;vendor/autoload.php&quot;</span><span class="nt">&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="nt">&lt;testsuites&gt;</span>
<span class="linenos" data-linenos="3 "></span><span class="w">        </span><span class="nt">&lt;testsuite</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Application Test Suite&quot;</span><span class="nt">&gt;</span>
<span class="linenos" data-linenos="4 "></span><span class="w">            </span><span class="nt">&lt;directory&gt;</span>tests<span class="nt">&lt;/directory&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="w">        </span><span class="nt">&lt;/testsuite&gt;</span>
<span class="linenos" data-linenos="6 "></span><span class="w">    </span><span class="nt">&lt;/testsuites&gt;</span>
<span class="linenos" data-linenos="7 "></span><span class="nt">&lt;/phpunit&gt;</span>
</code></pre></div>
<h4 id="estructura-dun-test">Estructura d’un test<a class="headerlink" href="#estructura-dun-test" title="Permanent link">&para;</a></h4>
<p>Els tests en PHPUnit són classes PHP que hereten de PHPUnit\Framework\TestCase. Cada mètode dins d'aquestes classes que comence amb test serà executat com una prova.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">use PHPUnit\Framework\TestCase;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">use App\Models\Empleado;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">class EmpleadoTest extends TestCase {</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    private $empleado;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    protected function setUp(): void {</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        $this-&gt;empleado = new Empleado(&#39;John&#39;, &#39;Doe&#39;, 4000, 30);</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="x">    public function testGetSou() {</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        $this-&gt;assertEquals(4000, $this-&gt;empleado-&gt;getSou());</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="x">    public function testSetSou() {</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        $this-&gt;empleado-&gt;setSou(4500);</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        $this-&gt;assertEquals(4500, $this-&gt;empleado-&gt;getSou());</span>
<span class="linenos" data-linenos="19 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="x">    public function testGetTelefonos() {</span>
<span class="linenos" data-linenos="22 "></span><span class="x">        $this-&gt;assertIsArray($this-&gt;empleado-&gt;getTelefonos());</span>
<span class="linenos" data-linenos="23 "></span><span class="x">        $this-&gt;assertEmpty($this-&gt;empleado-&gt;getTelefonos());</span>
<span class="linenos" data-linenos="24 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span><span class="x">    public function testSetTelefono() {</span>
<span class="linenos" data-linenos="27 "></span><span class="x">        $this-&gt;empleado-&gt;setTelefono(&#39;123456789&#39;);</span>
<span class="linenos" data-linenos="28 "></span><span class="x">        $this-&gt;assertCount(1, $this-&gt;empleado-&gt;getTelefonos());</span>
<span class="linenos" data-linenos="29 "></span><span class="x">        $this-&gt;assertEquals(&#39;123456789&#39;, $this-&gt;empleado-&gt;getTelefonos()[0]);</span>
<span class="linenos" data-linenos="30 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span><span class="x">    public function testListarTelefonos() {</span>
<span class="linenos" data-linenos="33 "></span><span class="x">        $this-&gt;empleado-&gt;setTelefono(&#39;123456789&#39;);</span>
<span class="linenos" data-linenos="34 "></span><span class="x">        $this-&gt;empleado-&gt;setTelefono(&#39;987654321&#39;);</span>
<span class="linenos" data-linenos="35 "></span><span class="x">        $this-&gt;assertEquals(&#39;123456789, 987654321&#39;, $this-&gt;empleado-&gt;listarTelefonos());</span>
<span class="linenos" data-linenos="36 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="37 "></span>
<span class="linenos" data-linenos="38 "></span><span class="x">    public function testVaciarTelefonos() {</span>
<span class="linenos" data-linenos="39 "></span><span class="x">        $this-&gt;empleado-&gt;setTelefono(&#39;123456789&#39;);</span>
<span class="linenos" data-linenos="40 "></span><span class="x">        $this-&gt;empleado-&gt;vaciarTelefonos();</span>
<span class="linenos" data-linenos="41 "></span><span class="x">        $this-&gt;assertEmpty($this-&gt;empleado-&gt;getTelefonos());</span>
<span class="linenos" data-linenos="42 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="43 "></span>
<span class="linenos" data-linenos="44 "></span><span class="x">    public function testDebePagarImpuestos() {</span>
<span class="linenos" data-linenos="45 "></span><span class="x">        $this-&gt;assertTrue($this-&gt;empleado-&gt;debePagarImpuestos());</span>
<span class="linenos" data-linenos="46 "></span><span class="x">        $this-&gt;empleado-&gt;setSou(3000);</span>
<span class="linenos" data-linenos="47 "></span><span class="x">        $this-&gt;assertFalse($this-&gt;empleado-&gt;debePagarImpuestos());</span>
<span class="linenos" data-linenos="48 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="49 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="execucio-de-proves">Execució de Proves<a class="headerlink" href="#execucio-de-proves" title="Permanent link">&para;</a></h4>
<p>Per executar les proves, podem utilitzar la següent comanda:</p>
<p>vendor/bin/phpunit</p>
<p>Aquesta comanda cercarà els arxius de prova en el directori especificat (per defecte tests) i executarà totes les proves.</p>
<h4 id="tipus-de-proves">Tipus de  proves<a class="headerlink" href="#tipus-de-proves" title="Permanent link">&para;</a></h4>
<p>Amb PHPUnit, podem realitzar diversos tipus de proves, entre elles:</p>
<ul>
<li>Proves Unitàries : Verifiquen el funcionament d'una unitat de codi individual, com una funció o mètode.</li>
<li>Proves Funcionals: Verifiquen que un conjunt de mòduls funciona correctament conjuntament. Aquestes proves poden simular interaccions de l'usuari en un sistema web, encara que això es fa millor amb frameworks especialitzats per a proves funcionals.</li>
<li>Proves d'Integració: Comproven que diferents mòduls o serveis funcionen correctament quan es combinen.</li>
</ul>
<p>Exemple de prova unitària:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function testResta() {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    $calculadora = new Calculadora();</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    $resultat = $calculadora-&gt;resta(5, 3);</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    $this-&gt;assertEquals(2, $resultat);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="assercions">Assercions<a class="headerlink" href="#assercions" title="Permanent link">&para;</a></h4>
<p>Les assercions permeten comprovar el resultat dels mètodes que volem provar. Les assercions esperen que el predicat sempre siga vertader.</p>
<p>PHPUnit ofereix les següent assercions:</p>
<ul>
<li><code>assertTrue</code> / <code>assertFalse</code>: Comprova que la condició donada siga avaluada com true / false</li>
<li><code>assertEquals</code> / <code>assertSame</code>: Comprova que dues variables siguen iguals</li>
<li><code>assertNotEquals</code> / <code>assertNotSame</code>: Comprova que dues variables NO siguen iguals</li>
<li><code>assertNull</code>: Comprova que un valor és null.</li>
<li><code>Same</code> → comprova els tipus. Si no coincideixen els tipus i els valors, l'asserció fallarà</li>
<li><code>Equals</code> → sense comprovació estricta</li>
<li><code>assertArrayHasKey</code> / <code>assertArrayNotHasKey</code>: Comprova que un array posseïsca un <em>key</em> determinat / o NO ho posseïsca</li>
<li><code>assertArraySubset</code>: Comprova que un array posseïsca un altre array com subset del mateix</li>
<li><code>assertAttributeContains</code> / <code>assertAttributeNotContains</code>: Comprova que un atribut d'una classe continga una variable determinada / o NO continga una variable determinada</li>
<li><code>assertAttributeEquals</code>: Comprova que un atribut d'una classe siga igual a una variable determinada.</li>
</ul>
<h4 id="proves-amb-dades">Proves amb dades<a class="headerlink" href="#proves-amb-dades" title="Permanent link">&para;</a></h4>
<p>Les proves en PHPUnit poden utilitzar data providers per executar el mateix test amb diferents dades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">/**</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x"> * @dataProvider proveidorDeDades</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x"> */</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">public function testMultiplica($a, $b, $esperat) {</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    $calculadora = new Calculadora();</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    $this-&gt;assertEquals($esperat, $calculadora-&gt;multiplica($a, $b));</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">public function proveidorDeDades() {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    return [</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        [2, 3, 6],</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        [0, 5, 0],</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        [-1, 5, -5],</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    ];</span>
<span class="linenos" data-linenos="15 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="mocks">Mocks<a class="headerlink" href="#mocks" title="Permanent link">&para;</a></h4>
<p>Un mock és un objecte simulat que imita el comportament d'un objecte real en un entorn de proves. S'utilitza per simular la funcionalitat de certs components o dependències d'una classe, sense necessitat d'executar el codi real d'aquests components. Això permet provar una classe de manera aïllada i controlar el comportament de les seves dependències.</p>
<p><strong>Els mocks són útils quan:</strong></p>
<ul>
<li>No volem o no podem dependre del comportament real d'un component extern, com una connexió a una base de dades o una API.</li>
<li>Necessitem verificar la interacció entre la classe provada i una dependència externa (per exemple, comprovar que un mètode s'ha cridat amb uns certs arguments).</li>
<li>Volem millorar la velocitat i la fiabilitat de les proves en eliminar la dependència de sistemes externs.</li>
</ul>
<p><strong>Com funciona un mock</strong></p>
<p>Quan utilitzem un mock, en lloc de cridar el mètode real d'una dependència, definim el comportament esperat manualment. També podem verificar que certs mètodes del mock s'hagin cridat, amb certs arguments, un nombre determinat de vegades, etc.</p>
<p><strong>Exemple senzill de mock amb PHPUnit</strong></p>
<p>Suposem que tenim una classe UserService que depèn d'una classe EmailService per enviar correus electrònics quan es crea un nou usuari. No volem enviar correus electrònics durant les proves, però sí que volem assegurar-nos que el mètode d'enviament de correus es crida quan es crea un usuari nou.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">class</span> <span class="nc">EmailService</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="c1">// Lògica per enviar un correu electrònic</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="k">class</span> <span class="nc">UserService</span>
<span class="linenos" data-linenos="12 "></span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">private</span> <span class="nv">$emailService</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">EmailService</span> <span class="nv">$emailService</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">emailService</span> <span class="o">=</span> <span class="nv">$emailService</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">createUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="22 "></span>        <span class="c1">// Crear usuari...</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>        <span class="c1">// Enviar un correu electrònic al nou usuari</span>
<span class="linenos" data-linenos="25 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">emailService</span><span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span> <span class="s1">&#39;Welcome!&#39;</span><span class="p">,</span> <span class="s1">&#39;Benvingut a la nostra plataforma!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">class</span> <span class="nc">UserServiceTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateUserSendsEmail</span><span class="p">()</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="c1">// Creem un mock de la classe EmailService</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$emailServiceMock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">EmailService</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>        <span class="c1">// Definim l&#39;expectativa: esperem que el mètode sendEmail sigui cridat una vegada</span>
<span class="linenos" data-linenos="13 "></span>        <span class="c1">// amb els arguments concrets que especifiquem.</span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$emailServiceMock</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
<span class="linenos" data-linenos="15 "></span>                         <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;sendEmail&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>                         <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span>
<span class="linenos" data-linenos="17 "></span>                             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">equalTo</span><span class="p">(</span><span class="s1">&#39;test@example.com&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="18 "></span>                             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">equalTo</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="19 "></span>                             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stringContains</span><span class="p">(</span><span class="s1">&#39;Benvingut a la nostra plataforma!&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="20 "></span>                         <span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>        <span class="c1">// Creem una instància de UserService passant el mock d&#39;EmailService</span>
<span class="linenos" data-linenos="23 "></span>        <span class="nv">$userService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserService</span><span class="p">(</span><span class="nv">$emailServiceMock</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span>        <span class="c1">// Simulem la creació d&#39;un nou usuari</span>
<span class="linenos" data-linenos="26 "></span>        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>
<span class="linenos" data-linenos="27 "></span>        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">=</span> <span class="s1">&#39;test@example.com&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="28 "></span>        <span class="nv">$userService</span><span class="o">-&gt;</span><span class="na">createUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span>        <span class="c1">// El mètode sendEmail del mock hauria de ser cridat una vegada amb els paràmetres especificats</span>
<span class="linenos" data-linenos="31 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="provant-excepcions">Provant excepcions<a class="headerlink" href="#provant-excepcions" title="Permanent link">&para;</a></h4>
<p>Les proves a més de comprovar que les classes funcionen com s'espera, han de cobrir tots els casos possibles. Així doncs, hem de poder fer proves que esperen que es llance una exempció (i que el missatge continga una certa informació):</p>
<p>Per a això, s'utilitzen les següent expectatives:</p>
<ul>
<li><code>expectException(Excepcion::class)</code></li>
<li><code>expectExceptionCode(codigoExcepcion)</code></li>
<li><code>expectExceptionMessage(missatge)</code></li>
</ul>
<p>De la mateixa manera que abans, primer es posa l'expectativa, i després es provoca que es llance l'exempció:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testExcepcio</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span>    <span class="nv">$calculadora</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculadora</span><span class="p">();</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nv">$calculadora</span><span class="o">-&gt;</span><span class="na">divideix</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="conclusio_1">Conclusió<a class="headerlink" href="#conclusio_1" title="Permanent link">&para;</a></h4>
<p>Les proves són crucials per a assegurar que el nostre codi PHP és fiable i manté la seua funcionalitat al llarg del temps. Utilitzar PHPUnit ens proporciona les eines necessàries per a escriure proves eficaces i mantenir el nostre projecte en un estat saludable.</p>
<h2 id="12-referencies-bibliografiques">12. Referències Bibliogràfiques<a class="headerlink" href="#12-referencies-bibliografiques" title="Permanent link">&para;</a></h2>
<h3 id="programacio-orientada-a-objectes-en-php">Programació Orientada a Objectes en PHP<a class="headerlink" href="#programacio-orientada-a-objectes-en-php" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>"PHP Objects, Patterns, and Practice"</strong><br />
  per M. Zandstra. Apress, 2017. ISBN: 978-1-4842-1361-3. Aquest llibre és un recurs essencial per entendre els fonaments de la programació orientada a objectes en PHP, així com patrons de disseny.</p>
</li>
<li>
<p><strong>"Learning PHP, MySQL &amp; JavaScript: With jQuery, CSS &amp; HTML5"</strong><br />
  per Robin Nixon. O'Reilly Media, 2018. ISBN: 978-1-4919-2070-2. Ofereix una introducció completa a la programació amb PHP, incloent-hi el model d'objectes de PHP.</p>
</li>
</ul>
<h3 id="constructors-i-destructors">Constructors i Destructors<a class="headerlink" href="#constructors-i-destructors" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PHP Manual: Constructors and Destructors</strong><br />
  Documentació oficial de PHP sobre constructors i destructors en la programació orientada a objectes. Disponible a <a href="https://www.php.net/manual/en/language.oop5.decon.php">https://www.php.net/manual/en/language.oop5.decon.php</a>.</li>
</ul>
<h3 id="encapsulacio-i-visibilitat">Encapsulació i Visibilitat<a class="headerlink" href="#encapsulacio-i-visibilitat" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PHP Manual: Visibility</strong><br />
  Secció del manual oficial de PHP que explica les paraules clau <code>public</code>, <code>protected</code>, i <code>private</code>, així com el concepte d'encapsulació. Accessible a <a href="https://www.php.net/manual/en/language.oop5.visibility.php">https://www.php.net/manual/en/language.oop5.visibility.php</a>.</li>
</ul>
<h3 id="herencia-i-polimorfisme">Herència i Polimorfisme<a class="headerlink" href="#herencia-i-polimorfisme" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>"Programming PHP"</strong><br />
  per Kevin Tatroe, Peter MacIntyre, i Rasmus Lerdorf. O'Reilly Media, 2013. ISBN: 978-1-4493-5053-6. Aquest llibre cobreix àmpliament els conceptes d'herència i polimorfisme en PHP, proporcionant exemples pràctics.</p>
</li>
<li>
<p><strong>PHP Manual: Inheritance</strong><br />
  Documentació oficial de PHP que tracta sobre l'herència en classes, incloent el polimorfisme. Disponible a <a href="https://www.php.net/manual/en/language.oop5.inheritance.php">https://www.php.net/manual/en/language.oop5.inheritance.php</a>.</p>
</li>
</ul>
<h3 id="classes-abstractes-i-interficies">Classes Abstractes i Interfícies<a class="headerlink" href="#classes-abstractes-i-interficies" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PHP Manual: Interfaces and Abstract Classes</strong><br />
  Explicació oficial de les classes abstractes i les interfícies en PHP. Disponible a <a href="https://www.php.net/manual/en/language.oop5.interfaces.php">https://www.php.net/manual/en/language.oop5.interfaces.php</a>.</li>
</ul>
<h3 id="nombres-magics-i-metodes-magics">Nombres màgics i Metodes màgics<a class="headerlink" href="#nombres-magics-i-metodes-magics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PHP Manual: Magic Methods</strong><br />
  Guia completa sobre els mètodes màgics en PHP, com <code>__construct()</code>, <code>__destruct()</code>, <code>__get()</code>, <code>__set()</code>, entre altres. Disponible a <a href="https://www.php.net/manual/en/language.oop5.magic.php">https://www.php.net/manual/en/language.oop5.magic.php</a>.</li>
</ul>
<h3 id="trait-en-php">Trait en PHP<a class="headerlink" href="#trait-en-php" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PHP Manual: Traits</strong><br />
  Documentació sobre traits en PHP, que permeten reutilitzar codi entre diferents classes. Disponible a <a href="https://www.php.net/manual/en/language.oop5.traits.php">https://www.php.net/manual/en/language.oop5.traits.php</a>.</li>
</ul>
<h3 id="excepcions-en-php">Excepcions en PHP<a class="headerlink" href="#excepcions-en-php" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>"The Pragmatic Programmer: Your Journey to Mastery"</strong><br />
  per David Thomas i Andrew Hunt. Addison-Wesley Professional, 2019. ISBN: 978-0-1359-5202-8. Inclou bones pràctiques per a la gestió d'excepcions, aplicables també a PHP.</p>
</li>
<li>
<p><strong>PHP Manual: Exceptions</strong><br />
  Secció del manual de PHP dedicada a les excepcions, explicant com llençar i capturar excepcions en PHP. Accessible a <a href="https://www.php.net/manual/en/language.exceptions.php">https://www.php.net/manual/en/language.exceptions.php</a>.</p>
</li>
</ul>
<h3 id="proves-amb-phpunit">Proves amb PHPUnit<a class="headerlink" href="#proves-amb-phpunit" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>"Modern PHP: New Features and Good Practices"</strong><br />
  per Josh Lockhart. O'Reilly Media, 2015. ISBN: 978-1-4919-2904-0. Aquest llibre inclou una secció sobre proves amb PHPUnit.</p>
</li>
<li>
<p><strong>PHPUnit Documentation</strong><br />
  Documentació oficial de PHPUnit, que cobreix com escriure i executar proves unitàries en PHP. Accessible a <a href="https://phpunit.de/documentation.html">https://phpunit.de/documentation.html</a>.</p>
</li>
</ul>
<h3 id="eines-de-desenvolupament-i-autocarrega">Eines de Desenvolupament i Autocàrrega<a class="headerlink" href="#eines-de-desenvolupament-i-autocarrega" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Composer Documentation</strong><br />
  Accessible des de <a href="https://getcomposer.org/doc/">https://getcomposer.org/doc/</a>. Composer és l'eina estàndard per a la gestió de dependències en PHP, i inclou suport per a l'autocàrrega de classes.</p>
</li>
<li>
<p><strong>PHP Manual: Autoloading Classes</strong><br />
  Guia sobre el mecanisme d'autocàrrega en PHP, que facilita la inclusió automàtica de classes en els teus projectes. Disponible a <a href="https://www.php.net/manual/en/language.oop5.autoload.php">https://www.php.net/manual/en/language.oop5.autoload.php</a>.</p>
</li>
</ul>
<h3 id="poo-avancada-patrons-de-disseny">POO Avançada: Patrons de Disseny<a class="headerlink" href="#poo-avancada-patrons-de-disseny" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>"Head First Design Patterns"</strong><br />
  per Eric Freeman i Elisabeth Robson. O'Reilly Media, 2020. ISBN: 978-1-4919-7175-9. Un recurs excel·lent per aprendre patrons de disseny aplicables a PHP.</p>
</li>
<li>
<p><strong>"PHP Design Patterns"</strong><br />
  per Stephan Schmidt. Publicat per Packt Publishing, 2008. ISBN: 978-1-84719-255-3. Aquest llibre explora com aplicar patrons de disseny en projectes PHP.</p>
</li>
</ul>
<h3 id="webs-de-referencia-addicionals">Webs de Referència Addicionals<a class="headerlink" href="#webs-de-referencia-addicionals" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>PHP: The Right Way</strong><br />
<a href="https://phptherightway.com/">https://phptherightway.com/</a>. Una guia per a desenvolupar aplicacions PHP seguint les millors pràctiques de la indústria.</p>
</li>
<li>
<p><strong>Stack Overflow</strong><br />
<a href="https://stackoverflow.com/questions/tagged/php">https://stackoverflow.com/questions/tagged/php</a>. Una font d'informació valuosa per resoldre problemes específics de PHP i discutir amb altres desenvolupadors.</p>
</li>
</ul>
<hr />
<h2 id="13-exercicis">13. Exercicis<a class="headerlink" href="#13-exercicis" title="Permanent link">&para;</a></h2>
<h3 id="bateria-dexercicis-solucionats-per-a-la-unitat-de-programacio-orientada-a-objectes">Bateria d'Exercicis Solucionats per a la Unitat de Programació Orientada a Objectes<a class="headerlink" href="#bateria-dexercicis-solucionats-per-a-la-unitat-de-programacio-orientada-a-objectes" title="Permanent link">&para;</a></h3>
<h5 id="exercici-1-crear-una-classe-basica">Exercici 1: Crear una Classe Bàsica<a class="headerlink" href="#exercici-1-crear-una-classe-basica" title="Permanent link">&para;</a></h5>
<ol>
<li>Crea una classe <code>Cotxe</code> que tinga les propietats <code>marca</code> i <code>model</code>. Afegeix un mètode <code>mostraInformacio</code> que retorne un string amb la marca i el model del cotxe.</li>
<li>Crea una instància de la classe <code>Cotxe</code>, assigna-li una marca i un model, i mostra la informació utilitzant el mètode <code>mostraInformacio</code>.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Cotxe</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraInformacio</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">return</span> <span class="s2">&quot;Marca: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">.</span> <span class="s2">&quot;, Model: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$cotxe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cotxe</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$cotxe</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">=</span> <span class="s2">&quot;Toyota&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span><span class="nv">$cotxe</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="s2">&quot;Corolla&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span><span class="k">echo</span> <span class="nv">$cotxe</span><span class="o">-&gt;</span><span class="na">mostraInformacio</span><span class="p">();</span> <span class="c1">// Output: Marca: Toyota, Model: Corolla</span>
</code></pre></div>
</details>

<h5 id="exercici-2-afegir-un-constructor-i-destructor">Exercici 2. Afegir un Constructor i destructor<a class="headerlink" href="#exercici-2-afegir-un-constructor-i-destructor" title="Permanent link">&para;</a></h5>
<ol>
<li>Modifica la classe <code>Cotxe</code> per afegir un constructor que prenga com a paràmetres la <code>marca</code> i el <code>model</code>, i que establisca aquestes propietats automàticament.</li>
<li>Afegeix un destructor a la classe <code>Cotxe</code> que mostre un missatge quan l'objecte és destruït. Crea un objecte i permet que es destruïsca al final del programa.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Cotxe</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$marca</span><span class="p">,</span> <span class="nv">$model</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">=</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span> <span class="s2">&quot;L&#39;objecte Cotxe ha estat destruït.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraInformacio</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">return</span> <span class="s2">&quot;Marca: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">.</span> <span class="s2">&quot;, Model: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-3-encapsulacio-de-propietats">Exercici 3. Encapsulació de Propietats<a class="headerlink" href="#exercici-3-encapsulacio-de-propietats" title="Permanent link">&para;</a></h5>
<ol>
<li>Modifica la classe <code>Cotxe</code> per a que les propietats <code>marca</code> i <code>model</code> siguen privades. Afegeix mètodes públics <code>getMarca</code>, <code>setMarca</code>, <code>getModel</code>, i <code>setModel</code> per accedir i modificar aquestes propietats.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Cotxe</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$marca</span><span class="p">,</span> <span class="nv">$model</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">=</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getMarca</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMarca</span><span class="p">(</span><span class="nv">$marca</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">=</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getModel</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setModel</span><span class="p">(</span><span class="nv">$model</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraInformacio</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="28 "></span>        <span class="k">return</span> <span class="s2">&quot;Marca: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMarca</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;, Model: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">();</span>
<span class="linenos" data-linenos="29 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="30 "></span><span class="p">}</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span><span class="nv">$cotxe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cotxe</span><span class="p">(</span><span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;Fiesta&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="33 "></span><span class="k">echo</span> <span class="nv">$cotxe</span><span class="o">-&gt;</span><span class="na">mostraInformacio</span><span class="p">();</span> <span class="c1">// Output: Marca: Ford, Model: Fiesta</span>
</code></pre></div>
</details>

<h5 id="exercici-4-herencia-i-polimorfisme">Exercici 4. Herència i Polimorfisme<a class="headerlink" href="#exercici-4-herencia-i-polimorfisme" title="Permanent link">&para;</a></h5>
<ol>
<li>Crea una classe <code>Vehicle</code> amb una propietat <code>tipus</code>. A continuació, crea una classe <code>Motocicleta</code> que herete de <code>Vehicle</code> i tinga una propietat <code>cilindrada</code>. Afegeix un mètode a <code>Motocicleta</code> que retorne el tipus i la cilindrada.</li>
<li>Crea una funció <code>mostraDetallsVehicle</code> que accepte un objecte de tipus <code>Vehicle</code> i mostre les seues propietats. Prova aquesta funció amb objectes de <code>Cotxe</code> i <code>Motocicleta</code>.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Vehicle</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">protected</span> <span class="nv">$tipus</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$tipus</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tipus</span> <span class="o">=</span> <span class="nv">$tipus</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraDetalls</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">return</span> <span class="s2">&quot;Tipus: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tipus</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">class</span> <span class="nc">Cotxe</span> <span class="k">extends</span> <span class="nx">Vehicle</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">private</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="k">private</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$marca</span><span class="p">,</span> <span class="nv">$model</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="s2">&quot;Cotxe&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">=</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraDetalls</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">mostraDetalls</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;, Marca: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">.</span> <span class="s2">&quot;, Model: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="p">}</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span><span class="k">class</span> <span class="nc">Motocicleta</span> <span class="k">extends</span> <span class="nx">Vehicle</span> <span class="p">{</span>
<span class="linenos" data-linenos="30 "></span>    <span class="k">private</span> <span class="nv">$cilindrada</span><span class="p">;</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$cilindrada</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="33 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="s2">&quot;Motocicleta&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="34 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cilindrada</span> <span class="o">=</span> <span class="nv">$cilindrada</span><span class="p">;</span>
<span class="linenos" data-linenos="35 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="36 "></span>
<span class="linenos" data-linenos="37 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraDetalls</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="38 "></span>        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">mostraDetalls</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;, Cilindrada: &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cilindrada</span><span class="p">;</span>
<span class="linenos" data-linenos="39 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="40 "></span><span class="p">}</span>
<span class="linenos" data-linenos="41 "></span>
<span class="linenos" data-linenos="42 "></span><span class="k">function</span> <span class="nf">mostraDetallsVehicle</span><span class="p">(</span><span class="nx">Vehicle</span> <span class="nv">$vehicle</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="43 "></span>    <span class="k">echo</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">mostraDetalls</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="44 "></span><span class="p">}</span>
<span class="linenos" data-linenos="45 "></span>
<span class="linenos" data-linenos="46 "></span><span class="nv">$cotxe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cotxe</span><span class="p">(</span><span class="s2">&quot;Toyota&quot;</span><span class="p">,</span> <span class="s2">&quot;Corolla&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="47 "></span><span class="nv">$moto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Motocicleta</span><span class="p">(</span><span class="mi">600</span><span class="p">);</span>
<span class="linenos" data-linenos="48 "></span>
<span class="linenos" data-linenos="49 "></span><span class="nx">mostraDetallsVehicle</span><span class="p">(</span><span class="nv">$cotxe</span><span class="p">);</span> <span class="c1">// Output: Tipus: Cotxe, Marca: Toyota, Model: Corolla</span>
<span class="linenos" data-linenos="50 "></span><span class="nx">mostraDetallsVehicle</span><span class="p">(</span><span class="nv">$moto</span><span class="p">);</span>  <span class="c1">// Output: Tipus: Motocicleta, Cilindrada: 600</span>
</code></pre></div>
</details>

<h5 id="exercici-5-implementacio-del-patro-mvc-amb-vehicles">Exercici 5. Implementació del Patró MVC amb Vehicles<a class="headerlink" href="#exercici-5-implementacio-del-patro-mvc-amb-vehicles" title="Permanent link">&para;</a></h5>
<p>Continuant amb l'exercici anterior on has creat les classes <code>Vehicle</code>, <code>Cotxe</code>, i <code>Motocicleta</code>, ara refactoritzaràs el codi per seguir el patró Model-Vista-Controlador (MVC). El teu objectiu és separar la lògica de negoci (models) de la presentació (vistes) i gestionar la interacció entre aquestes capes mitjançant un controlador.</p>
<ol>
<li>
<p><strong>Crear el Model</strong>:</p>
<ul>
<li>Refactoritza les classes <code>Vehicle</code>, <code>Cotxe</code>, i <code>Motocicleta</code> perquè representen el model de negoci i només contenen la lògica relacionada amb la gestió de vehicles.</li>
<li>Assegura't que els models no contenen cap codi de presentació.</li>
</ul>
</li>
<li>
<p><strong>Crear les Vistes</strong>:</p>
<ul>
<li>Crea vistes separades per mostrar els detalls dels vehicles:<ul>
<li>Una vista HTML que mostre la informació dels vehicles en format HTML.</li>
<li>Una vista en text simple que mostre els detalls dels vehicles en un format de text senzill.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Crear el Controlador</strong>:</p>
<ul>
<li>Implementa un controlador que gestione la interacció entre els models i les vistes.</li>
<li>El controlador ha de ser capaç de rebre una sol·licitud per mostrar un vehicle i triar la vista adequada per mostrar-ne els detalls.</li>
</ul>
</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="  1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="  2 "></span><span class="c1">// Models</span>
<span class="linenos" data-linenos="  3 "></span>
<span class="linenos" data-linenos="  4 "></span><span class="k">class</span> <span class="nc">Vehicle</span> <span class="p">{</span>
<span class="linenos" data-linenos="  5 "></span>    <span class="k">protected</span> <span class="nv">$tipus</span><span class="p">;</span>
<span class="linenos" data-linenos="  6 "></span>
<span class="linenos" data-linenos="  7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$tipus</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="  8 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tipus</span> <span class="o">=</span> <span class="nv">$tipus</span><span class="p">;</span>
<span class="linenos" data-linenos="  9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 10 "></span>
<span class="linenos" data-linenos=" 11 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTipus</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 12 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tipus</span><span class="p">;</span>
<span class="linenos" data-linenos=" 13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 14 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 15 "></span>
<span class="linenos" data-linenos=" 16 "></span><span class="k">class</span> <span class="nc">Cotxe</span> <span class="k">extends</span> <span class="nx">Vehicle</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 17 "></span>    <span class="k">private</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 18 "></span>    <span class="k">private</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 19 "></span>
<span class="linenos" data-linenos=" 20 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$marca</span><span class="p">,</span> <span class="nv">$model</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 21 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="s2">&quot;Cotxe&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 22 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span> <span class="o">=</span> <span class="nv">$marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 23 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="nv">$model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 25 "></span>
<span class="linenos" data-linenos=" 26 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getMarca</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 27 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">marca</span><span class="p">;</span>
<span class="linenos" data-linenos=" 28 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 29 "></span>
<span class="linenos" data-linenos=" 30 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getModel</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 31 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 32 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 33 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 34 "></span>
<span class="linenos" data-linenos=" 35 "></span><span class="k">class</span> <span class="nc">Motocicleta</span> <span class="k">extends</span> <span class="nx">Vehicle</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 36 "></span>    <span class="k">private</span> <span class="nv">$cilindrada</span><span class="p">;</span>
<span class="linenos" data-linenos=" 37 "></span>
<span class="linenos" data-linenos=" 38 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$cilindrada</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 39 "></span>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="s2">&quot;Motocicleta&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 40 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cilindrada</span> <span class="o">=</span> <span class="nv">$cilindrada</span><span class="p">;</span>
<span class="linenos" data-linenos=" 41 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 42 "></span>
<span class="linenos" data-linenos=" 43 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCilindrada</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 44 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cilindrada</span><span class="p">;</span>
<span class="linenos" data-linenos=" 45 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 46 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 47 "></span>
<span class="linenos" data-linenos=" 48 "></span><span class="c1">// Vistes</span>
<span class="linenos" data-linenos=" 49 "></span>
<span class="linenos" data-linenos=" 50 "></span><span class="k">class</span> <span class="nc">VehicleView</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 51 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">renderHtml</span><span class="p">(</span><span class="nx">Vehicle</span> <span class="nv">$vehicle</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 52 "></span>        <span class="nv">$output</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;Tipus: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getTipus</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 53 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$vehicle</span> <span class="nx">instanceof</span> <span class="nx">Cotxe</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 54 "></span>            <span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;&lt;p&gt;Marca: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getMarca</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 55 "></span>            <span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;&lt;p&gt;Model: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 56 "></span>        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$vehicle</span> <span class="nx">instanceof</span> <span class="nx">Motocicleta</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 57 "></span>            <span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;&lt;p&gt;Cilindrada: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getCilindrada</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot; cc&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 58 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 59 "></span>        <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="linenos" data-linenos=" 60 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 61 "></span>
<span class="linenos" data-linenos=" 62 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">renderText</span><span class="p">(</span><span class="nx">Vehicle</span> <span class="nv">$vehicle</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 63 "></span>        <span class="nv">$output</span> <span class="o">=</span> <span class="s2">&quot;Tipus: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getTipus</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 64 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$vehicle</span> <span class="nx">instanceof</span> <span class="nx">Cotxe</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 65 "></span>            <span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;Marca: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getMarca</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 66 "></span>            <span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;Model: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 67 "></span>        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$vehicle</span> <span class="nx">instanceof</span> <span class="nx">Motocicleta</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 68 "></span>            <span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;Cilindrada: &quot;</span> <span class="o">.</span> <span class="nv">$vehicle</span><span class="o">-&gt;</span><span class="na">getCilindrada</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot; cc</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 69 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 70 "></span>        <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="linenos" data-linenos=" 71 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 72 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 73 "></span>
<span class="linenos" data-linenos=" 74 "></span><span class="c1">// Controlador</span>
<span class="linenos" data-linenos=" 75 "></span>
<span class="linenos" data-linenos=" 76 "></span><span class="k">class</span> <span class="nc">VehicleController</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 77 "></span>    <span class="k">private</span> <span class="nv">$view</span><span class="p">;</span>
<span class="linenos" data-linenos=" 78 "></span>
<span class="linenos" data-linenos=" 79 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">VehicleView</span> <span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 80 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">;</span>
<span class="linenos" data-linenos=" 81 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 82 "></span>
<span class="linenos" data-linenos=" 83 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostrarVehicle</span><span class="p">(</span><span class="nx">Vehicle</span> <span class="nv">$vehicle</span><span class="p">,</span> <span class="nv">$format</span> <span class="o">=</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 84 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$format</span> <span class="o">===</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 85 "></span>            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">renderHtml</span><span class="p">(</span><span class="nv">$vehicle</span><span class="p">);</span>
<span class="linenos" data-linenos=" 86 "></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 87 "></span>            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">renderText</span><span class="p">(</span><span class="nv">$vehicle</span><span class="p">);</span>
<span class="linenos" data-linenos=" 88 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 89 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 90 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 91 "></span>
<span class="linenos" data-linenos=" 92 "></span><span class="c1">// Exemple d&#39;ús</span>
<span class="linenos" data-linenos=" 93 "></span>
<span class="linenos" data-linenos=" 94 "></span><span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VehicleView</span><span class="p">();</span>
<span class="linenos" data-linenos=" 95 "></span><span class="nv">$controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VehicleController</span><span class="p">(</span><span class="nv">$view</span><span class="p">);</span>
<span class="linenos" data-linenos=" 96 "></span>
<span class="linenos" data-linenos=" 97 "></span><span class="nv">$cotxe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cotxe</span><span class="p">(</span><span class="s2">&quot;Toyota&quot;</span><span class="p">,</span> <span class="s2">&quot;Corolla&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 98 "></span><span class="nv">$moto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Motocicleta</span><span class="p">(</span><span class="mi">600</span><span class="p">);</span>
<span class="linenos" data-linenos=" 99 "></span>
<span class="linenos" data-linenos="100 "></span><span class="c1">// Mostrar en HTML</span>
<span class="linenos" data-linenos="101 "></span><span class="nv">$controller</span><span class="o">-&gt;</span><span class="na">mostrarVehicle</span><span class="p">(</span><span class="nv">$cotxe</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="102 "></span><span class="nv">$controller</span><span class="o">-&gt;</span><span class="na">mostrarVehicle</span><span class="p">(</span><span class="nv">$moto</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="103 "></span>
<span class="linenos" data-linenos="104 "></span><span class="c1">// Mostrar en Text</span>
<span class="linenos" data-linenos="105 "></span><span class="nv">$controller</span><span class="o">-&gt;</span><span class="na">mostrarVehicle</span><span class="p">(</span><span class="nv">$cotxe</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="106 "></span><span class="nv">$controller</span><span class="o">-&gt;</span><span class="na">mostrarVehicle</span><span class="p">(</span><span class="nv">$moto</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">);</span>
</code></pre></div>
</details>

<h4 id="exercici-5-classes-abstractes-i-interficies">Exercici 5. Classes Abstractes i Interfícies<a class="headerlink" href="#exercici-5-classes-abstractes-i-interficies" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una classe abstracta <code>Figura</code> amb un mètode abstracte <code>calculaArea</code>. Després, crea classes <code>Cercle</code> i <code>Rectangle</code> que estiguen basades en <code>Figura</code> i implementen el mètode <code>calculaArea</code>.</li>
<li>Defineix una interfície <code>OperacionsBàsiques</code> amb els mètodes <code>suma</code> i <code>resta</code>. Implementa aquesta interfície en una classe <code>CalculadoraSimple</code>.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Figura</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">calculaArea</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">Cercle</span> <span class="k">extends</span> <span class="nx">Figura</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">private</span> <span class="nv">$radi</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$radi</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">radi</span> <span class="o">=</span> <span class="nv">$radi</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculaArea</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">return</span> <span class="nb">pi</span><span class="p">()</span> <span class="o">*</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">radi</span> <span class="o">*</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">radi</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="k">class</span> <span class="nc">Rectangle</span> <span class="k">extends</span> <span class="nx">Figura</span> <span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">private</span> <span class="nv">$ample</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>    <span class="k">private</span> <span class="nv">$llarg</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$ample</span><span class="p">,</span> <span class="nv">$llarg</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ample</span> <span class="o">=</span> <span class="nv">$ample</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">llarg</span> <span class="o">=</span> <span class="nv">$llarg</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculaArea</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="28 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ample</span> <span class="o">*</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">llarg</span><span class="p">;</span>
<span class="linenos" data-linenos="29 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="30 "></span><span class="p">}</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span><span class="nv">$cercle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cercle</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="linenos" data-linenos="33 "></span><span class="nv">$rectangle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="linenos" data-linenos="34 "></span>
<span class="linenos" data-linenos="35 "></span><span class="k">echo</span> <span class="s2">&quot;Àrea del cercle: &quot;</span> <span class="o">.</span> <span class="nv">$cercle</span><span class="o">-&gt;</span><span class="na">calculaArea</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Àrea del cercle: 78.5398</span>
<span class="linenos" data-linenos="36 "></span><span class="k">echo</span> <span class="s2">&quot;Àrea del rectangle: &quot;</span> <span class="o">.</span> <span class="nv">$rectangle</span><span class="o">-&gt;</span><span class="na">calculaArea</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Àrea del rectangle: 24</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">interface</span> <span class="nx">OperacionsBàsiques</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">suma</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">resta</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">CalculadoraSimple</span> <span class="k">implements</span> <span class="nx">OperacionsBàsiques</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">suma</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">resta</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">return</span> <span class="nv">$a</span> <span class="o">-</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$calculadora</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CalculadoraSimple</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span><span class="k">echo</span> <span class="s2">&quot;Suma: &quot;</span> <span class="o">.</span> <span class="nv">$calculadora</span><span class="o">-&gt;</span><span class="na">suma</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Suma: 8</span>
<span class="linenos" data-linenos="19 "></span><span class="k">echo</span> <span class="s2">&quot;Resta: &quot;</span> <span class="o">.</span> <span class="nv">$calculadora</span><span class="o">-&gt;</span><span class="na">resta</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Resta: 2</span>
</code></pre></div>
</details>

<h4 id="exercici-6-utilitzar-traits">Exercici 6.  Utilitzar Traits<a class="headerlink" href="#exercici-6-utilitzar-traits" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un trait <code>Informacio</code> amb un mètode <code>mostraInformacio</code>. Inclou aquest trait en les classes <code>Cotxe</code> i <code>Motocicleta</code>, i utilitza'l per mostrar informació addicional.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">trait</span> <span class="nx">Informacio</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mostraInformacio</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="k">return</span> <span class="s2">&quot;Aquest és un objecte de tipus &quot;</span> <span class="o">.</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">class</span> <span class="nc">Cotxe</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">use</span> <span class="nx">Informacio</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="k">class</span> <span class="nc">Motocicleta</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">use</span> <span class="nx">Informacio</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="nv">$cotxe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cotxe</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$moto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Motocicleta</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="k">echo</span> <span class="nv">$cotxe</span><span class="o">-&gt;</span><span class="na">mostraInformacio</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Aquest és un objecte de tipus Cotxe</span>
<span class="linenos" data-linenos="20 "></span><span class="k">echo</span> <span class="nv">$moto</span><span class="o">-&gt;</span><span class="na">mostraInformacio</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Aquest és un objecte de tipus Motocicleta</span>
</code></pre></div>
</details>

<h4 id="exercici-7-gestionar-excepcions">Exercici 7.  Gestionar Excepcions<a class="headerlink" href="#exercici-7-gestionar-excepcions" title="Permanent link">&para;</a></h4>
<ol>
<li>Escriu una funció <code>divideix</code> que prenga dos nombres com a paràmetres i retorne el resultat de la divisió. Si el segon nombre és zero, llença una excepció amb un missatge adequat. Captura aquesta excepció quan crides a la funció i mostra un missatge d'error.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">function</span> <span class="nf">divideix</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;No es pot dividir per zero.&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">return</span> <span class="nv">$a</span> <span class="o">/</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">echo</span> <span class="nx">divideix</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: 5</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">echo</span> <span class="nx">divideix</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Aquesta línia llançarà una excepció</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">echo</span> <span class="s2">&quot;Error: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// Output: Error: No es pot dividir per zero.</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h4 id="exercici-8-proves-amb-phpunit">Exercici 8. Proves amb PHPUnit<a class="headerlink" href="#exercici-8-proves-amb-phpunit" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea una classe <code>Calculadora</code> amb els mètodes <code>suma</code> i <code>resta</code>. Escriu una prova unitària amb PHPUnit per verificar que aquests mètodes funcionen correctament.</li>
<li>Afegeix un mètode <code>divideix</code> a la classe <code>Calculadora</code> que llance una excepció quan es divideix per zero. Escriu una prova unitària que assegure que aquesta excepció es llança correctament.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Arxiu: tests/CalculadoraTest.php</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">class</span> <span class="nc">Calculadora</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">suma</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">resta</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">return</span> <span class="nv">$a</span> <span class="o">-</span> <span class="nv">$b</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="k">class</span> <span class="nc">CalculadoraTest</span> <span class="k">extends</span> <span class="nx">TestCase</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSuma</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$calculadora</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculadora</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>        <span class="nv">$resultat</span> <span class="o">=</span> <span class="nv">$calculadora</span><span class="o">-&gt;</span><span class="na">suma</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nv">$resultat</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testResta</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>        <span class="nv">$calculadora</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculadora</span><span class="p">();</span>
<span class="linenos" data-linenos="24 "></span>        <span class="nv">$resultat</span> <span class="o">=</span> <span class="nv">$calculadora</span><span class="o">-&gt;</span><span class="na">resta</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="linenos" data-linenos="25 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$resultat</span><span class="p">);</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">// Arxiu: tests/CalculadoraTest.php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">use PHPUnit\Framework\TestCase;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">class Calculadora {</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    public function divideix($a, $b) {</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        if ($b == 0) {</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            throw new InvalidArgumentException(&quot;No es pot dividir per zero.&quot;);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        }</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        return $a / $b;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="11 "></span><span class="x">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">class CalculadoraTest extends TestCase {</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    public function testDivideix() {</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        $this-&gt;expectException(InvalidArgumentException::class);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="x">        $calculadora = new Calculadora();</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        $calculadora-&gt;divideix(5, 0);</span>
<span class="linenos" data-linenos="19 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="20 "></span><span class="x">}</span>
</code></pre></div>
</details>

<h4 id="exercici-9-espais-de-noms-namespaces">Exercici 9. Espais de Noms (Namespaces)<a class="headerlink" href="#exercici-9-espais-de-noms-namespaces" title="Permanent link">&para;</a></h4>
<ol>
<li>Crea un espai de noms <code>App\Models</code> i defineix una classe <code>Usuari</code> dins d'aquest espai de noms. Afegeix un mètode <code>getNomComplet</code> que retorne el nom complet de l'usuari.</li>
<li>En un fitxer separat, importa la classe <code>Usuari</code> de l'espai de noms <code>App\Models</code> i crea una instància d'aquesta classe. Utilitza el mètode <code>getNomComplet</code> per mostrar el nom complet d'un usuari.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Arxiu: src/Models/Usuari.php</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">class</span> <span class="nc">Usuari</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">private</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">private</span> <span class="nv">$cognom</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$nom</span><span class="p">,</span> <span class="nv">$cognom</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nom</span> <span class="o">=</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cognom</span> <span class="o">=</span> <span class="nv">$cognom</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getNomComplet</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nom</span> <span class="o">.</span> <span class="s2">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cognom</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">// Arxiu: index.php</span>
<span class="linenos" data-linenos="2 "></span><span class="x">require &#39;vendor/autoload.php&#39;;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="x">use App\Models\Usuari;</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="x">$usuari = new Usuari(&quot;Joan&quot;, &quot;Garcia&quot;);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">echo $usuari-&gt;getNomComplet(); // Output: Joan Garcia</span>
</code></pre></div>
</details>

<h4 id="exercici-10-autoloading-i-composer">Exercici 10. Autoloading i Composer<a class="headerlink" href="#exercici-10-autoloading-i-composer" title="Permanent link">&para;</a></h4>
<ol>
<li>Configura un projecte PHP amb Composer que utilitze l'autoloading PSR-4. Crea l'estructura de directoris <code>src/Models</code> i col·loca una classe <code>Producte</code> dins de <code>src/Models</code>. Verifica que l'autoloading funcione correctament instanciant la classe <code>Producte</code> en un fitxer separat.</li>
<li>Afegeix la llibreria <code>monolog/monolog</code> al projecte utilitzant Composer. Crea una instància de <code>Logger</code> i afegeix una entrada al registre de logs.</li>
</ol>
<details>
<summary>Solució</summary>

1. Crea l'estructura de directoris src/Models i col·loca el següent codi a src/Models/Producte.php:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">class</span> <span class="nc">Producte</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">private</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$nom</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nom</span> <span class="o">=</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getNom</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nom</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
</code></pre></div>

2. Configura l'autoloading en composer.json:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="nt">&quot;autoload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span><span class="w">        </span><span class="nt">&quot;psr-4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span><span class="w">            </span><span class="nt">&quot;App\\&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;src/&quot;</span>
<span class="linenos" data-linenos="5 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>

3. Executa composer dump-autoload per generar els fitxers d'autoload.
4. Utilitza la classe producte:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Arxiu: index.php</span>
<span class="linenos" data-linenos="3 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">use</span> <span class="nx">App\Models\Producte</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$producte</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Producte</span><span class="p">(</span><span class="s2">&quot;Ordinador&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="8 "></span><span class="k">echo</span> <span class="nv">$producte</span><span class="o">-&gt;</span><span class="na">getNom</span><span class="p">();</span> <span class="c1">// Output: Ordinador</span>
</code></pre></div>
5. Afegeix Monolog a composer.json:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>monolog/monolog
</code></pre></div>
6. Utilitza Monolog per crear un logger:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s1">&#39;nom_aplicacio&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s1">&#39;app.log&#39;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">WARNING</span><span class="p">));</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1">// Afegeix una entrada al log</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s1">&#39;Aquesta és una entrada d&#39;</span><span class="nx">advertència</span><span class="s1">&#39;);</span>
<span class="linenos" data-linenos="12 "></span><span class="s1">$log-&gt;error(&#39;</span><span class="nx">Aquesta</span> <span class="nx">és</span> <span class="nx">una</span> <span class="nx">entrada</span> <span class="nx">d</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
</code></pre></div>
</details>

<h4 id="exercici-11-logger">Exercici 11. Logger<a class="headerlink" href="#exercici-11-logger" title="Permanent link">&para;</a></h4>
<ol>
<li>Utilitzant la llibreria <code>Monolog</code>, crea un logger que escriga missatges a un fitxer <code>app.log</code>. Configura el logger per registrar missatges d'informació i d'error.</li>
<li>Configura un logger que escriga missatges de registre tant a un fitxer com a la consola. Prova el logger registrant missatges d'error.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s1">&#39;nom_aplicacio&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s1">&#39;app.log&#39;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">INFO</span><span class="p">));</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s1">&#39;app.log&#39;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">ERROR</span><span class="p">));</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="c1">// Registra missatges d&#39;informació i d&#39;error</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Aquesta és una entrada d’informació&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Aquesta és una entrada d’error&#39;</span><span class="p">);</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\ErrorLogHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s1">&#39;nom_aplicacio&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s1">&#39;app.log&#39;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">WARNING</span><span class="p">));</span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">ErrorLogHandler</span><span class="p">());</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="c1">// Registra missatges d’error al fitxer i a la consola</span>
<span class="linenos" data-linenos="13 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Aquesta és una entrada d’error&#39;</span><span class="p">);</span>
</code></pre></div>

</details>

<h4 id="exercici-12-documentacio">Exercici 12. Documentació<a class="headerlink" href="#exercici-12-documentacio" title="Permanent link">&para;</a></h4>
<ol>
<li>Documenta la classe <code>Producte</code> creada en l'exercici anterior utilitzant comentaris PHPDoc. Assegura't d'incloure la descripció de la classe, les propietats, i els mètodes.</li>
<li>Utilitza una eina com <code>phpDocumentor</code> per generar la documentació automàtica del codi PHP del projecte, incloent-hi la classe <code>Producte</code>.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd"> * Classe Producte</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd"> *</span>
<span class="linenos" data-linenos=" 7 "></span><span class="sd"> * Representa un producte amb un nom.</span>
<span class="linenos" data-linenos=" 8 "></span><span class="sd"> */</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">class</span> <span class="nc">Producte</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">     * @var string El nom del producte</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">private</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="16 "></span><span class="sd">     * Constructor de la classe Producte</span>
<span class="linenos" data-linenos="17 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="18 "></span><span class="sd">     * @param string $nom El nom del producte</span>
<span class="linenos" data-linenos="19 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="20 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$nom</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nom</span> <span class="o">=</span> <span class="nv">$nom</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="25 "></span><span class="sd">     * Obté el nom del producte</span>
<span class="linenos" data-linenos="26 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="27 "></span><span class="sd">     * @return string El nom del producte</span>
<span class="linenos" data-linenos="28 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="29 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getNom</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="30 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nom</span><span class="p">;</span>
<span class="linenos" data-linenos="31 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span><span class="p">}</span>
</code></pre></div>

1. Instal·la phpDocumentor globalment o com a dependència de desenvolupament:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>--dev<span class="w"> </span>phpdocumentor/phpdocumentor
</code></pre></div>

2. Genera la documentació:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vendor/bin/phpdoc<span class="w"> </span>-d<span class="w"> </span>src<span class="w"> </span>-t<span class="w"> </span>docs
</code></pre></div>

Aquest comandament generarà la documentació a la carpeta docs.

</details>

<h4 id="exercici-13-generacio-de-pdfs-amb-dompdf">Exercici 13. Generació de PDFs amb DomPDF<a class="headerlink" href="#exercici-13-generacio-de-pdfs-amb-dompdf" title="Permanent link">&para;</a></h4>
<ol>
<li>Instal·la la llibreria <code>dompdf/dompdf</code> amb Composer. Crea un script PHP que genere un PDF senzill amb un títol i un paràgraf de text.</li>
<li>Crea un PDF utilitzant DomPDF que incloga una taula amb dades i una imatge. Assegura't que el PDF es renderitze correctament i que la imatge s'incloga en el document.</li>
</ol>
<details>
<summary>Solució</summary>

1. Instal·la DomPDF amb Composer:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>dompdf/dompdf
</code></pre></div>

2. Crea un script PHP que generi un PDF senzill:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Dompdf\Dompdf</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$dompdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dompdf</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h1&gt;Informe de Vendes&lt;/h1&gt;&lt;p&gt;Aquest és un informe de les vendes.&lt;/p&gt;&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">loadHtml</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">setPaper</span><span class="p">(</span><span class="s1">&#39;A4&#39;</span><span class="p">,</span> <span class="s1">&#39;landscape&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">stream</span><span class="p">(</span><span class="s1">&#39;informe.pdf&#39;</span><span class="p">);</span>
</code></pre></div>

3. Crea un PDF amb una taula i una imatge:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Dompdf\Dompdf</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$dompdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dompdf</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$html</span> <span class="o">=</span> <span class="s1">&#39;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="s1">    &lt;h1&gt;Informe de Productes&lt;/h1&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="s1">    &lt;table border=&quot;1&quot; cellpadding=&quot;10&quot;&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="s1">        &lt;thead&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="s1">            &lt;tr&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="s1">                &lt;th&gt;Producte&lt;/th&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="s1">                &lt;th&gt;Preu&lt;/th&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="s1">            &lt;/tr&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="s1">        &lt;/thead&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="s1">        &lt;tbody&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="s1">            &lt;tr&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="s1">                &lt;td&gt;Ordinador&lt;/td&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="s1">                &lt;td&gt;500€&lt;/td&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="s1">            &lt;/tr&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="s1">            &lt;tr&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="s1">                &lt;td&gt;Teclat&lt;/td&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="s1">                &lt;td&gt;20€&lt;/td&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="s1">            &lt;/tr&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="s1">        &lt;/tbody&gt;</span>
<span class="linenos" data-linenos="26 "></span><span class="s1">    &lt;/table&gt;</span>
<span class="linenos" data-linenos="27 "></span><span class="s1">    &lt;img src=&quot;https://example.com/imatge.png&quot; alt=&quot;Imatge de Producte&quot; /&gt;</span>
<span class="linenos" data-linenos="28 "></span><span class="s1">&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">loadHtml</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
<span class="linenos" data-linenos="31 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">setPaper</span><span class="p">(</span><span class="s1">&#39;A4&#39;</span><span class="p">,</span> <span class="s1">&#39;portrait&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="32 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span>
<span class="linenos" data-linenos="33 "></span><span class="nv">$dompdf</span><span class="o">-&gt;</span><span class="na">stream</span><span class="p">(</span><span class="s2">&quot;informe_productes.pdf&quot;</span><span class="p">);</span>
</code></pre></div>

</details>

<h2 id="exercicis-proposats_2">Exercicis proposats<a class="headerlink" href="#exercicis-proposats_2" title="Permanent link">&para;</a></h2>
<h4 id="exercici-1-creacio-de-la-classe-basica-i-gestio-de-propietats">Exercici 1. Creació de la Classe Bàsica i Gestió de Propietats<a class="headerlink" href="#exercici-1-creacio-de-la-classe-basica-i-gestio-de-propietats" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Crea una classe <code>Persona</code> amb les propietats privades <code>nom</code>, <code>cognoms</code>, i <code>edat</code>. Encapsula aquestes propietats mitjançant getters i setters. Afig els següents mètodes:</p>
<ul>
<li><code>getNomComplet(): string</code> – Retorna el nom complet de la persona.</li>
<li><code>estaJubilat(): bool</code> – Retorna <code>true</code> si l'edat és major o igual a 65, <code>false</code> en cas contrari.</li>
</ul>
</li>
<li>
<p>Modifica la classe <code>Persona</code> afegint un constructor que assigna nom i cognoms. Si es proporciona un tercer paràmetre, assigna l'edat; en cas contrari, assigna una edat per defecte de 25 anys.</p>
</li>
<li>
<p>Modifica la classe <code>Persona</code> per utilitzar una constant <code>LIMITE_EDAT</code> amb el valor de 66 anys i utilitza-la en el mètode <code>estaJubilat</code>.</p>
</li>
</ul>
<h4 id="exercici-2-herencia-i-polimorfisme">Exercici 2. Herència i Polimorfisme<a class="headerlink" href="#exercici-2-herencia-i-polimorfisme" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Crea una classe <code>Empleado</code> que herete de <code>Persona</code>. Afig les següents propietats i mètodes:</p>
<ul>
<li><code>private float $sou</code></li>
<li><code>private array $telefons</code></li>
<li><code>anyadirTelefono(int $telefon): void</code> – Afig un número de telèfon a l'array.</li>
<li><code>listarTelefonos(): string</code> – Retorna els números de telèfon separats per comes.</li>
<li><code>vaciarTelefonos(): void</code> – Buida l'array de telèfons.</li>
<li><code>debePagarImpuestos(): bool</code> – Retorna <code>true</code> si el sou és superior a 3333€, <code>false</code> en cas contrari.</li>
</ul>
</li>
<li>
<p>Afig un mètode estàtic <code>toHtml(Empleado $emp): string</code> que genere un codi HTML que mostre el nom complet de l'empleat dins d'un paràgraf i els seus telèfons dins d'una llista ordenada.</p>
</li>
<li>Afig un mètode estàtic <code>toHtml(Persona $p)</code> a la classe Persona que mostre el nom complet de la persona dins d'un paràgraf. Modifica el mètode <code>toHtml</code> de <code>Empleado</code> per rebre una <code>Persona</code> com a paràmetre i comprovar si es tracta d'un <code>Empleado</code> amb <code>instanceof</code>.</li>
<li>Transforma <code>Persona</code> en una classe abstracta. Redefineix el mètode estàtic <code>toHtml(Persona $p)</code> en totes les seues subclasses. </li>
</ul>
<h4 id="exercici-3-integracio-despais-de-noms-autoloading-i-composer">Exercici 3. Integració d'Espais de Noms, Autoloading, i Composer<a class="headerlink" href="#exercici-3-integracio-despais-de-noms-autoloading-i-composer" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Crea una classe <code>Empresa</code> que incloga una propietat amb un array de <code>Empleados</code> . Implementa:</p>
<ul>
<li><code>public function addWorker(Empleado $t)</code></li>
<li><code>public function listWorkersHtml(): string</code> – Genera la llista de treballadors en format HTML.</li>
<li><code>public function getCosteNominas(): float</code> – Calcula el cost total de les nòmines.</li>
</ul>
</li>
<li>
<p>Configura el projecte PHP amb Composer que utilitze l'autoloading PSR-4.  </p>
</li>
</ul>
<h4 id="exercici-4-logger-i-documentacio">Exercici 4. Logger i Documentació<a class="headerlink" href="#exercici-4-logger-i-documentacio" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Utilitza la llibreria <code>Monolog</code> per configurar un logger que escriga missatges a un fitxer <code>app.log</code>. Afig funcionalitat perquè el logger registre missatges d'informació i d'error en diferents arxius segons la gravetat.</p>
</li>
<li>
<p>Configura un logger que escriga missatges de registre tant a un fitxer com a la consola. Prova el logger registrant missatges d'error i advertència.</p>
</li>
<li>
<p>Documenta la classe <code>Empleado</code> creada en exercicis anteriors utilitzant comentaris PHPDoc. Inclou la descripció de la classe, les propietats, i els mètodes. Utilitza una eina com <code>phpDocumentor</code> per generar documentació automàtica.</p>
</li>
<li>
<p>Escriu proves unitàries per als mètodes de les classes <code>Persona</code>, <code>Empleado</code>, i <code>Empresa</code> utilitzant PHPUnit. Prova els mètodes <code>getNomComplet</code>, <code>estaJubilat</code>, <code>addWorker</code>, i <code>getCosteNominas</code>. Assegura't que les proves cobreixen diferents escenaris, incloent errors potencials.</p>
</li>
<li>
<p>Escriu una prova unitària que comprove que el logger està registrant correctament els missatges d'error a l'arxiu corresponent. Utilitza un mock per assegurar-te que el logger funciona sense necessitat d'escriure en un fitxer real durant la prova.</p>
</li>
</ul>
<h4 id="exercici-5-generacio-de-pdfs-amb-dompdf">Exercici 5. Generació de PDFs amb DomPDF<a class="headerlink" href="#exercici-5-generacio-de-pdfs-amb-dompdf" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Instal·la la llibreria <code>dompdf/dompdf</code> amb Composer. Crea un script PHP que genere un PDF senzill amb un títol i un paràgraf de text.</p>
</li>
<li>
<p>Crea un PDF utilitzant DomPDF que incloga una taula amb dades i una imatge. Assegura't que el PDF es renderitze correctament i que la imatge s'incloga en el document.</p>
</li>
<li>
<p>Utilitzant la classe <code>Empresa</code> i <code>Empleado</code>, genera un informe en PDF amb la llista de treballadors i el seu sou. Utilitza DomPDF per generar aquest informe.</p>
</li>
</ul>
<h4 id="exercici-6-serialitzacio-i-json">Exercici 6. Serialització i JSON<a class="headerlink" href="#exercici-6-serialitzacio-i-json" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Crea una interfície <code>JSerializable</code> que incloga els mètodes:</p>
<ul>
<li><code>toJSON(): string</code> – Converteix l'objecte a un JSON utilitzant <code>json_encode()</code>.</li>
<li><code>toSerialize(): string</code> – Serialitza l'objecte utilitzant <code>serialize()</code>.</li>
</ul>
</li>
<li>
<p>Modifica les classes <code>Persona</code>, <code>Empleado</code>, i <code>Empresa</code> per implementar aquesta interfície. Assegura't que les propietats privades es puguen serialitzar correctament.</p>
</li>
<li>
<p>Escriu mètodes per deserialitzar un objecte a partir d'una cadena JSON o d'una cadena serialitzada. Prova aquests mètodes amb PHPUnit per assegurar-te que la deserialització funciona correctament.</p>
</li>
</ul>
<h4 id="exercici-7-separacio-del-model-de-negoci-i-la-presentacio-mvc">Exercici 7. Separació del Model de Negoci i la Presentació (MVC)<a class="headerlink" href="#exercici-7-separacio-del-model-de-negoci-i-la-presentacio-mvc" title="Permanent link">&para;</a></h4>
<p>Fins ara, has creat diverses classes que gestionen la lògica del joc i les dades (models), com <code>Persona</code>, <code>Empleado</code>, i <code>Empresa</code>, i has generat sortides HTML i PDFs amb DomPDF. Ara és el moment de refactoritzar la teua aplicació per assegurar una separació clara entre la lògica del negoci i la presentació, seguint el patró Model-Vista-Controlador (MVC).</p>
<ul>
<li>
<p><strong>Crear el Model</strong>:</p>
<ul>
<li>Refactoritza les classes <code>Persona</code>, <code>Empleado</code>, i <code>Empresa</code> per assegurar que només gestionen la lògica de negoci (per exemple, càlcul de nòmines, gestió d'empleats, etc.).</li>
<li>Assegura't que aquestes classes no contenen codi relacionat amb la presentació (HTML o PDF).</li>
</ul>
</li>
<li>
<p><strong>Crear les Vistes</strong>:</p>
<ul>
<li>Crea vistes separades per presentar la informació als usuaris:<ul>
<li>Una vista HTML per mostrar la informació de <code>Empleado</code> i <code>Empresa</code> com a llistats.</li>
<li>Una vista PDF per generar informes amb DomPDF, basant-se en les dades proporcionades pel model.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Crear el Controlador</strong>:</p>
<ul>
<li>Implementa un controlador que reba les sol·licituds dels usuaris, interactue amb el model (<code>Persona</code>, <code>Empleado</code>, <code>Empresa</code>), i tria la vista adequada per mostrar els resultats (HTML o PDF).</li>
<li>El controlador ha d'encapsular tota la lògica necessària per a gestionar la interacció entre la vista i el model, assegurant que el model no estiga lligat a la capa de presentació.</li>
</ul>
</li>
</ul>
<h4 id="exercici-8-creacio-de-proves-unitaries-per-al-patro-mvc">Exercici 8. Creació de Proves Unitàries per al Patró MVC<a class="headerlink" href="#exercici-8-creacio-de-proves-unitaries-per-al-patro-mvc" title="Permanent link">&para;</a></h4>
<p>Després de refactoritzar l'aplicació per separar la lògica del negoci de la presentació seguint el patró Model-Vista-Controlador (MVC), és fonamental assegurar-se que tots els components funcionen correctament i que la interacció entre ells es realitza tal com s'espera. Per això, has de crear una sèrie de proves unitàries utilitzant PHPUnit per verificar el funcionament del model, les vistes i els controladors.</p>
<ul>
<li>
<p><strong>Proves del Model</strong>:</p>
<ul>
<li>Escriu proves unitàries per verificar el funcionament dels mètodes de les classes <code>Persona</code>, <code>Empleado</code>, i <code>Empresa</code>.</li>
<li>Assegura't que els mètodes funcionen correctament, com ara:<ul>
<li><code>getNomComplet()</code></li>
<li><code>debePagarImpuestos()</code></li>
<li><code>addWorker()</code> i <code>getCosteNominas()</code></li>
</ul>
</li>
<li>Prova que els càlculs es realitzen correctament i que les dades es gestionen segons el que s'espera.</li>
</ul>
</li>
<li>
<p><strong>Proves del Controlador</strong>:</p>
<ul>
<li>Escriu proves unitàries per assegurar-te que els controladors interactuen correctament amb els models i que seleccionen la vista adequada per a cada situació.</li>
<li>Prova que les dades es passen correctament del model a la vista a través del controlador.</li>
<li>Implementa proves per verificar que el controlador respon correctament a diferents sol·licituds de l'usuari, per exemple:<ul>
<li>Mostrar una llista d'empleats en HTML.</li>
<li>Generar un informe en PDF utilitzant DomPDF.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Proves de les Vistes</strong>:</p>
<ul>
<li>Escriu proves unitàries per comprovar que les vistes reben i mostren correctament la informació proporcionada pel controlador.</li>
<li>Prova que la generació de contingut HTML o PDF es realitza correctament a partir de les dades proporcionades pel model.</li>
</ul>
</li>
</ul>
<h2 id="14-enunciat-dels-projectes">14. Enunciat dels projectes<a class="headerlink" href="#14-enunciat-dels-projectes" title="Permanent link">&para;</a></h2>
<h3 id="projecte-4-en-ratlla_2">Projecte "4 en Ratlla"<a class="headerlink" href="#projecte-4-en-ratlla_2" title="Permanent link">&para;</a></h3>
<h4 id="1-crear-lentorn-del-4-en-ratlla">1. Crear l'entorn del 4 en ratlla<a class="headerlink" href="#1-crear-lentorn-del-4-en-ratlla" title="Permanent link">&para;</a></h4>
<ul>
<li>Dins de php crear les carpetes App,Views i Helpers.</li>
<li>Dins de la carpeta App crea les carpetes Models, Controllers , Services i Exceptions. </li>
<li>Dins de la carpeta src tindrem el index.php i el css.</li>
</ul>
<h4 id="2-integracio-de-composer-i-autoloading">2. Integració de Composer i Autoloading<a class="headerlink" href="#2-integracio-de-composer-i-autoloading" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Configuració de Composer</strong>: Defineix un <code>composer.json</code> per al projecte, configurant l'autoloading PSR-4 per carregar automàticament les classes de <code>Joc4enRatlla</code>.</li>
<li><strong>Estructura del Projecte</strong>:<ul>
<li>Organitza el codi en directoris com <code>App/Models</code> per a les classes del joc i <code>App/Controllers</code> per a la gestió del flux del joc.</li>
<li>Configura Composer per gestionar les dependències del projecte.</li>
</ul>
</li>
</ul>
<h4 id="3-refactoritzacio-amb-programacio-orientada-a-objectes-poo-i-amb-mvc">3. Refactorització amb Programació Orientada a Objectes (POO) i amb MVC<a class="headerlink" href="#3-refactoritzacio-amb-programacio-orientada-a-objectes-poo-i-amb-mvc" title="Permanent link">&para;</a></h4>
<h5 id="models">Models<a class="headerlink" href="#models" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Dins de la carpeta Models:</p>
</li>
<li>
<p><strong>Classe <code>Board</code></strong>: Crea una classe <code>Board</code> per representar la graella del joc. Aquesta classe ha de gestionar la configuració inicial de la graella, els moviments dels jugadors, i la comprovació de si hi ha un guanyador.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">namespace Joc4enRatlla\Models;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">class Board</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    public const FILES = 6;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    public const COLUMNS = 7;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    public const DIRECTIONS = [</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        [0, 1],   // Horizontal derecha</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        [1, 0],   // Vertical abajo</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        [1, 1],   // Diagonal abajo-derecha</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        [1, -1]   // Diagonal abajo-izquierda</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    ];</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="x">    private array $slots; // graella</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="x">    public function __construct(){</span>
<span class="linenos" data-linenos="17 "></span><span class="x">      // TODO: Ha d&#39;inicializar $slots</span>
<span class="linenos" data-linenos="18 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="x">    // TODO: Getters i Setters </span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="x">    private static function initializeBoard(): array{</span>
<span class="linenos" data-linenos="23 "></span><span class="x">        // TODO: Inicialitza la graella amb valors buits</span>
<span class="linenos" data-linenos="24 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="25 "></span><span class="x">    public function setMovementOnBoard(int $column, int $player): array {</span>
<span class="linenos" data-linenos="26 "></span><span class="x">        // TODO: Realitza un moviment en la graella</span>
<span class="linenos" data-linenos="27 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="28 "></span><span class="x">    public function checkWin(array $coord): bool {</span>
<span class="linenos" data-linenos="29 "></span><span class="x">        // TODO: Comprova si hi ha un guanyador</span>
<span class="linenos" data-linenos="30 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="31 "></span><span class="x">    public function isValidMove(int $column): bool {</span>
<span class="linenos" data-linenos="32 "></span><span class="x">        // TODO: Comprova si el moviment és vàlid</span>
<span class="linenos" data-linenos="33 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="34 "></span>
<span class="linenos" data-linenos="35 "></span><span class="x">    public function isFull(): bool {</span>
<span class="linenos" data-linenos="36 "></span><span class="x">        // TODO: El tauler està ple?</span>
<span class="linenos" data-linenos="37 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="38 "></span>
<span class="linenos" data-linenos="39 "></span>
<span class="linenos" data-linenos="40 "></span>
<span class="linenos" data-linenos="41 "></span><span class="x">}</span>
</code></pre></div>
<ul>
<li><strong>Classe  <code>Jugador</code></strong>: Crea una classe <code>Player</code> per representar els jugadors del joc, amb propietats com el <code>name</code>, el <code>color</code> de les fitxes, forma de jugar <code>isAutomatic</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">namespace Joc4enRatlla\Models;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">class Player {</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    private $name;      // Nom del jugador</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    private $color;     // Color de les fitxes</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    private $isAutomatic; // Forma de jugar (automàtica/manual)</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    public function __construct( $name, $color, $isAutomatic = false) {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        // TODO: Inicialitzar variables </span>
<span class="linenos" data-linenos="11 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">    // TODO: Getters i Setters </span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="x">}</span>
</code></pre></div>
<ul>
<li><strong>Classe <code>Game</code></strong>: Refactoritza la lògica del joc en una classe <code>Game</code> que gestione la graella, el torn del jugador, i la lògica per determinar el guanyador, la puntuació.</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">namespace Joc4enRatlla\Models;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">use Joc4enRatlla\Models\Board;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">use Joc4enRatlla\Models\Player;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">class Game</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    private Board $board;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    private int $nextPlayer;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    private array $players;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    private ?Player $winner;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    private array $scores = [1 =&gt; 0, 2 =&gt; 0];</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="x">    public function __construct( Player $jugador1, Player $jugador2){</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        // TODO: S&#39;han d&#39;inicialitzar les variables tenint en compte que el array de jugador ha de començar amb l&#39;index 1 </span>
<span class="linenos" data-linenos="16 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="x">    // TODO: getters i setters</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="x">    public function reset(): void{</span>
<span class="linenos" data-linenos="21 "></span><span class="x">        // TODO: Reinicia el joc</span>
<span class="linenos" data-linenos="22 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="23 "></span><span class="x">    public function play($columna){</span>
<span class="linenos" data-linenos="24 "></span><span class="x">        // TODO: Realitza un moviment</span>
<span class="linenos" data-linenos="25 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="26 "></span><span class="x">    /**</span>
<span class="linenos" data-linenos="27 "></span><span class="x">    * Realitza moviment automàtic</span>
<span class="linenos" data-linenos="28 "></span><span class="x">    * @return void</span>
<span class="linenos" data-linenos="29 "></span><span class="x">    */                                          </span>
<span class="linenos" data-linenos="30 "></span><span class="x">    public function playAutomatic(){</span>
<span class="linenos" data-linenos="31 "></span><span class="x">        $opponent = $this-&gt;nextPlayer === 1 ? 2 : 1;</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="x">        for ($col = 1; $col &lt;= Board::COLUMNS; $col++) {</span>
<span class="linenos" data-linenos="34 "></span><span class="x">            if ($this-&gt;board-&gt;isValidMove($col)) {</span>
<span class="linenos" data-linenos="35 "></span><span class="x">                $tempBoard = clone($this-&gt;board);</span>
<span class="linenos" data-linenos="36 "></span><span class="x">                $coord = $tempBoard-&gt;setMovementOnBoard($col, $this-&gt;nextPlayer);</span>
<span class="linenos" data-linenos="37 "></span>
<span class="linenos" data-linenos="38 "></span><span class="x">                if ($tempBoard-&gt;checkWin($coord)) {</span>
<span class="linenos" data-linenos="39 "></span><span class="x">                    $this-&gt;play($col);</span>
<span class="linenos" data-linenos="40 "></span><span class="x">                    return;</span>
<span class="linenos" data-linenos="41 "></span><span class="x">                }</span>
<span class="linenos" data-linenos="42 "></span><span class="x">            }</span>
<span class="linenos" data-linenos="43 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="44 "></span>
<span class="linenos" data-linenos="45 "></span><span class="x">        for ($col = 1; $col &lt;= Board::COLUMNS; $col++) {</span>
<span class="linenos" data-linenos="46 "></span><span class="x">            if ($this-&gt;board-&gt;isValidMove($col)) {</span>
<span class="linenos" data-linenos="47 "></span><span class="x">                $tempBoard = clone($this-&gt;board);</span>
<span class="linenos" data-linenos="48 "></span><span class="x">                $coord = $tempBoard-&gt;setMovementOnBoard($col, $opponent);</span>
<span class="linenos" data-linenos="49 "></span><span class="x">                if ($tempBoard-&gt;checkWin($coord )) {</span>
<span class="linenos" data-linenos="50 "></span><span class="x">                    $this-&gt;play($col);</span>
<span class="linenos" data-linenos="51 "></span><span class="x">                    return;</span>
<span class="linenos" data-linenos="52 "></span><span class="x">                }</span>
<span class="linenos" data-linenos="53 "></span><span class="x">            }</span>
<span class="linenos" data-linenos="54 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="55 "></span>
<span class="linenos" data-linenos="56 "></span><span class="x">        $possibles = array();</span>
<span class="linenos" data-linenos="57 "></span><span class="x">        for ($col = 1; $col &lt;= Board::COLUMNS; $col++) {</span>
<span class="linenos" data-linenos="58 "></span><span class="x">            if ($this-&gt;board-&gt;isValidMove($col)) {</span>
<span class="linenos" data-linenos="59 "></span><span class="x">                $possibles[] = $col;</span>
<span class="linenos" data-linenos="60 "></span><span class="x">            }</span>
<span class="linenos" data-linenos="61 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="62 "></span><span class="x">        if (count($possibles)&gt;2) {</span>
<span class="linenos" data-linenos="63 "></span><span class="x">            $random = rand(-1,1);</span>
<span class="linenos" data-linenos="64 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="65 "></span><span class="x">        $middle = (int) (count($possibles) / 2)+$random;</span>
<span class="linenos" data-linenos="66 "></span><span class="x">        $inthemiddle = $possibles[$middle];</span>
<span class="linenos" data-linenos="67 "></span><span class="x">        $this-&gt;play($inthemiddle);</span>
<span class="linenos" data-linenos="68 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="69 "></span><span class="x">    public function save(){</span>
<span class="linenos" data-linenos="70 "></span><span class="x">        // TODO: Guarda l&#39;estat del joc a les sessions</span>
<span class="linenos" data-linenos="71 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="72 "></span><span class="x">    public static function restore(){</span>
<span class="linenos" data-linenos="73 "></span><span class="x">        // TODO: Restaura l&#39;estat del joc de les sessions</span>
<span class="linenos" data-linenos="74 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="75 "></span>
<span class="linenos" data-linenos="76 "></span><span class="x">}</span>
</code></pre></div>
  - <strong>Documentació</strong>:
    - Totes les classes i mètodes han d'estar documentats amb comentaris PHPDoc.</p>
<h5 id="controladors">Controladors<a class="headerlink" href="#controladors" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Dins de la carpeta Controllers:</p>
<ul>
<li><strong>Classe <code>JocController</code></strong>: Crea un controlador <code>JocController</code> que gestione el  joc. Aquest controlador ha de permetre als jugadors realitzar moviments, comprovar l'estat del joc, i gestionar les vistes.</li>
</ul>
</li>
</ul>
<p>```php
  namespace Joc4enRatlla\Controllers;</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>use Joc4enRatlla\Models\Player;
<span class="linenos" data-linenos=" 2 "></span>use Joc4enRatlla\Models\Game;
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>class GameController
<span class="linenos" data-linenos=" 6 "></span>{
<span class="linenos" data-linenos=" 7 "></span>private Game $game;
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>// Request és l&#39;array $_POST
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>public function __construct($request=null)
<span class="linenos" data-linenos="12 "></span>{
<span class="linenos" data-linenos="13 "></span>    // TODO: Inicialització del joc.Ha d&#39;inicializar el Game si és la primera vegada o agafar les dades de la sessió si ja ha estat inicialitzada
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    $this-&gt;play($request);
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>}
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>public function play(Array $request)  
<span class="linenos" data-linenos="20 "></span>{
<span class="linenos" data-linenos="21 "></span>    // TODO : Gestió del joc. Ací es on s&#39;ha de vore si hi ha guanyador, si el que juga es automàtic  o manual, s&#39;ha polsat reiniciar...
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span>    $board = $this-&gt;game-&gt;getBoard();
<span class="linenos" data-linenos="26 "></span>    $players = $this-&gt;game-&gt;getPlayers();
<span class="linenos" data-linenos="27 "></span>    $winner = $this-&gt;game-&gt;getWinner();
<span class="linenos" data-linenos="28 "></span>    $scores = $this-&gt;game-&gt;getScores();
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span>    loadView(&#39;index&#39;,compact(&#39;board&#39;,&#39;players&#39;,&#39;winner&#39;,&#39;scores&#39;));
<span class="linenos" data-linenos="31 "></span> }
</code></pre></div>
<p>}
```
</p>
<h5 id="serveis-i-funcions">Serveis i funcions<a class="headerlink" href="#serveis-i-funcions" title="Permanent link">&para;</a></h5>
<ul>
<li>Dins de la carpeta Services:
<ul>
<li><strong>Funció <code>loadView</code></strong>: Crea una funció <code>loadView</code> que carregue les vistes del joc. Aquesta funció ha de rebre el nom de la vista i les dades a passar a la vista, i ha de mostrar la vista amb les dades proporcionades.

<code>php
&lt;?php

namespace Joc4enRatlla\Services;

class Service
{
public static function loadView($view, $data = [])
{
    $viewPath = str_replace('.', '/', $view);
    extract($data);

    include  $_SERVER['DOCUMENT_ROOT'] . "/../Views/$viewPath.view.php";

}
}</code></li>
</ul>
</li>
</ul>
<p>i la funció <code>loadView</code> en un fitxer de funcions</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">  function loadView($view, $data = [])</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">       Joc4enRatlla\Services\Service::loadView($view, $data);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    }</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    function dd(...$data )</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    {</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        echo &quot;&lt;pre&gt;&quot;;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        foreach ($data as $d) {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">            var_dump($d);</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">        echo &quot;&lt;/pre&gt;&quot;;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        die();</span>
<span class="linenos" data-linenos="15 "></span><span class="x">    }</span>
</code></pre></div>
<h5 id="vistes">Vistes<a class="headerlink" href="#vistes" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Dins de la carpeta Views:</p>
<ul>
<li><strong>Vista <code>index.php</code></strong>: Crea una vista <code>index.php</code> que mostre la graella del joc, el torn actual del jugador, i els resultats finals (guanyador o empat). Aquesta vista ha de permetre als jugadors realitzar moviments en la graella.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    &lt;link rel=&quot;stylesheet&quot; href=&quot;4ratlla.css?v=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">time</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    &lt;title&gt;4 en ratlla&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    &lt;style&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        .player1 {</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            background-color: </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$players</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getColor</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="x"> ; /* Color   per un dels jugadors */</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        }</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="x">        .player2 {</span>
<span class="linenos" data-linenos="11 "></span><span class="x">            background-color:  </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$players</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getColor</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="x">; /* Color   per l&#39;altre jugador */</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="x">    &lt;/style&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;/../Views/partials/error.view.php&#39;</span>  <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x"> &lt;form action=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x">&quot; method=&quot;post&quot;&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">    </span><span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;/../Views/partials/board.view.php&#39;</span>  <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">     &lt;input type=&quot;submit&quot; name=&quot;reset&quot; value=&quot;Reiniciar joc&quot;&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">     &lt;input type=&quot;submit&quot; name=&quot;exit&quot; value=&quot;Acabar joc&quot;&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">&lt;/form&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x"> </span><span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;/../Views/partials/panel.view.php&#39;</span>  <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
<p>board.view.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;div class=&quot;board&quot;&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    &lt;table&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">     &lt;tr&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">       </span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$winner</span> <span class="p">)</span><span class="o">:</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nv">$j</span><span class="o">&lt;=</span> <span class="nv">$board</span><span class="o">::</span><span class="na">COLUMNS</span> <span class="p">;</span><span class="nv">$j</span><span class="o">++</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">         &lt;td&gt;&lt;input type=&#39;submit&#39; name=&#39;columna&#39; value=&#39;</span><span class="cp">&lt;?</span><span class="o">=</span><span class="nv">$j</span> <span class="cp">?&gt;</span><span class="x">&#39; /&gt;&lt;/td&gt;&quot;;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">      </span><span class="cp">&lt;?php</span> <span class="k">endfor</span> <span class="p">;</span> <span class="k">else</span><span class="o">:</span> <span class="cp">?&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        &lt;h1&gt;El guanyador es el jugador </span><span class="cp">&lt;?</span><span class="o">=</span>  <span class="nv">$winner</span> <span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">      </span><span class="cp">&lt;?php</span> <span class="k">endif</span> <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">     &lt;/tr&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">      </span><span class="cp">&lt;?php</span> <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;=</span> <span class="nv">$board</span><span class="o">::</span><span class="na">FILES</span> <span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="o">:</span>  <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">          &lt;tr&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">         </span><span class="cp">&lt;?php</span> <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nv">$j</span><span class="o">&lt;=</span> <span class="nv">$board</span><span class="o">::</span><span class="na">COLUMNS</span> <span class="p">;</span><span class="nv">$j</span><span class="o">++</span><span class="p">)</span><span class="o">:</span>  <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">             </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="k">match</span> <span class="p">(</span><span class="nv">$board</span><span class="o">-&gt;</span><span class="na">getSlots</span><span class="p">()[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]){</span>
<span class="linenos" data-linenos="15 "></span>                <span class="mi">0</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;td class=&quot;buid&quot;&gt;&lt;/td&gt;&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span>                <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;td class=&quot;player1&quot;&gt;&lt;/td&gt;&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span>                <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;td class=&quot;player2&quot;&gt;&lt;/td&gt;&#39;</span><span class="p">};</span>
<span class="linenos" data-linenos="18 "></span>                <span class="k">endfor</span> <span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>            <span class="k">endfor</span>   <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">         &lt;/tr&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">    &lt;/table&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">&lt;/div&gt;</span>
</code></pre></div>
<h5 id="spa">SPA<a class="headerlink" href="#spa" title="Permanent link">&para;</a></h5>
<p>Creen la pàgina index.php que carregarà el joc 4 en ratlla.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nb">session_start</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">require_once</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/../vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">require_once</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/../Helpers/functions.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Joc4enRatlla\Controllers\GameController</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$gameController</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GameController</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span> 
<span class="linenos" data-linenos=" 9 "></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nx">loadView</span><span class="p">(</span><span class="s1">&#39;jugador&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="4-proves-amb-phpunit">4. Proves amb PHPUnit<a class="headerlink" href="#4-proves-amb-phpunit" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Escriu Proves Unitàries</strong>: Crea proves unitàries per a la classe <code>Joc4enRatlla</code> utilitzant PHPUnit. Les proves poden incloure:<ul>
<li>Verificació de la configuració inicial de la graella.</li>
<li>Proves per assegurar que un moviment s'aplica correctament a la graella.</li>
<li>Proves per assegurar que el joc detecta correctament un guanyador o un empat.</li>
</ul>
</li>
<li><strong>Proves de Gestió de Sessions</strong>: Afig proves per assegurar que l'estat del joc i el torn del jugador es mantenen correctament a través de les sessions.</li>
</ul>
<h4 id="5-logger-amb-monolog_1">5. Logger amb Monolog<a class="headerlink" href="#5-logger-amb-monolog_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Configuració de Logger</strong>: Utilitza <code>Monolog</code> per registrar esdeveniments importants del joc, com quan un jugador fa un moviment, quan s'inicia una nova partida, o quan es produeixen errors.</li>
<li><strong>Diversos Handlers</strong>:<ul>
<li>Registra els moviments dels jugadors i els resultats del joc en un fitxer <code>game.log</code>.</li>
<li>Registra errors greus o problemes amb les sessions en un fitxer d'errors separat.</li>
</ul>
</li>
</ul>
<h3 id="consideracions-addicionals-pel-projecte">Consideracions Addicionals pel  Projecte<a class="headerlink" href="#consideracions-addicionals-pel-projecte" title="Permanent link">&para;</a></h3>
<h4 id="1-documentacio-amb-phpdoc">1. Documentació amb PHPDoc<a class="headerlink" href="#1-documentacio-amb-phpdoc" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Documentació Completa</strong>: Documenta totes les classes i mètodes amb comentaris PHPDoc. Això inclou les descripcions dels paràmetres i els valors de retorn per a cada mètode.</li>
<li><strong>Generació Automàtica</strong>: Utilitza <code>phpDocumentor</code> o una eina similar per generar la documentació automàticament. Afig la documentació generada al projecte per facilitar el manteniment i la comprensió del codi.</li>
</ul>
<h4 id="2-implementacio-dinterficies">2. Implementació d'Interfícies<a class="headerlink" href="#2-implementacio-dinterficies" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Interfície <code>JocInterface</code></strong>: Crea una interfície que definisca els mètodes bàsics que qualsevol joc  ha de tindre (<code>iniciarJoc</code>, <code>ferMoviment</code>, <code>comprovaGuanyador</code>, etc.). Assegura't que la  <code>Joc4enRatlla</code> implemente  aquesta interfície.</li>
</ul>
<h4 id="3-serialitzacio-i-persistencia">3. Serialització i Persistència<a class="headerlink" href="#3-serialitzacio-i-persistencia" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Serialització de l'Estat del Joc</strong>: Implementa funcionalitats per serialitzar l'estat del joc (usant JSON o <code>serialize()</code>) i deserialitzar-lo per mantenir la persistència entre sessions o guardar l'estat per a reprendre la partida posteriorment.</li>
</ul>
<h4 id="4-exempcions">4. Exempcions<a class="headerlink" href="#4-exempcions" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Gestió d'Excepcions</strong>: Utilitza excepcions per gestionar el que un jugador jugue una columna que ja estiga plena. Afig el missatge  d'error al jocs.</li>
</ul>
<h4 id="5-fes-que-el-jugador-puga-triar-nom-i-color">5. Fes que el jugador puga triar nom i color<a class="headerlink" href="#5-fes-que-el-jugador-puga-triar-nom-i-color" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Triar Nom i Color</strong>: Permet als jugadors triar el seu nom i el color de les fitxes al començar una partida. Aquesta informació ha de ser guardada en les sessions i mostrada en la vista del joc.</li>
</ul>
<h4 id="rubrica-de-lavaluacio">Rúbrica de l'Avaluació<a class="headerlink" href="#rubrica-de-lavaluacio" title="Permanent link">&para;</a></h4>
<h5 id="funcionalitat-del-joc_1">Funcionalitat del Joc<a class="headerlink" href="#funcionalitat-del-joc_1" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>El joc no és funcional o està incomplet.</td>
</tr>
<tr>
<td>1</td>
<td>El joc és funcional, però conté errors significatius.</td>
</tr>
<tr>
<td>2</td>
<td>El joc està majoritàriament funcional amb errors mínims.</td>
</tr>
<tr>
<td>3</td>
<td>El joc està completament funcional i sense errors.</td>
</tr>
</tbody>
</table>
<h5 id="implementacio-de-programacio-orientada-a-objectes-poo">Implementació de Programació Orientada a Objectes (POO)<a class="headerlink" href="#implementacio-de-programacio-orientada-a-objectes-poo" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No s'han utilitzat classes o s'ha fet de forma poc coherent.</td>
</tr>
<tr>
<td>1</td>
<td>Tots els models tenen la seua classe i és operativa.</td>
</tr>
<tr>
<td>2</td>
<td>L'aplicatiu funciona amb classes.</td>
</tr>
</tbody>
</table>
<h5 id="separacio-del-model-de-negoci-de-la-presentacio-mvc">Separació del Model de Negoci de la Presentació (MVC)<a class="headerlink" href="#separacio-del-model-de-negoci-de-la-presentacio-mvc" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No s'ha implementat la separació de model i presentació; el codi de lògica i presentació està mesclat.</td>
</tr>
<tr>
<td>1</td>
<td>Hi ha una separació parcial, però algunes parts de la lògica del negoci es barregen amb la presentació o a l'inrevés.</td>
</tr>
<tr>
<td>2</td>
<td>La separació entre model, vista i controlador està ben implementada, però podria millorar en alguns aspectes.</td>
</tr>
<tr>
<td>3</td>
<td>Excel·lent separació entre el model, vista i controlador, seguint els principis del patró MVC i mantenint un codi net.</td>
</tr>
</tbody>
</table>
<h5 id="integracio-de-composer-i-autoloading">Integració de Composer i Autoloading<a class="headerlink" href="#integracio-de-composer-i-autoloading" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No.</td>
</tr>
<tr>
<td>1</td>
<td>Sí.</td>
</tr>
</tbody>
</table>
<h5 id="implementacio-de-proves-amb-phpunit">Implementació de Proves amb PHPUnit<a class="headerlink" href="#implementacio-de-proves-amb-phpunit" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No s'han creat proves, o les proves creades són mínimes i no adequades per a verificar la funcionalitat.</td>
</tr>
<tr>
<td>1</td>
<td>Es presenten proves bàsiques amb PHPUnit, però cobreixen parcialment les funcionalitats requerides.</td>
</tr>
<tr>
<td>2</td>
<td>Proves unitàries completes que cobreixen la majoria dels casos, incloent proves de gestió de sessions i lògica de joc.</td>
</tr>
<tr>
<td>3</td>
<td>Proves exhaustives que cobreixen totes les funcionalitats i consideren casos límit, amb ús de mocks quan necessari.</td>
</tr>
</tbody>
</table>
<h5 id="us-de-logger-amb-monolog">Ús de Logger amb Monolog<a class="headerlink" href="#us-de-logger-amb-monolog" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No s'ha implementat el logger o no s'utilitza de manera efectiva per registrar esdeveniments importants.</td>
</tr>
<tr>
<td>1</td>
<td>Logger implementat, però amb ús limitat o incorrecte en la registració d'esdeveniments i errors.</td>
</tr>
<tr>
<td>2</td>
<td>Logger ben implementat, amb esdeveniments i errors registrats adequadament en diferents fitxers o canals.</td>
</tr>
</tbody>
</table>
<h5 id="documentacio-amb-phpdoc">Documentació amb PHPDoc<a class="headerlink" href="#documentacio-amb-phpdoc" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Falta documentació o és insuficient per comprendre les classes i mètodes del projecte.</td>
</tr>
<tr>
<td>1</td>
<td>Documentació bàsica amb PHPDoc, però amb omisions o descripcions poc clares.</td>
</tr>
<tr>
<td>2</td>
<td>Documentació completa amb PHPDoc per a totes les classes i mètodes, amb descripcions clares i detallades.</td>
</tr>
</tbody>
</table>
<h5 id="exempcions">Exempcions<a class="headerlink" href="#exempcions" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No hi ha.</td>
</tr>
<tr>
<td>1</td>
<td>Si hi ha però no es mostra missatge d'error.</td>
</tr>
<tr>
<td>2</td>
<td>Es tracta perfectament i hi ha missatge d'error.</td>
</tr>
</tbody>
</table>
<h5 id="interficie">Interfície<a class="headerlink" href="#interficie" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No hi ha.</td>
</tr>
<tr>
<td>1</td>
<td>Implementada.</td>
</tr>
</tbody>
</table>
<h5 id="eleccio-color-jugador-i-panell-de-resultats">Elecció color Jugador i panell de resultats<a class="headerlink" href="#eleccio-color-jugador-i-panell-de-resultats" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>No.</td>
</tr>
<tr>
<td>1</td>
<td>Un dels dos.</td>
</tr>
<tr>
<td>2</td>
<td>Els dos.</td>
</tr>
</tbody>
</table>
<h5 id="qualitat-del-codi-i-bones-practiques">Qualitat del Codi i Bones Pràctiques<a class="headerlink" href="#qualitat-del-codi-i-bones-practiques" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Codi desordenat i sense comentaris.</td>
</tr>
<tr>
<td>1</td>
<td>Codi desorganitzat, amb molts errors de sintaxi, mala nomenclatura, o sense bones pràctiques de codi.</td>
</tr>
<tr>
<td>2</td>
<td>Codi ben escrit, seguint les convencions de nomenclatura i bones pràctiques de desenvolupament.</td>
</tr>
</tbody>
</table>
<h5 id="innovacio-i-creativitat_1">Innovació i Creativitat<a class="headerlink" href="#innovacio-i-creativitat_1" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Punts</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Cap creativitat o innovació en el projecte.</td>
</tr>
<tr>
<td>1</td>
<td>Algunes idees creatives han estat implementades.</td>
</tr>
<tr>
<td>2</td>
<td>El projecte mostra innovació significativa.</td>
</tr>
</tbody>
</table>
<h2 id="15-autoavaluacio-programacio-orientada-a-objectes-en-php">15. Autoavaluació: Programació Orientada a Objectes en PHP<a class="headerlink" href="#15-autoavaluacio-programacio-orientada-a-objectes-en-php" title="Permanent link">&para;</a></h2>
<h4 id="exercici-1-constructors-en-php">Exercici 1: Constructors en PHP<a class="headerlink" href="#exercici-1-constructors-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_14">Pregunta:<a class="headerlink" href="#pregunta_14" title="Permanent link">&para;</a></h5>
<p>Quina és la funció principal d'un constructor en una classe PHP?</p>
<h5 id="opcions_14">Opcions:<a class="headerlink" href="#opcions_14" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q1a" name="question1" value="a">
  <label for="q1a">a) Destruir els objectes de la classe quan ja no són necessaris.</label><br>
  <input type="radio" id="q1b" name="question1" value="b">
  <label for="q1b">b) Inicialitzar les propietats de l'objecte quan es crea.</label><br>
  <input type="radio" id="q1c" name="question1" value="c">
  <label for="q1c">c) Executar una funció arbitrària abans de cada mètode.</label><br>
  <input type="radio" id="q1d" name="question1" value="d">
  <label for="q1d">d) Crear mètodes màgics automàticament.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer1()">
</form>

<p id="result1"></p>

<script>
function checkAnswer1() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question1');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) Inicialitzar les propietats de l'objecte quan es crea.";
    document.getElementById('result1').innerText = resultText;
}
</script>

<h4 id="exercici-2-herencia-en-php">Exercici 2: Herència en PHP<a class="headerlink" href="#exercici-2-herencia-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_15">Pregunta:<a class="headerlink" href="#pregunta_15" title="Permanent link">&para;</a></h5>
<p>Quina és l'avantatge principal de l'herència en la programació orientada a objectes?</p>
<h5 id="opcions_15">Opcions:<a class="headerlink" href="#opcions_15" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q2a" name="question2" value="a">
  <label for="q2a">a) Permet reutilitzar codi definint classes noves basades en classes existents.</label><br>
  <input type="radio" id="q2b" name="question2" value="b">
  <label for="q2b">b) Permet ocultar totes les propietats i mètodes de la classe.</label><br>
  <input type="radio" id="q2c" name="question2" value="c">
  <label for="q2c">c) Permet definir funcions globals sense necessitat de classes.</label><br>
  <input type="radio" id="q2d" name="question2" value="d">
  <label for="q2d">d) Permet cridar a funcions de JavaScript des de PHP.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer2()">
</form>

<p id="result2"></p>

<script>
function checkAnswer2() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question2');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) Permet reutilitzar codi definint classes noves basades en classes existents.";
    document.getElementById('result2').innerText = resultText;
}
</script>

<h4 id="exercici-3-polimorfisme">Exercici 3: Polimorfisme<a class="headerlink" href="#exercici-3-polimorfisme" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_16">Pregunta:<a class="headerlink" href="#pregunta_16" title="Permanent link">&para;</a></h5>
<p>Què permet el polimorfisme en el context de la POO?</p>
<h5 id="opcions_16">Opcions:<a class="headerlink" href="#opcions_16" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q3a" name="question3" value="a">
  <label for="q3a">a) Permet que una funció tinga múltiples implementacions depenent de l'objecte que la cride.</label><br>
  <input type="radio" id="q3b" name="question3" value="b">
  <label for="q3b">b) Permet la creació d'objectes a partir de funcions anònimes.</label><br>
  <input type="radio" id="q3c" name="question3" value="c">
  <label for="q3c">c) Permet la connexió entre PHP i bases de dades relacionals.</label><br>
  <input type="radio" id="q3d" name="question3" value="d">
  <label for="q3d">d) Permet executar múltiples scripts PHP alhora.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer3()">
</form>

<p id="result3"></p>

<script>
function checkAnswer3() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question3');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) Permet que una funció tinga múltiples implementacions depenent de l'objecte que la cride.";
    document.getElementById('result3').innerText = resultText;
}
</script>

<h4 id="exercici-4-espais-de-noms">Exercici 4: Espais de Noms<a class="headerlink" href="#exercici-4-espais-de-noms" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_17">Pregunta:<a class="headerlink" href="#pregunta_17" title="Permanent link">&para;</a></h5>
<p>Per a què s'utilitzen els espais de noms (namespaces) en PHP?</p>
<h5 id="opcions_17">Opcions:<a class="headerlink" href="#opcions_17" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q4a" name="question4" value="a">
  <label for="q4a">a) Per executar codi PHP de forma asincrònica.</label><br>
  <input type="radio" id="q4b" name="question4" value="b">
  <label for="q4b">b) Per evitar conflictes entre noms de classes, funcions o constants en diferents parts del codi.</label><br>
  <input type="radio" id="q4c" name="question4" value="c">
  <label for="q4c">c) Per definir variables globals accessibles des de qualsevol punt del codi.</label><br>
  <input type="radio" id="q4d" name="question4" value="d">
  <label for="q4d">d) Per importar codi d'altres llenguatges de programació com JavaScript.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer4()">
</form>

<p id="result4"></p>

<script>
function checkAnswer4() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question4');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) Per evitar conflictes entre noms de classes, funcions o constants en diferents parts del codi.";
    document.getElementById('result4').innerText = resultText;
}
</script>

<h4 id="exercici-5-traits-en-php">Exercici 5: Traits en PHP<a class="headerlink" href="#exercici-5-traits-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_18">Pregunta:<a class="headerlink" href="#pregunta_18" title="Permanent link">&para;</a></h5>
<p>Quin avantatge ofereixen els traits en PHP?</p>
<h5 id="opcions_18">Opcions:<a class="headerlink" href="#opcions_18" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q5a" name="question5" value="a">
  <label for="q5a">a) Permet escriure codi reutilitzable que es pot incloure en múltiples classes, independentment de la jerarquia d'herència.</label><br>
  <input type="radio" id="q5b" name="question5" value="b">
  <label for="q5b">b) Permet la creació de funcions globals en PHP.</label><br>
  <input type="radio" id="q5c" name="question5" value="c">
  <label for="q5c">c) Permet la comunicació entre diferents servidors web.</label><br>
  <input type="radio" id="q5d" name="question5" value="d">
  <label for="q5d">d) Permet executar codi PHP dins de plantilles HTML.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer5()">
</form>

<p id="result5"></p>

<script>
function checkAnswer5() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question5');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) Permet escriure codi reutilitzable que es pot incloure en múltiples classes, independentment de la jerarquia d'herència.";
    document.getElementById('result5').innerText = resultText;
}
</script>

<h4 id="exercici-6-excepcions-en-php">Exercici 6: Excepcions en PHP<a class="headerlink" href="#exercici-6-excepcions-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_19">Pregunta:<a class="headerlink" href="#pregunta_19" title="Permanent link">&para;</a></h5>
<p>Quina és la finalitat d'utilitzar excepcions en PHP?</p>
<h5 id="opcions_19">Opcions:<a class="headerlink" href="#opcions_19" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q6a" name="question6" value="a">
  <label for="q6a">a) Evitar l'execució de codi mal format.</label><br>
  <input type="radio" id="q6b" name="question6" value="b">
  <label for="q6b">b) Gestionar errors i condicions excepcionals de manera controlada dins d'una aplicació.</label><br>
  <input type="radio" id="q6c" name="question6" value="c">
  <label for="q6c">c) Declarar funcions dins d'una classe.</label><br>
  <input type="radio" id="q6d" name="question6" value="d">
  <label for="q6d">d) Garantir que totes les variables estiguen inicialitzades abans del seu ús.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer6()">
</form>

<p id="result6"></p>

<script>
function checkAnswer6() {
    var correctAnswer = "b";
    var radios = document.getElementsByName('question6');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és b) Gestionar errors i condicions excepcionals de manera controlada dins d'una aplicació.";
    document.getElementById('result6').innerText = resultText;
}
</script>

<h4 id="exercici-7-autoloading-en-php">Exercici 7: Autoloading en PHP<a class="headerlink" href="#exercici-7-autoloading-en-php" title="Permanent link">&para;</a></h4>
<h5 id="pregunta_20">Pregunta:<a class="headerlink" href="#pregunta_20" title="Permanent link">&para;</a></h5>
<p>Quin avantatge ofereix l'autoloading en PHP?</p>
<h5 id="opcions_20">Opcions:<a class="headerlink" href="#opcions_20" title="Permanent link">&para;</a></h5>
<form>
  <input type="radio" id="q7a" name="question7" value="a">
  <label for="q7a">a) Permet que les classes es carreguen automàticament quan s'utilitzen, sense necessitat de fer incloure manualment cada fitxer.</label><br>
  <input type="radio" id="q7b" name="question7" value="b">
  <label for="q7b">b) Permet l'execució de múltiples scripts alhora.</label><br>
  <input type="radio" id="q7c" name="question7" value="c">
  <label for="q7c">c) Permet la manipulació de fitxers en el servidor.</label><br>
  <input type="radio" id="q7d" name="question7" value="d">
  <label for="q7d">d) Permet la connexió amb bases de dades.</label><br><br>
  <input type="button" value="Comprovar" onclick="checkAnswer7()">
</form>

<p id="result7"></p>

<script>
function checkAnswer7() {
    var correctAnswer = "a";
    var radios = document.getElementsByName('question7');
    var userAnswer;
    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            userAnswer = radios[i].value;
            break;
        }
    }
    var resultText = userAnswer === correctAnswer ? "Correcte!" : "Incorrecte. La resposta correcta és a) Permet que les classes es carreguen automàticament quan s'utilitzen, sense necessitat de fer incloure manualment cada fitxer.";
    document.getElementById('result7').innerText = resultText;
}
</script>
<h1 id="desenvolupament-daplicacions-web-acces-a-dades">Desenvolupament d'aplicacions web: Accés a Dades.<a class="headerlink" href="#desenvolupament-daplicacions-web-acces-a-dades" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duració i criteris d'avaluació</summary>
<p>Duració estimada: 10 hores</p>
<hr />
<table>
<thead>
<tr>
<th>Resultat d'aprenentatge</th>
<th>Criteris d'avaluació</th>
</tr>
</thead>
<tbody>
<tr>
<td>6. Desenvolupa aplicacions web d'accés a magatzems de dades, aplicant mesures per a mantindre la seguretat i la integritat de la informació.</td>
<td>a) S'han analitzat les tecnologies que permeten l'accés mitjançant programació a la informació disponible en magatzems de dades. <br/> b) S'han creat aplicacions que establisquen connexions amb bases de dades. <br/> c) S'ha recuperat informació emmagatzemada en bases de dades. <br/> d) S'ha publicat en aplicacions web la informació recuperada. <br/> e) S'han utilitzat conjunts de dades per a emmagatzemar la informació. <br/> f) S'han creat aplicacions web que permeten l'actualització i l'eliminació  d'informació disponible en una base de dades.<br/> g) S'han provat i documentat les aplicacions web.</td>
</tr>
</tbody>
</table>
</details>
<p>En aquesta unitat aprendrem a accedir a dades que es troben en un servidor; recuperant, editant i creant aquestes dades a través d'una base de dades.</p>
<p>A través de les diferents capes o nivells, de les quals 2 d'elles ja coneixem (<em>Nginx</em>, <em>PHP</em>) i <em>MySQL</em> la que estudiarem en aquest tema.</p>
<div class="center img-large">
    <img src="imagenes/06/06-bbdd-arquitectura-3-niveles.png">
</div>

<h2 id="1-introduccio-a-les-tecnologies-per-accedir-a-dades">1. Introducció a les tecnologies per accedir a dades<a class="headerlink" href="#1-introduccio-a-les-tecnologies-per-accedir-a-dades" title="Permanent link">&para;</a></h2>
<h3 id="bases-de-dades-relacionals-sql">Bases de dades relacionals (SQL)<a class="headerlink" href="#bases-de-dades-relacionals-sql" title="Permanent link">&para;</a></h3>
<p>Les bases de dades relacionals utilitzen llenguatge SQL per emmagatzemar i recuperar dades de taules relacionades. En PHP, les tecnologies més utilitzades per accedir-hi són <strong>PDO</strong> i <strong>MySQLi</strong>. <strong>PDO</strong> suporta múltiples sistemes de bases de dades (MySQL, PostgreSQL, etc.), mentre que <strong>MySQLi</strong> està dissenyat específicament per a MySQL.</p>
<h3 id="bases-de-dades-nosql">Bases de dades NoSQL<a class="headerlink" href="#bases-de-dades-nosql" title="Permanent link">&para;</a></h3>
<p>Les bases de dades NoSQL, com <strong>MongoDB</strong> o <strong>Firebase</strong>, emmagatzemen dades en formats no estructurats, com JSON. Aquestes són ideals per a aplicacions que gestionen grans volums de dades o dades no estructurades. <strong>MongoDB</strong> és un sistema orientat a documents, mentre que <strong>Firebase</strong> és conegut per les seves capacitats en temps real.</p>
<h3 id="acces-a-apis">Accés a APIs<a class="headerlink" href="#acces-a-apis" title="Permanent link">&para;</a></h3>
<p>Les <strong>APIs REST</strong> permeten accedir a dades de serveis web externs utilitzant sol·licituds HTTP i respostes en formats com JSON o XML. <strong>GraphQL</strong> és una alternativa moderna que permet sol·licituds més específiques, només retornant les dades necessàries, en contrast amb les sol·licituds REST, que poden ser més generals.</p>
<h3 id="web-scraping">Web Scraping<a class="headerlink" href="#web-scraping" title="Permanent link">&para;</a></h3>
<p>El <strong>web scraping</strong> és el procés d'extracció automàtica de dades de pàgines web. Aquesta tècnica es pot utilitzar per recuperar informació d'una pàgina web quan no hi ha una API disponible. En PHP, es poden utilitzar diverses biblioteques per descarregar i analitzar contingut HTML, com ara <strong>cURL</strong> i <strong>DOMDocument</strong>.</p>
<h3 id="consideracions-de-seguretat_1">Consideracions de seguretat<a class="headerlink" href="#consideracions-de-seguretat_1" title="Permanent link">&para;</a></h3>
<p>És fonamental garantir la seguretat quan es treballa amb l'accés a dades. Això inclou protegir les aplicacions contra vulnerabilitats comunes, com les <strong>injeccions SQL</strong>, i assegurar les connexions utilitzant <strong>SSL/TLS</strong> quan es comuniqui amb bases de dades remotes o APIs externes.</p>
<h2 id="2-bases-de-dades-relacionals-sql">2. Bases de dades relacionals (SQL)<a class="headerlink" href="#2-bases-de-dades-relacionals-sql" title="Permanent link">&para;</a></h2>
<h3 id="installacio_3">Instal·lació<a class="headerlink" href="#installacio_3" title="Permanent link">&para;</a></h3>
<p>A través de <strong>XAMPP</strong> és molt senzill, simplement ens descarregaríem el programa i l'activaríem. Per a descarregar XAMPP <a href="https://www.apachefriends.org/es/download.html">prem ací</a>.</p>
<p>Amb <strong><em>Docker</em></strong> utilitzarem un altre  repositori que inclou el mysql i el phpMyAdmin i llancem
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div></p>
<p>Si tot ha eixit bé i el contenidor està en marxa, podrem visitar la pàgina de phpMyAdmin de la següent manera
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>http://localhost:8000
</code></pre></div></p>
<div class="center img-medium">
    <img src="imagenes/06/06-bbdd-phpMyAdmin-login.png">
</div>

<p>Per a accedir hem d'utilitzar les següents credencials que venen configurades en el arxiu <code>docker-compose.yml</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>usuario: root
<span class="linenos" data-linenos="2 "></span>contraseña: 1234
</code></pre></div>
<h3 id="estructura-duna-base-de-dades">Estructura d'una base de dades<a class="headerlink" href="#estructura-duna-base-de-dades" title="Permanent link">&para;</a></h3>
<p>Sabem que una base de dades té molts camps amb els seus noms i valors, però a més sabem que la base de dades ha de tindre un nom. per tant tindríem la següent estructura per a una base de dades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>NombreBaseDeDatos
<span class="linenos" data-linenos=" 2 "></span>    |__Tabla-#1
<span class="linenos" data-linenos=" 3 "></span>    |       |__DatosTabla-#1
<span class="linenos" data-linenos=" 4 "></span>    |
<span class="linenos" data-linenos=" 5 "></span>    |__Tabla-#2
<span class="linenos" data-linenos=" 6 "></span>    |       |__DatosTabla-#2
<span class="linenos" data-linenos=" 7 "></span>    |
<span class="linenos" data-linenos=" 8 "></span>    |__Tabla-#3
<span class="linenos" data-linenos=" 9 "></span>    |       |__DatosTabla-#3
<span class="linenos" data-linenos="10 "></span>    [...]
</code></pre></div>
<p>Vegem-ho en un exemple real</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>Ryanair
<span class="linenos" data-linenos=" 2 "></span>    |__pasajero
<span class="linenos" data-linenos=" 3 "></span>    |    |__id[*]
<span class="linenos" data-linenos=" 4 "></span>    |    |__nombre
<span class="linenos" data-linenos=" 5 "></span>    |    |__apellidos
<span class="linenos" data-linenos=" 6 "></span>    |    |__edad
<span class="linenos" data-linenos=" 7 "></span>    |    |__id_vuelo[^]
<span class="linenos" data-linenos=" 8 "></span>    |
<span class="linenos" data-linenos=" 9 "></span>    |__vuelo
<span class="linenos" data-linenos="10 "></span>    |    |__id[*]
<span class="linenos" data-linenos="11 "></span>    |    |__n_plazas
<span class="linenos" data-linenos="12 "></span>    |    |__disponible
<span class="linenos" data-linenos="13 "></span>    |    |__id_pais[^]
<span class="linenos" data-linenos="14 "></span>    |
<span class="linenos" data-linenos="15 "></span>    |__pais
<span class="linenos" data-linenos="16 "></span>         |__id[*]
<span class="linenos" data-linenos="17 "></span>         |__nombre
</code></pre></div>
<div class="leyenda">
    [*] Clau primària [^] Clave Forània
</div>

<div class="center img-large">
    <img src="imagenes/06/06-bbdd-estructura.png">
</div>

<h3 id="sql">SQL<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h3>
<p>Aquest llenguatge de consulta estructurada (<em>Structured Query Language</em>) és el que utilitzarem per a realitzar les consultes a les nostres bases de dades per a mostrar el contingut en les diferents interfícies web que creem al llarg de la unitat. Si vols saber més detalls visita <a href="https://es.wikipedia.org/wiki/sql">Wiki SQL</a></p>
<p>Exemple d'una sentència SQL on seleccionem totes les files i columnes de la nostra taula anomenada <strong>'pais'</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pais</span>
</code></pre></div>
<p>Estas sentencias pueden invocarse desde la consola de comandos mediante el intérprete <em>mysql</em> (previamente instalado en el sistema) o a través de la herramienta phpMyAdmin.</p>
<p>Las sentencias SQL también las podemos usar dentro de nuestro código php, de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="c1">// Llistat de clients, adreçats per DNI de manera ASCendent</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$clientesOrdenadosPorDNI</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM `pasajero` ORDER BY `dni`&quot;</span> <span class="nx">ASC</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<h3 id="phpmyadmin">phpMyAdmin<a class="headerlink" href="#phpmyadmin" title="Permanent link">&para;</a></h3>
<div class="center img-medium">
    <img src="imagenes/06/06-bbdd-phpMyAdmin-logo.png">
</div>

<p>Aquest programari funciona sota Ngingx i PHP i és més que res una interfície web per a gestionar les bases de dades que tinguem disponibles en el nostre servidor local. Molts *<em>hostings</em> ofereixen aquesta eina per defecte per a poder gestionar les BBDD que tinguem configurades sota el nostre compte.</p>
<h4 id="creant-una-base-de-dades-dins-de-phpmyadmin">Creant una base de dades dins de phpMyAdmin<a class="headerlink" href="#creant-una-base-de-dades-dins-de-phpmyadmin" title="Permanent link">&para;</a></h4>
<div class="center img-large">
    <img src="imagenes/06/06-bbdd-phpMyAdmin.gif">
</div>

<ol>
<li>
<p>Per a crear una nova base de dades hem d'entrar en <em>phpMyAdmin</em> com a <em>usuari root</em> i punxar en l'opció <span class="warning"><em>Nova</em></span> del menú de l'esquerra.</p>
</li>
<li>
<p>En la nova finestra de creació posarem un <strong>nom</strong> a nostra <em>bbdd</em>.</p>
</li>
<li>
<p>També establirem el <strong>cotejamiento</strong> <span class="warning"><em>utf8m4_unicode_ci</em></span> perquè nostra <em>bbdd</em> suporte tot tipus de caràcters (com els asiàtics) i fins i tot <em>emojis</em> ;)</p>
</li>
<li>
<p>Li donem al botó de <strong>Crear</strong> per a crear la <em>bbdd</em> i començar a escriure les diferents taules que anem a introduir en ella.</p>
</li>
</ol>
<p>El sistema generarà el codi SQL per a crear tot el que li hem posat i crearà la base de dades amb les taules que li hàgem ficat.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">persona</span><span class="o">`</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">nombre</span><span class="o">`</span><span class="w"> </span><span class="n">TINYTEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">apellidos</span><span class="o">`</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">telefono</span><span class="o">`</span><span class="w"> </span><span class="n">TINYTEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="opcions-en-phpmyadmin">Opcions en phpMyAdmin<a class="headerlink" href="#opcions-en-phpmyadmin" title="Permanent link">&para;</a></h4>
<p>Quan seleccionem una base de dades de la llista, el sistema ens mostra diverses pestanyes amb les quals interactuar amb la base de dades en qüestió:</p>
<ul>
<li>
<p><code>Estructura</code>: Podem veure les diferents taules que consoliden la nostra base de dades</p>
</li>
<li>
<p><code>SQL</code>: Per si volem injectar codi SQL perquè el sistema l'interprete</p>
</li>
<li>
<p><code>Buscar</code>: Serveix per a buscar per termes, en la nostra base de dades, aplicant diferents filtres de cerca</p>
</li>
<li>
<p><code>Generar consulta</code>: semblança a SQL però d'una manera més gràfica, sense haver de saber res del llenguatge</p>
</li>
<li>
<p><code>Exportar i importar</code>: Com el seu nom indica, per a fer qualsevol de les 2 operacions sobre la base de dades</p>
</li>
<li>
<p><code>Operacions</code>: Diferents opcions avançades per a realitzar en la nostra base de dades, de la qual destacarem l'opció <em>Cotejamiento</em> on podrem canviar el <em>cotejamiento</em> de la nostra taula però <span class="alert"><em>ULL AMB ACÔ</em> perquè podem eliminar dades sense voler, ja que en canviar el <em>cotejamiento</em> podem suprimir caràcters no suportats pel nou <em>cotejamiento</em></span></p>
</li>
</ul>
<p>No aprofundirem en la resta d'opcions però, en la pestanya <strong>Més</strong> existeix l'opció <strong>Dissenyador</strong> per a poder editar les relacions entre taules d'una manera gràfica (punxant i arrossegant) que veurem més endavant.</p>
<h2 id="3-php-data-objects-pdo">3. PHP Data Objects :: PDO<a class="headerlink" href="#3-php-data-objects-pdo" title="Permanent link">&para;</a></h2>
<p>La classe PDO de PHP s'utilitza per connectar-se a una base de dades i executar consultes SQL de manera segura. Quan construeixes una instància de PDO, pots passar-li diferents atributs en el constructor i opcions per configurar el comportament de la connexió. Aquí tens els atributs principals i el seu propòsit:</p>
<h3 id="constructor-de-la-classe-pdo">Constructor de la classe PDO<a class="headerlink" href="#constructor-de-la-classe-pdo" title="Permanent link">&para;</a></h3>
<p>El constructor de la classe PDO accepta tres paràmetres obligatoris i un opcional:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$dsn</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$username</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$password</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>$dsn (Data Source Name): És una cadena que especifica el tipus de base de dades i la informació necessària per connectar-s'hi.</li>
<li>Format per tipus de base de dades i configuració, per exemple:<ul>
<li>Mysql:host=localhost;dbname=testdb (per a MySQL).</li>
<li>pgsql:host=localhost;port=5432;dbname=testdb (per a PostgreSQL).</li>
<li>sqlite:/path/to/database.db (per a SQLite).</li>
</ul>
</li>
<li>$username: El nom d'usuari per a la connexió a la base de dades.</li>
<li>$password: La contrasenya associada al nom d'usuari.</li>
<li>$options (Opcional): Un array d'opcions per definir el comportament de la connexió. Aquests són alguns dels valors més comuns que es poden definir en aquest array:<ul>
<li>PDO::ATTR_ERRMODE: Controla com es gestionen els errors. Alguns valors comuns són:</li>
<li>PDO::ERRMODE_SILENT: Els errors no generen cap missatge.</li>
<li>PDO::ERRMODE_WARNING: Els errors generen un avís.</li>
<li>PDO::ERRMODE_EXCEPTION: Els errors generen una excepció, que és el més recomanable per controlar errors.</li>
<li>PDO::ATTR_DEFAULT_FETCH_MODE: Defineix el mode de recuperació de dades per defecte, com ara:</li>
<li>PDO::FETCH_ASSOC: Retorna les dades com un array associatiu.</li>
<li>PDO::FETCH_OBJ: Retorna les dades com un objecte.</li>
<li>PDO::FETCH_BOTH: Retorna les dades com un array associatiu i numèric.</li>
<li>PDO::ATTR_PERSISTENT: Habilita connexions persistents. Una connexió persistent pot millorar el rendiment mantenint la connexió activa per múltiples peticions en lloc de crear-ne una nova cada vegada.</li>
<li>PDO::ATTR_TIMEOUT: Defineix un temps límit per a la connexió en segons.</li>
</ul>
</li>
</ul>
<h5 id="exemple-de-connexio-amb-pdo">Exemple de connexió amb PDO<a class="headerlink" href="#exemple-de-connexio-amb-pdo" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$dsn = &quot;mysql:host=localhost;dbname=testdb&quot;;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">$username = &quot;usuari&quot;;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$password = &quot;contrasenya&quot;;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">$options = [</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    PDO::ATTR_PERSISTENT =&gt; true,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    PDO::MYSQL_ATTR_INIT_COMMAND =&gt; &quot;SET NAMES utf8&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">];</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">try {</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    $pdo = new PDO($dsn, $username, $password, $options);</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    echo &quot;Connexió establerta amb èxit!&quot;;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">} catch (PDOException $e) {</span>
<span class="linenos" data-linenos="15 "></span><span class="x">    echo &quot;Error de connexió: &quot; . $e-&gt;getMessage();</span>
<span class="linenos" data-linenos="16 "></span><span class="x">}</span>
</code></pre></div>
<p>Aquest codi estableix una connexió a una base de dades MySQL amb un joc de caràcters utf8, una connexió persistent, i llança excepcions en cas d'errors.</p>
<p>Qualsevol error que es llance a través de <strong>PDO</strong>, el sistema llançarà una  <strong>PDOException</strong> .</p>
<h3 id="fitxer-de-configuracio-de-la-bd">Fitxer de configuració de la BD<a class="headerlink" href="#fitxer-de-configuracio-de-la-bd" title="Permanent link">&para;</a></h3>
<p>De la mateixa manera que podem tenir el nostre arxiu de funcions <code>funciones.php</code> i alberguem totes les funcions que s'usen de manera global en l'aplicació, podem establir un arxiu de constants on definim els paràmetres de connexió amb la base de dades.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ conexion.php ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nx">constDSN</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=localhost;dbname=dwes&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nx">constUSUARIO</span> <span class="o">=</span> <span class="s2">&quot;dwes&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nx">constPASSWORD</span> <span class="o">=</span> <span class="s2">&quot;abc123&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="cm">/*  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="cm">        ▒▒▒▒▒▒▒▒ NO SUBAS ESTE ARCHIVO A git ▒▒▒▒▒</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="cm">        ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ */</span>
</code></pre></div></p>
<p>Aquest arxiu conté informació <span class="alert"><strong>molt sensible</strong></span> així que no és recomanable que puges aquest arxiu a <strong>git</strong>.</p>
<h3 id="sentencies-preparades">Sentències preparades<a class="headerlink" href="#sentencies-preparades" title="Permanent link">&para;</a></h3>
<p>Es tracta de sentències que s'estableixen com si foren plantilles de la SQL que llançarem, acceptant paràmetres que són establits a posteriori de la declaració de la sentència preparada.</p>
<p>Les sentències preparades eviten la <strong>injecció</strong> de SQL (SQL Injection) i milloren el rendiment de nostres <em>aplicacions</em> o pàgines web.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO Clientes VALUES (?, ?, ?, ?)&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Cada interrogant és un paràmetre que establirem després, unes quantes línies més a baix.</p>
<p>Una vegada tenim la plantilla de la nostra consulta, hem de seguir amb la preparació juntament amb 3 mètodes més de <strong>PHP</strong> per a la seua completa execució:</p>
<ul>
<li><code>prepare:</code> prepara la <strong>sentencia</strong> abans de ser executada.</li>
<li><code>bind</code>: el tipus d'unió (*<em>bind</em>^) de dada que pot ser mitjançant ' ? ' o ' :parametre '</li>
<li><code>execute</code> s'executa la consulta unint la plantilla amb les <em>variables</em> o paràmetres que hem establit.</li>
</ul>
<h3 id="exemple-parametros">Exemple paràmetros<a class="headerlink" href="#exemple-parametros" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">try</span> <span class="p">{</span> 
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cantidad&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM stock WHERE unidades = ?&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="nv">$cantidad</span><span class="p">]);</span>
<span class="linenos" data-linenos="18 "></span>        <span class="nv">$cantidadAfectada</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">rowCount</span><span class="p">();</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>        <span class="k">echo</span> <span class="nv">$cantidadAfectada</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span>
</code></pre></div>
<h3 id="exemple-bindparam">Exemple bindParam<a class="headerlink" href="#exemple-bindparam" title="Permanent link">&para;</a></h3>
<p>Molt semblant a utilitzar paràmetres però aquesta vegada la variable està dins de la sentència SQL, en aquest cas l'hem anomenada <code>:cant</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$conexion</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cantidad&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM stock WHERE unidades = :cant&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>        <span class="nv">$cantidadAfectada</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">rowCount</span><span class="p">();</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>        <span class="k">echo</span> <span class="nv">$cantidadAfectada</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div>
<h3 id="bindparam-vs-bindvalue">bindParam VS bindValue<a class="headerlink" href="#bindparam-vs-bindvalue" title="Permanent link">&para;</a></h3>
<p>Utilitzarem <code>bindValue()</code> quan hàgem d'inserir dades només una vegada, en canvi, haurem d'usar <code>bindParam()</code> quan hàgem de passar dades múltiples, com per exemple, un <em>array</em>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">// se asignan nombre a los parámetros</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM stock WHERE unidades = :cant&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="c1">// bindParam enlaza por referencia</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="c1">// se eliminan con cant = 1</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="c1">// bindValue enlaza por valor</span>
<span class="linenos" data-linenos="16 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>    <span class="c1">// se eliminan con cant = 0</span>
<span class="linenos" data-linenos="22 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</code></pre></div>
<p>Per a més informació i ús de les variables <em>PDO</em> <a href="https://www.php.net/manual/es/pdo.constants.php">consulta el manual de PHP</a>.</p>
<h3 id="inserint-registres">Inserint registres<a class="headerlink" href="#inserint-registres" title="Permanent link">&para;</a></h3>
<p>A l'hora d'inserir registres en una base de dades, hem de tindre en compte que en la taula pot haver-hi valors autoincrementats. Per a salvaguardar açò, el que hem de fer és deixar aqueix camp autoincrementat buit, però a l'hora de fer la connexió, hem de recuperar-ho amb el mètode <code>lastInsertId()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="nv">$nombre</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;nombre&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;SUCURSAL X&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$telefono</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;telefono&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;636123456&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;INSERT INTO tienda(nombre, tlf) VALUES (:nombre, :telefono)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:nombre&quot;</span><span class="p">,</span> <span class="nv">$nombre</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:telefono&quot;</span><span class="p">,</span> <span class="nv">$telefono</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>    <span class="nv">$idGenerado</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">lastInsertId</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">echo</span> <span class="nv">$idGenerado</span><span class="p">;</span>
</code></pre></div>
<h3 id="consultant-registres">Consultant registres<a class="headerlink" href="#consultant-registres" title="Permanent link">&para;</a></h3>
<p>A l'hora de recuperar els resultats d'una consulta, bastarà amb invocar al mètode <code>PDOStatement::fetch</code> per a llistar les files generades per la consulta.</p>
<p>Però hem de triar el tipus de dada que volem rebre entre els 3 que hi ha disponibles:</p>
<ul>
<li><code>PDO::FETCH_ASSOC:</code> array indexat que els seus keys són el nom de les columnes.</li>
<li><code>PDO::FETCH_NUM:</code> array indexat que els seus keys són números.</li>
<li><code>PDO::FETCH_BOTH:</code> valor per defecte. Retorna un array indexat que els seus keys són tant el nom de les columnes com números.</li>
</ul>
<div class="center img-large">
    <img src="imagenes/06/06-pdo-listado-fetch.png">
</div>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ consulta con array asociativo.php ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">try</span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;select * from tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>        <span class="k">while</span><span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">()){</span>
<span class="linenos" data-linenos="19 "></span>            <span class="k">echo</span> <span class="s2">&quot;Codigo:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;cod&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>            <span class="k">echo</span> <span class="s2">&quot;Nombre:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;nombre&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>            <span class="k">echo</span> <span class="s2">&quot;Teléfono:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;tlf&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div>
<p>Recuperant dades amb una matriu com a resultat de la nostra consulta</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ consulta con array asociativo ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$tiendas</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">foreach</span><span class="p">(</span><span class="nv">$tiendasas$tienda</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span><span class="s2">&quot;Codigo:&quot;</span> <span class="o">.</span> <span class="nv">$tienda</span><span class="p">[</span><span class="s2">&quot;cod&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span><span class="s2">&quot;Nombre:&quot;</span> <span class="o">.</span> <span class="nv">$tienda</span><span class="p">[</span><span class="s2">&quot;nombre&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
</code></pre></div>
Però si el que volem és llegir dades amb forma d'objecte utilitzant <code>PDO::FETCH_OBJ</code>, hem de crear un objecte amb propietats públiques amb el mateix nom que les columnes de la taula que anem a consultar.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ consulta con formato de objeto ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_OBJ</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">while</span><span class="p">(</span><span class="nv">$t</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span><span class="s2">&quot;Codigo:&quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">cod</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">echo</span><span class="s2">&quot;Nombre:&quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">nombre</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span><span class="s2">&quot;Teléfono:&quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">tlf</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
</code></pre></div>
<h3 id="consultes-amb-models">Consultes amb models<a class="headerlink" href="#consultes-amb-models" title="Permanent link">&para;</a></h3>
<p>Portem temps creant classes en PHP i les consultes també admeten aquest tipus de dades mitjançant l'ús de <code>PDO::FETCH_CLASS</code></p>
<p>Si usem aquest mètode, hem de tindre en compte que els noms dels atributs privats han de coincidir amb els noms de les columnes de la taula que anem a manejar.</p>
<p>Així doncs, si pel que siga canviem l'estructura de la taula <span class="alert"><strong>HEM DE CANVIAR</strong></span> la nostra classe perquè tot continue funcionant.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ clase Tienda ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nx">classTienda</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">private</span> <span class="nx">int</span> <span class="nv">$cod</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">private</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">private</span> <span class="o">?</span> <span class="nx">string</span> <span class="nv">$tlf</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getCodigo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>            <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">cod</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getNombre</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>            <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">nombre</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getTelefono</span><span class="p">()</span> <span class="o">:</span> <span class="o">?</span><span class="nx">string</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>            <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">tlf</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Consultando a través de la clase Tienda ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// Aquí &#39;Tienda&#39; es el nombre de nuestra clase</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span><span class="p">,</span> <span class="nx">Tienda</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">while</span><span class="p">(</span><span class="nv">$t</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">echo</span> <span class="s2">&quot;Codigo: &quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">getCodigo</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span> <span class="s2">&quot;Nombre: &quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">getNombre</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span> <span class="s2">&quot;Teléfono: &quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">getTelefono</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
</code></pre></div>
<p>Però què passa si les nostres classes tenen constructor? doncs que hem d'indicar-li, al mètode FECTH, que emplene les propietats després de cridar al constructor i per a això fem ús de <code>PDO::FETCH_PROPS_LATE</code>.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Consulta para una clase con constructor ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span> <span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="nx">Tienda</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$tiendas</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
</code></pre></div></p>
<h3 id="consultes-amb-like">Consultes amb LIKE<a class="headerlink" href="#consultes-amb-like" title="Permanent link">&para;</a></h3>
<p>Per a utilitzar el comodí <em>LIKE</em> o altres comodins, hem d'associar-lo a la dada i MAI en la pròpia consulta.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Utilizando comodines :: LIKE ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tienda where nombre like :nombre or tlf like :tlf&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span> <span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="nx">Tienda</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$cadBuscar</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">.</span> <span class="nv">$busqueda</span> <span class="o">.</span> <span class="s2">&quot;%&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="s2">&quot;nombre&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cadBuscar</span><span class="p">,</span><span class="s2">&quot;tlf&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cadBuscar</span><span class="p">]);</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
</code></pre></div>
<p>Teniu una llista d'exemples molt completa en la <a href="https://phpdelusions.net/pdo/objects">documentació oficial</a>.</p>
<h2 id="4-login-password">4. Login &amp; Password<a class="headerlink" href="#4-login-password" title="Permanent link">&para;</a></h2>
<div class="center img-medium">
    <img src="imagenes/06/06-login-password.gif">
</div>

<p>Per a manejar un sistema complet de login i password amb contrasenyes xifrades, necessitem un mètode que xifre aqueixos <em>strings</em> que l'usuari introdueix com a contrasenya; tant en el formulari de registre com en el del <em>login</em>, ja que en codificar una contrasenya, després hem de descodificar-la per a comprovar que totes dues *contrasenyes (la que introdueix l'usuari en el login i la que tenim en la base de dades) coincidisquen.</p>
<p>Necessitem doncs:</p>
<ul>
<li><code>password_hash()</code> per a emmagatzemar la contrasenya en la base de dades a l'hora de fer el <em>INSERT</em></li>
<li>
<p><code>PASSWORD_DEFAULT</code> emmagatzemem la contrasenya usant el mètode d'encriptació bcrypt</p>
</li>
<li>
<p><code>PASSWORD_BCRYPT</code> emmagatzemem la contrasenya usant l'algorisme CRYPT_BLOWFISH compatible amb crypt()</p>
</li>
<li>
<p><code>password_verify()</code> per a verificar l'usuari i la contrasenya</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Almacenando usuario y password en BD ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$usu</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;usuario&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$pas</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO usuarios(usuario, password) VALUES (:usuario, :password)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span>
<span class="linenos" data-linenos="12 "></span>        <span class="s2">&quot;usuario&quot;</span> <span class="o">=&gt;</span> <span class="nv">$usu</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span>        <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$pas</span><span class="p">,</span><span class="nx">PASSWORD_DEFAULT</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">]);</span>
</code></pre></div>
<p>Ara que tenim l'usuari codificat i guardat en la base de dades, el recuperarem per a poder loguejar-lo correctament.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Recuperando usuario y password en BD ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$usu</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;select * from usuarios where usuario = ?&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="nv">$usu</span><span class="p">]);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$usuario</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">if</span><span class="p">(</span><span class="nv">$usuario</span> <span class="o">&amp;&amp;</span> <span class="nb">password_verify</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">],</span> <span class="nv">$usuario</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span><span class="s2">&quot;OK!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="k">echo</span><span class="s2">&quot;KO&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
</code></pre></div></p>
<h2 id="5-querybuilder">5. QueryBuilder<a class="headerlink" href="#5-querybuilder" title="Permanent link">&para;</a></h2>
<p>Un Query Builder (Constructor de Consultes) és una eina o classe que facilita la creació, execució i manipulació de consultes SQL en un programa. L'objectiu principal és proporcionar una interfície més intuïtiva i segura per interactuar amb bases de dades, sense haver d'escriure consultes SQL en brut.</p>
<p>A continuació, detallo algunes de les principals avantatges i característiques d'un Query Builder com el que has compartit anteriorment:</p>
<ul>
<li>
<ol>
<li>Abstracció de la Base de Dades:</li>
</ol>
</li>
<li>
<p>El Query Builder proporciona una capa d'abstracció que permet interactuar amb diferents tipus de bases de dades (MySQL, PostgreSQL, SQLite, etc.) sense canviar el codi de la teva aplicació. Això facilita la portabilitat i l'escalabilitat del codi.</p>
</li>
<li>
<ol start="2">
<li>Seguretat:</li>
</ol>
</li>
<li>
<p>Prevé injeccions SQL: Gràcies a l'ús de sentències preparades i enllaçament de paràmetres, el Query Builder ajuda a prevenir atacs d'injecció SQL, una de les amenaces més comunes en desenvolupament web.</p>
</li>
<li>
<ol start="3">
<li>Sintaxi Més Neta i Més Fàcil:</li>
</ol>
</li>
<li>
<p>Els Query Builders solen proporcionar una sintaxi més neta i fàcil d'entendre que les cadenes SQL pures. Això fa que el codi sigui més llegible i fàcil de mantenir.</p>
</li>
<li>
<ol start="4">
<li>Reutilització de Codi:</li>
</ol>
</li>
<li>
<p>Les funcions del Query Builder es poden reutilitzar a tot el projecte, reduint la duplicació de codi i facilitant el manteniment.</p>
</li>
<li>
<ol start="5">
<li>Flexibilitat:</li>
</ol>
</li>
<li>
<p>Permet realitzar consultes complexes amb una sintaxi simplificada, facilitant l'adaptació del codi a canvis en els requeriments de l'aplicació.</p>
</li>
<li>
<ol start="6">
<li>Desenvolupament Més Ràpid:</li>
</ol>
</li>
<li>
<p>Ajuda a accelerar el procés de desenvolupament, ja que els desenvolupadors no necessiten recordar la sintaxi SQL exacta per a cada tipus de base de dades.</p>
</li>
<li>
<ol start="7">
<li>Fàcil de Depurar:</li>
</ol>
</li>
<li>
<p>El codi generat pel Query Builder és més fàcil de depurar en comparació amb les llargues cadenes SQL.</p>
</li>
<li>
<ol start="8">
<li>Suport per a Operacions CRUD:</li>
</ol>
</li>
<li>Els Query Builders solen incloure suport integrat per a operacions CRUD (Crear, Llegir, Actualitzar, Esborrar), fent més fàcil la manipulació de dades.</li>
</ul>
<p>En resum, un Query Builder serveix per simplificar la interacció amb bases de dades, proporcionant una interfície més segura, neta i fàcil d'utilitzar que les cadenes SQL pures. Ajuda a accelerar el desenvolupament, facilita el manteniment i millora la seguretat de l'aplicació.
Ací en tenim un exemple de construcció casera:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="  1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="  2 "></span>
<span class="linenos" data-linenos="  3 "></span><span class="k">namespace</span> <span class="nx">BatBook</span><span class="p">;</span>
<span class="linenos" data-linenos="  4 "></span>
<span class="linenos" data-linenos="  5 "></span><span class="k">use</span> <span class="nx">PDO</span><span class="p">;</span>
<span class="linenos" data-linenos="  6 "></span>
<span class="linenos" data-linenos="  7 "></span><span class="k">class</span> <span class="nc">QueryBuilder</span>
<span class="linenos" data-linenos="  8 "></span><span class="p">{</span>
<span class="linenos" data-linenos="  9 "></span>    <span class="c1">// Aquesta funció serveix per a construir i executar consultes SQL de tipus SELECT.</span>
<span class="linenos" data-linenos=" 10 "></span>    <span class="c1">// Es pot filtrar per valors, limitar la quantitat de resultats i establir un offset.</span>
<span class="linenos" data-linenos=" 11 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">sql</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$values</span><span class="o">=</span><span class="k">null</span><span class="p">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$offset</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
<span class="linenos" data-linenos=" 12 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 13 "></span>        <span class="c1">// Obté el nom de la taula a partir de la propietat estàtica $nameTable de la classe passada com argument.</span>
<span class="linenos" data-linenos=" 14 "></span>        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$class</span><span class="o">::</span><span class="nv">$nameTable</span><span class="p">;</span>
<span class="linenos" data-linenos=" 15 "></span>
<span class="linenos" data-linenos=" 16 "></span>        <span class="c1">// Obté una connexió a la base de dades.</span>
<span class="linenos" data-linenos=" 17 "></span>        <span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Connection</span><span class="o">::</span><span class="na">get</span><span class="p">();</span>
<span class="linenos" data-linenos=" 18 "></span>
<span class="linenos" data-linenos=" 19 "></span>        <span class="c1">// Construeix la consulta SQL bàsica.</span>
<span class="linenos" data-linenos=" 20 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM </span><span class="si">$table</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 21 "></span>
<span class="linenos" data-linenos=" 22 "></span>        <span class="c1">// Afegeix condicions WHERE si es proporcionen valors per a filtrar.</span>
<span class="linenos" data-linenos=" 23 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 24 "></span>            <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot; WHERE &quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 25 "></span>            <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 26 "></span>                <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 27 "></span>                    <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot; AND </span><span class="si">$id</span><span class="s2">=:</span><span class="si">$id</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 28 "></span>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 29 "></span>                    <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="si">$id</span><span class="s2">=:</span><span class="si">$id</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 30 "></span>                <span class="p">}</span>
<span class="linenos" data-linenos=" 31 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos=" 32 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 33 "></span>
<span class="linenos" data-linenos=" 34 "></span>        <span class="c1">// Afegeix les clàusules LIMIT i OFFSET si són necessàries.</span>
<span class="linenos" data-linenos=" 35 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$offset</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 36 "></span>            <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot; LIMIT </span><span class="si">$limit</span><span class="s2"> OFFSET </span><span class="si">$offset</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 37 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 38 "></span>
<span class="linenos" data-linenos=" 39 "></span>        <span class="c1">// Prepara la sentència SQL.</span>
<span class="linenos" data-linenos=" 40 "></span>        <span class="nv">$sentence</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 41 "></span>
<span class="linenos" data-linenos=" 42 "></span>        <span class="c1">// Enllaça els valors a la sentència.</span>
<span class="linenos" data-linenos=" 43 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$values</span><span class="o">??</span><span class="p">[]</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 44 "></span>            <span class="nv">$sentence</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:</span><span class="si">$key</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
<span class="linenos" data-linenos=" 45 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 46 "></span>
<span class="linenos" data-linenos=" 47 "></span>        <span class="c1">// Estableix el mode de recuperació a objectes de la classe especificada.</span>
<span class="linenos" data-linenos=" 48 "></span>        <span class="nv">$sentence</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span> <span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span> <span class="p">,</span> <span class="nv">$class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 49 "></span>
<span class="linenos" data-linenos=" 50 "></span>        <span class="c1">// Executa la consulta.</span>
<span class="linenos" data-linenos=" 51 "></span>        <span class="nv">$sentence</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 52 "></span>
<span class="linenos" data-linenos=" 53 "></span>        <span class="c1">// Retorna tots els resultats obtinguts.</span>
<span class="linenos" data-linenos=" 54 "></span>        <span class="k">return</span>  <span class="nv">$sentence</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
<span class="linenos" data-linenos=" 55 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 56 "></span>
<span class="linenos" data-linenos=" 57 "></span>    <span class="c1">// Aquesta funció serveix per a trobar una fila en una taula basant-se en el seu ID.</span>
<span class="linenos" data-linenos=" 58 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
<span class="linenos" data-linenos=" 59 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 60 "></span>        <span class="c1">//TODO</span>
<span class="linenos" data-linenos=" 61 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 62 "></span>
<span class="linenos" data-linenos=" 63 "></span>    <span class="c1">// Aquesta funció serveix per a insertar una fila en una taula.</span>
<span class="linenos" data-linenos=" 64 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">insert</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$values</span><span class="p">)</span>
<span class="linenos" data-linenos=" 65 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 66 "></span>        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$class</span><span class="o">::</span><span class="nv">$nameTable</span><span class="p">;</span>
<span class="linenos" data-linenos=" 67 "></span>        <span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Connection</span><span class="o">::</span><span class="na">get</span><span class="p">();</span>
<span class="linenos" data-linenos=" 68 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO </span><span class="si">$table</span><span class="s2"> (&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 69 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 70 "></span>            <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 71 "></span>                <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">;</span>
<span class="linenos" data-linenos=" 72 "></span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 73 "></span>                <span class="nv">$sql</span> <span class="o">.=</span> <span class="nv">$id</span><span class="p">;</span>
<span class="linenos" data-linenos=" 74 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos=" 75 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 76 "></span>        <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot;) VALUES (&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 77 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 78 "></span>            <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 79 "></span>                <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39;,:&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">;</span>
<span class="linenos" data-linenos=" 80 "></span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 81 "></span>                <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">;</span>
<span class="linenos" data-linenos=" 82 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos=" 83 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 84 "></span>        <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 85 "></span>        <span class="nv">$sentence</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 86 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$values</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 87 "></span>            <span class="nv">$sentence</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:</span><span class="si">$key</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
<span class="linenos" data-linenos=" 88 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 89 "></span>        <span class="nv">$sentence</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 90 "></span>        <span class="k">return</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="linenos" data-linenos=" 91 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 92 "></span>
<span class="linenos" data-linenos=" 93 "></span>    <span class="c1">// Aquesta funció serveix per a actualitzar una fila en una taula.</span>
<span class="linenos" data-linenos=" 94 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$values</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
<span class="linenos" data-linenos=" 95 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 96 "></span>        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$class</span><span class="o">::</span><span class="nv">$nameTable</span><span class="p">;</span>
<span class="linenos" data-linenos=" 97 "></span>        <span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Connection</span><span class="o">::</span><span class="na">get</span><span class="p">();</span>
<span class="linenos" data-linenos=" 98 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">$table</span><span class="s2"> SET &quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 99 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="100 "></span>            <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="101 "></span>                <span class="nv">$sql</span> <span class="o">.=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s1">&#39;=:&#39;</span><span class="o">.</span><span class="nv">$value</span><span class="p">;</span>
<span class="linenos" data-linenos="102 "></span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="103 "></span>                <span class="nv">$sql</span> <span class="o">.=</span> <span class="nv">$value</span><span class="o">.</span><span class="s1">&#39;=:&#39;</span><span class="o">.</span><span class="nv">$value</span><span class="p">;</span>
<span class="linenos" data-linenos="104 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos="105 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="106 "></span>        <span class="nv">$sql</span> <span class="o">.=</span> <span class="s2">&quot; WHERE id=:id&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="107 "></span>        <span class="nv">$sentence</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="108 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$values</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="109 "></span>            <span class="nv">$sentence</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:</span><span class="si">$key</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
<span class="linenos" data-linenos="110 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="111 "></span>        <span class="nv">$sentence</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>  
<span class="linenos" data-linenos="112 "></span>        <span class="nv">$sentence</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="113 "></span>        <span class="k">return</span> <span class="nv">$id</span><span class="p">;</span>
<span class="linenos" data-linenos="114 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="115 "></span>
<span class="linenos" data-linenos="116 "></span>    <span class="c1">// Aquesta funció serveix per a eliminar una fila en una taula basant-se en el seu ID.</span>
<span class="linenos" data-linenos="117 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
<span class="linenos" data-linenos="118 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="119 "></span>        <span class="c1">//TODO</span>
<span class="linenos" data-linenos="120 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="121 "></span><span class="p">}</span>
</code></pre></div>
<p>En resum, aquesta classe proporciona funcions estàtiques per a la construcció i execució de consultes SQL bàsiques com SELECT, INSERT, UPDATE, i DELETE. Utilitza l'extensió PDO per a la connexió a bases de dades i la preparació de sentències SQL, la qual cosa ajuda a prevenir injeccions SQL. També permet la manipulació fàcil de files en bases de dades, tot retornant objectes de la classe especificada.</p>
<h3 id="respotes-derror">Respotes d'error<a class="headerlink" href="#respotes-derror" title="Permanent link">&para;</a></h3>
<p>Quan no trebem un recurs en al nostra web, podem mostrar a l'usuari una pàgina específica d'error utilitzant la funció header. Una típica seria:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!-- not-found.php --&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">&lt;?php</span> <span class="nb">http_response_code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span> <span class="cp">?&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">&lt;head&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    &lt;title&gt;No trobat&lt;/title&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">&lt;/head&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">&lt;body&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    &lt;h1&gt;404 - Pàgina no trobada&lt;/h1&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    &lt;p&gt;Ho sentim, la pàgina que estàs buscant no s&#39;ha pogut trobar.&lt;/p&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    &lt;a href=&quot;index.php&quot;&gt;Torna a l&#39;inici&lt;/a&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">&lt;/body&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
<p>I per a utilitzar-la:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: not-found.php&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="k">exit</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<h2 id="6-acces-a-fitxers">6. Accès a fitxers<a class="headerlink" href="#6-acces-a-fitxers" title="Permanent link">&para;</a></h2>
<p>Gràcies a la funció fopen() des de PHP podem obrir arxius que es troben en els nostres servidor o una URL.</p>
<p>A aquesta funció cal passar-li 2 paràmetres; el nom de l'arxiu que volem obrir i la manera en què s'obrirà</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$fp = fopen(&quot;miarchivo.txt&quot;, &quot;r&quot;);</span>
</code></pre></div>
<p>Moltes vegades no podem obrir l'arxiu perquè aquest no es troba o no tenim accés a ell, per això és recomanable comprovar que podem fer-ho</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">if (!$fp = fopen(&quot;miarchivo.txt&quot;, &quot;r&quot;)){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    echo &quot;No se ha podido abrir el archivo&quot;;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
</code></pre></div>
<h3 id="maneres-dobertura-de-fitxers">Maneres d'obertura de fitxers<a class="headerlink" href="#maneres-dobertura-de-fitxers" title="Permanent link">&para;</a></h3>
<ul>
<li><code>r</code>: Manera lectura. Punter al principi de l'arxiu.</li>
<li><code>r+</code>: Obertura per a lectura i escriptura. Punter al principi de l'arxiu</li>
<li><code>w</code>: Obertura per a escriptura. Punter al principi de l'arxiu i el sobreescriu. Si no existeix s'intenta crear.</li>
<li><code>w+</code>: Obertura per a lectura i escriptura. Punter al principi de l'arxiu i el sobreescriu. Si no existeix s'intenta crear.</li>
<li><code>a</code>: Obertura per a escriptura. Punter al final de l'arxiu. Si no existeix s'intenta crear.</li>
<li><code>a+</code>: Obertura per a lectura i escriptura. Punter al final de l'arxiu. Si no existeix s'intenta crear.</li>
<li><code>x</code>: Creació i obertura per a només escriptura. Punter al principi de l'arxiu. Si l'arxiu ja existeix donarà error E_*WARNING. Si no existeix s'intenta crear.</li>
<li><code>x+</code>: Creació i obertura per a lectura i escriptura. Mateix comportament que x.</li>
<li><code>c</code>: Obertura per a escriptura. Si no existeix es crea. Si existeix no se sobreescriu ni dona cap error. Punter al principi de l'arxiu.</li>
<li><code>c+</code>: Obertura per a lectura i escriptura. Mateix comportament que C.</li>
<li><code>b</code>: Quan es treballa amb arxius binaris com <em>jpg, pdf, </em>png i altres. Se sol col·locar al final de la manera, és a dir <em>rb, r+b, x+b, </em>wb...</li>
</ul>
<h3 id="operacions-amb-arxius">Operacions amb arxius<a class="headerlink" href="#operacions-amb-arxius" title="Permanent link">&para;</a></h3>
<p>Per a poder <strong>llegir</strong> un arxiu necessitem usar la funció <em>fread()</em> de <em>PHP</em></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">//  ▒▒▒▒▒▒▒▒ Abriendo un archivo y leyendo su contenido ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">$fp = fopen($file, &quot;r&quot;);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">// filesize() nos devuelve el tamaño del archivo en cuestión</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">$contents = fread($fp, filesize($file));</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">// Cerramos la conexión con el archivo</span>
<span class="linenos" data-linenos="10 "></span><span class="x">fclose();</span>
</code></pre></div>
<p>Si el que volem és <strong>escriure</strong> en un arxiu, haurem de fer ús de la funció <em>fwrite()</em></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">//  ▒▒▒▒▒▒▒▒ Escribiendo en un archivo ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">$texto = &quot;Hola que tal&quot;;</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="x">$fp = fopen($file, &quot;w&quot;);</span>
<span class="linenos" data-linenos="7 "></span>
<span class="linenos" data-linenos="8 "></span><span class="x">fwrite($fp, $texto);</span>
<span class="linenos" data-linenos="9 "></span><span class="x">fclose($fp);</span>
</code></pre></div>
<h3 id="informacio-dun-fitxer">Informació d'un fitxer<a class="headerlink" href="#informacio-dun-fitxer" title="Permanent link">&para;</a></h3>
<p>Amb PHP i el seu mètode <em>stat()</em> podem obtindre informació sobre els arxius que li indiquem. Aquest mètode retorna fins a un total de 12 elements amb <em>informació</em> sobre el nostre arxiu.</p>
<p>0   <em>dev</em>    número de dispositiu
1   <em>ino</em>    número d'i-node
2   <em>mode</em>   manera de protecció de l'i-node
3   <em>nlink</em>  nombre d'enllaços
4   <em>uid</em>    ID d'usuari del propietari
5   <em>gid</em>    ID de grup del propietari
6   <em>rdev</em>   tipus de dispositiu, si és un dispositiu i-node
7   <em>size</em>   grandària en bytes
8   <em>atime</em>  moment de l'últim accés (temps Unix)
9   <em>mtime</em>  moment de l'última modificació (temps Unix)
10  <em>ctime</em>  moment de l'última modificació de l'i-node (temps Unix)
11  <em>blksize</em>    grandària del bloc E/S del sistema de fitxers
12  <em>blocks</em>     nombre de blocs de 512 bytes assignats</p>
<p>Uns exemples...</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">//  ▒▒▒▒▒▒▒▒ Información del archivo ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">$file</span> <span class="o">=</span> <span class="s2">&quot;miarchivo.txt&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">$texto</span> <span class="o">=</span> <span class="s2">&quot;Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$texto</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$datos</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Número de enlaces, 1</span>
<span class="linenos" data-linenos="14 "></span><span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Tamaño en bytes, 85</span>
<span class="linenos" data-linenos="15 "></span><span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Momento de último acceso, 1444138104</span>
<span class="linenos" data-linenos="16 "></span><span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Momento de última modificación, 1444138251</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<p>Dona una ullada a <a href="https://www.php.net/manual/es/book.dir.php">les funcions de directoris</a> que té <strong>PHP</strong>, és molt interessant.</p>
<h2 id="7-web-scraping">7. Web Scraping<a class="headerlink" href="#7-web-scraping" title="Permanent link">&para;</a></h2>
<p>Consisteix a navegar a una pàgina web i extraure informació automàticament, a partir del codi HTML generat, i organitzar la informació pública disponible en Internet.
Aquesta pràctica requereix l'ús d'una llibreria que facilite la descàrrega de la informació desitjada imitant la interacció d'un navegador web. Aquest "robot" pot accedir a diverses pàgines simultàniament.</p>
<div class="admonition question">
<p class="admonition-title">¿És legal?</p>
<p>Si el lloc web indica que té el contingut protegit per drets d'autor o en les normes d'accés via usuari/contrasenya ens avisa de la seua prohibició, estaríem incorrent en un delicte.
És recomanable estudiar l'arxiu <code>robots.txt</code> que es troba en l'arrel de cada lloc web.
Més informació en l'article <a href="https://ichi.pro/es/el-manual-completo-para-el-web-scraping-legal-y-etico-en-2021-69178542830388">El manual complet per al web scraping legal i ètic en 2021</a></p>
</div>
<h3 id="goutte">Goutte<a class="headerlink" href="#goutte" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/FriendsOfPHP/Goutte">Goutte</a> és un senzill client HTTP per a PHP creat específicament per a fer web scraping. Ho va desenvolupar el mateix autor del framework <em>Symfony</em> i ofereix un API senzilla per a extraure dades de les respostes HTML/XML dels llocs web.</p>
<p>Els components principals que abstrau <em>Goutte</em> sobre <em>Symfony</em> són:</p>
<ul>
<li><code>BrowserKit</code>: simula el comportament d'un navegador web.</li>
<li><code>CssSelector</code>: tradueix consultes CSS en consultes XPath.</li>
<li><code>DomCrawler</code>: facilita l'ús del DOM i XPath.</li>
</ul>
<p>Per a poder utilitzar <em>Goutte</em> en el nostre projecte, executarem el següent comando en el terminal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>fabpot/goutte
</code></pre></div>
<h3 id="goutte-con-selectores-css">Goutte con selectores CSS<a class="headerlink" href="#goutte-con-selectores-css" title="Permanent link">&para;</a></h3>
<p>A continuació farem un exemple molt senzill utilitzant els selectors CSS, extraient informació de la web <code>https://books.toscrape.com/</code>, la qual és una pàgina per a proves que no rebutjarà les nostres peticions.</p>
<p>Després de crear un client amb <em>Goutte</em>, hem de realitzar un petició a una URL. Amb la resposta obtinguda, podem utilitzar el mètode <code>filter</code> per a indicar-li la ruta CSS que volem recórrer i iterar sobre els resultats mitjançant una funció anònima. Una vegada estem dins d'un determinat node, el mètode <code>text()</code> ens retornarà el contingut del propi node.</p>
<p>En concret, ficarem en un array associatiu el títol i el preu de tots els llibres de la categoria <em>Classics</em>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Goutte\Client</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/classics_6/index.html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// colocamos los precios en un array</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="c1">// le pasamos $precios por referencia para poder editarla dentro del closure</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="c1">// colocamos el nombre y el precio en un array asociativo</span>
<span class="linenos" data-linenos="16 "></span><span class="nv">$contadorPrecios</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$libros</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="18 "></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article h3 a&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$precios</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$contadorPrecios</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$libros</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>        <span class="nv">$libros</span><span class="p">[</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">()]</span> <span class="o">=</span> <span class="nv">$precios</span><span class="p">[</span><span class="nv">$contadorPrecios</span><span class="p">];</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$contadorPrecios</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span><span class="p">);</span>
</code></pre></div>
<h3 id="crawler">Crawler<a class="headerlink" href="#crawler" title="Permanent link">&para;</a></h3>
<p>Un cas molt comú és obtindre la informació d'una pàgina que té els resultats paginados, de manera que anem recorrent els enllaços i accedint a cadascun dels resultats.</p>
<p>En aquest cas agafarem tots els preus dels llibres de fantasia, i els sumarem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Goutte\Client</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpClient\HttpClient</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nx">HttpClient</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">]));</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$salir</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="13 "></span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$salir</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>            <span class="nv">$texto</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span>            <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$texto</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Le quitamos las libras ¿2 posiciones?</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="nv">$enlace</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$enlace</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="c1">// el enlace next existe</span>
<span class="linenos" data-linenos="25 "></span>        <span class="nv">$sigPag</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="linenos" data-linenos="26 "></span>        <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$sigPag</span><span class="p">);</span> <span class="c1">// hacemos click</span>
<span class="linenos" data-linenos="27 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="28 "></span>        <span class="c1">// ya no hay enlace next</span>
<span class="linenos" data-linenos="29 "></span>        <span class="nv">$salir</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span><span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="nv">$precioTotal</span> <span class="o">=</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$precios</span><span class="p">);</span>
<span class="linenos" data-linenos="34 "></span><span class="k">echo</span> <span class="nv">$precioTotal</span><span class="p">;</span>
</code></pre></div>
<h2 id="8-exercisis">8. Exercisis<a class="headerlink" href="#8-exercisis" title="Permanent link">&para;</a></h2>
<h3 id="bateria-dexercicis-solucionats">Bateria d'exercicis solucionats<a class="headerlink" href="#bateria-dexercicis-solucionats" title="Permanent link">&para;</a></h3>
<h5 id="exercici-1-connexio-basica">Exercici 1. Connexió bàsica<a class="headerlink" href="#exercici-1-connexio-basica" title="Permanent link">&para;</a></h5>
<ol>
<li>Crea un fitxer PHP que faça una connexió a una base de dades MySQL utilitzant PDO.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;mysql:host=db;dbname=pruebadb&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$usuari</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$contrasenya</span> <span class="o">=</span> <span class="s1">&#39;1234&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$usuari</span><span class="p">,</span> <span class="nv">$contrasenya</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Connexió establerta!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">echo</span> <span class="s2">&quot;Error de connexió: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-2-inserir-un-registre">Exercici 2. Inserir un registre<a class="headerlink" href="#exercici-2-inserir-un-registre" title="Permanent link">&para;</a></h5>
<ol>
<li>Escriu una funció que insereixi un nou usuari a la taula <code>users</code> amb el nom i correu electrònic passats per paràmetre.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function inserirUsuari($nom, $correu) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    global $pdo;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    $sql = &quot;INSERT INTO users (nom, correu) VALUES (:nom, :correu)&quot;;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    $stmt = $pdo-&gt;prepare($sql);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    $stmt-&gt;bindParam(&#39;:nom&#39;, $nom);</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    $stmt-&gt;bindParam(&#39;:correu&#39;, $correu);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">    $stmt-&gt;execute();</span>
<span class="linenos" data-linenos="8 "></span><span class="x">    echo &quot;Usuari inserit!&quot;;</span>
<span class="linenos" data-linenos="9 "></span><span class="x">}</span>
</code></pre></div>

</details>

<h5 id="exericici-3-recuperar-dades">Exericici 3. Recuperar dades<a class="headerlink" href="#exericici-3-recuperar-dades" title="Permanent link">&para;</a></h5>
<ol>
<li>Fes una consulta SQL que mostri tots els usuaris registrats a la taula <code>users</code> i mostra'ls en una taula HTML.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">function</span> <span class="nf">mostrarUsuaris</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">echo</span> <span class="s2">&quot;&lt;table&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">while</span> <span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="nv">$fila</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="nv">$fila</span><span class="p">[</span><span class="s1">&#39;correu&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">echo</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>

</details>

<h5 id="exercici-4-actualitzar-dades">Exercici 4. Actualitzar dades<a class="headerlink" href="#exercici-4-actualitzar-dades" title="Permanent link">&para;</a></h5>
<ol>
<li>Escriu una funció que actualitzi el correu electrònic d'un usuari segons el seu identificador (<code>id</code>).</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">function</span> <span class="nf">actualitzarCorreu</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$nouCorreu</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE users SET correu = :correu WHERE id = :id&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s1">&#39;:correu&#39;</span> <span class="o">=&gt;</span> <span class="nv">$nouCorreu</span><span class="p">,</span> <span class="s1">&#39;:id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Correu actualitzat!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>

</details>

<h5 id="exercici-5-eliminar-un-registre">Exercici 5. Eliminar un registre<a class="headerlink" href="#exercici-5-eliminar-un-registre" title="Permanent link">&para;</a></h5>
<ol>
<li>Implementa un script que esborri un usuari per identificador (<code>id</code>).</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">function</span> <span class="nf">eliminarUsuari</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM users WHERE id = :id&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s1">&#39;:id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Usuari eliminat!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-6-tractament-derrors">Exercici 6. Tractament d'errors<a class="headerlink" href="#exercici-6-tractament-derrors" title="Permanent link">&para;</a></h5>
<ol>
<li>Modifica el codi anterior per gestionar els errors amb <code>try-catch</code> i mostrar missatges d'error clars.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span> <span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nx">actualitzarCorreu</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;noucorreu@example.com&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">echo</span> <span class="s2">&quot;Error en actualitzar: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-7-us-de-query-builder">Exercici 7. Ús de Query Builder<a class="headerlink" href="#exercici-7-us-de-query-builder" title="Permanent link">&para;</a></h5>
<ol>
<li>Utilitza un Query Builder per fer consultes a la base de dades de manera més fàcil i segura sense escriure SQL explícitament.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">#  Ús de Query Builder (amb Laravel com a exemple)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">function</span> <span class="nf">obtenirUsuaris</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$usuaris</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$usuaris</span> <span class="k">as</span> <span class="nv">$usuari</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">echo</span> <span class="nv">$usuari</span><span class="o">-&gt;</span><span class="na">nom</span> <span class="o">.</span> <span class="s1">&#39; - &#39;</span> <span class="o">.</span> <span class="nv">$usuari</span><span class="o">-&gt;</span><span class="na">correu</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-8-tractament-de-fitxers">Exercici 8. Tractament de fitxers<a class="headerlink" href="#exercici-8-tractament-de-fitxers" title="Permanent link">&para;</a></h5>
<ol>
<li>Crea un script que llegeixi un fitxer CSV i insereixi les dades en una taula de la base de dades.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">function</span> <span class="nf">llegirCSV</span><span class="p">(</span><span class="nv">$fitxerCSV</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">if</span> <span class="p">((</span><span class="nv">$gestor</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$fitxerCSV</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">))</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">while</span> <span class="p">((</span><span class="nv">$dades</span> <span class="o">=</span> <span class="nb">fgetcsv</span><span class="p">(</span><span class="nv">$gestor</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>            <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO users (nom, correu) VALUES (:nom, :correu)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>            <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s1">&#39;:nom&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dades</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;:correu&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dades</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span>
<span class="linenos" data-linenos="10 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$gestor</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">echo</span> <span class="s2">&quot;Dades inserides des del CSV!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-9-web-scraping">Exercici 9. Web Scraping<a class="headerlink" href="#exercici-9-web-scraping" title="Permanent link">&para;</a></h5>
<ol>
<li>Utilitza Goutte per a fer web scraping a la pàgina <code>https://books.toscrape.com/</code> i extreu el títol i preu de tots els llibres de la categoria <code>Classics</code>.</li>
<li>Mostra els resultats en una taula HTML.</li>
<li>Suma tots els preus i mostra el preu total.</li>
<li>Modifica el codi per a recórrer totes les pàgines de resultats.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>     <span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>     <span class="k">use</span> <span class="nx">Goutte\Client</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>     <span class="k">use</span> <span class="nx">Symfony\Component\HttpClient\HttpClient</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>     <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nx">HttpClient</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">]));</span>
<span class="linenos" data-linenos=" 9 "></span>     <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/classics_6/index.html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>     <span class="nv">$salir</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>     <span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="14 "></span>     <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$salir</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>         <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos="16 "></span>             <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>                 <span class="nv">$texto</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>                 <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$texto</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Le quitamos las libras ¿2 posiciones?</span>
<span class="linenos" data-linenos="19 "></span>                 <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>             <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>         <span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>         <span class="nv">$enlace</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>         <span class="k">if</span> <span class="p">(</span><span class="nv">$enlace</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>             <span class="c1">// el enlace next existe</span>
<span class="linenos" data-linenos="26 "></span>             <span class="nv">$sigPag</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="linenos" data-linenos="27 "></span>             <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$sigPag</span><span class="p">);</span> <span class="c1">// hacemos click</span>
<span class="linenos" data-linenos="28 "></span>         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="29 "></span>             <span class="c1">// ya no hay enlace next</span>
<span class="linenos" data-linenos="30 "></span>             <span class="nv">$salir</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="linenos" data-linenos="31 "></span>         <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>     <span class="p">}</span>    
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span>     <span class="nv">$precioTotal</span> <span class="o">=</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$precios</span><span class="p">);</span>
<span class="linenos" data-linenos="35 "></span>     <span class="k">echo</span> <span class="nv">$precioTotal</span><span class="p">;</span>
</code></pre></div>

</details>

<h3 id="exercicis-proposats_3">Exercicis proposats<a class="headerlink" href="#exercicis-proposats_3" title="Permanent link">&para;</a></h3>
<h4 id="exercici-1-creacio-duna-base-de-dades">Exercici 1: Creació d'una base de dades<a class="headerlink" href="#exercici-1-creacio-duna-base-de-dades" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Crea una base de dades amb una taula <code>empleats</code> que tinga els camps <code>id</code>, <code>nom</code>, <code>cognom</code> i <code>sou</code>.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Crear la base de dades i la taula.</li>
<li>Definir els tipus de dades adequats per als camps.</li>
</ul>
</li>
</ol>
<h4 id="exercici-2-llistat-dempleats">Exercici 2: Llistat d'empleats<a class="headerlink" href="#exercici-2-llistat-dempleats" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Crea un script PHP que mostre tots els empleats de la taula <code>empleats</code> en una taula HTML.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Connectar-se a la base de dades.</li>
<li>Recuperar els empleats i mostrar-los en una taula HTML.</li>
</ul>
</li>
</ol>
<h4 id="exercici-3-formulari-per-a-afegir-empleats">Exercici 3: Formulari per a afegir empleats<a class="headerlink" href="#exercici-3-formulari-per-a-afegir-empleats" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Afegeix un formulari HTML que permeta afegir nous empleats a la taula <code>empleats</code>.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Crear un formulari per a introduir el <code>nom</code>, <code>cognom</code> i <code>sou</code> de l'empleat.</li>
<li>Crear un script PHP per a gestionar la inserció de nous empleats en la taula.</li>
</ul>
</li>
</ol>
<h4 id="exercici-4-formulari-per-a-actualitzar-el-sou-dun-empleat">Exercici 4: Formulari per a actualitzar el sou d'un empleat<a class="headerlink" href="#exercici-4-formulari-per-a-actualitzar-el-sou-dun-empleat" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Afegeix un formulari per a modificar el sou d'un empleat existent.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Crear un formulari per a seleccionar l'empleat i introduir el nou sou.</li>
<li>Escriure un script PHP per a actualitzar el sou en la base de dades.</li>
</ul>
</li>
</ol>
<h4 id="exercici-5-formulari-per-a-eliminar-un-empleat">Exercici 5: Formulari per a eliminar un empleat<a class="headerlink" href="#exercici-5-formulari-per-a-eliminar-un-empleat" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Afegeix un formulari per a eliminar un empleat de la taula <code>empleats</code>.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Crear un formulari per a seleccionar l'empleat a eliminar.</li>
<li>Escriure un script PHP per a eliminar l'empleat de la base de dades.</li>
</ul>
</li>
</ol>
<h4 id="exercici-6-creacio-de-la-classe-empleat">Exercici 6: Creació de la classe <code>Empleat</code><a class="headerlink" href="#exercici-6-creacio-de-la-classe-empleat" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Crea una classe <code>Empleat</code> en PHP amb els atributs <code>id</code>, <code>nom</code>, <code>cognom</code> i <code>sou</code> i utilitza-la per a representar els empleats.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Definir la classe <code>Empleat</code> amb els seus atributs.</li>
<li>Modificar els exercicis anteriors per a utilitzar aquesta classe en lloc de variables simples.</li>
</ul>
</li>
</ol>
<h4 id="exercici-7completa-el-query-builder-seleccionat">Exercici 7:Completa el Query Builder seleccionat<a class="headerlink" href="#exercici-7completa-el-query-builder-seleccionat" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Completa el QueryBuilder seleccionat.</p>
</li>
<li>
<p><strong>Requisits:</strong>
   - Implementar el Query Builder en les operacions de consulta,   i eliminació.</p>
</li>
</ol>
<h4 id="exercici-8-us-dun-query-builder">Exercici 8: Ús d'un Query Builder<a class="headerlink" href="#exercici-8-us-dun-query-builder" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Modifica els exercicis anteriors per a utilitzar un Query Builder per a fer les consultes a la base de dades.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Implementar el Query Builder en les operacions de consulta, inserció, actualització i eliminació.</li>
</ul>
</li>
</ol>
<h4 id="exercici-9-poblar-la-taula-amb-dades-de-webscraping">Exercici 9: Poblar la taula amb dades de webscraping<a class="headerlink" href="#exercici-9-poblar-la-taula-amb-dades-de-webscraping" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Descripció:</strong>
   Modifica l'exercici de webscraping per a poblar una taula de la base de dades amb els llibres de la categoria <code>Classics</code> de la pàgina <code>https://books.toscrape.com/</code>.</p>
</li>
<li>
<p><strong>Requisits:</strong></p>
<ul>
<li>Realitzar el webscraping de la pàgina esmentada.</li>
<li>Inserir els llibres en una taula de la base de dades.</li>
</ul>
</li>
</ol>
<h2 id="9-enunciat-dels-projectes">9. Enunciat dels projectes<a class="headerlink" href="#9-enunciat-dels-projectes" title="Permanent link">&para;</a></h2>
<h3 id="projecte-4-en-ratlla_3">Projecte  "4 en Ratlla"<a class="headerlink" href="#projecte-4-en-ratlla_3" title="Permanent link">&para;</a></h3>
<h4 id="1-autenticacio-dusuaris-i-gestio-de-partides-guardades">1. Autenticació d'Usuaris i Gestió de Partides Guardades<a class="headerlink" href="#1-autenticacio-dusuaris-i-gestio-de-partides-guardades" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Registre d'Usuari:</strong>
   - Crea un formulari de login perquè el usuaris s'hagen de validar .
   - Si l'usuari no està registrat es donarà d'alta automàticament i se li permetrà entrar.
   - Després de validar-se o registrar-se es mostrarà la pantalla de triar nom i color.</p>
</li>
<li>
<p><strong>Opcions noves</strong> </p>
</li>
</ol>
<ul>
<li><strong>Guardar Partida</strong>: Es guardarà l'estat actual de la partida en la BBDD (només una per usuari, la darrera). Si guardem un altra substituirà a l'anterior. </li>
<li><strong>Carregar Partida</strong>: Es carregarà l'estat de la partida guardada per a l'usuari.</li>
<li><strong>Tancar sessió</strong>: Afig una opció perquè l’usuari puga tancar sessió i finalitzar la seua sessió activa.</li>
</ul>
<h4 id="3-consideracions-addicionals">3. Consideracions Addicionals<a class="headerlink" href="#3-consideracions-addicionals" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Seguretat:</strong>
   - Utilitza <strong>hashing</strong> de contrasenyes amb <code>password_hash()</code> per emmagatzemar-les de forma segura.</p>
</li>
<li>
<p><strong>Millores de la Interfície d'Usuari:</strong>
   - Proporciona missatges clars d'error en cas de contrasenyes incorrectes o usuaris inexistents.
   - Implementa una navegació senzilla per iniciar una nova partida o continuar una partida guardada.</p>
</li>
<li>
<p><strong>Proves:</strong>
   - Realitza proves per assegurar que l’autenticació d’usuaris funciona correctament.
   - Verifica que les partides es guarden i es recuperen adequadament.</p>
</li>
</ol>
<hr />
<h3 id="exemple-destructura-de-la-base-de-dades"><strong>Exemple d'Estructura de la Base de Dades:</strong><a class="headerlink" href="#exemple-destructura-de-la-base-de-dades" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">partides</span><span class="o">`</span><span class="w"> </span><span class="p">(</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">                           </span><span class="o">`</span><span class="n">usuari_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">                           </span><span class="o">`</span><span class="n">game</span><span class="o">`</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w">  </span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">usuaris</span><span class="o">`</span><span class="w"> </span><span class="p">(</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">                          </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">                          </span><span class="o">`</span><span class="n">nom_usuari</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">                          </span><span class="o">`</span><span class="n">contrasenya</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="linenos" data-linenos="10 "></span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">partides</span><span class="o">`</span>
<span class="linenos" data-linenos="13 "></span><span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">usuari_id</span><span class="o">`</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">usuaris</span><span class="o">`</span>
<span class="linenos" data-linenos="16 "></span><span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="k">ADD</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">nom_usuari</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">nom_usuari</span><span class="o">`</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">usuaris</span><span class="o">`</span>
<span class="linenos" data-linenos="20 "></span><span class="w">   </span><span class="k">MODIFY</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">partides</span><span class="o">`</span>
<span class="linenos" data-linenos="23 "></span><span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="o">`</span><span class="n">partides_ibfk_1</span><span class="o">`</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">usuari_id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="o">`</span><span class="n">usuaris</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span><span class="k">COMMIT</span><span class="p">;</span>
</code></pre></div>
<h1 id="projecte-integrador-bloc-1">Projecte Integrador Bloc 1.<a class="headerlink" href="#projecte-integrador-bloc-1" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duració i criteris d'avaluació</summary>
<p>Duració estimada: 16 hores</p>
<hr />
<table>
<thead>
<tr>
<th>Resultat d'aprenentatge</th>
<th>Criteris d'avaluació</th>
</tr>
</thead>
<tbody>
<tr>
<td>3. Escriu blocs de sentències embeguts en llenguatges de marques, seleccionant i utilitzant les estructures de programació.</td>
<td></td>
</tr>
<tr>
<td>4. Desenvolupa aplicacions web embegudes en llenguatges de marques analitzant i incorporant funcionalitats segons especificacions.</td>
<td></td>
</tr>
<tr>
<td>5. Desenvolupa aplicacions web identificant i aplicant mecanismes per a separar el codi de presentació de la lògica de negoci.</td>
<td></td>
</tr>
<tr>
<td>6. Desenvolupa aplicacions web d'accés a magatzems de dades, aplicant mesures per a mantindre la seguretat i la integritat de la informació</td>
<td></td>
</tr>
</tbody>
</table>
</details>
<h1 id="enunciat-del-projecte-backend-de-batoibooks">Enunciat del Projecte: Backend de BatoiBooks<a class="headerlink" href="#enunciat-del-projecte-backend-de-batoibooks" title="Permanent link">&para;</a></h1>
<h2 id="objectiu-del-projecte">Objectiu del Projecte<a class="headerlink" href="#objectiu-del-projecte" title="Permanent link">&para;</a></h2>
<p>Desenvolupar el backend per a l’aplicació <strong>BatoiBooks</strong> en PHP, proporcionant:</p>
<ul>
<li>Autenticació per token JWT.</li>
<li>Interfície d’administració amb funcionalitats avançades, com la generació de factures en PDF.</li>
</ul>
<hr />
<h2 id="funcionalitats-del-backend">Funcionalitats del Backend<a class="headerlink" href="#funcionalitats-del-backend" title="Permanent link">&para;</a></h2>
<h3 id="1-bbdd">1. BBDD<a class="headerlink" href="#1-bbdd" title="Permanent link">&para;</a></h3>
<p>Crear la BBDD i les taules utilitzant el següent <a href="recursos/batoiBook/batoiBook-2.sql">sql</a> </p>
<h3 id="2-autenticacio-per-al-frontend">2. Autenticació per al frontEnd<a class="headerlink" href="#2-autenticacio-per-al-frontend" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Registre</strong>: Endpoint per registrar nous usuaris. Rebrà dades com <code>email</code>, <code>nick</code> i <code>password</code>, i retornarà un token JWT per a la sessió de l’usuari.</p>
</li>
<li>
<p><strong>Login</strong>: Endpoint per a l'inici de sessió, on es validarà <code>email</code> i <code>password</code>. En cas d'èxit, es generarà un token JWT amb la informació d'identificació de l'usuari.</p>
</li>
<li>
<p><strong>Validació de Token</strong>: Cada controlador (excepte el de <code>login</code> i <code>register</code>) requerirà un token JWT vàlid per accedir a qualsevol dada, la qual cosa permetrà una gestió segura de la sessió.</p>
</li>
</ol>
<hr />
<h3 id="3-api-rest">3. API REST<a class="headerlink" href="#3-api-rest" title="Permanent link">&para;</a></h3>
<p>Es crearà un fitxer PHP específic per a cada entitat, que atendrà les operacions CRUD bàsiques. Les taules que es gestionaran són:</p>
<ul>
<li><strong>Books</strong></li>
<li><strong>Users</strong></li>
<li><strong>Modules</strong></li>
<li><strong>Courses</strong></li>
</ul>
<p>Per a cada taula es permetran operacions:</p>
<ul>
<li><strong>GET</strong>: Per obtenir dades (llistat o element per ID).</li>
<li><strong>POST</strong>: Per inserir nous elements.</li>
<li><strong>PUT</strong>: Per modificar elements existents.</li>
<li><strong>DELETE</strong>: Per eliminar elements.</li>
</ul>
<p>Cada operació validarà les dades abans de ser processades i respondrà amb els estats corresponents.</p>
<hr />
<h4 id="exemples-de-peticions">Exemples de peticions<a class="headerlink" href="#exemples-de-peticions" title="Permanent link">&para;</a></h4>
<ul>
<li>Tornar un llibre</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">GET /api/books.php?id=2</span>
</code></pre></div>
<ul>
<li>Tornar tots els llibres</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">GET /api/books.php</span>
</code></pre></div>
<ul>
<li>Afegir un llibre</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="err">POST /api/books.php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="err">Contingut JSON: {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="err">&quot;userId&quot;: 2,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="err">&quot;moduleCode&quot;: &quot;0011&quot;,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="err">&quot;publisher&quot;: &quot;Apunts&quot;,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="err">&quot;price&quot;: 15.00,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="err">&quot;pages&quot;: 100,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="err">&quot;status&quot;: &quot;new&quot;,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="err">&quot;photo&quot;: &quot;ruta_foto.jpg&quot;,</span>
<span class="linenos" data-linenos="10 "></span><span class="err">&quot;comments&quot;: &quot;En bon estat&quot;</span>
<span class="linenos" data-linenos="11 "></span><span class="err">}</span>
</code></pre></div>
<h3 id="4-interficie-dadministrador">4. Interfície d’Administrador<a class="headerlink" href="#4-interficie-dadministrador" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Autenticació de l'usuari</strong>: L'usuari s'autenticarà amb un usuari i es comprovarà que és l'administrador.</li>
<li><strong>Accés al CRUD de Mòduls i Cursos</strong>: L’usuari administrador podrà gestionar completament les taules <code>modules</code> i <code>courses</code>.</li>
<li><strong>Generació de Factures en PDF</strong>:<ul>
<li>Permetre la selecció de dates i usuaris.</li>
<li>Calcular un 10% de l’import total de les vendes per generar la factura.</li>
<li>Incloure el logotip de l'aplicació, data de generació, import total i desglossament de vendes.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="exigencies-tecniques">Exigències Tècniques<a class="headerlink" href="#exigencies-tecniques" title="Permanent link">&para;</a></h2>
<ul>
<li>Utilitzar PHP com a llenguatge del servidor.</li>
<li>Estructurar el projecte amb fitxers separats per a cada entitat dins de la carpeta <code>api/</code> i <code>backend</code></li>
<li>Utilitzar el format JSON per a la comunicació entre el client i el servidor.</li>
<li>Garantir la seguretat en les peticions autenticades mitjançant el token JWT.</li>
<li>Utilitzar en la mesura de lo possible el MVC en el backend i els control·ladors per a respondre a les peticions de l'API.</li>
<li>Cal fer test de la lògica de la factura.</li>
<li>Cal guardar en un fitxer de log les peticions que es fan a l'api en forma de: Usuari, IP client i Mètode utilitzat.   </li>
<li>Utilitzar, en la mesura de lo possible, exempcions per al maneig d'errors de l'usuari.</li>
</ul>
<hr />
<h2 id="exemples-de-resposta">Exemples de resposta<a class="headerlink" href="#exemples-de-resposta" title="Permanent link">&para;</a></h2>
<p>Estos exemples es poden agafar com a referència per a la implementació de l'API. Però només són la base sobre la que construir una solució pròpia que puga incorporar l'harència de classes per fer
mes eficient i reutilitzable el codi.</p>
<h3 id="estructura-de-directoris">Estructura de directoris<a class="headerlink" href="#estructura-de-directoris" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>App
<span class="linenos" data-linenos=" 2 "></span>├── Controllers
<span class="linenos" data-linenos=" 3 "></span>│   ├── Api
<span class="linenos" data-linenos=" 4 "></span>│   │   ├── ApiController.php 
<span class="linenos" data-linenos=" 5 "></span>│   │   ├── BookController.php
<span class="linenos" data-linenos=" 6 "></span>│   │   ├── CourseController.php
<span class="linenos" data-linenos=" 7 "></span>│   │   ├── ModuleController.php
<span class="linenos" data-linenos=" 8 "></span>│   │   └── AuthController.php
<span class="linenos" data-linenos=" 9 "></span>│   ├── ModuleController.php
<span class="linenos" data-linenos="10 "></span>│   ├── CourseController.php
<span class="linenos" data-linenos="11 "></span>│   └── AuthController.php
<span class="linenos" data-linenos="12 "></span>├── Helpers      
<span class="linenos" data-linenos="13 "></span>├── Exceptions       
<span class="linenos" data-linenos="14 "></span>├── Models
<span class="linenos" data-linenos="15 "></span>│   ├── Book.php
<span class="linenos" data-linenos="16 "></span>│   ├── Course.php
<span class="linenos" data-linenos="17 "></span>│   ├── Module.php
<span class="linenos" data-linenos="18 "></span>│   └── User.php
<span class="linenos" data-linenos="19 "></span>├── Services
<span class="linenos" data-linenos="20 "></span>│   ├── DBService.php
<span class="linenos" data-linenos="21 "></span>│   └── AuthService.php
<span class="linenos" data-linenos="22 "></span>├── Views
<span class="linenos" data-linenos="23 "></span>├── logs 
<span class="linenos" data-linenos="24 "></span>├── tests
<span class="linenos" data-linenos="25 "></span>├── config
<span class="linenos" data-linenos="26 "></span>│   └── connection.php
<span class="linenos" data-linenos="27 "></span>├── src
<span class="linenos" data-linenos="28 "></span>│   ├── api
<span class="linenos" data-linenos="29 "></span>│   │   ├── books.php
<span class="linenos" data-linenos="30 "></span>│   │   ├── courses.php
<span class="linenos" data-linenos="31 "></span>│   │   ├── modules.php
<span class="linenos" data-linenos="32 "></span>│   │   ├── register.php
<span class="linenos" data-linenos="33 "></span>│   │   └── login.php
<span class="linenos" data-linenos="34 "></span>│   ├── backend
<span class="linenos" data-linenos="35 "></span>│   │   ├── login.php
<span class="linenos" data-linenos="36 "></span>│   │   ├── generateInvoice.php
<span class="linenos" data-linenos="37 "></span>│   │   ├── modules.php
<span class="linenos" data-linenos="38 "></span>│   │   └── courses.php  
<span class="linenos" data-linenos="39 "></span>└── └── index.php
</code></pre></div>
<h3 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<h4 id="postman">POSTMAN<a class="headerlink" href="#postman" title="Permanent link">&para;</a></h4>
<p>Ací tens una <a href="recursos/batoiBook/BatoiBooksApi.postman_collection.json">col.lecció del POSTMAN</a> per realitzar les peticions i provar-les.</p>
<h4 id="dbservicephp">DBService.php<a class="headerlink" href="#dbservicephp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">namespace BatoiBook\Services;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">class DBService</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    public static function connect(): \PDO</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    {</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        $dbConfig =  require  $_SERVER[&#39;DOCUMENT_ROOT&#39;] . &#39;/../config/connection.php&#39;;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        try {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">            $dsn = &quot;mysql:host=&quot; . $dbConfig[&#39;host&#39;] . &quot;;dbname=&quot; . $dbConfig[&#39;dbname&#39;];</span>
<span class="linenos" data-linenos="11 "></span><span class="x">            $db = new \PDO($dsn, $dbConfig[&#39;username&#39;], $dbConfig[&#39;password&#39;]);</span>
<span class="linenos" data-linenos="12 "></span><span class="x">            $db-&gt;setAttribute(\PDO::ATTR_ERRMODE, \PDO::ERRMODE_EXCEPTION);</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        } catch (\PDOException $e) {</span>
<span class="linenos" data-linenos="14 "></span><span class="x">            die(&quot;Error de connexió: &quot; . $e-&gt;getMessage());</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="x">        return $db;</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="20 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="model">Model<a class="headerlink" href="#model" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">namespace BatoiBook\Models;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">class Course</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">   public function __construct(</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">   public int $id = 0,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">   public string $course = &#39;&#39;,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">   public int $familyId = 0,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">   public string $vliteral = &#39;&#39;,</span>
<span class="linenos" data-linenos="10 "></span><span class="x">   public string $cliteral = &#39;&#39; ) </span>
<span class="linenos" data-linenos="11 "></span><span class="x">   {}</span>
<span class="linenos" data-linenos="12 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="controlador">Controlador<a class="headerlink" href="#controlador" title="Permanent link">&para;</a></h4>
<p>En el ApiController.php es troben les funcions comunes a tots els controladors, com el jsonResponse i errorResponse.  </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">namespace BatoiBook\Controllers\Api;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">use \PDO;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">use \PDOException;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">class CourseController extends ApiController</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    protected PDO $db;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    public function __construct()</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        $this-&gt;db = DBService::connect();</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">    public function getAll(): void</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT * FROM courses&quot;);</span>
<span class="linenos" data-linenos="16 "></span><span class="x">        $stmt-&gt;execute();</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        $stmt-&gt;setFetchMode(PDO::FETCH_CLASS | PDO::FETCH_PROPS_LATE, Course::class);</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="x">        $this-&gt;jsonResponse($stmt-&gt;fetchAll());</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="x">    public function getOne(int $id): void</span>
<span class="linenos" data-linenos="23 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="24 "></span><span class="x">        //TODO: Implementar consulta </span>
<span class="linenos" data-linenos="25 "></span><span class="x">        $record = $stmt-&gt;fetch();</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span><span class="x">        if ($record) {</span>
<span class="linenos" data-linenos="28 "></span><span class="x">            $this-&gt;jsonResponse($record);</span>
<span class="linenos" data-linenos="29 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="30 "></span><span class="x">            $this-&gt;errorResponse(&quot;Record not found&quot;, 404);</span>
<span class="linenos" data-linenos="31 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="32 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span><span class="x">    public function create(array $data): int</span>
<span class="linenos" data-linenos="35 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="36 "></span><span class="x">        try {</span>
<span class="linenos" data-linenos="37 "></span><span class="x">            //TODO: Implementar inserció</span>
<span class="linenos" data-linenos="38 "></span><span class="x">            return $this-&gt;db-&gt;lastInsertId();</span>
<span class="linenos" data-linenos="39 "></span><span class="x">         } catch (PDOException $e) {</span>
<span class="linenos" data-linenos="40 "></span><span class="x">            $this-&gt;errorResponse(&quot;Failed to create record: &quot; . $e-&gt;getMessage());</span>
<span class="linenos" data-linenos="41 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="42 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="43 "></span>
<span class="linenos" data-linenos="44 "></span><span class="x">    public function update(int $id, array $data): void</span>
<span class="linenos" data-linenos="45 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="46 "></span><span class="x">        try {</span>
<span class="linenos" data-linenos="47 "></span><span class="x">            //TODO: Implementar actualització</span>
<span class="linenos" data-linenos="48 "></span>
<span class="linenos" data-linenos="49 "></span><span class="x">            $stmt-&gt;execute();</span>
<span class="linenos" data-linenos="50 "></span><span class="x">            if ($stmt-&gt;rowCount() &gt; 0) {</span>
<span class="linenos" data-linenos="51 "></span><span class="x">                $this-&gt;jsonResponse([&quot;message&quot; =&gt; &quot;Record updated successfully&quot;]);</span>
<span class="linenos" data-linenos="52 "></span><span class="x">            } else {</span>
<span class="linenos" data-linenos="53 "></span><span class="x">                $this-&gt;errorResponse(&quot;Record not found&quot;, 404);</span>
<span class="linenos" data-linenos="54 "></span><span class="x">            }</span>
<span class="linenos" data-linenos="55 "></span><span class="x">        } catch (PDOException $e) {</span>
<span class="linenos" data-linenos="56 "></span><span class="x">            $this-&gt;errorResponse(&quot;Failed to update record: &quot; . $e-&gt;getMessage());</span>
<span class="linenos" data-linenos="57 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="58 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="59 "></span>
<span class="linenos" data-linenos="60 "></span><span class="x">    public function delete(int $id): void</span>
<span class="linenos" data-linenos="61 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="62 "></span><span class="x">        //TODO: Implementar eliminació</span>
<span class="linenos" data-linenos="63 "></span><span class="x">        if ($stmt-&gt;rowCount() &gt; 0) {</span>
<span class="linenos" data-linenos="64 "></span><span class="x">            $this-&gt;jsonResponse([&quot;message&quot; =&gt; &quot;Record deleted successfully&quot;]);</span>
<span class="linenos" data-linenos="65 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="66 "></span><span class="x">            $this-&gt;errorResponse(&quot;Record not found&quot;, 404);</span>
<span class="linenos" data-linenos="67 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="68 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="69 "></span><span class="x">}</span>
</code></pre></div>
<h4 id="coursesphp">courses.php<a class="headerlink" href="#coursesphp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">require_once $_SERVER[&#39;DOCUMENT_ROOT&#39;] . &#39;/../vendor/autoload.php&#39;;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">require_once $_SERVER[&#39;DOCUMENT_ROOT&#39;] . &#39;/../Helpers/functions.php&#39;;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">use BatoiBook\Controllers\Api\CourseController;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">header(&quot;Content-Type: application/json&quot;);</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">$controller = new CourseController();</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">$method = $_SERVER[&#39;REQUEST_METHOD&#39;];</span>
<span class="linenos" data-linenos="10 "></span><span class="x">$id = isset($_GET[&#39;id&#39;]) ? (int)$_GET[&#39;id&#39;] : null;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="x">switch ($method) {</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    case &#39;GET&#39;:</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        if (isset($id)) {</span>
<span class="linenos" data-linenos="15 "></span><span class="x">            $controller-&gt;getOne($id);</span>
<span class="linenos" data-linenos="16 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="17 "></span><span class="x">            $controller-&gt;getAll ();</span>
<span class="linenos" data-linenos="18 "></span><span class="x">       }</span>
<span class="linenos" data-linenos="19 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    case &#39;POST&#39;:</span>
<span class="linenos" data-linenos="21 "></span><span class="x">        $data = json_decode(file_get_contents(&#39;php://input&#39;), true);</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span><span class="x">        if ($data) {</span>
<span class="linenos" data-linenos="24 "></span><span class="x">            $controller-&gt;create($data);</span>
<span class="linenos" data-linenos="25 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="26 "></span><span class="x">            echo json_encode([&quot;error&quot; =&gt; &quot;Invalid data&quot;]);</span>
<span class="linenos" data-linenos="27 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="28 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">    case &#39;PUT&#39;:</span>
<span class="linenos" data-linenos="30 "></span><span class="x">        $data = json_decode(file_get_contents(&#39;php://input&#39;), true);</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span><span class="x">        if (isset($_GET[&#39;id&#39;]) &amp;&amp; $data) {</span>
<span class="linenos" data-linenos="33 "></span><span class="x">            $success = $controller-&gt;update ($id, $data);</span>
<span class="linenos" data-linenos="34 "></span><span class="x">            echo json_encode([&quot;message&quot; =&gt; $success ? &quot;Field updated successfully&quot; : &quot;Book not found&quot;]);</span>
<span class="linenos" data-linenos="35 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="36 "></span><span class="x">            echo json_encode([&quot;error&quot; =&gt; &quot;Invalid data or ID&quot;]);</span>
<span class="linenos" data-linenos="37 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="38 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos="39 "></span><span class="x">    case &#39;DELETE&#39;:</span>
<span class="linenos" data-linenos="40 "></span><span class="x">        if (isset($_GET[&#39;id&#39;])) {</span>
<span class="linenos" data-linenos="41 "></span><span class="x">            $controller-&gt;delete ($id);</span>
<span class="linenos" data-linenos="42 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="43 "></span><span class="x">            echo json_encode([&quot;error&quot; =&gt; &quot;ID not provided&quot;]);</span>
<span class="linenos" data-linenos="44 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="45 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos="46 "></span><span class="x">    default:</span>
<span class="linenos" data-linenos="47 "></span><span class="x">        echo json_encode([&quot;error&quot; =&gt; &quot;Invalid request method&quot;]);</span>
<span class="linenos" data-linenos="48 "></span><span class="x">        break;</span>
<span class="linenos" data-linenos="49 "></span><span class="x">}</span>
</code></pre></div>
<h3 id="autentificacio">Autentificació<a class="headerlink" href="#autentificacio" title="Permanent link">&para;</a></h3>
<h4 id="requeriments-previs">Requeriments previs<a class="headerlink" href="#requeriments-previs" title="Permanent link">&para;</a></h4>
<p>Cal instal·lar la llibreria <code>firebase/php-jwt</code> per a poder generar i validar els tokens JWT.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>firebase/php-jwt
</code></pre></div>
<h4 id="loginphp">login.php<a class="headerlink" href="#loginphp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">   require_once $_SERVER[&#39;DOCUMENT_ROOT&#39;] . &#39;/../vendor/autoload.php&#39;;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">   use Firebase\JWT\JWT;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">   use Firebase\JWT\Key;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">   use BatoiBook\Services\DBService;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">   // Clau secreta per generar el token (és important mantenir-la segura)</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">   $secretKey = &#39;clau_secreta&#39;;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">   header(&#39;Content-Type: application/json&#39;);</span>
<span class="linenos" data-linenos="10 "></span><span class="x">   // Llegeix les dades de la petició</span>
<span class="linenos" data-linenos="11 "></span><span class="x">   $data = json_decode(file_get_contents(&quot;php://input&quot;));</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="x">   if (!empty($data-&gt;email) &amp;&amp; !empty($data-&gt;password)) {</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="x">        $db = DBService::connect();  </span>
<span class="linenos" data-linenos="16 "></span><span class="x">        //TODO: Implementar consulta per recuperar l&#39;usuari</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        $user = $stmt-&gt;fetch();</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        if ($user) {</span>
<span class="linenos" data-linenos="19 "></span><span class="x">            if (password_verify($data-&gt;password,$user-&gt;password)) {</span>
<span class="linenos" data-linenos="20 "></span><span class="x">                $payload = [</span>
<span class="linenos" data-linenos="21 "></span><span class="x">                     &quot;iss&quot; =&gt; &quot;http://localhost&quot;, // Issuer</span>
<span class="linenos" data-linenos="22 "></span><span class="x">                     &quot;aud&quot; =&gt; &quot;http://localhost&quot;, // Audience</span>
<span class="linenos" data-linenos="23 "></span><span class="x">                     &quot;iat&quot; =&gt; time(),             // Issued at</span>
<span class="linenos" data-linenos="24 "></span><span class="x">                     &quot;exp&quot; =&gt; time() + 3600,      // Expira en una hora</span>
<span class="linenos" data-linenos="25 "></span><span class="x">                     &quot;userId&quot; =&gt; $userId</span>
<span class="linenos" data-linenos="26 "></span><span class="x">                 ];</span>
<span class="linenos" data-linenos="27 "></span><span class="x">                $jwt = JWT::encode($payload, $secretKey, &#39;HS256&#39;);    </span>
<span class="linenos" data-linenos="28 "></span><span class="x">                echo json_encode([&quot;success&quot; =&gt; true, &quot;token&quot; =&gt; $jwt]);</span>
<span class="linenos" data-linenos="29 "></span><span class="x">            } else {</span>
<span class="linenos" data-linenos="30 "></span><span class="x">                echo json_encode([&quot;success&quot; =&gt; false, &quot;message&quot; =&gt; &quot;Contrasenya incorrecta&quot;]);</span>
<span class="linenos" data-linenos="31 "></span><span class="x">            }</span>
<span class="linenos" data-linenos="32 "></span><span class="x">        } else {</span>
<span class="linenos" data-linenos="33 "></span><span class="x">            echo json_encode([&quot;success&quot; =&gt; false, &quot;message&quot; =&gt; &quot;Usuari no trobat&quot;]);</span>
<span class="linenos" data-linenos="34 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="35 "></span>
<span class="linenos" data-linenos="36 "></span><span class="x">   } else {</span>
<span class="linenos" data-linenos="37 "></span><span class="x">       echo json_encode([&quot;success&quot; =&gt; false, &quot;message&quot; =&gt; &quot;Falten dades&quot;]);</span>
<span class="linenos" data-linenos="38 "></span><span class="x">   }</span>
</code></pre></div>
<h4 id="registerphp">register.php<a class="headerlink" href="#registerphp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">//TODO: Implementar registre d&#39;usuari</span>
</code></pre></div>
<h4 id="validatephp">validate.php<a class="headerlink" href="#validatephp" title="Permanent link">&para;</a></h4>
<p>per a validar que qualsevol petició a l'API siga autenticada.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">if (!isset($_SERVER[&#39;HTTP_AUTHORIZATION&#39;])) {</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">      throw new UnAuthoritzedException(&quot;Token no proporcionat&quot;);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">}</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">$authHeader = $_SERVER[&#39;HTTP_AUTHORIZATION&#39;];</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">[$type, $token] = explode(&quot; &quot;, $authHeader);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">if ($type !== &#39;Bearer&#39;) {</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    throw new UnAuthoritzedException(&quot;Tipus de token no vàlid&quot;);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">try {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    $jwt = JWT::decode($token, new Key(SELF::SECRET_KEY, &#39;HS256&#39;));</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    $userId = $jwt-&gt;userId;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">} catch (Exception $e) {</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    throw new UnAuthoritzedException(&quot;Token no vàlid o expirat&quot;);</span>
<span class="linenos" data-linenos="14 "></span><span class="x">}</span>
</code></pre></div></p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2021-2026 Aitor Medrano, Luis Alemañ, Ignasi Gomis - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>