
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cipfpbatoi.github.io/dwes2526/06Nodejs.html">
      
      
        <link rel="prev" href="05seguretat_Laravel.html">
      
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>6.- Desenvolupament d'APIs REST amb Node.js - Desenvolupament web en entorn de Servidor</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-X6D0LR7TC8"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-X6D0LR7TC8",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-X6D0LR7TC8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sa-61-introduccio-i-conceptes-previs" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="index.html" title="Desenvolupament web en entorn de Servidor" class="md-header__button md-logo" aria-label="Desenvolupament web en entorn de Servidor" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desenvolupament web en entorn de Servidor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6.- Desenvolupament d'APIs REST amb Node.js
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode nit"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canviar a mode nit" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Desenvolupament web en entorn de Servidor" class="md-nav__button md-logo" aria-label="Desenvolupament web en entorn de Servidor" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    Desenvolupament web en entorn de Servidor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01arquitecturas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.- Arquitectures Web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02php.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.- Programació web amb PHP
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03MVC_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.- Arquitectura MVC amb Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04dades_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.- Accés segur i estructurat a bases de dades amb Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05seguretat_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.- Aplicacions segures i reactives en Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    6.- Desenvolupament d'APIs REST amb Node.js
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="06Nodejs.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    6.- Desenvolupament d'APIs REST amb Node.js
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sa-61-introduccio-i-conceptes-previs" class="md-nav__link">
    <span class="md-ellipsis">
      SA 6.1 – Introducció i conceptes previs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SA 6.1 – Introducció i conceptes previs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-que-es-nodejs" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 1. Què és Node.js?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-que-es-express" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 2. Què és Express?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-que-es-una-api" class="md-nav__link">
    <span class="md-ellipsis">
      🌐 3. Què és una API?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-arquitectura-i-estructura-dun-projecte-api" class="md-nav__link">
    <span class="md-ellipsis">
      🏗️ 4. Arquitectura i estructura d’un projecte API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-flux-de-treball-duna-api" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 5. Flux de treball d’una API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-eines-utils-per-al-desenvolupament-dapis" class="md-nav__link">
    <span class="md-ellipsis">
      🛠️ 6. Eines útils per al desenvolupament d’APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bones-practiques-des-del-principi" class="md-nav__link">
    <span class="md-ellipsis">
      💡 Bones pràctiques des del principi
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sa-62-creacio-del-projecte-pas-a-pas-api-en-memoria" class="md-nav__link">
    <span class="md-ellipsis">
      SA 6.2 Creació del projecte pas a pas (API en memòria)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SA 6.2 Creació del projecte pas a pas (API en memòria)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-inicialitzacio-del-projecte" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ 1. Inicialització del projecte
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-estructura-del-projecte" class="md-nav__link">
    <span class="md-ellipsis">
      🗂️ 2. Estructura del projecte
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-app-i-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 3. App i servidor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-middlewares-de-404-i-errors" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 4. Middlewares de 404 i errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-validacio-dentrada-amb-express-validator" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 5. Validació d’entrada amb express-validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-rutes-i-crud-en-memoria" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 6. Rutes i CRUD en memòria
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-proves-amb-postman-curl" class="md-nav__link">
    <span class="md-ellipsis">
      🔍 7. Proves amb Postman / curl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-proves-des-del-client-javascript-fetch" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 8. Proves des del client (JavaScript fetch())
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-extres-utils" class="md-nav__link">
    <span class="md-ellipsis">
      🌐↔️🌐 9. Extres útils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-exercicis-per-entregar" class="md-nav__link">
    <span class="md-ellipsis">
      📝 10. Exercicis (per entregar)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      🐞🛠️ 11. Troubleshooting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sa-63-connexio-a-mongodb-mongoose-i-crud-persistent" class="md-nav__link">
    <span class="md-ellipsis">
      SA 6.3 Connexió a MongoDB (Mongoose) i CRUD persistent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SA 6.3 Connexió a MongoDB (Mongoose) i CRUD persistent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-requisits-i-configuracio" class="md-nav__link">
    <span class="md-ellipsis">
      🧰 1. Requisits i configuració
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-connexio-a-mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      🔌 2. Connexió a MongoDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-model-de-dades-amb-mongoose" class="md-nav__link">
    <span class="md-ellipsis">
      🔌 3. Model de dades amb Mongoose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-reescriure-controladors-per-a-mongo" class="md-nav__link">
    <span class="md-ellipsis">
      ✍️ 4. Reescriure controladors per a Mongo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-seed-de-dades" class="md-nav__link">
    <span class="md-ellipsis">
      🌱 5. Seed de dades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-proves-rapides" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 7. Proves ràpides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-bones-practiques-de-persistencia" class="md-nav__link">
    <span class="md-ellipsis">
      💡 8. Bones pràctiques de persistència
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-exercicis-per-entregar" class="md-nav__link">
    <span class="md-ellipsis">
      📝 9. Exercicis (per entregar)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      🐞🛠️ 10. Troubleshooting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sa-64-documentacio-amb-swagger-openapi" class="md-nav__link">
    <span class="md-ellipsis">
      SA 6.4 Documentació amb Swagger / OpenAPI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SA 6.4 Documentació amb Swagger / OpenAPI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-arxiu-openapijson-basic" class="md-nav__link">
    <span class="md-ellipsis">
      🧱 1. Arxiu openapi.json bàsic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-servir-swagger-ui" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ 2. Servir Swagger UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-afegir-exemples-i-respostes-detallades" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 3. Afegir exemples i respostes detallades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-bones-practiques-de-documentacio" class="md-nav__link">
    <span class="md-ellipsis">
      💡 4. Bones pràctiques de documentació
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-exercicis-per-entregar" class="md-nav__link">
    <span class="md-ellipsis">
      📝 5. Exercicis (per entregar)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-troubleshooting-swagger" class="md-nav__link">
    <span class="md-ellipsis">
      🐞🛠️ 6. Troubleshooting Swagger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-swagger-automatic-amb-swagger-jsdoc" class="md-nav__link">
    <span class="md-ellipsis">
      🐞🛠️ 7. Swagger automàtic amb swagger-jsdoc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sa-65-practiques-guiades-reptes-oberts-i-rubrica-davaluacio" class="md-nav__link">
    <span class="md-ellipsis">
      SA 6.5 – Pràctiques guiades, reptes oberts i rúbrica d’avaluació
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SA 6.5 – Pràctiques guiades, reptes oberts i rúbrica d’avaluació">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-practiques-guiades" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 1. Pràctiques guiades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-reptes-oberts" class="md-nav__link">
    <span class="md-ellipsis">
      💡 2. Reptes oberts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-rubrica-davaluacio-de-projecte-final" class="md-nav__link">
    <span class="md-ellipsis">
      📊 3. Rúbrica d’avaluació de projecte final
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-recomanacions-finals-per-al-projecte" class="md-nav__link">
    <span class="md-ellipsis">
      📁 4. Recomanacions finals per al projecte
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>6.- Desenvolupament d'APIs REST amb Node.js</h1>

<h2 id="sa-61-introduccio-i-conceptes-previs">SA 6.1 – Introducció i conceptes previs<a class="headerlink" href="#sa-61-introduccio-i-conceptes-previs" title="Permanent link">&para;</a></h2>
<h3 id="1-que-es-nodejs">🧠 1. Què és Node.js?<a class="headerlink" href="#1-que-es-nodejs" title="Permanent link">&para;</a></h3>
<p><strong>Node.js</strong> és un entorn d’execució de JavaScript fora del navegador.<br />
En lloc d’executar-se al client (com en aplicacions web tradicionals), s’executa al <strong>servidor</strong>, permetent-nos construir aplicacions backend, APIs, serveis web i molt més utilitzant el mateix llenguatge que al frontend: <strong>JavaScript</strong>.</p>
<p>💡 <strong>Per què és interessant</strong></p>
<ul>
<li>Permet treballar amb un únic llenguatge tant al client com al servidor.</li>
<li>És lleuger, ràpid i molt eficient gràcies al motor V8 de Chrome.</li>
<li>Té un ecosistema immens de paquets a través de <code>npm</code>.</li>
<li>És ideal per crear <strong>APIs REST</strong>, <strong>microserveis</strong> o aplicacions temps real.</li>
</ul>
<p>📦 Exemple bàsic:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">// hola.js</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hola món des de Node.js!&#39;</span><span class="p">);</span>
</code></pre></div>
Executa’l amb:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>node<span class="w"> </span>hola.js
</code></pre></div></p>
<hr />
<h3 id="2-que-es-express">🚀 2. Què és Express?<a class="headerlink" href="#2-que-es-express" title="Permanent link">&para;</a></h3>
<p><strong>Express</strong> és un framework minimalista per a Node.js que simplifica molt la creació de servidors web i APIs.<br />
Permet definir <strong>rutes HTTP</strong>, gestionar <strong>paràmetres</strong>, utilitzar <strong>middlewares</strong>, enviar respostes i molt més amb molt poques línies de codi.</p>
<p>✅ Funcions clau d’Express:</p>
<ul>
<li>Crear rutes per als diferents recursos (<code>/users</code>, <code>/products</code>, etc.)</li>
<li>Gestionar peticions HTTP (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, …)</li>
<li>Analitzar dades del cos de la petició (<code>req.body</code>)</li>
<li>Afegir funcionalitats amb <em>middlewares</em> (validació, logs, errors…)</li>
<li>Organitzar lògica del servidor de manera clara i escalable</li>
</ul>
<p>📦 Exemple mínim d’un servidor Express:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hola món amb Express!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">});</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Servidor escoltant a http://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span><span class="p">});</span>
</code></pre></div>
<hr />
<h3 id="3-que-es-una-api">🌐 3. Què és una API?<a class="headerlink" href="#3-que-es-una-api" title="Permanent link">&para;</a></h3>
<p>Una <strong>API</strong> (<em>Application Programming Interface</em>) és un conjunt de regles i punts d’entrada que permeten que un programa puga comunicar-se amb un altre.<br />
En el context web, una <strong>API REST</strong> és un servei que exposa dades o funcionalitats a través del protocol <strong>HTTP</strong>.</p>
<p>Per exemple, una API de productes pot oferir endpoints com:</p>
<table>
<thead>
<tr>
<th>Mètode</th>
<th>Endpoint</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/api/v1/products</code></td>
<td>Obté tots els productes</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/v1/products/:id</code></td>
<td>Obté un producte per ID</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/v1/products</code></td>
<td>Crea un nou producte</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/api/v1/products/:id</code></td>
<td>Actualitza un producte existent</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/v1/products/:id</code></td>
<td>Elimina un producte</td>
</tr>
</tbody>
</table>
<p>📌 Una <strong>API RESTful</strong> té unes característiques concretes:</p>
<ul>
<li>Usa els mètodes HTTP correctament (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>PATCH</code>…)</li>
<li>Utilitza URLs clares i orientades a recursos (<code>/users</code>, <code>/orders</code>, <code>/products</code>)</li>
<li>Retorna dades en format estàndard (normalment <code>JSON</code>)</li>
<li>Fa ús dels codis d’estat HTTP (<code>200</code>, <code>201</code>, <code>404</code>, <code>422</code>, <code>500</code>…)</li>
</ul>
<hr />
<h3 id="4-arquitectura-i-estructura-dun-projecte-api">🏗️ 4. Arquitectura i estructura d’un projecte API<a class="headerlink" href="#4-arquitectura-i-estructura-dun-projecte-api" title="Permanent link">&para;</a></h3>
<p>Una API professional sol tindre una estructura organitzada que facilite el manteniment i l’escalabilitat:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>api-inventari/
<span class="linenos" data-linenos=" 2 "></span>├─ package.json
<span class="linenos" data-linenos=" 3 "></span>├─ .env
<span class="linenos" data-linenos=" 4 "></span>├─ src/
<span class="linenos" data-linenos=" 5 "></span>│  ├─ server.js          # Punt d&#39;entrada: arranca el servidor
<span class="linenos" data-linenos=" 6 "></span>│  ├─ app.js             # Configura Express i middlewares
<span class="linenos" data-linenos=" 7 "></span>│  ├─ routes/            # Definició de rutes (endpoints)
<span class="linenos" data-linenos=" 8 "></span>│  ├─ controllers/       # Lògica de negoci per a cada ruta
<span class="linenos" data-linenos=" 9 "></span>│  ├─ models/            # Definició dels esquemes de dades (Mongo, etc.)
<span class="linenos" data-linenos="10 "></span>│  ├─ middlewares/       # Validació, errors, autenticació...
<span class="linenos" data-linenos="11 "></span>│  ├─ validation/        # Regles de validació d’entrada
<span class="linenos" data-linenos="12 "></span>│  └─ lib/               # Connexió a BD i utilitats
<span class="linenos" data-linenos="13 "></span>└─ openapi.json          # Especificació Swagger
</code></pre></div>
<p>💡 <strong>Avantatge d’aquesta estructura:</strong></p>
<ul>
<li>Separa clarament responsabilitats  </li>
<li>Facilita el testing i el manteniment  </li>
<li>Permet escalar el projecte fàcilment</li>
</ul>
<h3 id="5-flux-de-treball-duna-api">🔧 5. Flux de treball d’una API<a class="headerlink" href="#5-flux-de-treball-duna-api" title="Permanent link">&para;</a></h3>
<p>Quan un client (p. ex. una aplicació web o mòbil) fa una petició a l’API:</p>
<ol>
<li>🛰️ El client envia una <strong>petició HTTP</strong> (<code>GET</code>, <code>POST</code>, etc.) a un endpoint.</li>
<li>📬 El servidor Express rep la petició i comprova si la ruta existeix.</li>
<li>🧰 Els <strong>middlewares</strong> processen la petició (validació, autenticació...).</li>
<li>🧠 El <strong>controlador</strong> executa la lògica (consultar BD, crear recurs…).</li>
<li>📦 El <strong>model</strong> interactua amb la base de dades si cal.</li>
<li>📤 El servidor retorna una <strong>resposta JSON</strong> amb un codi d’estat adequat.</li>
</ol>
<p>Exemple de resposta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;64d0c6f5b2e4f1&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cafè 1kg&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">12.50</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="nt">&quot;stock&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="linenos" data-linenos="6 "></span><span class="w">  </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="6-eines-utils-per-al-desenvolupament-dapis">🛠️ 6. Eines útils per al desenvolupament d’APIs<a class="headerlink" href="#6-eines-utils-per-al-desenvolupament-dapis" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Postman / Thunder Client</strong> → per provar endpoints manualment  </li>
<li><strong>MongoDB Compass</strong> → per gestionar dades si uses MongoDB  </li>
<li><strong>Swagger UI</strong> → per documentar i provar l’API  </li>
<li><strong>ESLint + Prettier</strong> → per mantenir un codi net i consistent  </li>
<li><strong>dotenv</strong> → per gestionar variables d’entorn</li>
</ul>
<h3 id="bones-practiques-des-del-principi">💡 Bones pràctiques des del principi<a class="headerlink" href="#bones-practiques-des-del-principi" title="Permanent link">&para;</a></h3>
<p>✅ <strong>Nom de rutes RESTful</strong>: utilitza noms de recursos en plural (<code>/products</code>, <code>/users</code>)<br />
✅ <strong>Codis d’estat HTTP</strong>: respon amb el codi correcte (<code>201</code> en creació, <code>404</code> si no trobat…)<br />
✅ <strong>JSON net i clar</strong>: evita informació innecessària i segueix un format consistent<br />
✅ <strong>Middleware de validació</strong>: mai confies en les dades d’entrada<br />
✅ <strong>Control centralitzat d’errors</strong>: un únic lloc per capturar i gestionar errors</p>
<h2 id="sa-62-creacio-del-projecte-pas-a-pas-api-en-memoria">SA 6.2 Creació del projecte pas a pas (API en memòria)<a class="headerlink" href="#sa-62-creacio-del-projecte-pas-a-pas-api-en-memoria" title="Permanent link">&para;</a></h2>
<p>En aquesta secció construirem una <strong>API REST d’inventari</strong> amb <strong>Express</strong> utilitzant <strong>ES Modules (<code>import/export</code>)</strong> i <strong>emmagatzematge en memòria</strong> (sense base de dades). L’objectiu és entendre <strong>clarament</strong> el flux: <em>rutes → middleware → controladors → respostes</em>. A la Secció 3 connectarem la mateixa API a <strong>MongoDB</strong> sense canviar la interfície pública.</p>
<h3 id="1-inicialitzacio-del-projecte">⚙️ 1. Inicialització del projecte<a class="headerlink" href="#1-inicialitzacio-del-projecte" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Crea una carpeta i inicialitza <code>npm</code>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mkdir<span class="w"> </span>api-inventari<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>api-inventari
<span class="linenos" data-linenos="2 "></span>npm<span class="w"> </span>init<span class="w"> </span>-y
</code></pre></div></p>
</li>
<li>
<p>Edita <code>package.json</code> per activar <strong>ES Modules</strong> i afegir scripts bàsics:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;api-inventari&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;module&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;src/server.js&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="nt">&quot;dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node --watch src/server.js&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node src/server.js&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p>Instala dependències necessàries:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>npm<span class="w"> </span>i<span class="w"> </span>express<span class="w"> </span>cors<span class="w"> </span>helmet<span class="w"> </span>morgan<span class="w"> </span>express-validator<span class="w"> </span>swagger-ui-express<span class="w"> </span>dotenv
<span class="linenos" data-linenos="2 "></span>npm<span class="w"> </span>i<span class="w"> </span>-D<span class="w"> </span>eslint
</code></pre></div></p>
</li>
</ol>
<blockquote>
<p>ℹ️ <code>swagger-ui-express</code> el farem servir per mostrar la documentació en la Secció 4 (ara deixarem el “ganxo” posat).</p>
</blockquote>
<h3 id="2-estructura-del-projecte">🗂️ 2. Estructura del projecte<a class="headerlink" href="#2-estructura-del-projecte" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>api-inventari/
<span class="linenos" data-linenos=" 2 "></span>├─ package.json
<span class="linenos" data-linenos=" 3 "></span>├─ .env                 # opcional (PORT, etc.)
<span class="linenos" data-linenos=" 4 "></span>├─ openapi.json         # la farem a la Secció 4
<span class="linenos" data-linenos=" 5 "></span>└─ src/
<span class="linenos" data-linenos=" 6 "></span>   ├─ server.js         # arrencada
<span class="linenos" data-linenos=" 7 "></span>   ├─ app.js            # configuració d’Express i rutes
<span class="linenos" data-linenos=" 8 "></span>   ├─ routes/
<span class="linenos" data-linenos=" 9 "></span>   │  └─ products.routes.js
<span class="linenos" data-linenos="10 "></span>   ├─ controllers/
<span class="linenos" data-linenos="11 "></span>   │  └─ products.controller.memory.js
<span class="linenos" data-linenos="12 "></span>   ├─ middlewares/
<span class="linenos" data-linenos="13 "></span>   │  ├─ not-found.js
<span class="linenos" data-linenos="14 "></span>   │  └─ error-handler.js
<span class="linenos" data-linenos="15 "></span>   └─ validation/
<span class="linenos" data-linenos="16 "></span>      └─ products.rules.js
</code></pre></div>
<h3 id="3-app-i-servidor">🚀 3. App i servidor<a class="headerlink" href="#3-app-i-servidor" title="Permanent link">&para;</a></h3>
<p><strong><code>src/app.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="nx">morgan</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;morgan&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="nx">helmet</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;helmet&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">import</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;cors&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">import</span><span class="w"> </span><span class="nx">productsRouter</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./routes/products.routes.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">import</span><span class="w"> </span><span class="nx">notFound</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middlewares/not-found.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">import</span><span class="w"> </span><span class="nx">errorHandler</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middlewares/error-handler.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="c1">// Middlewares globals</span>
<span class="linenos" data-linenos="13 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">helmet</span><span class="p">());</span>
<span class="linenos" data-linenos="14 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
<span class="linenos" data-linenos="15 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="16 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="c1">// Rutes</span>
<span class="linenos" data-linenos="19 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api/v1/products&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">productsRouter</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="c1">// 404 i errors</span>
<span class="linenos" data-linenos="22 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">notFound</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">app</span><span class="p">;</span>
</code></pre></div></p>
<p><strong><code>src/server.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;dotenv/config&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">import</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./app.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="6 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`API Inventari escoltant a http://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="p">});</span>
</code></pre></div></p>
<h3 id="4-middlewares-de-404-i-errors">🧩 4. Middlewares de 404 i errors<a class="headerlink" href="#4-middlewares-de-404-i-errors" title="Permanent link">&para;</a></h3>
<p><strong><code>src/middlewares/not-found.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">notFound</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Ruta no trobada&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="3 "></span><span class="p">}</span>
</code></pre></div></p>
<p><strong><code>src/middlewares/error-handler.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">errorHandler</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">status</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;Error intern del servidor&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div></p>
<h3 id="5-validacio-dentrada-amb-express-validator">🧪 5. Validació d’entrada amb <code>express-validator</code><a class="headerlink" href="#5-validacio-dentrada-amb-express-validator" title="Permanent link">&para;</a></h3>
<p><strong><code>src/validation/products.rules.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express-validator&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">listQueryRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isString</span><span class="p">(),</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isBoolean</span><span class="p">().</span><span class="nx">toBoolean</span><span class="p">(),</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;minPrice&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isFloat</span><span class="p">({</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}).</span><span class="nx">toFloat</span><span class="p">(),</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;maxPrice&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isFloat</span><span class="p">({</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}).</span><span class="nx">toFloat</span><span class="p">()</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">];</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">productCreateRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">isString</span><span class="p">().</span><span class="nx">trim</span><span class="p">().</span><span class="nx">notEmpty</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;name requerit&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;sku&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isString</span><span class="p">().</span><span class="nx">trim</span><span class="p">(),</span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">).</span><span class="nx">isFloat</span><span class="p">({</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}).</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;price &gt;= 0&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;stock&#39;</span><span class="p">).</span><span class="nx">isInt</span><span class="p">({</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}).</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;stock &gt;= 0&#39;</span><span class="p">),</span>
<span class="linenos" data-linenos="15 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isBoolean</span><span class="p">()</span>
<span class="linenos" data-linenos="16 "></span><span class="p">];</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">productUpdateRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">isString</span><span class="p">().</span><span class="nx">notEmpty</span><span class="p">(),</span>
<span class="linenos" data-linenos="20 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isString</span><span class="p">().</span><span class="nx">trim</span><span class="p">().</span><span class="nx">notEmpty</span><span class="p">(),</span>
<span class="linenos" data-linenos="21 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;sku&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isString</span><span class="p">().</span><span class="nx">trim</span><span class="p">(),</span>
<span class="linenos" data-linenos="22 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isFloat</span><span class="p">({</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}),</span>
<span class="linenos" data-linenos="23 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;stock&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isInt</span><span class="p">({</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}),</span>
<span class="linenos" data-linenos="24 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">).</span><span class="nx">optional</span><span class="p">().</span><span class="nx">isBoolean</span><span class="p">()</span>
<span class="linenos" data-linenos="25 "></span><span class="p">];</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">productStockRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="28 "></span><span class="w">  </span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">isString</span><span class="p">().</span><span class="nx">notEmpty</span><span class="p">(),</span>
<span class="linenos" data-linenos="29 "></span><span class="w">  </span><span class="nx">body</span><span class="p">(</span><span class="s1">&#39;delta&#39;</span><span class="p">).</span><span class="nx">isInt</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s1">&#39;delta integer (positiu o negatiu)&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="30 "></span><span class="p">];</span>
</code></pre></div></p>
<blockquote>
<p>💡 <strong>Consell didàctic:</strong> tracteu la <strong>validació</strong> com una “porta d’entrada” a la API. Tot passa per ací.</p>
</blockquote>
<h3 id="6-rutes-i-crud-en-memoria">🔗 6. Rutes i CRUD en memòria<a class="headerlink" href="#6-rutes-i-crud-en-memoria" title="Permanent link">&para;</a></h3>
<p><strong><code>src/routes/products.routes.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Router</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../controllers/products.controller.memory.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">listQueryRules</span><span class="p">,</span><span class="w"> </span><span class="nx">productCreateRules</span><span class="p">,</span><span class="w"> </span><span class="nx">productStockRules</span><span class="p">,</span><span class="w"> </span><span class="nx">productUpdateRules</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../validation/products.rules.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validationResult</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express-validator&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Router</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rules</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="p">...</span><span class="nx">rules</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">422</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">errors</span><span class="o">:</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">array</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="nx">next</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">];</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">listQueryRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">getById</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">productCreateRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">create</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">productUpdateRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;/:id/stock&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">productStockRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">adjustStock</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span><span class="nx">router</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">remove</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</code></pre></div></p>
<p><strong><code>src/controllers/products.controller.memory.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// Almacenament en memòria (per a aprendre el flux)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kd">let</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kd">let</span><span class="w"> </span><span class="nx">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">list</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="p">,</span><span class="w"> </span><span class="nx">minPrice</span><span class="p">,</span><span class="w"> </span><span class="nx">maxPrice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">PRODUCTS</span><span class="p">];</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">needle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">q</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">needle</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">sku</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">needle</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;boolean&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">active</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">active</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">minPrice</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">minPrice</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">maxPrice</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">maxPrice</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getById</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="23 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="24 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="linenos" data-linenos="25 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="26 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="28 "></span><span class="p">}</span>
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">create</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="31 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="32 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="linenos" data-linenos="33 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sku</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">sku</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">sku</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;SKU duplicat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="34 "></span>
<span class="linenos" data-linenos="35 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
<span class="linenos" data-linenos="36 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">_id</span><span class="o">++</span><span class="p">),</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">price</span><span class="p">),</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">stock</span><span class="p">),</span><span class="w"> </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">(</span><span class="nx">active</span><span class="p">),</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="nx">now</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="p">};</span>
<span class="linenos" data-linenos="37 "></span><span class="w">    </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">created</span><span class="p">);</span>
<span class="linenos" data-linenos="38 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">201</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">created</span><span class="p">);</span>
<span class="linenos" data-linenos="39 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="40 "></span><span class="p">}</span>
<span class="linenos" data-linenos="41 "></span>
<span class="linenos" data-linenos="42 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="43 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="44 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="linenos" data-linenos="45 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="46 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
<span class="linenos" data-linenos="47 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">sku</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">stock</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">active</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">{};</span>
<span class="linenos" data-linenos="48 "></span>
<span class="linenos" data-linenos="49 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sku</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">sku</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">sku</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">sku</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">sku</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;SKU duplicat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="50 "></span>
<span class="linenos" data-linenos="51 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">prev</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">price</span><span class="p">),</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">stock</span><span class="p">),</span><span class="w"> </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">(</span><span class="nx">active</span><span class="p">),</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="linenos" data-linenos="52 "></span><span class="w">    </span><span class="nx">PRODUCTS</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">updated</span><span class="p">;</span>
<span class="linenos" data-linenos="53 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">updated</span><span class="p">);</span>
<span class="linenos" data-linenos="54 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="55 "></span><span class="p">}</span>
<span class="linenos" data-linenos="56 "></span>
<span class="linenos" data-linenos="57 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">adjustStock</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="58 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="59 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="linenos" data-linenos="60 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="61 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">delta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="linenos" data-linenos="62 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
<span class="linenos" data-linenos="63 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">prev</span><span class="p">.</span><span class="nx">stock</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">delta</span><span class="p">));</span>
<span class="linenos" data-linenos="64 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">prev</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="nx">newStock</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="linenos" data-linenos="65 "></span><span class="w">    </span><span class="nx">PRODUCTS</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">updated</span><span class="p">;</span>
<span class="linenos" data-linenos="66 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">updated</span><span class="p">);</span>
<span class="linenos" data-linenos="67 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="68 "></span><span class="p">}</span>
<span class="linenos" data-linenos="69 "></span>
<span class="linenos" data-linenos="70 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">remove</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="71 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="72 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="linenos" data-linenos="73 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="74 "></span><span class="w">    </span><span class="nx">PRODUCTS</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="linenos" data-linenos="75 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">204</span><span class="p">).</span><span class="nx">send</span><span class="p">();</span>
<span class="linenos" data-linenos="76 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="77 "></span><span class="p">}</span>
</code></pre></div></p>
<h3 id="7-proves-amb-postman-curl">🔍 7. Proves amb Postman / curl<a class="headerlink" href="#7-proves-amb-postman-curl" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Arranca el servidor</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>npm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div></p>
</li>
<li>
<p><strong>Crea un producte</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/v1/products<span class="w">      </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w">      </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Tassa ceràmica&quot;,&quot;sku&quot;:&quot;TAS-001&quot;,&quot;price&quot;:4.5,&quot;stock&quot;:20}&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Llista productes</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>curl<span class="w"> </span>http://localhost:3000/api/v1/products
</code></pre></div></p>
</li>
<li>
<p><strong>Obté per ID</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>curl<span class="w"> </span>http://localhost:3000/api/v1/products/1
</code></pre></div></p>
</li>
<li>
<p><strong>Actualitza</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span>http://localhost:3000/api/v1/products/1<span class="w">      </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w">      </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;price&quot;:4.9,&quot;stock&quot;:30}&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Ajusta stock</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>http://localhost:3000/api/v1/products/1/stock<span class="w">      </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w">      </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;delta&quot;: -2}&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Elimina</strong>:
   <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:3000/api/v1/products/1
</code></pre></div></p>
</li>
</ol>
<h3 id="8-proves-des-del-client-javascript-fetch">🧪 8. Proves des del client (JavaScript <code>fetch()</code>)<a class="headerlink" href="#8-proves-des-del-client-javascript-fetch" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Pots provar-ho des de la consola del navegador o en un fitxer <code>.html</code> senzill amb <code>&lt;script type="module"&gt;</code>.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://localhost:3000/api/v1/products&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="c1">// Crear</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">API</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Cafè 1kg&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;CAF-1000&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">12.5</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span><span class="w"> </span><span class="p">})</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Creat:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">created</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="c1">// Llistar</span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">API</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Llista:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="w">  </span><span class="c1">// Obtenir per ID</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">created</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Un:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">one</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="w">  </span><span class="c1">// Actualitzar</span>
<span class="linenos" data-linenos="21 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">created</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="24 "></span><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">13.2</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="w"> </span><span class="p">})</span>
<span class="linenos" data-linenos="25 "></span><span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="26 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Actualitzat:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updated</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span><span class="w">  </span><span class="c1">// Ajustar stock</span>
<span class="linenos" data-linenos="29 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">stocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">created</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/stock`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="30 "></span><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;PATCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="31 "></span><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="32 "></span><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">delta</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">5</span><span class="w"> </span><span class="p">})</span>
<span class="linenos" data-linenos="33 "></span><span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="34 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Stock:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">stocked</span><span class="p">);</span>
<span class="linenos" data-linenos="35 "></span>
<span class="linenos" data-linenos="36 "></span><span class="w">  </span><span class="c1">// Eliminar</span>
<span class="linenos" data-linenos="37 "></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">delRes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">created</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;DELETE&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="38 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Eliminat, status =&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">delRes</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="linenos" data-linenos="39 "></span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="9-extres-utils">🌐↔️🌐 9. Extres útils<a class="headerlink" href="#9-extres-utils" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>CORS</strong>: si tens un frontend en un altre port (p. ex. Vite a <code>5173</code>), CORS ja està habilitat globalment amb <code>app.use(cors())</code>. Pots restringir l’origen si cal:
  <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">({</span><span class="w"> </span><span class="nx">origin</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;http://localhost:5173&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">}));</span>
</code></pre></div></li>
<li><strong>Límit de mida del body</strong> (per evitar abusos):
  <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;100kb&#39;</span><span class="w"> </span><span class="p">}));</span>
</code></pre></div></li>
<li><strong>Logs</strong>: <code>morgan('dev')</code> és ideal en dev. En prod, millor logs estructurats (p. ex. pino).</li>
</ul>
<h3 id="10-exercicis-per-entregar">📝 10. Exercicis (per entregar)<a class="headerlink" href="#10-exercicis-per-entregar" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Paginació i ordenació</strong> a <code>GET /products</code> (<code>?page=1&amp;limit=10&amp;sort=price,-name</code>).</li>
<li><strong>Filtre per rang de stock</strong> (<code>stockMin</code>, <code>stockMax</code>).</li>
<li><strong>Camp nou <code>category</code></strong> i filtre <code>?category=begudes</code>.</li>
<li><strong>Endpoint <code>GET /products/export.csv</code></strong> que retorne un CSV dels productes.</li>
<li><strong>Validacions extra</strong> (nom mínim 3 caràcters, <code>sku</code> regex <code>[A-Z0-9-]+</code>).</li>
</ol>
<blockquote>
<p>💡 Avaluació formativa: valorar codi net, ús correcte d’HTTP, validacions, i que no es trenque davant d’inputs erronis.</p>
</blockquote>
<h3 id="11-troubleshooting">🐞🛠️ 11. Troubleshooting<a class="headerlink" href="#11-troubleshooting" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>Error [ERR_MODULE_NOT_FOUND]</code></strong> → comprova rutes d’import i extensions <code>.js</code> en imports locals.</li>
<li><strong><code>Unexpected token 'export'</code></strong> → falta <code>"type": "module"</code> al <code>package.json</code>.</li>
<li><strong>No parseja JSON</strong> → assegura <code>app.use(express.json())</code> i header <code>Content-Type: application/json</code> a les peticions.</li>
<li><strong>CORS</strong> → si el navegador bloqueja, comprova <code>app.use(cors())</code> i l’o</li>
</ul>
<h2 id="sa-63-connexio-a-mongodb-mongoose-i-crud-persistent">SA 6.3 Connexió a MongoDB (Mongoose) i CRUD persistent<a class="headerlink" href="#sa-63-connexio-a-mongodb-mongoose-i-crud-persistent" title="Permanent link">&para;</a></h2>
<p>En aquesta secció convertirem l’API en memòria de la Secció 2 en una <strong>API amb persistència real</strong> utilitzant <strong>MongoDB</strong> i <strong>Mongoose</strong>. Mantindrem els <strong>endpoints</strong> i el <strong>contracte</strong> (mateixa interfície pública), canviant només la <strong>capa de dades</strong>.</p>
<h3 id="1-requisits-i-configuracio">🧰 1. Requisits i configuració<a class="headerlink" href="#1-requisits-i-configuracio" title="Permanent link">&para;</a></h3>
<h4 id="installacio-de-dependencies">Instal·lació de dependències<a class="headerlink" href="#installacio-de-dependencies" title="Permanent link">&para;</a></h4>
<p>Si no ho has fet encara:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>npm<span class="w"> </span>i<span class="w"> </span>mongoose<span class="w"> </span>dotenv
</code></pre></div></p>
<h4 id="variables-dentorn-env">Variables d’entorn <code>.env</code><a class="headerlink" href="#variables-dentorn-env" title="Permanent link">&para;</a></h4>
<p>Crea o edita <code>.env</code> a l’arrel del projecte:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>PORT=3000
<span class="linenos" data-linenos="2 "></span>STORE=mongo
<span class="linenos" data-linenos="3 "></span>MONGO_URI=mongodb://127.0.0.1:27017/inventari
</code></pre></div></p>
<blockquote>
<p>💡 Si utilitzes <strong>MongoDB Atlas</strong>, reemplaça <code>MONGO_URI</code> pel connection string del teu cluster.</p>
</blockquote>
<h3 id="2-connexio-a-mongodb">🔌 2. Connexió a MongoDB<a class="headerlink" href="#2-connexio-a-mongodb" title="Permanent link">&para;</a></h3>
<p><strong><code>src/lib/db.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">mongoose</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;mongoose&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">connectDB</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;strictQuery&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">dbName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;inventari&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="6 "></span><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;MongoDB connectada&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div></p>
<p><strong><code>src/server.js</code></strong> (arrencada amb connexió quan <code>STORE=mongo</code>)
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;dotenv/config&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./app.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">connectDB</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./lib/db.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">STORE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">STORE</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;memory&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">STORE</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;mongo&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_URI</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">URI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Falta MONGO_URI en .env&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span><span class="w">        </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">connectDB</span><span class="p">(</span><span class="nx">URI</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="w">    </span><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`API Inventari escoltant a http://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> (store=</span><span class="si">${</span><span class="nx">STORE</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span><span class="w">    </span><span class="p">});</span>
<span class="linenos" data-linenos="21 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error arrencant:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="p">})();</span>
</code></pre></div></p>
<h3 id="3-model-de-dades-amb-mongoose">🔌 3. Model de dades amb Mongoose<a class="headerlink" href="#3-model-de-dades-amb-mongoose" title="Permanent link">&para;</a></h3>
<p><strong><code>src/models/product.model.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">mongoose</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;mongoose&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">productSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">trim</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">minlength</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nx">sku</span><span class="o">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">sparse</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">trim</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="sr">/^[A-Z0-9-]+$/</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nx">price</span><span class="o">:</span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nx">stock</span><span class="o">:</span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="nx">active</span><span class="o">:</span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">timestamps</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="c1">// Índex útil per a cerques</span>
<span class="linenos" data-linenos="12 "></span><span class="nx">productSchema</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">productSchema</span><span class="p">);</span>
</code></pre></div></p>
<blockquote>
<p>🧠 <strong>Notes</strong><br />
- <code>unique: true</code> a <code>sku</code> crea un índex únic (evita duplicats).<br />
- <code>sparse: true</code> permet documents sense <code>sku</code> sense violar l’únic.<br />
- <code>match</code> valida el format: lletres majúscules, digits i guions.<br />
- <code>timestamps: true</code> afegeix <code>createdAt</code> i <code>updatedAt</code> automàticament.</p>
</blockquote>
<h3 id="4-reescriure-controladors-per-a-mongo">✍️ 4. Reescriure controladors per a Mongo<a class="headerlink" href="#4-reescriure-controladors-per-a-mongo" title="Permanent link">&para;</a></h3>
<p><strong><code>src/controllers/products.controller.mongo.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../models/product.model.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">list</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="p">,</span><span class="w"> </span><span class="nx">minPrice</span><span class="p">,</span><span class="w"> </span><span class="nx">maxPrice</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;boolean&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">filter</span><span class="p">.</span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">active</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">minPrice</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">maxPrice</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="nx">filter</span><span class="p">.</span><span class="nx">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">minPrice</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">filter</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">$gte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">minPrice</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">maxPrice</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">filter</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">$lte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxPrice</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">filter</span><span class="p">.</span><span class="nx">$or</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="16 "></span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$regex</span><span class="o">:</span><span class="w"> </span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="nx">$options</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;i&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="17 "></span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">sku</span><span class="o">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$regex</span><span class="o">:</span><span class="w"> </span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="nx">$options</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;i&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="p">];</span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">filter</span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}).</span><span class="nx">lean</span><span class="p">();</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getById</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="27 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="28 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">lean</span><span class="p">();</span>
<span class="linenos" data-linenos="29 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="30 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
<span class="linenos" data-linenos="31 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="32 "></span><span class="p">}</span>
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">create</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="35 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="36 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="linenos" data-linenos="37 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="38 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">201</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">created</span><span class="p">);</span>
<span class="linenos" data-linenos="39 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="40 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="o">?</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">11000</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;SKU duplicat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="41 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ValidationError&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">422</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="42 "></span><span class="w">    </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="linenos" data-linenos="43 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="44 "></span><span class="p">}</span>
<span class="linenos" data-linenos="45 "></span>
<span class="linenos" data-linenos="46 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="47 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="48 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
<span class="linenos" data-linenos="49 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">{};</span>
<span class="linenos" data-linenos="50 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">findByIdAndUpdate</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ow">new</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">runValidators</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}).</span><span class="nx">lean</span><span class="p">();</span>
<span class="linenos" data-linenos="51 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">updated</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="52 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">updated</span><span class="p">);</span>
<span class="linenos" data-linenos="53 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="54 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="o">?</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">11000</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;SKU duplicat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="55 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ValidationError&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">422</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="56 "></span><span class="w">    </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="linenos" data-linenos="57 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="58 "></span><span class="p">}</span>
<span class="linenos" data-linenos="59 "></span>
<span class="linenos" data-linenos="60 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">adjustStock</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="61 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="62 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
<span class="linenos" data-linenos="63 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">delta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="linenos" data-linenos="64 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
<span class="linenos" data-linenos="65 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="66 "></span><span class="w">    </span><span class="nx">product</span><span class="p">.</span><span class="nx">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">stock</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">delta</span><span class="p">));</span>
<span class="linenos" data-linenos="67 "></span><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
<span class="linenos" data-linenos="68 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
<span class="linenos" data-linenos="69 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="70 "></span><span class="p">}</span>
<span class="linenos" data-linenos="71 "></span>
<span class="linenos" data-linenos="72 "></span><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">remove</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="73 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="74 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
<span class="linenos" data-linenos="75 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">findByIdAndDelete</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">lean</span><span class="p">();</span>
<span class="linenos" data-linenos="76 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">out</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No trobat&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="77 "></span><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">204</span><span class="p">).</span><span class="nx">send</span><span class="p">();</span>
<span class="linenos" data-linenos="78 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="79 "></span><span class="p">}</span>
</code></pre></div></p>
<p><strong><code>src/routes/products.routes.mongo.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Router</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../controllers/products.controller.mongo.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">listQueryRules</span><span class="p">,</span><span class="w"> </span><span class="nx">productCreateRules</span><span class="p">,</span><span class="w"> </span><span class="nx">productStockRules</span><span class="p">,</span><span class="w"> </span><span class="nx">productUpdateRules</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../validation/products.rules.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validationResult</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express-validator&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Router</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rules</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="p">...</span><span class="nx">rules</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">422</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">errors</span><span class="o">:</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">array</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="nx">next</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">];</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">listQueryRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">getById</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">productCreateRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">create</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">productUpdateRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;/:id/stock&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">productStockRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">adjustStock</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span><span class="nx">router</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">remove</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</code></pre></div></p>
<p><strong><code>src/app.js</code></strong> (selecció de router per <code>STORE</code>)
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="nx">morgan</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;morgan&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="nx">helmet</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;helmet&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">import</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;cors&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">import</span><span class="w"> </span><span class="nx">productsRouterMemory</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./routes/products.routes.js&#39;</span><span class="p">;</span><span class="w">       </span><span class="c1">// memòria</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">import</span><span class="w"> </span><span class="nx">productsRouterMongo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./routes/products.routes.mongo.js&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Mongo</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">import</span><span class="w"> </span><span class="nx">notFound</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middlewares/not-found.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="k">import</span><span class="w"> </span><span class="nx">errorHandler</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middlewares/error-handler.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">helmet</span><span class="p">());</span>
<span class="linenos" data-linenos="14 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
<span class="linenos" data-linenos="15 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="linenos" data-linenos="16 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">STORE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">STORE</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;memory&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">productsRouter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">STORE</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;mongo&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">productsRouterMongo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">productsRouterMemory</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api/v1/products&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">productsRouter</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">notFound</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">);</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">app</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="5-seed-de-dades">🌱 5. Seed de dades<a class="headerlink" href="#5-seed-de-dades" title="Permanent link">&para;</a></h3>
<p><strong><code>scripts/seed.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;dotenv/config&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">connectDB</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../src/lib/db.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Product</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../src/models/product.model.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_URI</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">URI</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Defineix MONGO_URI en .env&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">connectDB</span><span class="p">(</span><span class="nx">URI</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">Product</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">([</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Cafè gra 1kg&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;CAF-1000&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">12.5</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Te verd 200g&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TE-0200&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">6.2</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="mf">120</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Llet ametla 1L&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sku</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;LLE-ALM-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">1.95</span><span class="p">,</span><span class="w"> </span><span class="nx">stock</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="p">]);</span>
<span class="linenos" data-linenos="17 "></span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Seed complet!&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="20 "></span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="23 "></span><span class="p">})();</span>
</code></pre></div></p>
<p>Executa:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>npm<span class="w"> </span>run<span class="w"> </span>seed
</code></pre></div></p>
<h3 id="7-proves-rapides">🧪 7. Proves ràpides<a class="headerlink" href="#7-proves-rapides" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># Crear</span>
<span class="linenos" data-linenos=" 2 "></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/v1/products<span class="w">   </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w">   </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Tassa ceràmica&quot;,&quot;sku&quot;:&quot;TAS-001&quot;,&quot;price&quot;:4.5,&quot;stock&quot;:20}&#39;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1"># Llistar (amb filtre)</span>
<span class="linenos" data-linenos=" 5 "></span>curl<span class="w"> </span><span class="s2">&quot;http://localhost:3000/api/v1/products?q=tassa&amp;minPrice=3&amp;maxPrice=10&quot;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1"># Per ID (usa _id de Mongo)</span>
<span class="linenos" data-linenos=" 8 "></span>curl<span class="w"> </span>http://localhost:3000/api/v1/products/&lt;id&gt;
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># Actualitzar</span>
<span class="linenos" data-linenos="11 "></span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span>http://localhost:3000/api/v1/products/&lt;id&gt;<span class="w">   </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w">   </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;price&quot;:4.9,&quot;stock&quot;:30}&#39;</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="c1"># Ajust stock</span>
<span class="linenos" data-linenos="14 "></span>curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>http://localhost:3000/api/v1/products/&lt;id&gt;/stock<span class="w">   </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w">   </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;delta&quot;: -2}&#39;</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># Eliminar</span>
<span class="linenos" data-linenos="17 "></span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:3000/api/v1/products/&lt;id&gt;
</code></pre></div>
<h3 id="8-bones-practiques-de-persistencia">💡 8. Bones pràctiques de persistència<a class="headerlink" href="#8-bones-practiques-de-persistencia" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Índexs</strong>: assegura índex únic per a <code>sku</code> i text per a cerques.  </li>
<li><strong>Validació a BD</strong> (Mongoose) + <strong>validació a API</strong> (express-validator).  </li>
<li><strong>Lean queries</strong> (<code>.lean()</code>) per rendiment quan no necessites documents mutables.  </li>
<li><strong>Paginació</strong>: evita retornar milers de documents, usa <code>limit</code>/<code>skip</code>.  </li>
<li><strong>DTOs</strong>: controla camps retornats (<code>_id</code>, <code>__v</code>, etc.).  </li>
<li><strong>Errors Mongo</strong>: captura <code>code 11000</code> (duplicats) i <code>ValidationError</code>.</li>
</ul>
<h3 id="9-exercicis-per-entregar">📝 9. Exercicis (per entregar)<a class="headerlink" href="#9-exercicis-per-entregar" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Paginació</strong>: <code>GET /products?page=1&amp;limit=10</code> amb metadades (<code>total</code>, <code>pages</code>, <code>page</code>).</li>
<li><strong>Ordenació</strong>: afegir <code>?sort=price,-name</code>.</li>
<li><strong>Camp nou <code>category</code></strong> amb índex i filtre <code>?category=...</code>.</li>
<li><strong>Esquema amb <code>minlength</code>/<code>maxlength</code></strong> i proves de validació 422.</li>
<li><strong>Endpoint <code>GET /products/export.csv</code></strong> generant CSV des de Mongo.</li>
<li><strong>Soft delete</strong>: afegeix <code>deletedAt</code> i filtra per defecte elements no eliminats.</li>
</ol>
<h3 id="10-troubleshooting">🐞🛠️ 10. Troubleshooting<a class="headerlink" href="#10-troubleshooting" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>MongoServerError: E11000 duplicate key error</code></strong> → <code>sku</code> duplicat. Respon <code>409</code>.</li>
<li><strong><code>CastError: Cast to ObjectId failed</code></strong> → ID no vàlid. Valida el format abans de la query.</li>
<li><strong><code>ValidationError</code></strong> → algun camp no compleix l’esquema. Respon <code>422</code> amb el missatge.</li>
<li><strong>Sense connexió</strong> → revisa <code>MONGO_URI</code>, firewall, i que el servei de Mongo estiga actiu.</li>
</ul>
<h2 id="sa-64-documentacio-amb-swagger-openapi">SA 6.4  Documentació amb Swagger / OpenAPI<a class="headerlink" href="#sa-64-documentacio-amb-swagger-openapi" title="Permanent link">&para;</a></h2>
<p>En aquesta secció afegirem <strong>documentació formal</strong> a la nostra API amb <strong>OpenAPI 3.0</strong> i la servirem amb <strong>Swagger UI</strong> perquè siga navegable i executable des del navegador.</p>
<h3 id="1-arxiu-openapijson-basic">🧱 1. Arxiu <code>openapi.json</code> bàsic<a class="headerlink" href="#1-arxiu-openapijson-basic" title="Permanent link">&para;</a></h3>
<p>A l’arrel del projecte crea <code>openapi.json</code>. A continuació tens una plantilla completa per al nostre recurs <strong>Producte</strong> amb esquemes, validacions i exemples.</p>
<blockquote>
<p>Pots copiar-ho tal qual i adaptar camps/operacions segons el teu projecte.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="  1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="  2 "></span><span class="w">  </span><span class="nt">&quot;openapi&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3.0.3&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="  3 "></span><span class="w">  </span><span class="nt">&quot;info&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="  4 "></span><span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;API Inventari 2DAW&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="  5 "></span><span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="  6 "></span><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;API REST de Productes/Inventari documentada amb OpenAPI 3.0&quot;</span>
<span class="linenos" data-linenos="  7 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="  8 "></span><span class="w">  </span><span class="nt">&quot;servers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="  9 "></span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:3000&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dev local&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 10 "></span><span class="w">  </span><span class="p">],</span>
<span class="linenos" data-linenos=" 11 "></span><span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 12 "></span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gestió del catàleg de productes&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 13 "></span><span class="w">  </span><span class="p">],</span>
<span class="linenos" data-linenos=" 14 "></span><span class="w">  </span><span class="nt">&quot;paths&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 15 "></span><span class="w">    </span><span class="nt">&quot;/api/v1/products&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 16 "></span><span class="w">      </span><span class="nt">&quot;get&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 17 "></span><span class="w">        </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Products&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos=" 18 "></span><span class="w">        </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Llistar productes&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 19 "></span><span class="w">        </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 20 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Text de cerca a name o sku&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 21 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 22 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;minPrice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 23 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;maxPrice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 24 "></span><span class="w">        </span><span class="p">],</span>
<span class="linenos" data-linenos=" 25 "></span><span class="w">        </span><span class="nt">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 26 "></span><span class="w">          </span><span class="nt">&quot;200&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 27 "></span><span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Llista de productes&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 28 "></span><span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 29 "></span><span class="w">              </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 30 "></span><span class="w">                </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/Product&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 31 "></span><span class="w">              </span><span class="p">}</span>
<span class="linenos" data-linenos=" 32 "></span><span class="w">            </span><span class="p">}</span>
<span class="linenos" data-linenos=" 33 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos=" 34 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos=" 35 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos=" 36 "></span><span class="w">      </span><span class="nt">&quot;post&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 37 "></span><span class="w">        </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Products&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos=" 38 "></span><span class="w">        </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Crear producte&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 39 "></span><span class="w">        </span><span class="nt">&quot;requestBody&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 40 "></span><span class="w">          </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos=" 41 "></span><span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 42 "></span><span class="w">            </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 43 "></span><span class="w">              </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/ProductCreate&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 44 "></span><span class="w">              </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 45 "></span><span class="w">                </span><span class="nt">&quot;basic&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 46 "></span><span class="w">                  </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Exemple bàsic&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 47 "></span><span class="w">                  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tassa ceràmica&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;sku&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TAS-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;stock&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 48 "></span><span class="w">                </span><span class="p">}</span>
<span class="linenos" data-linenos=" 49 "></span><span class="w">              </span><span class="p">}</span>
<span class="linenos" data-linenos=" 50 "></span><span class="w">            </span><span class="p">}</span>
<span class="linenos" data-linenos=" 51 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos=" 52 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos=" 53 "></span><span class="w">        </span><span class="nt">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 54 "></span><span class="w">          </span><span class="nt">&quot;201&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Creat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/Product&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 55 "></span><span class="w">          </span><span class="nt">&quot;409&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SKU duplicat&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 56 "></span><span class="w">          </span><span class="nt">&quot;422&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Validació incorrecta&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 57 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos=" 58 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos=" 59 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos=" 60 "></span><span class="w">    </span><span class="nt">&quot;/api/v1/products/{id}&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 61 "></span><span class="w">      </span><span class="nt">&quot;get&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 62 "></span><span class="w">        </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Products&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos=" 63 "></span><span class="w">        </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Obtenir producte per ID&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 64 "></span><span class="w">        </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 65 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 66 "></span><span class="w">        </span><span class="p">],</span>
<span class="linenos" data-linenos=" 67 "></span><span class="w">        </span><span class="nt">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 68 "></span><span class="w">          </span><span class="nt">&quot;200&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/Product&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 69 "></span><span class="w">          </span><span class="nt">&quot;404&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;No trobat&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 70 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos=" 71 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos=" 72 "></span><span class="w">      </span><span class="nt">&quot;put&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 73 "></span><span class="w">        </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Products&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos=" 74 "></span><span class="w">        </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Actualitzar producte&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 75 "></span><span class="w">        </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 76 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 77 "></span><span class="w">        </span><span class="p">],</span>
<span class="linenos" data-linenos=" 78 "></span><span class="w">        </span><span class="nt">&quot;requestBody&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 79 "></span><span class="w">          </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos=" 80 "></span><span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/ProductUpdate&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 81 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos=" 82 "></span><span class="w">        </span><span class="nt">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 83 "></span><span class="w">          </span><span class="nt">&quot;200&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Actualitzat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/Product&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 84 "></span><span class="w">          </span><span class="nt">&quot;404&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;No trobat&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 85 "></span><span class="w">          </span><span class="nt">&quot;409&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SKU duplicat&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 86 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos=" 87 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos=" 88 "></span><span class="w">      </span><span class="nt">&quot;delete&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 89 "></span><span class="w">        </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Products&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos=" 90 "></span><span class="w">        </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Eliminar producte&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 91 "></span><span class="w">        </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 92 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 93 "></span><span class="w">        </span><span class="p">],</span>
<span class="linenos" data-linenos=" 94 "></span><span class="w">        </span><span class="nt">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 95 "></span><span class="w">          </span><span class="nt">&quot;204&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Eliminat&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 96 "></span><span class="w">          </span><span class="nt">&quot;404&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;No trobat&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 97 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos=" 98 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos=" 99 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="100 "></span><span class="w">    </span><span class="nt">&quot;/api/v1/products/{id}/stock&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="101 "></span><span class="w">      </span><span class="nt">&quot;patch&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="102 "></span><span class="w">        </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Products&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos="103 "></span><span class="w">        </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ajustar stock d&#39;un producte&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="104 "></span><span class="w">        </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="105 "></span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="106 "></span><span class="w">        </span><span class="p">],</span>
<span class="linenos" data-linenos="107 "></span><span class="w">        </span><span class="nt">&quot;requestBody&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="108 "></span><span class="w">          </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos="109 "></span><span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="110 "></span><span class="w">            </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/StockPatch&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="111 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos="112 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="113 "></span><span class="w">        </span><span class="nt">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="114 "></span><span class="w">          </span><span class="nt">&quot;200&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/Product&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="115 "></span><span class="w">          </span><span class="nt">&quot;404&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;No trobat&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="116 "></span><span class="w">          </span><span class="nt">&quot;422&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Validació incorrecta&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="117 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="118 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="119 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="120 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="121 "></span><span class="w">  </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="122 "></span><span class="w">    </span><span class="nt">&quot;schemas&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="123 "></span><span class="w">      </span><span class="nt">&quot;Product&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="124 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="125 "></span><span class="w">        </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="126 "></span><span class="w">          </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w">       </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ID intern (o _id de Mongo)&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="127 "></span><span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="128 "></span><span class="w">          </span><span class="nt">&quot;sku&quot;</span><span class="p">:</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^[A-Z0-9-]+$&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="129 "></span><span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="130 "></span><span class="w">          </span><span class="nt">&quot;stock&quot;</span><span class="p">:</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="131 "></span><span class="w">          </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w">   </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="132 "></span><span class="w">          </span><span class="nt">&quot;createdAt&quot;</span><span class="p">:{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;date-time&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="133 "></span><span class="w">          </span><span class="nt">&quot;updatedAt&quot;</span><span class="p">:{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;date-time&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="134 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="135 "></span><span class="w">        </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">]</span>
<span class="linenos" data-linenos="136 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="137 "></span><span class="w">      </span><span class="nt">&quot;ProductCreate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="138 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="139 "></span><span class="w">        </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="140 "></span><span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w">   </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="141 "></span><span class="w">          </span><span class="nt">&quot;sku&quot;</span><span class="p">:</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^[A-Z0-9-]+$&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="142 "></span><span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="143 "></span><span class="w">          </span><span class="nt">&quot;stock&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="144 "></span><span class="w">          </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="145 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="146 "></span><span class="w">        </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stock&quot;</span><span class="p">]</span>
<span class="linenos" data-linenos="147 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="148 "></span><span class="w">      </span><span class="nt">&quot;ProductUpdate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="149 "></span><span class="w">        </span><span class="nt">&quot;allOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/ProductCreate&quot;</span><span class="w"> </span><span class="p">}]</span>
<span class="linenos" data-linenos="150 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="151 "></span><span class="w">      </span><span class="nt">&quot;StockPatch&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="152 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="153 "></span><span class="w">        </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;delta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pot ser positiu o negatiu&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="154 "></span><span class="w">        </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span>
<span class="linenos" data-linenos="155 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="156 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="157 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="158 "></span><span class="p">}</span>
</code></pre></div>
<blockquote>
<p>🔎 <strong>Consell</strong>: guarda aquest fitxer a l’arrel del projecte perquè siga fàcil de trobar i versionar.</p>
</blockquote>
<h3 id="2-servir-swagger-ui">⚙️ 2. Servir Swagger UI<a class="headerlink" href="#2-servir-swagger-ui" title="Permanent link">&para;</a></h3>
<p>Afegim Swagger UI a <code>app.js</code> (després de configurar les rutes).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">swaggerUi</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;swagger-ui-express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">readFileSync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:fs&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">import</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:path&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">fileURLToPath</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:url&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">__filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileURLToPath</span><span class="p">(</span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">__dirname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// ...</span>
<span class="linenos" data-linenos="10 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">openapiPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;openapi.json&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">openapi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">openapiPath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="12 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api-docs&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">serve</span><span class="p">,</span><span class="w"> </span><span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">openapi</span><span class="p">));</span>
</code></pre></div>
<p>Ara obri: <strong>http://localhost:3000/api-docs</strong></p>
<h3 id="3-afegir-exemples-i-respostes-detallades">🧠 3. Afegir exemples i respostes detallades<a class="headerlink" href="#3-afegir-exemples-i-respostes-detallades" title="Permanent link">&para;</a></h3>
<p>Els <strong>exemples</strong> ajuden l’alumnat a saber què enviar i què esperar:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">&quot;requestBody&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/ProductCreate&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="nt">&quot;valid&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Cafè gra 1kg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;sku&quot;</span><span class="p">:</span><span class="s2">&quot;CAF-1000&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mf">12.5</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;stock&quot;</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">        </span><span class="nt">&quot;invalid&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-3</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;stock&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<p>També pots descriure <strong>errors</strong> amb esquemes (p. ex. per a 422):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">&quot;422&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Validació incorrecta&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;application/json&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">          </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="4-bones-practiques-de-documentacio">💡 4. Bones pràctiques de documentació<a class="headerlink" href="#4-bones-practiques-de-documentacio" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Mantín sincronitzat</strong> el que diu <code>openapi.json</code> amb la realitat del codi.</li>
<li><strong>Descripcions clares</strong>: explica què fa cada endpoint i quins casos d’ús té.</li>
<li><strong>Nomena</strong> correctament (recursos en plural, verbs en mètodes, <code>id</code> al path).</li>
<li><strong>Exemples</strong> reals i útils (no genèrics).</li>
<li><strong>Versiona</strong> l’API: <code>/api/v1/...</code> i reflecteix-ho a <code>servers</code>.</li>
<li><strong>DRY amb <code>components</code></strong>: posa esquemes reutilitzables allí.</li>
<li><strong>Respostes</strong>: documenta les principals (<code>200</code>, <code>201</code>, <code>204</code>, <code>400/404/409/422</code>, <code>500</code>).</li>
</ul>
<h3 id="5-exercicis-per-entregar">📝 5. Exercicis (per entregar)<a class="headerlink" href="#5-exercicis-per-entregar" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Completa <code>openapi.json</code></strong> amb:<br />
   a) Resposta <code>400</code> per <code>id</code> mal format.<br />
   b) <code>examples</code> detallats per <code>PUT</code> i <code>PATCH /stock</code>.<br />
   c) Descripció de paràmetres de filtrat a <code>GET /products</code>.</p>
</li>
<li>
<p><strong>Afig <code>category</code></strong> al <code>schema Product</code> i actualitza <code>ProductCreate</code> i <code>ProductUpdate</code>.</p>
</li>
<li>
<p><strong>Camps de resposta</strong>: crea un <code>schema Error</code> comú i reutilitza’l en respostes 4xx/5xx.</p>
</li>
<li>
<p><strong>Endpoint nou</strong>: documenta <code>GET /api/v1/products/export.csv</code> (tipus <code>text/csv</code>).</p>
</li>
<li>
<p><strong>Autenticació (bonus)</strong>: afegeix <code>securitySchemes</code> (Bearer JWT) i marca <code>POST/PUT/PATCH/DELETE</code> com a protegits.</p>
</li>
</ol>
<h3 id="6-troubleshooting-swagger">🐞🛠️ 6. Troubleshooting Swagger<a class="headerlink" href="#6-troubleshooting-swagger" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pantalla en blanc</strong> a <code>/api-docs</code> → JSON mal format (valida’l en un JSON linter).  </li>
<li><strong>No carrega <code>openapi.json</code></strong> → rutes relatives: comprova la ruta <code>path.join(__dirname, '..', 'openapi.json')</code>.  </li>
<li><strong>Errors CORS</strong> provant des de Swagger → assegura <code>app.use(cors())</code>.  </li>
<li><strong>Exemples no apareixen</strong> → han d’estar dins de <code>content -&gt; application/json -&gt; examples</code>.</li>
</ul>
<h3 id="7-swagger-automatic-amb-swagger-jsdoc">🐞🛠️ 7. Swagger automàtic amb swagger-jsdoc<a class="headerlink" href="#7-swagger-automatic-amb-swagger-jsdoc" title="Permanent link">&para;</a></h3>
<p>Anem també a mostrar com <strong>generar la documentació OpenAPI automàticament</strong> a partir de <strong>comentaris JSDoc</strong> en les rutes d’Express, utilitzant <strong>swagger-jsdoc</strong> + <strong>swagger-ui-express</strong>.</p>
<h4 id="installacio">🛠️ Instal·lació<a class="headerlink" href="#installacio" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>npm<span class="w"> </span>i<span class="w"> </span>swagger-jsdoc<span class="w"> </span>swagger-ui-express
</code></pre></div>
<h4 id="configuracio-base">🧱 Configuració base<a class="headerlink" href="#configuracio-base" title="Permanent link">&para;</a></h4>
<p><strong><code>src/swagger.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">swaggerJSDoc</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;swagger-jsdoc&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="nx">definition</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nx">openapi</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3.0.3&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;API Inventari 2DAW&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1.1.0&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Documentació automàtica des de JSDoc&#39;</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nx">servers</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="w"> </span><span class="p">}],</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="nx">apis</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;./src/routes/*.js&#39;</span><span class="p">],</span><span class="w"> </span><span class="c1">// fitxers amb comentaris JSDoc</span>
<span class="linenos" data-linenos="14 "></span><span class="p">};</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">swaggerSpec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">swaggerJSDoc</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</code></pre></div></p>
<p><strong><code>src/app.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">import</span><span class="w"> </span><span class="nx">swaggerUi</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;swagger-ui-express&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">swaggerSpec</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./swagger.js&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api-docs&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">serve</span><span class="p">,</span><span class="w"> </span><span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">swaggerSpec</span><span class="p">));</span>
</code></pre></div></p>
<h4 id="comentaris-jsdoc-a-les-rutes">🗂️ Comentaris JSDoc a les rutes<a class="headerlink" href="#comentaris-jsdoc-a-les-rutes" title="Permanent link">&para;</a></h4>
<p><strong><code>src/routes/products.routes.js</code></strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cm">/**</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cm"> * @openapi</span>
<span class="linenos" data-linenos=" 3 "></span><span class="cm"> * /api/v1/products:</span>
<span class="linenos" data-linenos=" 4 "></span><span class="cm"> *   get:</span>
<span class="linenos" data-linenos=" 5 "></span><span class="cm"> *     tags: [Products]</span>
<span class="linenos" data-linenos=" 6 "></span><span class="cm"> *     summary: Llistar productes</span>
<span class="linenos" data-linenos=" 7 "></span><span class="cm"> *     parameters:</span>
<span class="linenos" data-linenos=" 8 "></span><span class="cm"> *       - in: query</span>
<span class="linenos" data-linenos=" 9 "></span><span class="cm"> *         name: q</span>
<span class="linenos" data-linenos="10 "></span><span class="cm"> *         schema: { type: string }</span>
<span class="linenos" data-linenos="11 "></span><span class="cm"> *       - in: query</span>
<span class="linenos" data-linenos="12 "></span><span class="cm"> *         name: active</span>
<span class="linenos" data-linenos="13 "></span><span class="cm"> *         schema: { type: boolean }</span>
<span class="linenos" data-linenos="14 "></span><span class="cm"> *     responses:</span>
<span class="linenos" data-linenos="15 "></span><span class="cm"> *       200: { description: Llista de productes }</span>
<span class="linenos" data-linenos="16 "></span><span class="cm"> */</span>
<span class="linenos" data-linenos="17 "></span><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">listQueryRules</span><span class="p">),</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
</code></pre></div></p>
<h4 id="8-components-reutilitzables">🖥️ 8. Components reutilitzables<a class="headerlink" href="#8-components-reutilitzables" title="Permanent link">&para;</a></h4>
<p>Pots definir <strong>components</strong> (schemas) en <code>swaggerSpec</code> (via <code>options.definition.components = {...}</code>) o incloure’ls en un fitxer <code>.yml</code> separat i combinar-los amb <code>swagger-jsdoc</code>.</p>
<h4 id="9-bones-practiques">💡 9. Bones pràctiques<a class="headerlink" href="#9-bones-practiques" title="Permanent link">&para;</a></h4>
<ul>
<li>Posa <strong>tags</strong> per agrupar endpoints.</li>
<li>Escriu <strong>exemples</strong> a <code>requestBody</code> i <code>responses</code>.</li>
<li>Mantín el <strong>contracte</strong> sincronitzat. Si canvies una ruta, actualitza el JSDoc.</li>
<li>Valida amb un <strong>validator OpenAPI</strong> (ex. Swagger Editor) si afegeixes elements avançats.</li>
</ul>
<h4 id="10-enllac-a-la-ui">🔗 10. Enllaç a la UI<a class="headerlink" href="#10-enllac-a-la-ui" title="Permanent link">&para;</a></h4>
<p>Amb el servidor en marxa:<br />
<strong>http://localhost:3000/api-docs</strong></p>
<h2 id="sa-65-practiques-guiades-reptes-oberts-i-rubrica-davaluacio">SA 6.5 – Pràctiques guiades, reptes oberts i rúbrica d’avaluació<a class="headerlink" href="#sa-65-practiques-guiades-reptes-oberts-i-rubrica-davaluacio" title="Permanent link">&para;</a></h2>
<p>Aquesta secció recull una sèrie d’activitats perquè l’alumnat consolide els coneixements adquirits i demostre la seua competència en el desenvolupament d’APIs amb Node.js, Express, MongoDB i Swagger.</p>
<h3 id="1-practiques-guiades">🧪 1. Pràctiques guiades<a class="headerlink" href="#1-practiques-guiades" title="Permanent link">&para;</a></h3>
<h4 id="practica-1-afegir-paginacio-i-ordenacio">🧪 Pràctica 1 – Afegir paginació i ordenació<a class="headerlink" href="#practica-1-afegir-paginacio-i-ordenacio" title="Permanent link">&para;</a></h4>
<ul>
<li>Endpoint: <code>GET /api/v1/products</code></li>
<li>Objectiu: implementar <code>?page</code>, <code>?limit</code> i <code>?sort</code> (acceptant <code>price</code>, <code>name</code>, <code>-price</code>...).</li>
<li>Ex.: <code>GET /api/v1/products?page=2&amp;limit=5&amp;sort=-price</code></li>
</ul>
<p><strong>Criteris clau:</strong>
- Retornar metadades (<code>total</code>, <code>page</code>, <code>pages</code>, <code>limit</code>)
- Ordenació ascendent i descendent
- Validació d’entrada (<code>limit</code> &gt; 0, etc.)</p>
<h4 id="practica-2-exportacio-de-dades">🧪 Pràctica 2 – Exportació de dades<a class="headerlink" href="#practica-2-exportacio-de-dades" title="Permanent link">&para;</a></h4>
<ul>
<li>Endpoint: <code>GET /api/v1/products/export.csv</code></li>
<li>Objectiu: generar un fitxer CSV amb tots els productes (nom, sku, preu, stock, actiu).</li>
</ul>
<p><strong>Criteris clau:</strong>
- Capçalera <code>Content-Type: text/csv</code>
- Nom de fitxer amb data (<code>products-2025-10-15.csv</code>)
- Compatibilitat amb Excel / LibreOffice</p>
<h4 id="practica-3-camp-nou-i-filtrat-avancat">🧪 Pràctica 3 – Camp nou i filtrat avançat<a class="headerlink" href="#practica-3-camp-nou-i-filtrat-avancat" title="Permanent link">&para;</a></h4>
<ul>
<li>Afig un camp <code>category</code> al model de producte.  </li>
<li>Permet filtrar per <code>?category=bebidas</code> en el <code>GET /products</code>.</li>
</ul>
<p><strong>Criteris clau:</strong>
- Actualitzar <code>ProductCreate</code> i <code>ProductUpdate</code>
- Validar categories vàlides (<code>alimentació</code>, <code>begudes</code>, <code>altres</code>)
- Índex de cerca per <code>category</code></p>
<h4 id="practica-4-soft-delete">🧪 Pràctica 4 – Soft delete<a class="headerlink" href="#practica-4-soft-delete" title="Permanent link">&para;</a></h4>
<ul>
<li>Objectiu: implementar un sistema de <em>soft delete</em> amb un camp <code>deletedAt</code>.  </li>
<li>Els productes eliminats <strong>no s’esborren</strong>, només s’oculten per defecte.</li>
</ul>
<p><strong>Criteris clau:</strong>
- <code>DELETE /products/:id</code> → afegeix <code>deletedAt</code>
- <code>GET /products</code> → exclou elements amb <code>deletedAt</code>
- <code>GET /products?includeDeleted=true</code> → inclou tots</p>
<h4 id="practica-5-validacions-avancades-i-missatges-personalitzats">🧪 Pràctica 5 – Validacions avançades i missatges personalitzats<a class="headerlink" href="#practica-5-validacions-avancades-i-missatges-personalitzats" title="Permanent link">&para;</a></h4>
<ul>
<li>Objectiu: reforçar la seguretat i robustesa de l’API.</li>
<li>Requisits:</li>
<li>Nom mínim 3 caràcters i màxim 50</li>
<li>SKU únic i format <code>[A-Z0-9-]+</code></li>
<li>Stock ≤ 10.000</li>
<li>Missatges de validació personalitzats</li>
</ul>
<h3 id="2-reptes-oberts">💡 2. Reptes oberts<a class="headerlink" href="#2-reptes-oberts" title="Permanent link">&para;</a></h3>
<h4 id="repte-1-api-de-biblioteca">💡 Repte 1 – API de biblioteca<a class="headerlink" href="#repte-1-api-de-biblioteca" title="Permanent link">&para;</a></h4>
<ul>
<li>Recursos: <code>Books</code>, <code>Authors</code></li>
<li>Operacions: CRUD complet, filtrat per autor, gènere, any.</li>
<li>Extres: endpoint per a llibres disponibles / prestats.</li>
</ul>
<p><strong>Objectius:</strong> relacions entre col·leccions, validació, rutes RESTful.</p>
<h4 id="repte-2-api-de-comandes-duna-botiga">💡 Repte 2 – API de comandes d’una botiga<a class="headerlink" href="#repte-2-api-de-comandes-duna-botiga" title="Permanent link">&para;</a></h4>
<ul>
<li>Recursos: <code>Products</code>, <code>Orders</code>, <code>Customers</code></li>
<li>Requisits: crear comandes amb productes, calcular total automàticament.</li>
<li>Extres: endpoint <code>GET /orders/stats</code> amb vendes totals per mes.</li>
</ul>
<p><strong>Objectius:</strong> relacions 1:N i N:M, agregacions, validacions complexes.</p>
<h4 id="repte-3-api-de-notes-dalumnes">💡 Repte 3 – API de notes d’alumnes<a class="headerlink" href="#repte-3-api-de-notes-dalumnes" title="Permanent link">&para;</a></h4>
<ul>
<li>Recursos: <code>Students</code>, <code>Grades</code>, <code>Subjects</code></li>
<li>Funcions: CRUD, càlcul mitjanes automàtiques, filtrat per curs.</li>
<li>Extres: <code>GET /students/honor-roll</code> → alumnes amb mitjana &gt; 9.</li>
</ul>
<p><strong>Objectius:</strong> càlculs dinàmics i endpoints derivats.</p>
<h4 id="repte-4-api-de-tasques-i-projectes">💡 Repte 4 – API de tasques i projectes<a class="headerlink" href="#repte-4-api-de-tasques-i-projectes" title="Permanent link">&para;</a></h4>
<ul>
<li>Recursos: <code>Projects</code>, <code>Tasks</code>, <code>Users</code></li>
<li>Funcions: assignar tasques a usuaris, canviar estat (<code>pending</code>, <code>done</code>...).</li>
<li>Extres: endpoint per a percentatge de completat.</li>
</ul>
<p><strong>Objectius:</strong> disseny d’estructura, lògica de negoci i documentació.</p>
<h4 id="repte-5-api-desdeveniments-culturals">💡 Repte 5 – API d’esdeveniments culturals<a class="headerlink" href="#repte-5-api-desdeveniments-culturals" title="Permanent link">&para;</a></h4>
<ul>
<li>Recursos: <code>Events</code>, <code>Venues</code>, <code>Tickets</code></li>
<li>Funcions: CRUD complet, consulta d’entrades disponibles, aforament.</li>
<li>Extres: <code>GET /events/next</code> → pròxims 10 esdeveniments.</li>
</ul>
<p><strong>Objectius:</strong> combinar múltiples recursos i treballar amb dates.</p>
<h3 id="3-rubrica-davaluacio-de-projecte-final">📊 3. Rúbrica d’avaluació de projecte final<a class="headerlink" href="#3-rubrica-davaluacio-de-projecte-final" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Criteri</th>
<th>Insuficient (0-4)</th>
<th>Bé (5-6)</th>
<th>Notable (7-8)</th>
<th>Excel·lent (9-10)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Estructura del projecte</strong></td>
<td>Desorganitzada o incompleta</td>
<td>Correcta però poc modular</td>
<td>Bona organització, separació clara de capes</td>
<td>Excel·lent arquitectura, escalable i neta</td>
</tr>
<tr>
<td><strong>Rutes i mètodes REST</strong></td>
<td>Incomplets o incorrectes</td>
<td>Complets però amb errors</td>
<td>Complets i ben implementats</td>
<td>Complets, correctes i amb bones pràctiques REST</td>
</tr>
<tr>
<td><strong>Validacions i errors</strong></td>
<td>Inexistents o incorrectes</td>
<td>Presenten algunes mancances</td>
<td>Completes i adequades</td>
<td>Exhaustives, missatges clars i validacions avançades</td>
</tr>
<tr>
<td><strong>Lògica i funcionalitat</strong></td>
<td>Errors greus o incompliment de requisits</td>
<td>Funcionalitat bàsica</td>
<td>Funcionalitat completa i correcta</td>
<td>Lògica avançada, càlculs i relacions complexes</td>
</tr>
<tr>
<td><strong>Persistència i dades</strong></td>
<td>No persistent o mal implementada</td>
<td>Persistència funcional però limitada</td>
<td>Persistència completa i correcta</td>
<td>Persistència òptima amb índexs, agregacions i rendiment</td>
</tr>
<tr>
<td><strong>Documentació Swagger</strong></td>
<td>Inexistent o incompleta</td>
<td>Present però amb mancances</td>
<td>Completa i actualitzada</td>
<td>Excel·lent, detallada, amb exemples i components reutilitzats</td>
</tr>
<tr>
<td><strong>Proves i robustesa</strong></td>
<td>No s’han fet proves</td>
<td>Proves mínimes</td>
<td>Proves completes i correctes</td>
<td>Proves exhaustives i cobertura de casos límit</td>
</tr>
<tr>
<td><strong>Originalitat i creativitat</strong></td>
<td>Poc treball o còpia literal</td>
<td>Adaptació bàsica del projecte guia</td>
<td>Adaptació creativa amb millores</td>
<td>Projecte original, amb funcionalitats pròpies i innovadores</td>
</tr>
</tbody>
</table>
<h3 id="4-recomanacions-finals-per-al-projecte">📁 4. Recomanacions finals per al projecte<a class="headerlink" href="#4-recomanacions-finals-per-al-projecte" title="Permanent link">&para;</a></h3>
<ul>
<li>🧠 <strong>Planificació</strong>: defineix recursos, endpoints i esquemes abans de començar a programar.  </li>
<li>📚 <strong>Documentació</strong>: escriu <code>openapi.json</code> a mesura que avances, no al final.  </li>
<li>🧪 <strong>Proves constants</strong>: utilitza Postman o Thunder Client per validar cada endpoint.  </li>
<li>📦 <strong>Commits freqüents</strong>: versiona els canvis i escriu missatges clars.  </li>
<li>🚀 <strong>Millora contínua</strong>: afegeix funcionalitats addicionals si el projecte base ja funciona.</li>
</ul>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2021-2026 Aitor Medrano, Luis Alemañ, Ignasi Gomis - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>