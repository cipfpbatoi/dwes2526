
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cipfpbatoi.github.io/dwes2526/06herramientas.html">
      
      
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Ferramentes - Desenvolupament web en entorn de Servidor</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-X6D0LR7TC8"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-X6D0LR7TC8",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-X6D0LR7TC8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ferramentes" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="index.html" title="Desenvolupament web en entorn de Servidor" class="md-header__button md-logo" aria-label="Desenvolupament web en entorn de Servidor" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desenvolupament web en entorn de Servidor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ferramentes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode nit"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canviar a mode nit" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Desenvolupament web en entorn de Servidor" class="md-nav__button md-logo" aria-label="Desenvolupament web en entorn de Servidor" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    Desenvolupament web en entorn de Servidor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01arquitecturas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.- Arquitectures Web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02php.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.- Programació web amb PHP
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03MVC_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.- Arquitectura MVC amb Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04dades_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.- Accés segur i estructurat a bases de dades amb Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05seguretat_Laravel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.- Aplicacions segures i reactives en Laravel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06Nodejs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.- Desenvolupament d'APIs REST amb Node.js
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="ferramentes">Ferramentes<a class="headerlink" href="#ferramentes" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duració y criteris d'avaluació</summary>
<p>Duració estimada: 16 hores</p>
<hr />
<table>
<thead>
<tr>
<th>Resultat d'aprenentatge</th>
<th>Criteris d'avaluació</th>
</tr>
</thead>
<tbody>
<tr>
<td>4.- Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades según especificaciones.</td>
<td>g) Se han utilizado herramientas y entornos para facilitar la programación, prueba y depuración del código.</td>
</tr>
</tbody>
</table>
</details>
<p>En aquesta unitat estudiarem algunes de les eines més utilitzades en PHP.</p>
<h2 id="composer">Composer<a class="headerlink" href="#composer" title="Permanent link">&para;</a></h2>
<figure style="float: right;">
    <img src="imagenes/05/logo-composer.png" width="200">
    <figcaption>Logo Composer</figcaption>
</figure>

<p>Eina per excel·lència en PHP per a la gestió de llibreries i dependències, de manera que instal·la i les actualitza assegurant que tot l'equip de desenvolupament té el mateix entorn i versions. A més, ofereix <em>autoloading</em> del nostre codi, de manera que no hàgem de fer-lo nosaltres "a mà".</p>
<p>Està escrit en PHP, i podeu consultar tota la seua documentació en <a href="https://getcomposer.org/">https://getcomposer.org/</a>.</p>
<p>Utilitza <a href="https://packagist.org/"><em>Packagist</em></a> com a repositori de llibreries.</p>
<p>Funcionalment, és similar a Maven (Java) / npm (JS).</p>
<h3 id="installacio">Instal·lació<a class="headerlink" href="#installacio" title="Permanent link">&para;</a></h3>
<p>Si estem usant XAMPP, hem d'instal·lar <em>Composer</em> en el propi sistema operatiu. Es recomana seguir les <a href="https://getcomposer.org/doc/00-intro.md">instruccions oficials</a> segons el sistema operatiu a emprar.</p>
<p>En canvi, si usem <em>Docker</em>, necessitem modificar la configuració del nostre contenidor. En el nostre cas, hem decidit modificar l'arxiu <code>Dockerfile</code> i afegir el següent comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>composer:2.0<span class="w"> </span>/usr/bin/composer<span class="w"> </span>/usr/local/bin/composer
</code></pre></div>
<p>És important que dins del contenidor comprovem que tenim la v2:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>-V
</code></pre></div>
<h3 id="primers-passos">Primers passos<a class="headerlink" href="#primers-passos" title="Permanent link">&para;</a></h3>
<p>Quan creem un projecte per primera vegada, hem d'inicialitzar el repositori. Per a això, executarem el comando <code>composer init</code> on:</p>
<ul>
<li>Configurem el nom del paquet, descripció, autor (nom <email>), tipus de paquet (project), etc...</li>
<li>Definim les dependències del projecte (<code>require</code>) i les de desenvolupament (<code>require-dev</code>) de manera interactiva.</li>
<li>En les de desenvolupament s'indica aquelles que no s'instal·laran a l'entorn de producció, per exemple, les llibreries de proves.</li>
</ul>
<p>Després de la seua configuració, es crearà automàticament l'arxiu <code>composer.json</code> amb les dades introduïdes i descàrrega les llibreries en la carpeta <code>vendor</code>. La instal·lació de les llibreries sempre es realitza de manera local per a cada projecte.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dwes/log&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pruebas con Monolog&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nt">&quot;require&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">        </span><span class="nt">&quot;monolog/monolog&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^2.1&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nt">&quot;license&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="nt">&quot;authors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="10 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a.medrano@edu.gva.es&quot;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">]</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<p>A l'hora d'indicar cada llibreria introduirem:</p>
<ul>
<li>el nom de la llibreria, composta tant pel creador o "vendor", com pel nom del projecte. Exemples: <code>monolog/monolog</code> o <code>laravel/installer</code>.</li>
<li>
<p>la versió de cada llibreria. Tenim diverses opcions per a indicar-la:</p>
<ul>
<li>Directament: 1.4.2</li>
<li>Amb comodins: 1.</li>
<li>A partir de: &gt;= 2.0.3</li>
<li>Sense trencament de canvis: ^1.3.2 // &gt;=1.3.2 &lt;2.0.0</li>
</ul>
</li>
</ul>
<h3 id="actualitzar-llibreries">Actualitzar llibreries<a class="headerlink" href="#actualitzar-llibreries" title="Permanent link">&para;</a></h3>
<p>Podem definir les dependències via l'arxiu <code>composer.json</code> o mitjançant comandos amb el format <code>composer require vendor/package:version</code>. Per exemple, si volem afegir phpUnit com a llibreria de desenvolupament, farem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>phpunit/phpunit<span class="w"> </span>–dev
</code></pre></div>
<p>Després d'afegir noves llibreries, hem d'actualitzar el nostre projecte:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>update
</code></pre></div>
<p>Si creem l'arxiu <code>composer.json</code> nosaltres directament sense inicialitzar el repositori, hem d'instal·lar les dependències:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>install
</code></pre></div>
<p>En fer aquest pas (tant instal·lar com actualitzar), com ja hem comentat, es descarreguen les llibreries en dins de la carpeta <code>vendor</code>. És molt important afegir aquesta carpeta a l'arxiu <code>.gitignore</code> per a no pujar-les a GitHub.</p>
<p>A més es crea l'arxiu <code>composer.lock</code>, que emmagatzema la versió exacta que s'ha instal·lat de cada llibreria (aquest arxiu no es toca).</p>
<h3 id="autoloadphp"><code>autoload.php</code><a class="headerlink" href="#autoloadphp" title="Permanent link">&para;</a></h3>
<p><em>Composer</em> crea de manera automàtica en <code>vendor/autoload.php</code> el codi per a incloure de manera automàtica totes les llibreries que tinguem configurades en <code>composer.json</code>.</p>
<p>Per a utilitzar-ho, en la capçalera del nostre arxius posarem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
</code></pre></div>
<p>En el nostre cas, de moment només el podrem en els arxius on provem les classes</p>
<p>Si volem que Composer també s'encarregue de carregar de manera automàtica les nostres classes de domini, dins de l'arxiu <code>composer.json</code>, definirem la propietat <code>autoload</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">&quot;autoload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="nt">&quot;psr-4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;Dwes\\&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app/Dwes&quot;</span><span class="p">}</span>
<span class="linenos" data-linenos="3 "></span><span class="p">},</span>
</code></pre></div>
<p>Posteriorment, hem de tornar a generar el <em>autoload</em> de <em>Composer</em> mitjançant l'opció <code>dump-autoload</code> (o <code>du</code>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>dump-autoload
</code></pre></div>
<h2 id="arxius-pdf">Arxius PDF<a class="headerlink" href="#arxius-pdf" title="Permanent link">&para;</a></h2>
<p>Amb PHP podem manejar tot tipus d'arxius com ja hem vist però, què passa si volem generar fitxers PDF amb dades tretes d'una base de dades?</p>
<div class="center img-small">
    <img src="imagenes/06/06-pdf.png">
</div>

<p>Gràcies a una classe escrita en PHP, podem generar arxius PDF sense necessitat d'instal·lar llibreries addicionals en el nostre servidor.
Però anem a utilitzar una llibreria que permet transformar codi html en pdf.</p>
<h3 id="dompdf">DOMPDF<a class="headerlink" href="#dompdf" title="Permanent link">&para;</a></h3>
<p>Afegirem la llibreria de <a href="https://github.com/seldaek/monolog"><em>DOMPDF</em></a> al nostre projecte. Per a això, inclourem la llibreria en el nostre projecte amb:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>dompdf/dompdf
</code></pre></div>
Una vegada que DOMPDF està instal·lat, el procés per generar PDFs des de HTML és bastant directe. Els passos bàsics són:</p>
<p>Pas 1: Incloent DOMPDF
Primer, necessitarem incloure DOMPDF en el script PHP. Si estem utilitzant Composer, això es fa automàticament a través de l'auto-càrrega de Composer. Només cal afegir la següent línia al principi del'script:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">require &#39;vendor/autoload.php&#39;;</span>
</code></pre></div>
<p>Pas 2: Creació d'una Instància de DOMPDF
A continuació, creem una nova instància de la classe DOMPDF:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">use Dompdf\Dompdf;</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="x">$dompdf = new Dompdf();</span>
</code></pre></div>
<p>Pas 3: Carregar HTML
Després, carregem l'HTML en l'objecte DOMPDF. Això es pot fer directament com una cadena o carregant un fitxer HTML:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$html = &quot;&lt;html&gt;&lt;body&gt;Hola, això és una prova.&lt;/body&gt;&lt;/html&gt;&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$dompdf-&gt;loadHtml($html);</span>
</code></pre></div>
<p>O bé carregar un fitxer HTML:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;loadHtml(file_get_contents(&#39;path/to/your/file.html&#39;));</span>
</code></pre></div>
<p>Pas 4: Configuració de la Mida del Paper i l'Orientació
Podem configurar la mida del paper i l'orientació si és necessari:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;setPaper(&#39;A4&#39;, &#39;portrait&#39;); // o &#39;landscape&#39;</span>
</code></pre></div>
<p>Pas 5: Renderització del PDF
Ara, demanem a DOMPDF que renderitze el PDF:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;render();</span>
</code></pre></div>
<p>Pas 6: Eixida del PDF
Finalment, podem enviar el PDF al navegador, guardar-lo en un fitxer o fer amb ell el que necessitem:</p>
<p>Per mostrar-lo al navegador:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$dompdf-&gt;stream(&quot;document.pdf&quot;, array(&quot;Attachment&quot; =&gt; false));</span>
</code></pre></div>
<p>Per desar-lo en un fitxer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$output = $dompdf-&gt;output();</span>
<span class="linenos" data-linenos="2 "></span><span class="x">file_put_contents(&#39;path/to/save/document.pdf&#39;, $output);</span>
</code></pre></div>
<h5 id="consells-addicionals">Consells Addicionals<a class="headerlink" href="#consells-addicionals" title="Permanent link">&para;</a></h5>
<p>Cal assegurar-se que l'HTML és vàlid i ben format. DOMPDF intenta ser tolerant amb l'HTML, però l'HTML mal format pot causar problemes.
El CSS que s'utilitze pot afectar significativament com es veu el PDF. DOMPDF suporta una bona part de CSS 2.1, però no tot.
Si necessitem incloure imatges, cal assegurar-se que les rutes són absolutes i accessibles des del servidor on s'executa DOMPDF.
Aquesta és una guia bàsica per començar amb DOMPDF. Per a casos d'ús més avançats i opcions de configuració, cal consultar la documentació oficial de DOMPDF.</p>
<h2 id="monolog">Monolog<a class="headerlink" href="#monolog" title="Permanent link">&para;</a></h2>
<p>Provarem <em>Composer</em> afegint la llibreria de <a href="https://github.com/seldaek/monolog"><em>Monolog</em></a> al nostre projecte. Es tracta d'un llibreria per a la gestió de logs de les nostres aplicacions, suportant diferents nivells (info, warning, etc...), eixides (fitxers, sockets, BBDD, Web Services, email, etc) i formats (text pla, HTML, JSON, etc...).</p>
<p>Per a això, inclourem la llibreria en el nostre projecte amb:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>monolog/monolog
</code></pre></div>
<p>Monolog 2 requereix almenys PHP 7.2, compleix amb el estandar de logging PSR-3, i és la llibreria emprada per <em>Laravel</em> i <em>Symfony</em> per a la gestió de logs.</p>
<div class="admonition info">
<p class="admonition-title">Quan utilitzar un log</p>
<ul>
<li>Seguir les acciones/moviments dels usuaris</li>
<li>Registrar les transaccions</li>
<li>Rastrejar els errors d'usuari</li>
<li>Fallades/avisos a nivell de sistema</li>
<li>Interpretar i col·leccionar dades per a posterior investigació de patrons</li>
</ul>
</div>
<h3 id="nivells">Nivells<a class="headerlink" href="#nivells" title="Permanent link">&para;</a></h3>
<p>A continuació vam mostrar els diferents nivells de menys a més restrictiu:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>* debug -100: Informació detallada amb propòsits de debug. No usar en entorns de producció.
<span class="linenos" data-linenos="2 "></span>* info - 200: Esdeveniments interessants com l&#39;inici de sessió d&#39;usuaris.
<span class="linenos" data-linenos="3 "></span>* notice - 250: Esdeveniments normals però significatius.
<span class="linenos" data-linenos="4 "></span>* warning - 300: Ocurrències excepcionals que no arriben a ser error.
<span class="linenos" data-linenos="5 "></span>* error - 400: Errors d&#39;execució que permeten continuar amb l&#39;execució de l&#39;aplicació però que han de ser monitorats.
<span class="linenos" data-linenos="6 "></span>* critical - 500: Situacions importants on es generen excepcions no esperades o no hi ha disponible un component.
<span class="linenos" data-linenos="7 "></span>* alert - 550: S&#39;han de prendre mesures immediatament.
<span class="linenos" data-linenos="8 "></span>  Caiguda completa de la web, base de dades no disponible, etc... A més, se solen enviar missatges per email.
<span class="linenos" data-linenos="9 "></span>* emergency - 600: És l&#39;error més greu i indica que tot el sistema està inutilitzable.
</code></pre></div>
<h3 id="hola-monolog">Hola Monolog<a class="headerlink" href="#hola-monolog" title="Permanent link">&para;</a></h3>
<p>Per exemple, en l'arxiu <code>pruebaLog.php</code> que col·locaríem en l'arrel, primer incloem el <em>autoload</em>, importem els classes a utilitzar per a finalment usar els mètodes de <em>Monolog</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">include</span> <span class="no">__DIR__</span> <span class="o">.</span><span class="s2">&quot;/vendor/autoload.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ERROR&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de CRITICAL&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">alert</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ALERT&quot;</span><span class="p">);</span>
</code></pre></div>
<p>En tots els mètodes de registre de missatges (<code>debug</code>, <code>info</code>, ...), a més del propi missatge, li podem passar informació com el contingut d'alguna variable, usuari de l'aplicació, etc.. com a segon paràmetre dins d'un array, el qual es coneix com <strong>array de contexte</strong>. 
És convenient fer-ho mitjançant un array associatiu per a facilitar la lectura del log.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;datos&quot;</span> <span class="o">=&gt;</span> <span class="nv">$producto</span><span class="p">]);</span>
</code></pre></div>
<h3 id="funcionament">Funcionament<a class="headerlink" href="#funcionament" title="Permanent link">&para;</a></h3>
<p>Cada instància <code>Logger</code> té un nom de canal i una pila de manejadores (<em>handler</em>).
Cada missatge que manem al log travessa la pila de manejadores, i cadascun decideix si ha de registrar la informació, i si es dona el cas, finalitzar la propagació.
Per exemple, un <code>StreamHandler</code> en el fons de la pila que ho escriga tot en disc, i en el topall afig un <code>MailHandler</code> que envie un mail només quan hi haja un error.</p>
<h3 id="manejadors">Manejadors<a class="headerlink" href="#manejadors" title="Permanent link">&para;</a></h3>
<p>Cada manejador tambien té un formatejador (<code>Formatter</code>). Si no s'indica cap, se li assigna un per defecte. L'últim manejador inserit serà el primer a executar-se.
Després es van executant conforme a la pila.</p>
<p>Els manejadores més utilitzats són:</p>
<ul>
<li><code>StreamHandler(ruta, nivel)</code></li>
<li><code>RotatingFileHandler(ruta, maxFiles, nivel)</code></li>
<li><code>NativeMailerHandler(para, asunto, desde, nivel)</code></li>
<li><code>FirePHPHandler(nivel)</code></li>
</ul>
<p>Si volem que els missatges de l'aplicació isquen pel log del servidor,
en el nostre cas l'arxiu <code>error.log</code> de Apatxe* utilitzarem com a ruta l'eixida d'error:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// error.log</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">FirePHP</p>
<p>Per exemple, mitjançant <code>FirePHPHandler</code>, podem utilitzar <code>FirePHP</code>, la qual és una eina per a fer debug en la consola de Firefox<em>.
Després d'instal·lar l'extensió en Firefox, habilitar les opcions i configurar el </em>Handler*, podem veure els missatges acolorits amb les seues dades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiFirePHPLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Logger</span><span class="o">::</span><span class="na">INFO</span><span class="p">));</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$datos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="s2">&quot;personaje&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Batman&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="6 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<span class="linenos" data-linenos="8 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<span class="linenos" data-linenos="9 "></span><span class="c1">// ...</span>
</code></pre></div>
<p><figure style="align: center;">
    <img src="imagenes/05/firePhp.png">
    <figcaption>Ejemplo de uso de FirePHP</figcaption>
</figure></p>
</div>
<h3 id="canals">Canals<a class="headerlink" href="#canals" title="Permanent link">&para;</a></h3>
<p>Se'ls assigna en crear el <code>Logger</code>. En grans aplicacions, es crea un canal per cada subsistema: vendes, comptabilitat, magatzem.
No és una bona pràctica usar el nom de la classe com a canal, això es fa amb un processador.</p>
<p>Per al seu ús, és recomane assignar el log a una propietat privada a Logger, i posteriorment, en el constructor de la classe, assignar el canal, manejadors i format.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiApp&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</code></pre></div>
<p>I dins dels mètodes per a escriure en el log:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
</code></pre></div>
<h3 id="processadors">Processadors<a class="headerlink" href="#processadors" title="Permanent link">&para;</a></h3>
<p>Els processadors permeten afegir informació als missatges. 
Per a això, s'apilen després de cada manejador mitjançant el mètode <code>pushProcessor($processador)</code>.</p>
<p>Alguns processadors coneguts són <code>IntrospectionProcessor</code> (mostren la línia, fitxer, classe i metodo des del qual s'invoca el log), <code>WebProcessor</code> (afig la URI, mètode i IP) o <code>GitProcessor</code> (afig la branca i el commit).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">PHP</label><label for="__tabbed_1_2">Consola en format text</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">IntrospectionProcessor</span><span class="p">());</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">WARNING</span><span class="p">));</span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// no usa Introspection pq lo hemos apilado después, le asigno otro</span>
<span class="linenos" data-linenos="7 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">WebProcessor</span><span class="p">());</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>[2020-11-26T13:35:31.076138+01:00] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] {&quot;file&quot;:&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;,&quot;line&quot;:12,&quot;class&quot;:null,&quot;function&quot;:null}
<span class="linenos" data-linenos="2 "></span>[2020-11-26T13:35:31.078344+01:00] MiLogger.INFO: Esto es un mensaje de INFO [] {&quot;file&quot;:&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;,&quot;line&quot;:13,&quot;class&quot;:null,&quot;function&quot;:null}
</code></pre></div>
</div>
</div>
</div>
<h3 id="formateadores">Formateadores<a class="headerlink" href="#formateadores" title="Permanent link">&para;</a></h3>
<p>S'associen als manejadores amb <code>setFormatter</code>. Els formateadores més utilitzats són <code>LineFormatter</code>, <code>HtmlFormatter</code> o <code>JsonFormatter</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">PHP</label><label for="__tabbed_2_2">Consola en JSON</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="nv">$rfh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="nv">$rfh</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">());</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$rfh</span><span class="p">);</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span><span class="nt">&quot;context&quot;</span><span class="p">:{},</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="nt">&quot;level_name&quot;</span><span class="p">:</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">,</span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="s2">&quot;2020-11-27T15:36:52.747211+01:00&quot;</span><span class="p">,</span><span class="nt">&quot;extra&quot;</span><span class="p">:{}}</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span><span class="nt">&quot;context&quot;</span><span class="p">:{},</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="nt">&quot;level_name&quot;</span><span class="p">:</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">,</span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="s2">&quot;2020-11-27T15:36:52.747538+01:00&quot;</span><span class="p">,</span><span class="nt">&quot;extra&quot;</span><span class="p">:{}}</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Més informació</p>
<p>Més informació sobre manejadores, formateadores i processadors en <a href="https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md">https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md</a></p>
</div>
<h3 id="us-de-factories">Ús de Factories<a class="headerlink" href="#us-de-factories" title="Permanent link">&para;</a></h3>
<p>En comptes de instanciar un log en cada classe, és convenient crear una factoria (per exemple, seguint la idea del patró de disseny <a href="https://refactoring.guru/és/design-patterns/factory-method"><em>Factory Method</em></a>).</p>
<p>Per al següent exemple, suposarem que creguem la factoria en el <em>namespace</em> <code>Dwes\Exemples\Util</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Logger</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<p>Si en comptes de retornar un <code>Monolog\Logger</code> utilitzem la interfície de PSR, si en el futur canviem la implementació del log, no haurem de modificar nostre codi. Així doncs, la factoria ara retornarà <code>Psr\Log\LoggerInterface</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">use</span> <span class="nx">Psr\Log\LoggerInterface</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">LoggerInterface</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;log/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
<p>Finalment, per a utilitzar la factoria, només canviem el codi que teníem en el constructor de les classes que usen el log, quedant alguna cosa asi:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Dwes\Ejemplos\Util\LogFactory</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">private</span> <span class="nv">$codigo</span><span class="p">;</span> 
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">private</span> <span class="nx">Logger</span> <span class="nv">$log</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$codigo</span><span class="p">){</span> 
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="o">=</span><span class="nv">$codigo</span><span class="p">;</span> 
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="o">=</span> <span class="nx">LogFactory</span><span class="o">::</span><span class="na">getLogger</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="c1">/// ... resto del código</span>
<span class="linenos" data-linenos="21 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="documentacion-con-phpdocumentor">Documentación con <em>phpDocumentor</em><a class="headerlink" href="#documentacion-con-phpdocumentor" title="Permanent link">&para;</a></h2>
<p><a href="https://www.phpdoc.org/">phpDocumentor</a> és l'eina per a documentar el codi PHP. És similar en propòsit i funcionament a <em>Javadoc</em>.</p>
<p>Així doncs, és un eina que facilita la documentació del codi PHP, creant un lloc web amb l'API de l'aplicació.</p>
<p>Es basa en l'ús d'anotacions sobre els docblocks. Per a posar-ho en marxa, en el nostre cas ens decantarem per utilitzar la imatge que ja existeix de Docker.</p>
<h3 id="installacio_1">Instal·lació<a class="headerlink" href="#installacio_1" title="Permanent link">&para;</a></h3>
<h5 id="pas-1-installacio-amb-docker">Pas 1: Instal·lació amb Docker<a class="headerlink" href="#pas-1-installacio-amb-docker" title="Permanent link">&para;</a></h5>
<p>Primer, cal assegurar-se tenir Docker instal·lat i funcionant al  sistema. Després, s'ha de descarregar i executar el contenidor de phpDocumentor utilitzant la següent comanda:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker<span class="w"> </span>pull<span class="w"> </span>phpdoc/phpdoc
</code></pre></div>
<h5 id="pas-2-generacio-de-documentacio">Pas 2: Generació de Documentació<a class="headerlink" href="#pas-2-generacio-de-documentacio" title="Permanent link">&para;</a></h5>
<p>Un cop tinguem la imatge, podem utilitzar-la per generar la documentació. El procés bàsic implica muntar els fitxers de codi dins del contenidor Docker i executar phpDocumentor sobre aquests fitxers.</p>
<p>Ací hi ha un exemple de com fer-ho:</p>
<p>En el cas d'usar <em>Docker</em>, usarem el següent comando per a executar-lo (crea el contenidor, executa el comando que li demanem, i automàticament l'esborra):</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/data<span class="w"> </span>phpdoc/phpdoc:latest<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>/data/src<span class="w"> </span>-t<span class="w"> </span>/data/docs
</code></pre></div>
Aquesta comanda fa el següent:</p>
<p>--rm: Això elimina el contenidor després d'executar-lo, així no es queden contenidors inactius.
-v $(pwd):/data: Munta el directori actual del teu sistema ($(pwd)) al directori /data dins del contenidor. Hauràs de reemplaçar $(pwd) amb el camí on està el teu codi font si no estàs executant aquesta comanda des del directori del teu projecte.
-d /data/src: Especifica el directori dins del contenidor on es troba el teu codi font. Reemplaça /data/src amb el camí corresponent dins del contenidor si és diferent.
-t /data/docs: Especifica on vols que es generi la documentació dins del contenidor. En aquest cas, es generarà dins de /data/docs.</p>
<h5 id="pas-3-acces-a-la-documentacio-generada">Pas 3: Accés a la Documentació Generada<a class="headerlink" href="#pas-3-acces-a-la-documentacio-generada" title="Permanent link">&para;</a></h5>
<p>Una vegada generada, la documentació estarà dins del directori que especificat (en aquest cas, <code>docs</code> dins del directori docs de projecte). Pots obrir els fitxers HTML amb qualsevol navegador per veure la documentació.</p>
<h3 id="docblock">DocBlock<a class="headerlink" href="#docblock" title="Permanent link">&para;</a></h3>
<p>Un <em>docblock</em> és el bloc de codi que es col·loca damunt d'un recurs. El seu format és:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 3 "></span><span class="sd">* Sumari*, una sola línia</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd">* Descripció* que pot utilitzar diverses línies</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd">* i que ofereix detalls de l&#39;element o referències</span>
<span class="linenos" data-linenos=" 7 "></span><span class="sd">* per a ampliar la informació</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="sd">* @param string $miArgumento amb una descripció* de l&#39;argument</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">* que pot usar diverses línies.</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="sd">* @return void</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">*/</span>
<span class="linenos" data-linenos="14 "></span><span class="k">function</span> <span class="nf">miFuncion</span><span class="p">(</span><span class="nx">tipo</span> <span class="nv">$miArgumento</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="documentant-el-codi">Documentant el codi<a class="headerlink" href="#documentant-el-codi" title="Permanent link">&para;</a></h3>
<p>En tots els elements, ademas del sumari i/o descripció, posarem:</p>
<ul>
<li>En les classes:<ul>
<li><code>@author</code> nom <email></li>
<li><code>@package</code> ruta del namespace</li>
</ul>
</li>
<li>En les propietats:<ul>
<li><code>@var</code> tipus descripció</li>
</ul>
</li>
<li>En els mètodes:<ul>
<li><code>@param</code> tipus $nomene descripció</li>
<li><code>@throws</code> ClaseException descripció</li>
<li><code>@return</code> tipus descripció</li>
</ul>
</li>
</ul>
<p>Vegem-ho amb un exemple. Suposem que tenim una classe que representa un client:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 3 "></span><span class="sd">* Classe que representa un client</span>
<span class="linenos" data-linenos=" 4 "></span><span class="sd">* </span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd">* El client s&#39;encarrega d&#39;emmagatzemar els suports que té llogat,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd">* de manera que podem llogar i retornar productes mitjançant les operacions</span>
<span class="linenos" data-linenos=" 7 "></span><span class="sd">* homònimes.</span>
<span class="linenos" data-linenos=" 8 "></span><span class="sd">* </span>
<span class="linenos" data-linenos=" 9 "></span><span class="sd">* @package Dwes\Videoclub\Model</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">* @author Aitor Medrano &lt;a.medrano@edu.gva.es&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">*/</span>
<span class="linenos" data-linenos="12 "></span><span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span> 
<span class="linenos" data-linenos="15 "></span>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$numero</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="18 "></span><span class="sd">    * Colecció de soports alquilats</span>
<span class="linenos" data-linenos="19 "></span><span class="sd">    * @var array&lt;Soporte&gt; </span>
<span class="linenos" data-linenos="20 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">private</span> <span class="nv">$soportesAlquilados</span><span class="p">[];</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    <span class="o">/*</span>
<span class="linenos" data-linenos="24 "></span>    <span class="o">*</span> <span class="nx">Comprova</span> <span class="nx">si</span> <span class="nx">el</span> <span class="nx">suport</span> <span class="nx">rebut</span> <span class="nx">ja</span> <span class="nx">el</span> <span class="nx">té</span> <span class="nx">llogat</span> <span class="nx">el</span> <span class="nx">client</span>
<span class="linenos" data-linenos="25 "></span>    <span class="o">*</span> <span class="o">@</span><span class="nx">param</span> <span class="nx">Suport</span> <span class="nv">$suporte</span> <span class="nx">Suport</span> <span class="nx">a</span> <span class="nx">comprovar</span>
<span class="linenos" data-linenos="26 "></span>    <span class="o">*</span> <span class="o">@</span><span class="k">return</span> <span class="nx">bool</span> <span class="k">true</span> <span class="nx">si</span> <span class="nx">ho</span> <span class="nx">té</span> <span class="nx">llogat</span>
<span class="linenos" data-linenos="27 "></span>    <span class="o">/</span>
<span class="linenos" data-linenos="28 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">tieneAlquilado</span><span class="p">(</span><span class="nx">Soporte</span> <span class="nv">$soporte</span><span class="p">)</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span> 
<span class="linenos" data-linenos="29 "></span>        <span class="c1">// ...</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
</code></pre></div>
<p>Si generem la documentació i obrim amb un navegador l'arxiu <code>docs/api/index.html</code> podrem navegar fins a la classe `Client:</p>
<figure style="align: center;">
    <img src="imagenes/05/phpdoc.png">
    <figcaption>phpDocumentor de Cliente</figcaption>
</figure>

<h2 id="web-scraping"><em>Web Scraping</em><a class="headerlink" href="#web-scraping" title="Permanent link">&para;</a></h2>
<p>Consisteix a navegar a una pàgina web i extraure informació automàticament, a partir del codi HTML generat, i organitzar la informació pública disponible en Internet.
Aquesta pràctica requereix l'ús d'una llibreria que facilite la descàrrega de la informació desitjada imitant la interacció d'un navegador web. Aquest "robot" pot accedir a diverses pàgines simultàniament.</p>
<div class="admonition question">
<p class="admonition-title">¿És legal?</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Si el lloc web indica que té el contingut protegit per drets d&#39;autor o en les normes d&#39;accés via usuari/contrasenya ens avisa de la seua prohibició, estaríem incorrent en un delicte.
<span class="linenos" data-linenos="2 "></span>És recomanable estudiar l&#39;arxiu `robots.txt` que es troba en l&#39;arrel de cada lloc web.
<span class="linenos" data-linenos="3 "></span>Més informació en l&#39;article [El manual complet per al web scraping legal i ètic en 2021](https://ichi.pro/es/el-manual-completo-para-el-web-scraping-legal-y-etico-en-2021-69178542830388)
</code></pre></div>
</div>
<h3 id="goutte">Goutte<a class="headerlink" href="#goutte" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/FriendsOfPHP/Goutte">Goutte</a> és un senzill client HTTP per a PHP creat específicament per a fer web scraping. Ho va desenvolupar el mateix autor del framework <em>Symfony</em> i ofereix un API senzilla per a extraure dades de les respostes HTML/XML dels llocs web.</p>
<p>Els components principals que abstrau <em>Goutte</em> sobre <em>Symfony</em> són:</p>
<ul>
<li><code>BrowserKit</code>: simula el comportament d'un navegador web.</li>
<li><code>CssSelector</code>: tradueix consultes CSS en consultes XPath.</li>
<li><code>DomCrawler</code>: facilita l'ús del DOM i XPath.</li>
</ul>
<p>Per a poder utilitzar <em>Goutte</em> en el nostre projecte, executarem el següent comando en el terminal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>fabpot/goutte
</code></pre></div>
<h3 id="goutte-con-selectores-css">Goutte con selectores CSS<a class="headerlink" href="#goutte-con-selectores-css" title="Permanent link">&para;</a></h3>
<p>A continuació farem un exemple molt senzill utilitzant els selectors CSS, extraient informació de la web <code>https://books.toscrape.com/</code>, la qual és una pàgina per a proves que no rebutjarà les nostres peticions.</p>
<p>Després de crear un client amb <em>Goutte</em>, hem de realitzar un petició a una URL. Amb la resposta obtinguda, podem utilitzar el mètode <code>filter</code> per a indicar-li la ruta CSS que volem recórrer i iterar sobre els resultats mitjançant una funció anònima. Una vegada estem dins d'un determinat node, el mètode <code>text()</code> ens retornarà el contingut del propi node.</p>
<p>En concret, ficarem en un array associatiu el títol i el preu de tots els llibres de la categoria <em>Classics</em>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">$httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Goutte\Client</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/classics_6/index.html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// colocamos los precios en un array</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="c1">// le pasamos $precios por referencia para poder editarla dentro del closure</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="c1">// colocamos el nombre y el precio en un array asociativo</span>
<span class="linenos" data-linenos="16 "></span><span class="nv">$contadorPrecios</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span><span class="nv">$libros</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="18 "></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article h3 a&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$precios</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$contadorPrecios</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$libros</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>        <span class="nv">$libros</span><span class="p">[</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">()]</span> <span class="o">=</span> <span class="nv">$precios</span><span class="p">[</span><span class="nv">$contadorPrecios</span><span class="p">];</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$contadorPrecios</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span><span class="p">);</span>
</code></pre></div>
<h3 id="crawler">Crawler<a class="headerlink" href="#crawler" title="Permanent link">&para;</a></h3>
<p>Un cas molt comú és obtindre la informació d'una pàgina que té els resultats paginados, de manera que anem recorrent els enllaços i accedint a cadascun dels resultats.</p>
<p>En aquest cas agafarem tots els preus dels llibres de fantasia, i els sumarem:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Goutte\Client</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpClient\HttpClient</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nx">HttpClient</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">]));</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="nv">$salir</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="13 "></span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$salir</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>            <span class="nv">$texto</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span>            <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$texto</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Le quitamos las libras ¿2 posiciones?</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="nv">$enlace</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$enlace</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="c1">// el enlace next existe</span>
<span class="linenos" data-linenos="25 "></span>        <span class="nv">$sigPag</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="linenos" data-linenos="26 "></span>        <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$sigPag</span><span class="p">);</span> <span class="c1">// hacemos click</span>
<span class="linenos" data-linenos="27 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="28 "></span>        <span class="c1">// ya no hay enlace next</span>
<span class="linenos" data-linenos="29 "></span>        <span class="nv">$salir</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span><span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="nv">$precioTotal</span> <span class="o">=</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$precios</span><span class="p">);</span>
<span class="linenos" data-linenos="34 "></span><span class="k">echo</span> <span class="nv">$precioTotal</span><span class="p">;</span>
</code></pre></div>
<h2 id="proves-amb-codeception">Proves amb Codeception<a class="headerlink" href="#proves-amb-codeception" title="Permanent link">&para;</a></h2>
<p>El curs passat, dins del mòdul de Entorns de Desenvolupament*, estudiarieu la importància de la realització de proves, així com les proves unitàries mitjançant <a href="https://junit.org/junit5/">JUnit</a>.</p>
<figure style="float: right;">
    <img src="imagenes/05/tdd.png" width="300">
    <figcaption>Test Driven Development</figcaption>
</figure>

<p>Hui dia és de gran importància seguir una bona metodologia de proves, sent el desenvolupament dirigit per les proves (Test Driven Development / TDD) un dels enfocaments més emprats, el qual consisteix en:</p>
<ol>
<li>Escriure el test, i com no hi ha codi implementat, la prova falle (roig).</li>
<li>Escriure el codi d'aplicació perquè la prova funcione (verda).</li>
<li>refactoritzar el codi de l'aplicació amb l'ajuda de la prova per a comprovar que no trenquem res (refactor).</li>
</ol>
<p>En el cas de PHP, l'eina que s'utilitza és <em>PHPUnit</em> (<a href="https://phpunit.de/">https://phpunit.de/</a>), que com el seu nom indica, està basada en JUnit. La versió actual és la 9.0.
També podem utilitzar <em>Codeception</em> (<a href="https://codeception.com/">https://codeception.com/</a>) que inclou <em>PHPUnit</em>.</p>
<h3 id="introduccio-a-codeception">Introducció a Codeception<a class="headerlink" href="#introduccio-a-codeception" title="Permanent link">&para;</a></h3>
<p>Codeception és una eina de proves per a PHP que inclou suport per a proves unitàries, funcionals, d'acceptació i API. Per més informació, pots consultar la seua documentació oficial a Codeception.</p>
<h4 id="installacio-i-configuracio">Instal·lació i Configuració<a class="headerlink" href="#installacio-i-configuracio" title="Permanent link">&para;</a></h4>
<p>Per començar amb Codeception, afegeix-lo com a dependència de desenvolupament en el teu composer.json:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">&quot;require-dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="nt">&quot;codeception/codeception&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.0&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="p">},</span>
<span class="linenos" data-linenos="4 "></span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="5 "></span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;codecept run --colors&quot;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<p>També pots instal·lar-lo directament des del terminal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer<span class="w"> </span>require<span class="w"> </span>--dev<span class="w"> </span>codeception/codeception<span class="w"> </span>^4.0
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Llibreries de desenvolupament</p>
</div>
<p>Les llibreries que es col·loquen en <code>require-dev</code> són les de desenvolupament i <em>testing</em>, de manera que no s'instal·laran en un entorn de producció.</p>
<p>Una vegada instal·lat, executa vendor/bin/codecept bootstrap per inicialitzar la configuració bàsica.</p>
<h5 id="estructura-de-carpetes">Estructura de Carpetes<a class="headerlink" href="#estructura-de-carpetes" title="Permanent link">&para;</a></h5>
<p>Codeception organitza les proves en diverses carpetes segons el tipus de prova: 
tests/unit, tests/functional, tests/acceptance.</p>
<h5 id="exemple-de-prova-unitaria">Exemple de Prova Unitària<a class="headerlink" href="#exemple-de-prova-unitaria" title="Permanent link">&para;</a></h5>
<p>A continuació, un exemple de com escriure una prova unitària en Codeception:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">tests\unit</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">class</span> <span class="nc">PilaTest</span> <span class="k">extends</span> <span class="nx">\Codeception\Test\Unit</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPushAndPop</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$pila</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$pila</span><span class="p">,</span> <span class="s1">&#39;batman&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;batman&#39;</span><span class="p">,</span> <span class="nv">$pila</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
<span class="linenos" data-linenos="13 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;batman&#39;</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="p">}</span>
</code></pre></div>
<h5 id="execucio-de-proves">Execució de Proves<a class="headerlink" href="#execucio-de-proves" title="Permanent link">&para;</a></h5>
<p>Per executar les proves, pots utilitzar les comandes següents:</p>
<p>vendor/bin/codecept run (executa totes les proves)
vendor/bin/codecept run unit (executa només proves unitàries)
vendor/bin/codecept run --testdox --colors (mostra els resultats en format més llegible)</p>
<h3 id="dissenyant-proves">Dissenyant proves<a class="headerlink" href="#dissenyant-proves" title="Permanent link">&para;</a></h3>
<p>Tal com hem vist en l'exemple, la classe de prova ha d'heretar de <code>\Codeception\Test\Unit</code>, i el nom de la classe ha d'acabar en <code>Test</code>, d'aquí ve que hàgem anomenat la classe de prova com <code>PilaTest</code>.
Una prova implica un mètode de prova (públic) per cada funcionalitat a provar. Cada un dels mètodes se'ls associa un cas de prova.
Els mètodes han de nomenar-se amb el prefix <code>test</code>, per exemple, <code>testPushAndPop</code>. És molt important que el nom siga molt clar i descriptiu del propòsit de la prova. (<em>camelCase</em>).
En els casos de prova prepararem diverses assercions per a tota la casuística: rangs de valors, tipus de dades, excepcions, etc...</p>
<h3 id="assercions">Assercions<a class="headerlink" href="#assercions" title="Permanent link">&para;</a></h3>
<p>Les assercions permeten comprovar el resultat dels mètodes que volem provar. Les assercions esperen que el predicat sempre siga vertader.</p>
<p>PHPUnit ofereix les següent assercions:</p>
<ul>
<li><code>assertTrue</code> / <code>assertFalse</code>: Comprova que la condició donada siga avaluada com true / false</li>
<li><code>assertEquals</code> / <code>assertSame</code>: Comprova que dues variables siguen iguals</li>
<li><code>assertNotEquals</code> / <code>assertNotSame</code>: Comprova que dues variables NO siguen iguals</li>
<li><code>Same</code> → comprova els tipus. Si no coincideixen els tipus i els valors, l'asserció fallarà</li>
<li><code>Equals</code> → sense comprovació estricta</li>
<li><code>assertArrayHasKey</code> / <code>assertArrayNotHasKey</code>: Comprova que un array posseïsca un <em>key</em> determinat / o NO ho posseïsca</li>
<li><code>assertArraySubset</code>: Comprova que un array posseïsca un altre array com subset del mateix</li>
<li><code>assertAttributeContains</code> / <code>assertAttributeNotContains</code>: Comprova que un atribut d'una classe continga una variable determinada / o NO continga una variable determinada</li>
<li><code>assertAttributeEquals</code>: Comprova que un atribut d'una classe siga igual a una variable determinada.</li>
</ul>
<h3 id="comparant-leixida">Comparant l'eixida<a class="headerlink" href="#comparant-leixida" title="Permanent link">&para;</a></h3>
<p>Si els mètodes a provar generen contingut mitjançant <code>echo</code> o una instrucció similar, disposem de les següent expectatives:</p>
<ul>
<li><code>expectOutputString(salidaEsperada)</code></li>
<li><code>expectOutputRegex(expresionRegularEsperada)</code></li>
</ul>
<p>Les expectatives difereixen de les assercions que informen del resultat que s'espera abans d'invocar al mètode. Després de definir l'expectativa, s'invoca al mètode que realitza el <code>echo</code>/<code>print</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">namespace</span> <span class="nx">Dwes\Videoclub\Model</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Dwes\Videoclub\Model\CintaVideo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">CintaVideoTest</span> <span class="k">extends</span> <span class="nx">TestCase</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConstructor</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span> 
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span> <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">getNumero</span><span class="p">(),</span> <span class="mi">23</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testMuestraResumen</span><span class="p">()</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$resultado</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span>        <span class="nv">$resultado</span> <span class="o">.=</span> <span class="s2">&quot;&lt;br&gt;Los cazafantasmas&lt;br&gt;3.5 (IVA no incluido)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="nv">$resultado</span> <span class="o">.=</span> <span class="s2">&quot;&lt;br&gt;Duración: 107 minutos&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>        <span class="c1">// definimos la expectativa</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>        <span class="c1">// invocamos al método que hará echo</span>
<span class="linenos" data-linenos="23 "></span>        <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">muestraResumen</span><span class="p">();</span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="p">}</span>
</code></pre></div>
<h5 id="proveidors-de-dades">Proveïdors de Dades<a class="headerlink" href="#proveidors-de-dades" title="Permanent link">&para;</a></h5>
<p>Els providers en Codeception s'utilitzen principalment per a provar amb diferents conjunts de dades utilitzant el mateix test. Aquí tens una guia bàsica de com utilitzar-los:</p>
<p>Definir el Provider: Primer, has de definir una funció que retorni un array de dades. Aquesta funció és el teu provider. Per exemple:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function myDataProvider() {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">return [</span>
<span class="linenos" data-linenos="3 "></span><span class="x">[&#39;data1&#39;, &#39;result1&#39;],</span>
<span class="linenos" data-linenos="4 "></span><span class="x">[&#39;data2&#39;, &#39;result2&#39;]</span>
<span class="linenos" data-linenos="5 "></span><span class="x">];</span>
<span class="linenos" data-linenos="6 "></span><span class="x">}</span>
</code></pre></div>
<p>Utilitzar el Provider en un Test: Després, pots utilitzar aquest provider en un mètode de prova, passant el nom de la funció provider com a anotació. Per exemple:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">/**</span>
<span class="linenos" data-linenos="2 "></span><span class="x">* @dataProvider myDataProvider</span>
<span class="linenos" data-linenos="3 "></span><span class="x">  */</span>
<span class="linenos" data-linenos="4 "></span><span class="x">  public function testMyFunction($input, $expected) {</span>
<span class="linenos" data-linenos="5 "></span><span class="x">  $result = myFunction($input);</span>
<span class="linenos" data-linenos="6 "></span><span class="x">  $this-&gt;assertEquals($expected, $result);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">  }</span>
</code></pre></div>
<p>En aquest exemple, testMyFunction s'executarà múltiples vegades amb cada conjunt de dades proporcionat per myDataProvider. Això és especialment útil quan vols provar una funció o mètode amb diferents valors d'entrada i verificar si el resultat és el que esperes en cada cas.</p>
<h3 id="provant-excepcions">Provant excepcions<a class="headerlink" href="#provant-excepcions" title="Permanent link">&para;</a></h3>
<p>Les proves a més de comprovar que les classes funcionen com s'espera, han de cobrir tots els casos possibles. Així doncs, hem de poder fer proves que esperen que es llance una excepció (i que el missatge continga una certa informació):</p>
<p>Per a això, s'utilitzen les següent expectatives:</p>
<ul>
<li><code>expectException(Excepcion::class)</code></li>
<li><code>expectExceptionCode(codigoExcepcion)</code></li>
<li><code>expectExceptionMessage(missatge)</code></li>
</ul>
<p>De la mateixa manera que abans, primer es posa l'expectativa, i després es provoca que es llance l'excepció:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testAlquilarCupoLleno</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$soporte1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span> 
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$soporte2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Juego</span><span class="p">(</span><span class="s2">&quot;The Last of Us Part II&quot;</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mf">49.99</span><span class="p">,</span> <span class="s2">&quot;PS4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$soporte3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;Origen&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;es,en,fr&quot;</span><span class="p">,</span> <span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$soporte4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;El Imperio Contraataca&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;es,en&quot;</span><span class="p">,</span><span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$cliente1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cliente</span><span class="p">(</span><span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span> 
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte1</span><span class="p">);</span> 
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte2</span><span class="p">);</span> 
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte3</span><span class="p">);</span> 
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">CupoSuperadoException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte4</span><span class="p">);</span> 
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://desarrolloweb.com/manuales/tutorial-composer.html">Tutorial de Composer</a></li>
<li><a href="https://www.freecodecamp.org/news/web-scraping-with-php-crawl-web-pages/">Web Scraping with PHP – How to Crawl Web Pages Using Open Source Tools</a></li>
<li><a href="https://zetcode.com/php/monolog/">PHP Monolog</a></li>
<li><a href="https://codeception.com/">Codeception</a></li>
</ul>
<h3 id="projecte-batoibook">Projecte Batoi/Book<a class="headerlink" href="#projecte-batoibook" title="Permanent link">&para;</a></h3>
<h4 id="exercicis">Exercicis<a class="headerlink" href="#exercicis" title="Permanent link">&para;</a></h4>
<ol start="501">
<li>Instal.la el monolog i el dompdf en el projecte Book.</li>
<li>
<p>Afegirem un canal per control·lar els accesos a la pàgina web de BatoiBooks.</p>
<ul>
<li>Afegirem el log al login i al register, amb el nom del canal <code>AccesLogger</code>.</li>
<li>S'ha d'emmagatzemar en <code>logs/acces.log</code> mostrant tots els missatges des de <em>debug</em>.</li>
<li>
<p>Dins de la classe User anem a :</p>
</li>
<li>
<p>Quan un usuari es logueja correctament, ha d'escriure un log de tipus <em>info</em>.</p>
</li>
<li>Quan un usuari es deslogueja, ha d'escriure un log de tipus <em>info</em>.</li>
<li>Quan un usuari fa un accés sense exit s'ha d'escriure un log de tipus <em>warning</em>.</li>
<li>Quan un usuari es registra, s'ha d'escriure un log de tipus <em>info</em>.</li>
</ul>
</li>
<li>
<p>Crea una classe MyLog per centralitzar la creació dels logs i utilitza-la amb els exercicis anteriors.</p>
</li>
<li>Crea un enllaç en cada llibre de la pàgina de myBooks per imprimir un llibre en un PDF.</li>
<li>Instal·la el phpdocs utilitzant el composer</li>
<li>Documenta la classe Book.</li>
<li>Fes que la documentació del directori <code>app</code> es puga veure en la pàgina web en el directori <code>docs</code>.</li>
</ol>
<h4 id="activitats">Activitats<a class="headerlink" href="#activitats" title="Permanent link">&para;</a></h4>
<ol start="521">
<li>Guarda en books.log els llibres que s'ha donat d'alta en la pàgina web. Del llibre es vol guarda el ID, nombre del llibre i usuari que la donat d'alta.</li>
<li>Fes que totes les exempcions que es llancen en la pàgina web es guarden en un fitxer <code>exceptions.log</code> en el directori <code>logs</code> i es pugen vore amb el FirePHP.</li>
<li>Crea un botó en la pàgina <code>myBooks.php</code> que genere un document pdf amb una taula amb els llibres de l'usuari.</li>
<li>Documenta totes les classes.</li>
<li>Fes que la api <code>books.php</code> retorne tots els llibres si no se li pasa una id.</li>
<li>
<p>L'editorial McGrawHill ha decidit donar un descompte del 10% al CIPFP Batoi a la familia d'Informàtica. La informació està a la pàgina https://www.mheducation.es/escolar/ciclos-formativos/familia-profesional-informatica.</p>
<ul>
<li>Crea els llibres guardan la següent informació:</li>
<li>El módul l'hauràs de buscar per la descripció en la BD.</li>
<li>El preu amb el descompte.</li>
<li>En observacions va el contingut del llibre.</li>
<li>Les pàgines seran 200.
526. </li>
</ul>
</li>
</ol>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2021-2026 Aitor Medrano, Luis Alemañ, Ignasi Gomis - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>